import { Config, SondaVitePlugin } from "sonda";

//#region src/entrypoints/astro.ts
function SondaAstroPlugin(userOptions = {}) {
	const options = new Config(userOptions, {
		integration: "astro",
		filename: "sonda_[env]_[index]"
	});
	if (!options.enabled) return {
		name: "sonda/astro",
		hooks: {}
	};
	return {
		name: "sonda/astro",
		hooks: { "astro:build:setup"({ vite, target }) {
			if (target === "server" && !options.server) return;
			const sondaOptions = options.clone();
			sondaOptions.filename = sondaOptions.filename.replace("[env]", target);
			vite.plugins ??= [];
			vite.plugins.push({
				...SondaVitePlugin(sondaOptions),
				name: "sonda/astro"
			});
		} }
	};
}

//#endregion
export { SondaAstroPlugin as default };