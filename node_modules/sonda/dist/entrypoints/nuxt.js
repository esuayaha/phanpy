import { Config, SondaVitePlugin } from "sonda";

//#region src/entrypoints/nuxt.ts
function SondaNuxtPlugin(userOptions = {}) {
	return function SondaNuxtPlugin$1(_, nuxt) {
		const options = new Config(userOptions, {
			integration: "nuxt",
			filename: "sonda_[env]_[index]"
		});
		if (!options.enabled) return;
		nuxt.hook("vite:extendConfig", (config, { isClient, isServer }) => {
			const env = isClient ? "client" : "nitro";
			if (isServer && !options.server) return;
			const sondaOptions = options.clone();
			sondaOptions.filename = sondaOptions.filename.replace("[env]", env);
			config.plugins ??= [];
			config.plugins.push({
				...SondaVitePlugin(sondaOptions),
				name: "sonda/nuxt"
			});
		});
	};
}

//#endregion
export { SondaNuxtPlugin as default };