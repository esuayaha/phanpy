{"version":3,"mappings":"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","names":["functionDebounce","debounce","fn","wait","callFirst","timeout","debouncedFn","clear","flush","call","debounceWrapper","context","args","callNow","window","document","event","params","evt","handleTouchStart","handleTouchMove","handleTouchEnd","xDown","yDown","xDiff","yDiff","timeDown","startEl","touchCount","e","swipeThreshold","getNearestAttribute","swipeUnit","swipeTimeout","timeDiff","eventType","changedTouches","eventData","xUp","yUp","el","attributeName","defaultValue","attributeValue","usePageVisibility","deps","savedCallback","useRef","useEffect","current","handleVisibilityChange","hidden","visibilityState","console","addEventListener","STREAMING_TIMEOUT","POLL_INTERVAL","BackgroundService","memo","isLoggedIn","t","_useLingui","visible","setVisible","useState","visibleTimeout","clearTimeout","setTimeout","checkLatestNotification","masto","instance","skipCheckMarkers","states","notificationsLast","notificationsIterator","v1","notifications","list","limit","sinceId","id","values","value","next","length","notificationsShowNew","lastReadId","markers","fetch","timeline","sub","streamTimeout","pollNotifications","streaming","api","hasStreaming","user","notification","subscribe","entry","skipThreading","unsubscribe","clearInterval","r","info","useInterval","checkForUpdates","lastCheckDate","now","appVersion","currentCloakMode","_t","useHotkeys","showToast","fetchLatestPostsMemoized","pmem","currentAccountID","statusesIterator","accounts","$select","statuses","exclude_replies","exclude_reblogs","expires","ComposeButton","snapStates","useSnapshot","menuOpen","setMenuOpen","latestPosts","setLatestPosts","loadingPosts","setLoadingPosts","buttonRef","menuRef","columnMode","settings","shortcutsViewMode","handleButton","key","toLowerCase","composerState","minimized","openOSK","composeDataElements","querySelectorAll","opts","JSON","parse","undefined","shiftKey","openCompose","showCompose","useKey","ignoreEventWhen","querySelector","metaKey","ctrlKey","altKey","bindLongPress","useLongPress","threshold","fetchLatestPosts","useCallback","getCurrentAccountID","posts","handleReplyToPost","post","replyToStatus","_jsxs","_Fragment","children","_jsx","ref","type","onClick","onContextMenu","preventDefault","class","publishing","publishingError","Icon","icon","size","alt","ControlledMenu","state","anchorRef","onClose","direction","gap","unmountOnClose","portal","target","body","boundingBoxPadding","safeBoundingBoxPadding","containerProps","style","zIndex","closeMenu","submenuOpenDelay","MenuLink","to","_Trans","MenuDivider","SubMenu2","align","shift","disabled","label","className","map","createdDate","Date","createdAt","isWithinDay","getTime","MenuItem","statusPeek","RelativeTime","datetime","format","dateTime","toISOString","title","toLocaleString","niceDateTime","SequentialKeys","key1","key2","components","0","1","KeyboardShortcutsHelp","showKeyboardShortcutsHelp","test","hash","Modal","tabindex","keys","action","2","parents","coords","siblings","animations","intersections","mutationObservers","intervals","options","debounces","enabled","root","scrollX","scrollY","TGT","DEL","NEW","handleMutations","mutations","elements","getElements","animate","handleResizes","entries","updateAllPos","updatePos","isOffscreen","rect","vw","vh","observePosition","oldObserver","invocations","buffer","getCoords","offsetWidth","offsetHeight","rootMargin","px","observer","optionsOrPlugin","getOptions","delay","isPlugin","currentAnimation","parent","forEach","lowPriority","poll","callback","resize","supportedBrowser","nodes","mutation","node","i","child","_a","_b","isMounted","preExisting","add","remain","remove","raw","str","getScrollOffset","p","x","y","getTransitionSizes","oldCoords","newCoords","widthFrom","heightFrom","widthTo","heightTo","styles","paddingY","paddingX","getTarget","isEnabled","callbacks","getPluginTuple","pluginReturn","config","animation","pluginOrOptions","deltaLeft","deltaTop","deltaRight","start","end","keyframes","cleanUp","prev","finalX","finalY","top","left","width","height","deletePosition","adjustScroll","styleReset","scrollDeltaX","scrollDeltaY","scrollBefore","lastHeight","lastWidth","startScroll","smoothScroll","deltaY","deltaX","offsetParent","parentStyles","parentCoords","autoAnimate","element","mo","a","d","io","useAutoAnimate","controller","setController","setEnabled","dec2hex","dec","toString","slice","verifier","array","Uint32Array","crypto","getRandomValues","Array","from","join","sha256","plain","data","TextEncoder","encode","subtle","digest","base64urlencode","bytes","Uint8Array","len","byteLength","String","fromCharCode","btoa","replace","generateCodeChallenge","v","hashed","supportsPKCE","instanceURL","res","ok","status","json","code_challenge_methods_supported","includes","__generateCodeChallenge","DEV","PHANPY_CLIENT_NAME","CLIENT_NAME","PHANPY_WEBSITE","WEBSITE","import","SCOPES","sameSite","location","hostname","currentLocation","origin","pathname","REDIRECT_URI","registerApplication","registrationParams","URLSearchParams","client_name","redirect_uris","scopes","website","method","headers","getPKCEAuthorizationURL","client_id","forceLogin","codeVerifier","codeChallenge","code_challenge_method","code_challenge","redirect_uri","response_type","append","getAuthorizationURL","authorizationParams","scope","getAccessToken","client_secret","code","code_verifier","grant_type","tokenResponse","tokenJSON","token","revokeResponse","isStandalone","matchMedia","matches","Accounts","getAccounts","currentAccount","moreThanOneAccount","_","reload","useReducer","accountsListParent","tabIndex","account","isCurrent","isDefault","isLoggedOut","accessToken","Avatar","url","avatarStatic","onDblClick","log","saveAccounts","NameText","showAcct","setCurrentAccountID","Menu2","menuButton","href","splice","MenuConfirm","subMenu","confirmLabel","menuItemClassName","revokeAccessToken","clientId","clientSecret","store","session","get","Link","showImportExportAccounts","logo","ButtonInstall","HTMLElement","connectedCallback","button","navigator","install","ev","customElements","define","regionMaps","LangSelector","i18n","useLingui","populatedLocales","useMemo","LOCALES","lang","regionlessCode","native","localeCode2Text","locale","fallback","CATALOGS","find","c","nativeName","_common","name","sort","b","order","localeCompare","DEFAULT_LANG","onChange","local","set","activateLang","common","createBackendPushSubscription","subscription","push","create","fetchBackendPushSubscription","updateBackendPushSubscription","update","removeBackendPushSubscription","isPushSupported","getRegistration","serviceWorker","getSubscription","registration","pushManager","urlBase64ToUint8Array","base64String","padding","repeat","base64","rawData","atob","outputArray","charCodeAt","initSubscription","backendSubscription","err","message","sameEndpoint","sameKey","vapidKey","applicationServerKey","vapidKeyStr","applicationServerKeyStr","policy","DEFAULT_TEXT_SIZE","TEXT_SIZES","SMALLEST_TEXT_SIZE","LARGEST_TEXT_SIZE","PHANPY_PRIVACY_POLICY_URL","PRIVACY_POLICY_URL","PHANPY_TRANSLANG_INSTANCES","TRANSLANG_INSTANCES","PHANPY_IMG_ALT_API_URL","IMG_ALT_API_URL","PHANPY_GIPHY_API_KEY","GIPHY_API_KEY","targetLanguages","Object","languages","tl","TRANSLATION_API_NAME","Settings","currentTheme","themeFormRef","targetLanguage","contentTranslationTargetLanguage","systemTargetLanguage","getTranslateTargetLanguage","systemTargetLanguageText","currentTextSize","prefs","setPrefs","getPreferences","authenticated","expTabBarV2","setExpTabBarV2","disableQuotePolicy","onInput","formData","FormData","theme","documentElement","html","classList","$manualMeta","$autoMetas","m","toggle","defaultChecked","TextSizeControl","rel","for","source","newPrefs","setPreferences","supportsNativeQuote","alert","checked","autoRefresh","boostsCarousel","contentTranslation","showCommon","contentTranslationHideLanguages","contentTranslationAutoInline","composerGIFPicker","mediaAltGenerator","shortcutSettingsCloudImportExport","cloakMode","showDrafts","PushNotificationsSection","display","flexWrap","alignItems","marginTop","src","aspectRatio","background","borderRadius","showAccount","readOnly","select","warn","textSizeFieldRef","setSize","debouncedSize","useDebounce","setProperty","fontSize","min","max","step","size2","_t2","pushFormRef","setNeedRelogin","previousPolicyRef","allowNotifications","setUIState","needRelogin","alerts","setAllowNotifications","alert2","policyEl","fromEntries","mention","favourite","reblog","follow","followRequest","alertsCount","policyChanged","allowNotifications2","updateSubscription","removeSubscription","catch","isLoading","permission","Notification","focusDeck","timer","columns","getElementById","focusedColumn","focus","firstVisibleColumn","column","getBoundingClientRect","modals","modal","modalFocusElement","pages","page","useLocationChange","useLocation","currentLocationRef","AccountHandleInfo","acct","username","server","split","encodedAcct","punycode","toASCII","SUPPORTED_IMAGE_FORMATS","SUPPORTED_IMAGE_FORMATS_STR","FieldsAttributesRow","index","hasValue","setHasValue","maxLength","required","dir","enterKeyHint","currentTarget","EditProfileSheet","uiState","setAccount","headerPreview","setHeaderPreview","avatarPreview","setAvatarPreview","acc","verifyCredentials","displayName","avatar","header","note","fields","fieldsAttributesRef","avatarMediaAttachments","headerMediaAttachments","abrupt","fieldsAttributesFields","field","fieldsAttributes","newAccount","header2","error","file","accept","blob","mediaAttachments","mediaIndex","Math","ENDORSEMENTS_LIMIT","Endorsements","accountID","open","onlyOpenIfHasEndorsements","endorsementsContainer","endorsementsUIState","setEndorsementsUIState","endorsements","setEndorsements","relationshipsMap","setRelationshipsMap","supports","behavior","block","fetchRelationships","relationships","reallyOpen","Loader","AccountBlock","avatarSize","relationship","_isSearchEnabled","v2","search","q","isSearchEnabled","FETCH_MAX_AGE","MAX_AGE","fetchLists","lists","updatedAt","getLists","fetchList","getList","theList","getListTitle","addListStore","updateListStore","deleteListStore","listID","findIndex","ListExclusiveBadge","insignificant","ListAddEdit","editMode","nameFieldRef","repliesPolicyFieldRef","exclusiveFieldRef","repliesPolicy","exclusive","supportsExclusive","onSubmit","listResult","replies_policy","AddRemoveListsSheet","setLists","listsContainingAccount","setListsContainingAccount","reloadCount","listsContainingAccount2","setShowListAddEditModal","showListAddEditModal","inList","l","accountIds","PrivateNoteSheet","initialNote","onRelationshipChange","textareaRef","trim","newRelationship","comment","TranslatedBioSheet","fieldsText","getHTMLText","text","whiteSpace","TranslationBlock","forceTranslate","MUTE_DURATIONS","MUTE_DURATIONS_LABELS","i18nDuration","RelatedActions","standalone","setShowEditProfile","showEndorsements","renderEndorsements","setRenderEndorsements","currentMasto","currentInstance","currentAuthenticated","sameInstance","relationshipUIState","setRelationshipUIState","setRelationship","locked","lastStatusAt","moved","following","showingReblogs","notifying","followedBy","blocking","blockedBy","muting","mutingNotifications","requested","domainBlocking","endorsed","privateNote","currentInfo","setCurrentInfo","isSelf","setIsSelf","acctWithInstance","supportsEndorsements","currentID","acctHasInstance","results","resolve","updateAccount","setShowTranslatedBio","setShowAddRemoveLists","showPrivateNoteModal","setShowPrivateNoteModal","loading","showTranslatedBio","showAddRemoveLists","setSearchEnabled","searchEnabled","headerStatic","hideTime","showQrCodeModal","backgroundMask","caption","onScannerClick","position","overflow","lists2","onMenuChange","draftStatus","query","handle","openTrigger","duration","textOverflow","reloadGenericAccounts","counter","confirm","showReportModal","relationship2","urlObj","host","LIMIT","ACCOUNT_INFO_MAX_AGE","fetchFamiliarFollowers","familiarFollowers","memFetchFamiliarFollowers","fetchPostingStats","fetchStatuses","stats","total","originals","replies","boosts","memFetchPostingStats","isValidUrl","string","handleScannerClick","actionableText","hideAllModals","AccountInfo","fetchAccount","isString","setInfo","sameCurrentInstance","info2","bot","emojis","group","statusesCount","memorial","roles","hideCollections","headerIsAvatar","infoHasEssentials","account2","updated","headerCornerColors","setHeaderCornerColors","followersIterator","accountInstance","firstLoad","familiarFollowersCache","newValue","familiarFollowers2","familiar","followingIterator","LinkOrDiv","accountLink","postingStats","setPostingStats","renderFamiliarFollowers","setFamiliarFollowers","postingStatsUIState","setPostingStatsUIState","followers","renderPostingStats","onProfileUpdate","isStringURL","skeleton","stopPropagation","onError","ctx","canvas","crossOrigin","onLoad","pixelDimension","rgbColors","OffscreenCanvas","createElement","willReadFrequently","imageSmoothingEnabled","drawImage","colors","g","dataLength","lightenRGB","color","handleWithInstance","arena","showMediaModal","internal","handleContentLinks","dangerouslySetInnerHTML","verifiedAt","__html","EmojiText","fetchFollowers","showGenericAccounts","heading","fetchAccounts","excludeRelationshipAttrs","blankCopy","follower","followersCount","shortenNumber","fetchFollowing","followingCount","hasPostingStats","3","_i18n","daysSinceLastPost","luminence","alpha","AccountSheet","propInstance","lookup","skip_webfinger","result","accountWithSameString","startsWith","accountURL","URL","Drafts","drafts","setDrafts","db","ns","getCurrentAccountNS","ownKeys","filter","getMany","hasDrafts","draft","replyTo","quote","updatedAtDate","quoteStatus","MiniDraft","spoilerText","hasPoll","hasMedia","hasQuote","hasPollOrMedia","firstImageMedia","image","objectURL","createObjectURL","EmbedModal","GenericAccounts","postID","isCurrentInstance","showMore","setShowMore","staticAccounts","showReactions","setAccounts","loadRelationships","loadAccounts","done","isArray","theAccount","j","_types","newAccounts","Status","showStats","InView","ImportAccountsSelection","importedAccounts","existingAccounts","accountsToImport","statusOrder","duplicate","new","__status","selectedAccounts","setSelectedAccounts","initialSelection","handleImportSelection","showAccounts","selectedCount","Boolean","every","newSelection","shouldSelect","isSelected","ImportExportAccounts","setImportedAccounts","dragOver","setDragOver","handleExport","exportData","rest","stringify","Blob","date","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","download","click","revokeObjectURL","processFile","handleImport","onDragOver","onDragLeave","onDrop","FORCE_TRANSLATE_LIMIT","MediaAltModal","setForceTranslate","differentLanguage","localeMatch","isShortAlt","supportsTTS","speak","textWrap","sourceLanguage","classToType","obj","unpack","keyOrder","k","PI","TWOPI","PITHIRD","DEG2RAD","RAD2DEG","multiplyMatrices","A","B","B_cols","product","row","col","labConstants","compand","linear","sign","xyz2rgb","z","MtxAdaptMa","MtxAdaptMaI","MtxXYZ2RGB","RefWhiteRGB","Xn","Yn","Zn","LAB_CONSTANTS","As","Bs","Cs","Ad","Bd","Cd","X1","Y1","Z1","X2","Y2","Z2","oklab2rgb","L","X","Y","Z","OKLab_to_XYZ","b_","OKLab","LMStoXYZ","OKLabtoLMS","LMSnl","gammaAdjustSRGB","companded","rgb2xyz","MtxRGB2XYZ","rgb2oklab","xyz","XYZ_to_OKLab","XYZ","XYZtoLMS","LMStoOKLab","LMS","sin","cos","lch2lab","h","oklch2rgb","sqrt","atan2","round","lab2lch","rgb2oklch","MediaModal","statusID","carouselRef","currentIndex","setCurrentIndex","carouselFocusItem","useLayoutEffect","scrollIntoView","prevStatusID","scrollLeft","clientWidth","differentStatusID","scrollTo","isRTL","showControls","setShowControls","handleSwipe","removeEventListener","handleScroll","abs","passive","mediaOkColors","media","blurhash","averageColor","getBlurHashAverageColor","mediaAccentColors","okColor","light","dark","default","mediaAccentGradients","range","lightGradient","darkGradient","toastRef","hideToast","currentColor","$meta","metaColor","mediaColor","content","colorScheme","contains","backgroundAttachment","accentColor","showMediaAlt","description","showOriginal","menuClassName","OpenLinkSheet","linkText","displayUrl","protocol","handleCopy","clipboard","writeText","handleShare","R1_RUN_LENGTH_THRESHOLD","R2_BLOCK_PENALTY","R3_FINDER_PATTERN_LENGTH","R3_FINDER_PENALTY","R4_BALANCE_STEP_PERCENT","R4_BALANCE_STEP_POINTS","chCodes","assertNumber","validateVersion","ver","bin","pad","mod","fillArr","val","interleaveBytes","blocks","maxLen","totalLen","idx","best","bestScore","score","alphabet","char","input","letter","digits","Bitmap","s","lines","line","offset","yPos","xPos","cur","border","bm","factor","out","first","second","cc","reset","whiteBG","darkBG","optimize","pathData","prevPoint","point","relM","bH","u16le","dims","N","fullChunks","isRGB","ECMode","Encoding","BYTES","WORDS_PER_BLOCK","ECC_BLOCKS","last","distance","count","interval","ecc","maskIdx","words","numBlocks","blockLen","shortBlocks","PATTERNS","_x","_y","GF","p_poly","exp","poly","degree","coefficient","coefficients","scalar","smaller","larger","sumDiff","lengthDiff","divisor","elm","R","rLast","tLast","rLastLast","tLastLast","dltInverse","degreeDiff","scale","sigmaTildeAtZero","inverse","RS","eccWords","pol","syndrome","hasError","evl","monomial","errorLocator","errorEvaluator","locations","pos","xiInverse","denominator","interleave","rs","eccBlocks","isShort","resBlocks","resECC","drawTemplate","finder","alignPos","bits","getBit","bit","zigzag","tpl","pattern","xOffset","detectType","utf8ToBytes","encoder","encoded","dataLen","n","utf8","capacity","drawQR","need","mask","calculateRowRunPenalty","rowBits","moduleCount","penalty","runLength","previousColor","calculateColumnRunPenalty","bitmap","columnIndex","columnHeight","calculateRowFinderPenalty","rowLength","lastStart","light4ThenFinder7","finder7ThenLight4","calculateColumnFinderPenalty","matrix","rowIndex","runPenalty","blockPenalty","lastCol","lastRow","nextCol","cell","finderPenalty","darkCount","darkPercent","deviation","balancePenalty","drawQRBest","bestMask","validateECC","ec","validateEncoding","enc","validateMask","encodeQR","output","encoding","utils","getContext","QrCode","arenaCircle","captionRef","captionHeight","setCaptionHeight","arenaLoaded","setArenaLoaded","arenaHasAlpha","setArenaHasAlpha","effectiveArenaCircle","img","Image","onload","getImageData","totalPixels","lowAlphaCount","hasAlpha","onerror","qrData","gridSize","centerExcludeSize","centerStart","centerEnd","isFilled","centerX","centerY","radius","dx","isFilledInGrid","isInPositionMarker","cx","cy","hasTop","hasRight","hasBottom","hasLeft","markerOuterRadius","markerInnerRadius","centerImagePadding","centerImageSize","centerImageX","centerImageY","captionSpacing","viewBoxWidth","viewBoxHeight","viewBox","xmlns","fill","stroke","rx","ry","in","stdDeviation","slope","intercept","markerPositions","bleed","preserveAspectRatio","opacity","mediaDevicesSupported","mediaDevices","getUserMedia","QrCodeModal","hasBarcodeDetector","__vitePreload","QRCamera","constructor","stream","player","setStream","setAttribute","srcObject","listDevices","enumerateDevices","Error","device","kind","deviceId","setDevice","stop","video","exact","readFrame","fullSize","videoHeight","videoWidth","getSize","track","getTracks","createQRCamera","permissions","ideal","facingMode","checkValidity","containerRef","videoRef","setIsScanning","overlayRef","decodedText","setDecodedText","handleScreenOrientationChange","screenOrientation","screen","orientation","cam","qrCanvas","detector","cancelMainLoop","qrDom","BarcodeDetector","formats","QRCanvas","cropToSquare","overlayMainColor","overlayFinderColor","animationId","mainLoop","rafLoop","isScanning","startCamera","showActionableButton","playsInline","muted","disablepictureinpicture","CATEGORIES","CATEGORIES_INFO","spam","legal","violation","stampLabel","other","excludeStamp","findMatchingLanguage","rule","currentLang","translations","availableLanguages","matchedLang","normalizedLanguages","part","region","charAt","toUpperCase","translateRules","rules","_translatedText","ReportModal","domain","translatedRules","currentDomain","getCurrentInstance","selectedCategory","setSelectedCategory","showRules","setShowRules","rulesRef","hasRules","setHasRules","previewMode","useAvatarStatic","showActivity","category","forward","ruleIds","reports","accountId","statusIds","Fragment","maxlength","rows","switch","LZString","f","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","character","compressed","uncompressed","buf","TotalLen","current_value","bitsPerChar","getCharFromInt","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","ii","resetValue","getNextValue","dictionary","enlargeIn","dictSize","numBits","w","resb","maxpower","power","module","floatingButtonUrl","multiColumnUrl$1","tabMenuBarUrl","MAX_FETCH","fetchFollowedTags","iterator","followedTags","tags","fetchCount","getFollowedTags","fauxDiv","extractTagsFromStatus","hashtagLinks","AsyncText","setText","Promise","then","SHORTCUTS_LIMIT","TYPES","TYPE_TEXT","public","bookmarks","favourites","hashtag","trending","mentions","TYPE_PARAMS","notRequired","placeholder","fetchAccountTitle","SHORTCUTS_META","path","excludeViewMode","subtitle","encodeURIComponent","ShortcutsSettings","shortcuts","showForm","setShowForm","showImportExport","setShowImportExport","shortcutsListParent","textTransform","imgURL","multiColumnUrl","shortcut","excludedViewMode","shortcutsArr","temp","shortcutIndex","justifyContent","ShortcutForm","mode","ImportExport","FORM_NOTES","currentType","setCurrentType","followedHashtags","setFollowedHashtags","form","formRef","autocorrect","autocapitalize","tag","spellCheck","shortcutsStr","compressToEncodedURIComponent","setImportShortcutStr","parsedImportShortcutStr","setImportUIState","importShortcutStr","parsed","decompressFromEncodedURIComponent","hasCurrentSettings","shortcutsImportFieldRef","importUIState","dt","match","some","nonUniqueShortcuts","exceededLimit","newShortcuts","newNote","settingsJSON","changes","prevValue","Modals","navigate","useNavigate","preload","ComposeSuspense","__COMPOSE__","replyMode","editStatus","newStatus","scheduledAt","reloadStatusPage","reloadScheduledPosts","reply","edit","toast","prevLocation","showSettings","destination","showOpenLink","showShortcutsSettings","showEmbedModal","showQrScannerModal","QrScannerModal","exportDisabled","NavigationCommand","hotkeyOptions","FollowRequestButtons","requestState","setRequestState","hasRelationship","followRequests","authorize","NOTIFICATION_ICONS","follow_request","severed_relationships","moderation_warning","emoji_reaction","annual_report","quoted_update","emojiText","emoji","emoji_url","staticUrl","emojiObject","CustomEmoji","contentText","postsCount","postType","Subject","clickable","poll-self","poll-voted","favourite+reblog","admin.sign_up","admin.report","targetAccount","year","SEVERED_RELATIONSHIPS_TEXT","account_suspension","targetName","domain_block","user_domain_block","MODERATION_WARNING_TEXT","none","disable","mark_statuses_as_sensitive","delete_statuses","sensitive","silence","suspend","AVATARS_LIMIT","isStatic","disableContextMenu","report","annualReport","_ids","_accounts","_statuses","_groupKeys","sampleAccounts","notificationsCount","groupKey","_notificationsCount","_sampleAccountsCount","actualStatus","actualStatusID","isVoted","voted","isReplyToOthers","inReplyToAccountId","favsCount","reblogsCount","props","handleOpenGenericAccounts","diffCount","expandAccounts","showAvatar","emojiURL","shortcode","formattedCreatedAt","genericAccountsHeading","statusKey","filtered","isOwnPost","filterInfo","isFiltered","type2","gKey","keyAccounts","keyAccount","_accounts2","status2","allowContextMenu","TruncatedLink","dispatchEvent","clientX","clientY","allowFilters","useTruncated","Notification$2","oldProps","newProps","NotificationService","routeNotification","showNotificationSheet","notificationAccount","hasModal","hasStatus","clearAppBadge","id2","setShowNotificationSheet","getSearchHistory","history","MAX_HISTORY_LENGTH","addToSearchHistory","queryType","existingIndex","item","unshift","timestamp","limitedHistory","removeFromSearchHistory","filteredHistory","clearAllSearchHistory","generateSearchItemData","hashSymbol","hashtagText","SearchForm","forwardRef","searchParams","setSearchParams","useSearchParams","searchMenuOpen","setSearchMenuOpen","setQuery","searchFieldRef","useImperativeHandle","setValue","blur","searchHistory","searchSuggestionsData","recentSearchItems","historyItem","isRecentSearch","autocomplete","onSearch","onFocus","firstItem","onBlur","onKeyDown","focusItem","nextItem","nextElementSibling","parentElement","prevItem","previousElementSibling","items","lastItem","SearchCommand","showSearch","setShowSearch","searchFormRef","showSearchCommand","isSearchPage","isYearInPostsPage","closeSearch","enableOnFormTags","Shortcuts","isMultiColumnMode","shortcutsColumnsMode","tabBarRef","hasLists","formattedShortcuts","pin","timeoutId","activeTab","inline","parseInt","scrollTop","updatesButton","instanceRef","viewScroll","getComputedStyle","Shortcuts$1","groupBoosts","newValues","boostStash","serialBoosts","boostStashID","half","floor","dedupeBoosts","boostedStatusIDs","filteredItems","boosterID","groupContext","contextIndex","contexts","repliedItem","self","inReplyToId","firstItemAccountID","newItems","appliedContextIndices","inReplyToIds","contextItems","it","sKey","statusReply","queueMicrotask","fallbackFetch","fetchStatus","saveStatus","ids","replyToStatuses","assignFollowedTags","statusFollowedTags","statusWithFollowedTags","extractedTags","itemFollowedTags","useScroll","scrollableRef","distanceFromStart","distanceFromEnd","scrollThresholdStart","scrollThresholdEnd","distanceFromStartPx","_distanceFromStartPx","distanceFromEndPx","_distanceFromEndPx","scrollDirection","setScrollDirection","reachStart","setReachStart","reachEnd","setReachEnd","nearReachStart","setNearReachStart","nearReachEnd","setNearReachEnd","isVertical","scrollableElement","previousScrollStart","onScroll","scrollHeight","scrollWidth","clientHeight","scrollStart","scrollDimension","clientDimension","scrollDistance","init","Event","useScrollFn","useThrottledCallback","scrollDelta","isScrollingForward","leading","resetScrollDirection","MediaPost","onMediaClick","accountEmojis","repliesCount","reblogged","favourited","favouritesCount","bookmarked","visibility","language","editedAt","card","uri","_deleted","_pinned","debugHover","filterContext","useContext","FilterContext","showSpoilerMedia","hasSpoiler","readingExpandMedia","filterTitleStr","Media","MediaPost$1","NavMenu","showFollowing","detect","cancelOnMovement","menuState","setMenuState","mutesIterator","fetchMutes","mutes","blocksIterator","fetchBlocks","buttonClickTS","squircle","commitHash","__COMMIT_HASH__","ListMenu","supportsLists","NavMenu$1","scrollIntoViewOptions","Timeline","titleComponent","emptyText","errorText","useItemID","fetchItems","checkForUpdatesInterval","headerStart","headerEnd","timelineStart","refresh","view","showFollowedTags","showReplyParent","clearWhenRefresh","setItems","showNew","setShowNew","debug","__BENCHMARK","isMediaFirstInstance","mediaFirst","allowGrouping","loadItemsTS","firstLoad2","loadItems","useDebouncedCallback","ts","otherPosts","pinnedPosts","items2","jRef","handler","itemsSelector","activeItem","activeElement","activeItemRect","allItems","activeItemIndex","indexOf","itemRect","topmostItem","kRef","showNewPostsIndicator","handleLoadNewPosts","scrollFnCallback","headerRef","hiddenUI","cancel","prevView","disableIdleCheck","loadOrCheckUpdates","inBackground","noPointers","__IDLE__","visible2","lastHiddenTime","dotRef","Provider","oRef","TimelineItem","inView","marginBlockEnd","fItems","aFiltered","bFiltered","filteredItemsIDs","isCarousel","unfiltered","filteredItems2","StatusCarousel","_grouped","_pinned2","item2","_pinned3","actualStatusID3","reblog3","statusID3","statusID2","actualStatusID2","reblog2","url2","contentTextWeight","manyItems","enableCommentHint","isMiddle","showCompact","_differentAuthor","isSpoiler","isStart","isEnd","TimelineStatusCompact","itemKey","oldID","newID","setRender","render","startButtonRef","_t3","endButtonRef","_t4","statusPeekText","ThreadBadge","titlesStr","MIN_YEAR","MIN_YEAR_MONTH","supportsInputMonth","mem","AccountStatuses","useParams","month","excludeReplies","excludeBoosts","tagged","accountStatusesIterator","allSearchParams","searchOffsetRef","isValidMonth","_month","monthIndex","after","_year","afterStr","before","beforeStr","searchResults","done2","value2","pinnedStatuses","pinned","pinnedStatusesIds","postId","featuredTags","setFeaturedTags","acctDisplay","accountDisplay","monthYear","fetchAccount2","featuredTags2","useTitle","TimelineStart","cachedAccount","filterBarRef","validity","MonthPicker","active","allowSwitch","offsetLeft","fetchAccountStatuses","masto2","minYear","maxYear","minMonth","maxMonth","yearFieldRef","monthFieldRef","AnnualReport","setResults","annualReports","report2","datePlaceholder","totals","textAlign","Bookmarks","bookmarksIterator","fetchBookmarks","catchupUrl","FILTER_CONTEXT","CATCHUP_NS","RANGES","beyond","FILTER_KEYS","original","quotes","groups","FILTER_SORTS","FILTER_GROUPS","DTF","Intl","DateTimeFormat","day","hour","minute","quotedStatus","Catchup","dtf","showTopLinks","setShowTopLinks","supportsPixelfed","fetchHome","maxCreatedAt","allResults","homeIterable","homeIterator","mainloop","addedResults","createdAtTime","selfPost","_filtered","_followedTags","catchupRangeRef","catchupLastRef","handleCatchupClick","maxCreatedAtHuman","catchupID","startAt","endAt","catchup","setPosts","setPrevCatchups","catchupIds","prevCatchups","pc","catchupId","reloadCatchups","sessionStorage","catchups","ownCatchups","lastCatchups","restCatchups","trimmedCatchups","setLastCatchupEndAt","filterCounts","links","links2","reloadCatchupsCount","__FILTER","thePost","link","topLinks","linksLoop","shared","selectedFilterCategory","selectedAuthor","setSelectedAuthor","setRange","sortBy","setSortBy","sortOrder","setSortOrder","setSelectedFilterCategory","groupBy","setGroupBy","savedState","filteredPosts","authors","authorCounts","authorsHash","filteredPosts2","boostedPosts","setJSON","authorCountsMap","postFilterMatches","__BOOSTERS","filteredPostsMap","__HIDDEN","authorCountsList","sortedFilteredPosts","authorIndices","authorID","bIndex","bAccountID","aIndex","bDensity","aDensity","prevGroup","authorsListParent","autoAnimated","postsBarType","isFiltered2","postsBins","postsBar","binByTime","bins","getJSON","scrollElement","lastCatchupRange","lastCatchupEndAt","authorUsername","sortOrderIndex","groupByText","authorRect","scrollableRect","authorElement","right","setShowHelp","hlRef","_2","escRef","isRadio","handleArrowKeys","isArrowKeys","closest","beyondRange","untilLastCatchup","st","formatRange","likes","transform","imageDescription","sharers","publishedAt","author","paddingInline","density","showSeparator","IntersectionPostLineItem","showHelp","PostLine","isFollowedTags","isReplyTo","onMouseEnter","PostPeek","setShow","show","MEDIA_DENSITY","CARD_DENSITY","pollContent","htmlContentLength","MEDIA_SIZE","_thread","isThread","theQuote","readingExpandSpoilers","postText","showPostContent","emojifyText","o","mediaURL","remoteMediaURL","multiple","showMedia","previewUrl","meta","gifv","PostStats","quotesCount","numBins","maxDate","minDate","Favourites","favouritesIterator","fetchFavourites","FILTER_CONTEXT_UNIMPLEMENTED","FILTER_CONTEXT_LABELS","home","thread","EXPIRY_DURATIONS","EXPIRY_DURATIONS_LABELS","Filters","showFiltersAddEditModal","setShowFiltersAddEditModal","filters","setFilters","keywords","expiresAt","keyword","ExpiryStatus","FiltersAddEdit","_id","incID","filterAction","hasExpiry","expiresAtDate","editKeywords","setEditKeywords","keywordsRef","setRemovedKeyword_IDs","filteredEditKeywords","setRemovedKeywordIDs","removedKeyword_IDs","keywordIDs","getAll","keywordKeywords","keywordWholeWords","keywordsAttributes","wholeWord","removedKeywordIDs","context2","expiresIn","wholeWords","filterResult","filterAction2","_id2","getAPIVersions","showNeverExpires","expired","rerender","FollowedHashtags","Following","client","streamingClient","setStreamingClient","latestItem","onStreamingReady","latestItemChanged","clearFollowedTagsState","include_reblogs","valueContainsLatestItem","getStatus","TAGS_LIMIT_PER_MODE","TOTAL_TAGS_LIMIT","Hashtags","mediaView","hashtags","linkParams","hashtagTitle","maxID","fetchHashtags","timelines","any","maxId","onlyMedia","since_id","followUIState","setFollowUIState","reachLimit","featuredUIState","setFeaturedUIState","isFeaturedTag","setIsFeaturedTag","setDownOverflow","finally","featuredTagID","delete","FocusableItem","newHashtag","MenuGroup","exists","newInstance","List","listIterator","setList","showManageMembersModal","setShowManageMembersModal","list2","MenuHeader","ListManageMembers","MEMBERS_LIMIT","members","setMembers","membersIterator","fetchMembers","member","as","RemoveAddButton","setRemoved","removed","notificationTypeKeys","GROUP_TYPES","groupable","fixNotifications","massageNotifications2","notificationGroups","sampleAccountIds","statusId","groupNotifications2","groupNotifications","newGroupNotifications","gn","latestPageNotificationAt","mostRecentNotificationId","newGroupNotifications1","notificationsMap","virtualType","sampleCountDiffNotificationsCount","mappedNotification","ma","mappedAccount","otherGN","newGroupNotifications2","notificationsMap2","toLocaleDateString","hasOneAccount","cleanNotifications","reverse","cleanNotifications2","emptySearchParams","Mentions","stateType","setStateType","mentionsIterator","fetchMentions","types","conversationsIterator","latestConversationItem","lastStatus","fetchConversations","NOTIFICATIONS_LIMIT","NOTIFICATIONS_GROUPED_LIMIT","memSupportsGroupedNotifications","mastodon","mastoFetchNotificationsIterable","mastoFetchNotifications","getGroupedNotifications","NOTIFICATIONS_POLICIES","NOTIFICATIONS_POLICIES_TEXT","forNotFollowing","forNotFollowers","forNewAccounts","forPrivateMentions","forLimitedAccounts","Notifications","notificationID","notificationAccessToken","onlyMentions","setOnlyMentions","setFollowRequests","announcements","setAnnouncements","notificationsIterable","allNotifications","groupedNotifications","notificationsLastFetchTime","fetchFollowRequests","loadFollowRequests","requests","fetchAnnouncements","supportsFilteredNotifications","showNotificationsSettings","setShowNotificationsSettings","notificationsPolicy","setNotificationsPolicy","fetchNotificationsPolicy","loadNotificationsPolicy","notificationsRequests","setNotificationsRequests","fetchNotificationsRequest","loadNotifications","fetchNotificationsPromise","fetchNotifications","loadUpdates","unsub","subscribeKey","yesterdayDate","todayDate","currentDay","showTodayEmpty","announcementsListRef","annualReportNotification2","annualReportNotification","setAnnualReportNotification","dateYear","annualReportYear","statusLink","todaySubHeading","today","forceOpts","announcement","onToggle","request","summary","pendingRequestsCount","NotificationRequestModalButton","differentDay","notificationDay","subHeading","newPolicy","AnnouncementBlock","contact","contactAccount","startsAt","endsAt","published","allDay","reactions","read","publishedDateText","updatedAtText","publishedAtDate","reaction","me","fetchNotficationsByAccount","showModal","setShowModal","notifs","setNotifications","NotificationRequestButtons","hasRequestState","Notifications$1","Public","isLocal","publicIterator","fetchPublic","remote","prompt","RecentSearches","onItemClick","handleClearAll","handleRemoveItem","listRef","SHORT_LIMIT","Search","offsetRef","statusResults","setStatusResults","accountResults","setAccountResults","hashtagResults","setHashtagResults","typeResults","setTypeResultsFunc","loadResults","filterBarParent","reduce","TREND_CACHE_TIME","fetchLinks","trends","fetchTrendsStatuses","pixelfed","discover","fetchLinkList","Trending","setHashtags","setLinks","trendIterator","fetchTrends","currentLinkMentionsLoading","setCurrentLinkMentionsLoading","currentLinkMentionsIterator","currentLink","setCurrentLink","hasCurrentLink","supportsTrendingLinkPosts","currentLinkRef","prevCurrentLink","authorUrl","authorName","providerName","providerUrl","isShortTitle","labAverageColor","title2","hasAuthor","flexShrink","fetchLinkMentions","Columns","Component","Hashtag","$column","currentFocusedColumn","prevColKey","nextColKey","Home","NotificationsLink","notificationLinkRef","NotificationsMenu","NOTIFICATIONS_DISPLAY_LIMIT","hasFollowRequests","setHasFollowRequests","skipFollowRequests","headerHeight","Home$1","statusPostRegexes","getInstanceStatusObject","theURL","regex","getInstanceStatusURL","HttpRoute","statusObject","statusURL","Lists","hasExclusiveLists","instancesListURL","openAuthPopup","features","popup","closed","closeAuthPopup","close","watchAuthPopup","onSuccess","resolved","messageHandler","cleanup","pollInterval","PHANPY_DEFAULT_INSTANCE","DEFAULT_INSTANCE","Login","instanceURLRef","cachedInstanceURL","submit","instanceText","setInstanceText","instancesList","setInstancesList","searcher","Fuse","submitInstance","xmlDoc","DOMParser","parseFromString","getElementsByTagName","template","getCredentialApplication","credentialApplication","storeCredentialApplication","authPKCE","authUrl","callbackUrl","cleanInstanceText","instanceTextLooksLikeDomain","instancesSuggestions","instance2","selectedInstanceText","ScheduledPosts","scheduledPosts","setScheduledPosts","showScheduledPostModal","setShowScheduledPostModal","postsIterator","scheduledStatuses","allPosts","quotedStatusId","quoteApprovalPolicy","option","votesCount","ScheduledPostPreview","ScheduledPostEdit","hours","formatOpts","weekday","differentScheduledAt","setNewScheduledAt","newScheduledAt","localTZ","getLocalTimezoneName","pastSchedule","ScheduledAtField","setScheduledAt","EditHistoryControls","prevEditedAt","nextEditedAt","editedAtIndex","editHistoryMode","editHistoryRef","exitEditHistory","useEditHistory","SUBCOMMENTS_OPEN_ALL_LIMIT","MAX_WEIGHT","cachedRepliesToggle","cachedStatusesMap","scrollPositions","resetScrollPosition","STATUSES_SELECTOR","STATUS_URL_REGEX","StatusPage","mediaParam","mediaOnlyParam","mediaStatusID","mediaStatus","showMediaOnly","heroStatus","setHeroStatus","existingCanonical","originalHref","canonicalLink","head","appendChild","removeChild","closeLink","matchStatusPath","matchPath","postViewState","mediaClose","mediaAttachments2","handleMediaClose","mediaVTN","getSafeViewTransitionName","els","foundEls","el2","elBounds","innerHeight","transition","startViewTransition","viewTransitionName","viewTransitioned","$carousel","$deckContainer","$deckContainers","linkable","restProps","createdAtSort","MONTH_IN_MS","StatusThread","setViewMode","totalDescendants","setStatuses","heroStatusRef","scrollOffsets","fullContext","initEditHistory","threadsCount","currentEditedAtStatus","nextEditedAtStatus","descendants","sCreatedAt","currentEditedAtStatusCreatedAt","nextEditedAtStatusCreatedAt","ancestors2","ancestors","heroStatus2","missingAncestorIds","missingId","referencingStatus","ghostStatus","insertIndex","missingStatuses","ghost","nestedDescendants","ancestorsIsThread","heroAccountID","descendantLevelsCount","__replies","level","nextLevel","_replies","_r","expandReplies","calcStatusWeight","descendant","mappedNestedDescendants","weight","initContext","reloadHero","ancestor","reallyCachedStatuses","allStatuses","contextFetch","pRetry","heroTimer","cachedStatuses","retries","restructureContext","descendantsThread","threadsCount2","heroFetch","heroLimit","threadifyStatus","setThreadsCount","setShowRefresh","offsetTop","lastInitContextTS","setLimit","scrollPosition","newScrollOffsets","newScrollTop","showRefresh","contextURL","statusWeightCache","heroContentText","heroDisplayName","postInstance","apiCache","ignoreVary","postSameInstance","heroInView","setHeroInView","activeStatusRect","activeStatus","allStatusLinks","activeStatusIndex","nextStatus","statusLinkRect","topmostStatusLink","heroPointer","prevStatus","details","initialPageState","handleMediaClick","handleStatusLinkClick","renderStatus","isHero","reachTopPost","isLinkable","requestAnimationFrame","withinContext","enableTranslate","translate","StatusParent","hasDescendants","setReachTopPost","showActionsBar","prevEntry","moreStatusesKeys","getIDs","hasParentThread","accWeight","months","slicedStatuses","prevLocationIsStatusPage","currentDate","prevDate","prevID","monthsDiff","years","spoilerButton","ThreadCountContext","statusesList","viewMode","isFinite","onAnimationEnd","back","short","arr","buttons","SubComments","openAll","parentLink","diveDeep","replies3","sameCount","totalComments","totalWeight","openBefore","detailsRef","setRenderReplies","Container","isDetails","shortReply","dataset","renderReplies","cachedWeight","POLL_VIRTUAL_LENGTH","cardLength","CARD_VIRTUAL_LENGTH","mediaLength","pollLength","StatusRoute","boostsCarouselUrl","multiHashtagTimelineUrl","nestedCommentsThreadUrl","logoText","PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL","DEFAULT_INSTANCE_REGISTRATION_URL","appSite","__COMMIT_TIME__","Welcome","nativeAlert","__nativeAlert","Toastify","gravity","YearInPosts","lazy","__STATES__","__STATES_STATS__","counts","unmountedPosts","setInterval","unfurledLinks","postInNotifications","$post","unfurled","keysCount","ICONS","nonIdleEvents","setIdle","debouncedSetIdle","onNonIdle","capture","relatedTarget","isIOS","showingMediaModal","textSize","$app","$body","BENCHES","__BENCH_RESULTS","isPWA","PATH_RESTORE_TIME_LIMIT","setIsLoggedIn","App","isPopup","getVapidKey","vapid_key","access_token","clientID","initClient","allSettled","initStates","getAccount","searchAccount","initPreferences","initInstance","hasPreferences","location2","restoredRef","lastPathKey","sessionCookie","isRootPath","lastAccessed","lastPath","SecondaryRoutes","Route","PrimaryRoutes","Routes","Root","nonRootLocation","getPrevLocation","Sandbox","backgroundLocation","isModalPage","Suspense","initActivateLang","initPWAViewport","I18nProvider","HashRouter","IconSpriteProvider","localStorage","removeItem","caches","IGNORE_CACHE_KEYS","clearRanOnce","FAST_INTERVAL","SLOW_INTERVAL","clearCaches","cache","_keys","MAX_SW_CACHE_SIZE","deleteKeys"],"ignoreList":[0,1,6,7,37,38,39,40,41,42,43,44,45,46,47,48,49,50,53,58],"sources":["../../node_modules/just-debounce-it/index.mjs","../../node_modules/swiped-events/src/swiped-events.js","../../src/utils/usePageVisibility.js","../../src/components/background-service.jsx","../../src/components/compose-button.jsx","../../src/components/keyboard-shortcuts-help.jsx","../../node_modules/@formkit/auto-animate/index.mjs","../../node_modules/@formkit/auto-animate/preact/index.mjs","../../src/utils/oauth-pkce.js","../../src/utils/auth.js","../../src/pages/accounts.jsx","../../src/assets/logo.svg","../../src/components/button-install.js","../../src/components/lang-selector.jsx","../../src/utils/push-notifications.js","../../src/pages/settings.jsx","../../src/utils/focus-deck.js","../../src/utils/useLocationChange.js","../../src/components/account-handle-info.jsx","../../src/components/edit-profile-sheet.jsx","../../src/components/endorsements.jsx","../../src/utils/is-search-enabled.js","../../src/utils/lists.js","../../src/components/list-exclusive-badge.jsx","../../src/components/list-add-edit.jsx","../../src/components/add-remove-lists-sheet.jsx","../../src/components/private-note-sheet.jsx","../../src/components/translated-bio-sheet.jsx","../../src/components/related-actions.jsx","../../src/components/account-info.jsx","../../src/components/account-sheet.jsx","../../src/components/drafts.jsx","../../src/components/embed-modal.jsx","../../src/components/generic-accounts.jsx","../../src/components/import-accounts-selection.jsx","../../src/components/import-export-accounts.jsx","../../src/components/media-alt-modal.jsx","../../node_modules/chroma-js/src/utils/limit.js","../../node_modules/chroma-js/src/utils/type.js","../../node_modules/chroma-js/src/utils/unpack.js","../../node_modules/chroma-js/src/utils/index.js","../../node_modules/chroma-js/src/utils/multiply-matrices.js","../../node_modules/chroma-js/src/io/lab/lab-constants.js","../../node_modules/chroma-js/src/io/lab/lab2rgb.js","../../node_modules/chroma-js/src/io/oklab/oklab2rgb.js","../../node_modules/chroma-js/src/io/lab/rgb2lab.js","../../node_modules/chroma-js/src/io/oklab/rgb2oklab.js","../../node_modules/chroma-js/src/io/lch/lch2lab.js","../../node_modules/chroma-js/src/io/oklch/oklch2rgb.js","../../node_modules/chroma-js/src/io/lch/lab2lch.js","../../node_modules/chroma-js/src/io/oklch/rgb2oklch.js","../../src/components/media-modal.jsx","../../src/components/open-link-sheet.jsx","../../node_modules/qr/index.js","../../src/components/qr-code.jsx","../../src/components/qr-code-modal.jsx","../../src/components/qr-scanner-modal.jsx","../../src/components/report-modal.jsx","../../node_modules/lz-string/libs/lz-string.js","../../src/assets/floating-button.svg","../../src/assets/multi-column.svg","../../src/assets/tab-menu-bar.svg","../../src/utils/followed-tags.js","../../src/components/AsyncText.jsx","../../src/components/shortcuts-settings.jsx","../../src/components/modals.jsx","../../src/components/navigation-command.jsx","../../src/components/follow-request-buttons.jsx","../../src/components/notification.jsx","../../src/components/notification-service.jsx","../../src/utils/search-history.js","../../src/components/search-form.jsx","../../src/components/search-command.jsx","../../src/components/shortcuts.jsx","../../src/utils/timeline-utils.js","../../src/utils/useScroll.js","../../src/utils/useScrollFn.js","../../src/components/media-post.jsx","../../src/components/nav-menu.jsx","../../src/components/timeline.jsx","../../src/pages/account-statuses.jsx","../../src/pages/annual-report.jsx","../../src/pages/bookmarks.jsx","../../src/assets/features/catch-up.png","../../src/pages/catchup.jsx","../../src/pages/favourites.jsx","../../src/pages/filters.jsx","../../src/pages/followed-hashtags.jsx","../../src/pages/following.jsx","../../src/pages/hashtag.jsx","../../src/pages/list.jsx","../../src/utils/group-notifications.js","../../src/pages/mentions.jsx","../../src/pages/notifications.jsx","../../src/pages/public.jsx","../../src/components/recent-searches.jsx","../../src/pages/search.jsx","../../src/pages/trending.jsx","../../src/components/columns.jsx","../../src/pages/home.jsx","../../src/utils/get-instance-status-url.js","../../src/pages/http-route.jsx","../../src/pages/lists.jsx","../../src/data/instances.json?url","../../src/utils/auth-popup.js","../../src/pages/login.jsx","../../src/pages/scheduled-posts.jsx","../../src/components/edit-history-controls.jsx","../../src/pages/status.jsx","../../src/pages/status-route.jsx","../../src/assets/features/boosts-carousel.jpg","../../src/assets/features/multi-column.jpg","../../src/assets/features/multi-hashtag-timeline.jpg","../../src/assets/features/nested-comments-thread.jpg","../../src/assets/logo-text.svg","../../src/pages/welcome.jsx","../../src/utils/toast-alert.js","../../src/app.jsx","../../src/main.jsx"],"sourcesContent":["var functionDebounce = debounce;\n\nfunction debounce(fn, wait, callFirst) {\n  var timeout = null;\n  var debouncedFn = null;\n\n  var clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n\n      debouncedFn = null;\n      timeout = null;\n    }\n  };\n\n  var flush = function() {\n    var call = debouncedFn;\n    clear();\n\n    if (call) {\n      call();\n    }\n  };\n\n  var debounceWrapper = function() {\n    if (!wait) {\n      return fn.apply(this, arguments);\n    }\n\n    var context = this;\n    var args = arguments;\n    var callNow = callFirst && !timeout;\n    clear();\n\n    debouncedFn = function() {\n      fn.apply(context, args);\n    };\n\n    timeout = setTimeout(function() {\n      timeout = null;\n\n      if (!callNow) {\n        var call = debouncedFn;\n        debouncedFn = null;\n\n        return call();\n      }\n    }, wait);\n\n    if (callNow) {\n      return debouncedFn();\n    }\n  };\n\n  debounceWrapper.cancel = clear;\n  debounceWrapper.flush = flush;\n\n  return debounceWrapper;\n}\n\nexport {functionDebounce as default};\n","/*!\n * swiped-events.js - v@version@\n * Pure JavaScript swipe events\n * https://github.com/john-doherty/swiped-events\n * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element\n * @author John Doherty <www.johndoherty.info>\n * @license MIT\n */\n(function (window, document) {\n\n    'use strict';\n\n    // patch CustomEvent to allow constructor creation (IE/Chrome)\n    if (typeof window.CustomEvent !== 'function') {\n\n        window.CustomEvent = function (event, params) {\n\n            params = params || { bubbles: false, cancelable: false, detail: undefined };\n\n            var evt = document.createEvent('CustomEvent');\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n            return evt;\n        };\n\n        window.CustomEvent.prototype = window.Event.prototype;\n    }\n\n    document.addEventListener('touchstart', handleTouchStart, false);\n    document.addEventListener('touchmove', handleTouchMove, false);\n    document.addEventListener('touchend', handleTouchEnd, false);\n\n    var xDown = null;\n    var yDown = null;\n    var xDiff = null;\n    var yDiff = null;\n    var timeDown = null;\n    var startEl = null;\n    var touchCount = 0;\n\n    /**\n     * Fires swiped event if swipe detected on touchend\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchEnd(e) {\n\n        // if the user released on a different target, cancel!\n        if (startEl !== e.target) return;\n\n        var swipeThreshold = parseInt(getNearestAttribute(startEl, 'data-swipe-threshold', '20'), 10); // default 20 units\n        var swipeUnit = getNearestAttribute(startEl, 'data-swipe-unit', 'px'); // default px\n        var swipeTimeout = parseInt(getNearestAttribute(startEl, 'data-swipe-timeout', '500'), 10);    // default 500ms\n        var timeDiff = Date.now() - timeDown;\n        var eventType = '';\n        var changedTouches = e.changedTouches || e.touches || [];\n\n        if (swipeUnit === 'vh') {\n            swipeThreshold = Math.round((swipeThreshold / 100) * document.documentElement.clientHeight); // get percentage of viewport height in pixels\n        }\n        if (swipeUnit === 'vw') {\n            swipeThreshold = Math.round((swipeThreshold / 100) * document.documentElement.clientWidth); // get percentage of viewport height in pixels\n        }\n\n        if (Math.abs(xDiff) > Math.abs(yDiff)) { // most significant\n            if (Math.abs(xDiff) > swipeThreshold && timeDiff < swipeTimeout) {\n                if (xDiff > 0) {\n                    eventType = 'swiped-left';\n                }\n                else {\n                    eventType = 'swiped-right';\n                }\n            }\n        }\n        else if (Math.abs(yDiff) > swipeThreshold && timeDiff < swipeTimeout) {\n            if (yDiff > 0) {\n                eventType = 'swiped-up';\n            }\n            else {\n                eventType = 'swiped-down';\n            }\n        }\n\n        if (eventType !== '') {\n\n            var eventData = {\n                dir: eventType.replace(/swiped-/, ''),\n                touchType: (changedTouches[0] || {}).touchType || 'direct',\n                fingers: touchCount, // Number of fingers used\n                xStart: parseInt(xDown, 10),\n                xEnd: parseInt((changedTouches[0] || {}).clientX || -1, 10),\n                yStart: parseInt(yDown, 10),\n                yEnd: parseInt((changedTouches[0] || {}).clientY || -1, 10)\n            };\n\n            // fire `swiped` event event on the element that started the swipe\n            startEl.dispatchEvent(new CustomEvent('swiped', { bubbles: true, cancelable: true, detail: eventData }));\n\n            // fire `swiped-dir` event on the element that started the swipe\n            startEl.dispatchEvent(new CustomEvent(eventType, { bubbles: true, cancelable: true, detail: eventData }));\n        }\n\n        // reset values\n        xDown = null;\n        yDown = null;\n        timeDown = null;\n    }\n    /**\n     * Records current location on touchstart event\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchStart(e) {\n\n        // if the element has data-swipe-ignore=\"true\" we stop listening for swipe events\n        if (e.target.getAttribute('data-swipe-ignore') === 'true') return;\n\n        startEl = e.target;\n\n        timeDown = Date.now();\n        xDown = e.touches[0].clientX;\n        yDown = e.touches[0].clientY;\n        xDiff = 0;\n        yDiff = 0;\n        touchCount = e.touches.length;\n    }\n\n    /**\n     * Records location diff in px on touchmove event\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchMove(e) {\n\n        if (!xDown || !yDown) return;\n\n        var xUp = e.touches[0].clientX;\n        var yUp = e.touches[0].clientY;\n\n        xDiff = xDown - xUp;\n        yDiff = yDown - yUp;\n    }\n\n    /**\n     * Gets attribute off HTML element or nearest parent\n     * @param {object} el - HTML element to retrieve attribute from\n     * @param {string} attributeName - name of the attribute\n     * @param {any} defaultValue - default value to return if no match found\n     * @returns {any} attribute value or defaultValue\n     */\n    function getNearestAttribute(el, attributeName, defaultValue) {\n\n        // walk up the dom tree looking for attributeName\n        while (el && el !== document.documentElement) {\n\n            var attributeValue = el.getAttribute(attributeName);\n\n            if (attributeValue) {\n                return attributeValue;\n            }\n\n            el = el.parentNode;\n        }\n\n        return defaultValue;\n    }\n\n}(window, document));\n","import { useEffect, useRef } from 'preact/hooks';\n\nexport default function usePageVisibility(fn = () => {}, deps = []) {\n  const savedCallback = useRef(fn);\n  useEffect(() => {\n    savedCallback.current = fn;\n  }, [deps]);\n\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      const hidden = document.hidden || document.visibilityState === 'hidden';\n      console.log(' Page visibility changed', hidden ? 'hidden' : 'visible');\n      savedCallback.current(!hidden);\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () =>\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n  }, []);\n}\n","import { useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport { api } from '../utils/api';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport useInterval from '../utils/useInterval';\nimport usePageVisibility from '../utils/usePageVisibility';\n\nconst STREAMING_TIMEOUT = 1000 * 3; // 3 seconds\nconst POLL_INTERVAL = 20_000; // 20 seconds\n\nexport default memo(function BackgroundService({ isLoggedIn }) {\n  const { t } = useLingui();\n\n  // Notifications service\n  // - WebSocket to receive notifications when page is visible\n  const [visible, setVisible] = useState(true);\n  const visibleTimeout = useRef();\n  usePageVisibility((visible) => {\n    clearTimeout(visibleTimeout.current);\n    if (visible) {\n      setVisible(true);\n    } else {\n      visibleTimeout.current = setTimeout(() => {\n        setVisible(false);\n      }, POLL_INTERVAL);\n    }\n  });\n\n  const checkLatestNotification = async (masto, instance, skipCheckMarkers) => {\n    if (states.notificationsLast) {\n      const notificationsIterator = masto.v1.notifications\n        .list({\n          limit: 1,\n          sinceId: states.notificationsLast.id,\n        })\n        .values();\n      const { value: notifications } = await notificationsIterator.next();\n      if (notifications?.length) {\n        if (skipCheckMarkers) {\n          states.notificationsShowNew = true;\n        } else {\n          let lastReadId;\n          try {\n            const markers = await masto.v1.markers.fetch({\n              timeline: 'notifications',\n            });\n            lastReadId = markers?.notifications?.lastReadId;\n          } catch (e) {}\n          if (lastReadId) {\n            states.notificationsShowNew = notifications[0].id !== lastReadId;\n          } else {\n            states.notificationsShowNew = true;\n          }\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    let sub;\n    let streamTimeout;\n    let pollNotifications;\n    if (isLoggedIn && visible) {\n      const { masto, streaming, instance } = api();\n      (async () => {\n        // 1. Get the latest notification\n        await checkLatestNotification(masto, instance);\n\n        let hasStreaming = false;\n        // 2. Start streaming\n        if (streaming) {\n          streamTimeout = setTimeout(() => {\n            (async () => {\n              try {\n                hasStreaming = true;\n                sub = streaming.user.notification.subscribe();\n                console.log(' Streaming notification', sub);\n                for await (const entry of sub) {\n                  if (!sub) break;\n                  if (!visible) break;\n                  console.log(' Notification entry', entry);\n                  if (entry.event === 'notification') {\n                    console.log(' Notification', entry);\n                    saveStatus(entry.payload, instance, {\n                      skipThreading: true,\n                    });\n                  }\n                  states.notificationsShowNew = true;\n                }\n                console.log(' Streaming notification loop STOPPED');\n              } catch (e) {\n                hasStreaming = false;\n                console.error(e);\n              }\n\n              if (!hasStreaming) {\n                console.log(' Streaming failed, fallback to polling');\n                pollNotifications = setInterval(() => {\n                  checkLatestNotification(masto, instance, true);\n                }, POLL_INTERVAL);\n              }\n            })();\n          }, STREAMING_TIMEOUT);\n        }\n      })();\n    }\n    return () => {\n      sub?.unsubscribe?.();\n      sub = null;\n      clearTimeout(streamTimeout);\n      clearInterval(pollNotifications);\n    };\n  }, [visible, isLoggedIn]);\n\n  // Check for updates service\n  const lastCheckDate = useRef();\n  const checkForUpdates = () => {\n    lastCheckDate.current = Date.now();\n    console.log(' Check app update');\n    fetch('./version.json')\n      .then((r) => r.json())\n      .then((info) => {\n        if (info) states.appVersion = info;\n      })\n      .catch((e) => {\n        console.error(e);\n      });\n  };\n  useInterval(checkForUpdates, visible && 1000 * 60 * 30); // 30 minutes\n  usePageVisibility((visible) => {\n    if (visible) {\n      if (!lastCheckDate.current) {\n        checkForUpdates();\n      } else {\n        const diff = Date.now() - lastCheckDate.current;\n        if (diff > 1000 * 60 * 60) {\n          // 1 hour\n          checkForUpdates();\n        }\n      }\n    }\n  });\n\n  // Global keyboard shortcuts \"service\"\n  useHotkeys(\n    'shift+alt+k',\n    (e) => {\n      // Need modifers check due to useKey: true\n      if (!e.shiftKey || !e.altKey) return;\n\n      const currentCloakMode = states.settings.cloakMode;\n      states.settings.cloakMode = !currentCloakMode;\n      showToast({\n        text: currentCloakMode ? t`Cloak mode disabled` : t`Cloak mode enabled`,\n      });\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey,\n    },\n  );\n\n  return null;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useCallback, useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport niceDateTime from '../utils/nice-date-time';\nimport openCompose from '../utils/open-compose';\nimport openOSK from '../utils/open-osk';\nimport pmem from '../utils/pmem';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport showCompose from '../utils/show-compose';\nimport states from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuLink from './menu-link';\nimport RelativeTime from './relative-time';\nimport SubMenu2 from './submenu2';\n\n// Function to fetch the latest posts from the current user\n// Use pmem to memoize fetch results for 1 minute\nconst fetchLatestPostsMemoized = pmem(\n  async (masto, currentAccountID) => {\n    const statusesIterator = masto.v1.accounts\n      .$select(currentAccountID)\n      .statuses.list({\n        limit: 3,\n        exclude_replies: true,\n        exclude_reblogs: true,\n      })\n      .values();\n    const { value } = await statusesIterator.next();\n    return value || [];\n  },\n  { expires: 60000 },\n); // 1 minute cache\n\nexport default function ComposeButton() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto } = api();\n\n  // Context menu state\n  const [menuOpen, setMenuOpen] = useState(false);\n  const [latestPosts, setLatestPosts] = useState([]);\n  const [loadingPosts, setLoadingPosts] = useState(false);\n  const buttonRef = useRef(null);\n  const menuRef = useRef(null);\n\n  const columnMode = snapStates.settings.shortcutsViewMode === 'multi-column';\n\n  function handleButton(e) {\n    // useKey will even listen to Shift\n    // e.g. press Shift (without c) will trigger this \n    if (e.key && e.key.toLowerCase() !== 'c') return;\n\n    if (snapStates.composerState.minimized) {\n      states.composerState.minimized = false;\n      openOSK();\n      return;\n    }\n\n    const composeDataElements = document.querySelectorAll('data.compose-data');\n    // If there's a lot of them, ignore\n    const opts =\n      !columnMode && composeDataElements.length === 1\n        ? JSON.parse(composeDataElements[0].value)\n        : undefined;\n\n    if (e.shiftKey) {\n      const newWin = openCompose(opts);\n\n      if (!newWin) {\n        states.showCompose = opts || true;\n      }\n    } else {\n      openOSK();\n      states.showCompose = opts || true;\n    }\n  }\n\n  useHotkeys('c, shift+c', handleButton, {\n    useKey: true,\n    ignoreEventWhen: (e) => {\n      const hasModal = !!document.querySelector('#modal-container > *');\n      return hasModal || e.metaKey || e.ctrlKey || e.altKey;\n    },\n  });\n\n  // Setup longpress handler to open context menu\n  const bindLongPress = useLongPress(\n    () => {\n      setMenuOpen(true);\n    },\n    {\n      threshold: 600,\n    },\n  );\n\n  const fetchLatestPosts = useCallback(async () => {\n    try {\n      setLoadingPosts(true);\n      const currentAccountID = getCurrentAccountID();\n      if (!currentAccountID) {\n        return;\n      }\n      const posts = await fetchLatestPostsMemoized(masto, currentAccountID);\n      setLatestPosts(posts);\n    } catch (error) {\n    } finally {\n      setLoadingPosts(false);\n    }\n  }, [masto]);\n\n  // Function to handle opening the compose window to reply to a post\n  const handleReplyToPost = useCallback((post) => {\n    showCompose({\n      replyToStatus: post,\n    });\n    setMenuOpen(false);\n  }, []);\n\n  useEffect(() => {\n    if (menuOpen) {\n      fetchLatestPosts();\n    }\n  }, [fetchLatestPosts, menuOpen]);\n\n  return (\n    <>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        id=\"compose-button\"\n        onClick={handleButton}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          setMenuOpen(true);\n        }}\n        {...bindLongPress()}\n        class={`${snapStates.composerState.minimized ? 'min' : ''} ${\n          snapStates.composerState.publishing ? 'loading' : ''\n        } ${snapStates.composerState.publishingError ? 'error' : ''}`}\n      >\n        <Icon icon=\"quill\" size=\"xl\" alt={t`Compose`} />\n      </button>\n      <ControlledMenu\n        ref={menuRef}\n        state={menuOpen ? 'open' : undefined}\n        anchorRef={buttonRef}\n        onClose={() => setMenuOpen(false)}\n        direction=\"top\"\n        gap={8} // Add gap between menu and button\n        unmountOnClose\n        portal={{\n          target: document.body,\n        }}\n        boundingBoxPadding={safeBoundingBoxPadding()}\n        containerProps={{\n          style: {\n            zIndex: 19,\n          },\n          onClick: () => {\n            menuRef.current?.closeMenu?.();\n          },\n        }}\n        submenuOpenDelay={600}\n      >\n        <MenuLink to=\"/sp\">\n          <Icon icon=\"schedule\" />{' '}\n          <span>\n            <Trans>Scheduled Posts</Trans>\n          </span>\n        </MenuLink>\n        <MenuDivider />\n        <SubMenu2\n          align=\"end\"\n          direction=\"top\"\n          shift={-8}\n          disabled={loadingPosts || latestPosts.length === 0}\n          label={\n            <>\n              <Icon icon=\"comment\" />{' '}\n              <span className=\"menu-grow\">\n                <Trans>Add to thread</Trans>\n              </span>\n              {loadingPosts ? '' : <Icon icon=\"chevron-right\" />}\n            </>\n          }\n        >\n          {latestPosts.length > 0 &&\n            latestPosts.map((post) => {\n              const createdDate = new Date(post.createdAt);\n              const isWithinDay = Date.now() - createdDate.getTime() < 86400000;\n\n              return (\n                <MenuItem key={post.id} onClick={() => handleReplyToPost(post)}>\n                  <small>\n                    <div class=\"menu-post-text\">{statusPeek(post)}</div>\n                    <span className=\"more-insignificant\">\n                      {/* Show relative time if within a day */}\n                      {isWithinDay && (\n                        <>\n                          <RelativeTime datetime={createdDate} format=\"micro\" />{' '}\n                          {' '}\n                        </>\n                      )}\n                      <time\n                        className=\"created\"\n                        dateTime={createdDate.toISOString()}\n                        title={createdDate.toLocaleString()}\n                      >\n                        {niceDateTime(post.createdAt)}\n                      </time>\n                    </span>\n                  </small>\n                </MenuItem>\n              );\n            })}\n        </SubMenu2>\n      </ControlledMenu>\n    </>\n  );\n}\n","import './keyboard-shortcuts-help.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Modal from './modal';\n\n// Helper component for sequential key shortcuts\nfunction SequentialKeys({ key1, key2 }) {\n  return (\n    <Trans>\n      <kbd>{key1}</kbd> then <kbd>{key2}</kbd>\n    </Trans>\n  );\n}\n\nexport default memo(function KeyboardShortcutsHelp() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n\n  function onClose() {\n    states.showKeyboardShortcutsHelp = false;\n  }\n\n  useHotkeys(\n    '?',\n    () => {\n      console.log('help');\n      states.showKeyboardShortcutsHelp = true;\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => {\n        const isCatchUpPage = /\\/catchup/i.test(location.hash);\n        return isCatchUpPage || e.metaKey || e.ctrlKey || e.altKey;\n        // const hasModal = !!document.querySelector('#modal-container > *');\n        // return hasModal;\n      },\n    },\n  );\n\n  return (\n    !!snapStates.showKeyboardShortcutsHelp && (\n      <Modal onClose={onClose}>\n        <div id=\"keyboard-shortcuts-help-container\" class=\"sheet\" tabindex=\"-1\">\n          <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n          <header>\n            <h2>\n              <Trans>Keyboard shortcuts</Trans>\n            </h2>\n          </header>\n          <main>\n            <table>\n              <tbody>\n                {[\n                  {\n                    action: t`Keyboard shortcuts help`,\n                    keys: <kbd>?</kbd>,\n                  },\n                  {\n                    action: t`Next post`,\n                    keys: <kbd>j</kbd>,\n                  },\n                  {\n                    action: t`Previous post`,\n                    keys: <kbd>k</kbd>,\n                  },\n                  {\n                    action: t`Skip carousel to next post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>j</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Skip carousel to previous post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>k</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Load new posts`,\n                    keys: <kbd>.</kbd>,\n                  },\n                  {\n                    action: t`Open post details`,\n                    keys: (\n                      <Trans>\n                        <kbd>Enter</kbd> or <kbd>o</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: (\n                      <Trans>\n                        Expand content warning or\n                        <br />\n                        toggle expanded/collapsed thread\n                      </Trans>\n                    ),\n                    keys: <kbd>x</kbd>,\n                  },\n                  {\n                    action: t`Close post or dialogs`,\n                    keys: (\n                      <Trans>\n                        <kbd>Esc</kbd> or <kbd>Backspace</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Focus column in multi-column mode`,\n                    keys: (\n                      <Trans>\n                        <kbd>1</kbd> to <kbd>9</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Focus next column in multi-column mode`,\n                    keys: <kbd>]</kbd>,\n                  },\n                  {\n                    action: t`Focus previous column in multi-column mode`,\n                    keys: <kbd>[</kbd>,\n                  },\n                  {\n                    action: t`Compose new post`,\n                    keys: <kbd>c</kbd>,\n                  },\n                  {\n                    action: t`Compose new post (new window)`,\n                    className: 'insignificant',\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>c</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Send post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Ctrl</kbd> + <kbd>Enter</kbd> or <kbd></kbd> +{' '}\n                        <kbd>Enter</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Search`,\n                    keys: <kbd>/</kbd>,\n                  },\n                  {\n                    action: t`Reply`,\n                    keys: <kbd>r</kbd>,\n                  },\n                  {\n                    action: t`Reply (new window)`,\n                    className: 'insignificant',\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>r</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Like (favourite)`,\n                    keys: (\n                      <Trans>\n                        <kbd>l</kbd> or <kbd>f</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Boost`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>b</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Quote`,\n                    keys: <kbd>q</kbd>,\n                  },\n                  {\n                    action: t`Bookmark`,\n                    keys: <kbd>d</kbd>,\n                  },\n                  {\n                    action: t`Toggle Cloak mode`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>Alt</kbd> + <kbd>k</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Go to Home`,\n                    keys: <SequentialKeys key1=\"g\" key2=\"h\" />,\n                  },\n                  {\n                    action: t`Go to Notifications`,\n                    keys: <SequentialKeys key1=\"g\" key2=\"n\" />,\n                  },\n                ].map(({ action, className, keys }) => (\n                  <tr key={action}>\n                    <th class={className}>{action}</th>\n                    <td>{keys}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </main>\n        </div>\n      </Modal>\n    )\n  );\n});\n","/**\n * A set of all the parents currently being observe. This is the only non weak\n * registry.\n */\nconst parents = new Set();\n/**\n * Element coordinates that is constantly kept up to date.\n */\nconst coords = new WeakMap();\n/**\n * Siblings of elements that have been removed from the dom.\n */\nconst siblings = new WeakMap();\n/**\n * Animations that are currently running.\n */\nconst animations = new WeakMap();\n/**\n * A map of existing intersection observers used to track element movements.\n */\nconst intersections = new WeakMap();\n/**\n * A map of existing mutation observers used to track element movements.\n */\nconst mutationObservers = new WeakMap();\n/**\n * Intervals for automatically checking the position of elements occasionally.\n */\nconst intervals = new WeakMap();\n/**\n * The configuration options for each group of elements.\n */\nconst options = new WeakMap();\n/**\n * Debounce counters by id, used to debounce calls to update positions.\n */\nconst debounces = new WeakMap();\n/**\n * All parents that are currently enabled are tracked here.\n */\nconst enabled = new WeakSet();\n/**\n * The document used to calculate transitions.\n */\nlet root;\n/**\n * The roots XY scroll positions.\n */\nlet scrollX = 0;\nlet scrollY = 0;\n/**\n * Used to sign an element as the target.\n */\nconst TGT = \"__aa_tgt\";\n/**\n * Used to sign an element as being part of a removal.\n */\nconst DEL = \"__aa_del\";\n/**\n * Used to sign an element as being \"new\". When an element is removed from the\n * dom, but may cycle back in we can sign it with new to ensure the next time\n * it is recognized we consider it new.\n */\nconst NEW = \"__aa_new\";\n/**\n * Callback for handling all mutations.\n * @param mutations - A mutation list\n */\nconst handleMutations = (mutations) => {\n    const elements = getElements(mutations);\n    // If elements is \"false\" that means this mutation that should be ignored.\n    if (elements) {\n        elements.forEach((el) => animate(el));\n    }\n};\n/**\n *\n * @param entries - Elements that have been resized.\n */\nconst handleResizes = (entries) => {\n    entries.forEach((entry) => {\n        if (entry.target === root)\n            updateAllPos();\n        if (coords.has(entry.target))\n            updatePos(entry.target);\n    });\n};\n/**\n * Determine if an element is fully outside of the current viewport.\n * @param el - Element to test\n */\nfunction isOffscreen(el) {\n    const rect = el.getBoundingClientRect();\n    const vw = (root === null || root === void 0 ? void 0 : root.clientWidth) || 0;\n    const vh = (root === null || root === void 0 ? void 0 : root.clientHeight) || 0;\n    return rect.bottom < 0 || rect.top > vh || rect.right < 0 || rect.left > vw;\n}\n/**\n * Observe this elements position.\n * @param el - The element to observe the position of.\n */\nfunction observePosition(el) {\n    const oldObserver = intersections.get(el);\n    oldObserver === null || oldObserver === void 0 ? void 0 : oldObserver.disconnect();\n    let rect = coords.get(el);\n    let invocations = 0;\n    const buffer = 5;\n    if (!rect) {\n        rect = getCoords(el);\n        coords.set(el, rect);\n    }\n    const { offsetWidth, offsetHeight } = root;\n    const rootMargins = [\n        rect.top - buffer,\n        offsetWidth - (rect.left + buffer + rect.width),\n        offsetHeight - (rect.top + buffer + rect.height),\n        rect.left - buffer,\n    ];\n    const rootMargin = rootMargins\n        .map((px) => `${ -1 * Math.floor(px)}px`)\n        .join(\" \");\n    const observer = new IntersectionObserver(() => {\n        ++invocations > 1 && updatePos(el);\n    }, {\n        root,\n        threshold: 1,\n        rootMargin,\n    });\n    observer.observe(el);\n    intersections.set(el, observer);\n}\n/**\n * Update the exact position of a given element.\n * @param el - An element to update the position of.\n * @param debounce - Whether or not to debounce the update. After an animation is finished, it should update as soon as possible to prevent flickering on quick toggles.\n */\nfunction updatePos(el, debounce = true) {\n    clearTimeout(debounces.get(el));\n    const optionsOrPlugin = getOptions(el);\n    const delay = debounce\n        ? isPlugin(optionsOrPlugin)\n            ? 500\n            : optionsOrPlugin.duration\n        : 0;\n    debounces.set(el, setTimeout(async () => {\n        const currentAnimation = animations.get(el);\n        try {\n            await (currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.finished);\n            coords.set(el, getCoords(el));\n            observePosition(el);\n        }\n        catch {\n            // ignore errors as the `.finished` promise is rejected when animations were cancelled\n        }\n    }, delay));\n}\n/**\n * Updates all positions that are currently being tracked.\n */\nfunction updateAllPos() {\n    clearTimeout(debounces.get(root));\n    debounces.set(root, setTimeout(() => {\n        parents.forEach((parent) => forEach(parent, (el) => lowPriority(() => updatePos(el))));\n    }, 100));\n}\n/**\n * Its possible for a quick scroll or other fast events to get past the\n * intersection observer, so occasionally we need want \"cold-poll\" for the\n * latests and greatest position. We try to do this in the most non-disruptive\n * fashion possible. First we only do this ever couple seconds, staggard by a\n * random offset.\n * @param el - Element\n */\nfunction poll(el) {\n    setTimeout(() => {\n        intervals.set(el, setInterval(() => lowPriority(updatePos.bind(null, el)), 2000));\n    }, Math.round(2000 * Math.random()));\n}\n/**\n * Perform some operation that is non critical at some point.\n * @param callback\n */\nfunction lowPriority(callback) {\n    if (typeof requestIdleCallback === \"function\") {\n        requestIdleCallback(() => callback());\n    }\n    else {\n        requestAnimationFrame(() => callback());\n    }\n}\n/**\n * A resize observer, responsible for recalculating elements on resize.\n */\nlet resize;\n/**\n * Ensure the browser is supported.\n */\nconst supportedBrowser = typeof window !== \"undefined\" && \"ResizeObserver\" in window;\n/**\n * If this is in a browser, initialize our Web APIs\n */\nif (supportedBrowser) {\n    root = document.documentElement;\n    new MutationObserver(handleMutations);\n    resize = new ResizeObserver(handleResizes);\n    window.addEventListener(\"scroll\", () => {\n        scrollY = window.scrollY;\n        scrollX = window.scrollX;\n    });\n    resize.observe(root);\n}\n/**\n * Retrieves all the elements that may have been affected by the last mutation\n * including ones that have been removed and are no longer in the DOM.\n * @param mutations - A mutation list.\n * @returns\n */\nfunction getElements(mutations) {\n    const observedNodes = mutations.reduce((nodes, mutation) => {\n        return [\n            ...nodes,\n            ...Array.from(mutation.addedNodes),\n            ...Array.from(mutation.removedNodes),\n        ];\n    }, []);\n    // Short circuit if _only_ comment nodes are observed\n    const onlyCommentNodesObserved = observedNodes.every((node) => node.nodeName === \"#comment\");\n    if (onlyCommentNodesObserved)\n        return false;\n    return mutations.reduce((elements, mutation) => {\n        // Short circuit if we find a purposefully deleted node.\n        if (elements === false)\n            return false;\n        if (mutation.target instanceof Element) {\n            target(mutation.target);\n            if (!elements.has(mutation.target)) {\n                elements.add(mutation.target);\n                for (let i = 0; i < mutation.target.children.length; i++) {\n                    const child = mutation.target.children.item(i);\n                    if (!child)\n                        continue;\n                    if (DEL in child) {\n                        return false;\n                    }\n                    target(mutation.target, child);\n                    elements.add(child);\n                }\n            }\n            if (mutation.removedNodes.length) {\n                for (let i = 0; i < mutation.removedNodes.length; i++) {\n                    const child = mutation.removedNodes[i];\n                    if (DEL in child) {\n                        return false;\n                    }\n                    if (child instanceof Element) {\n                        elements.add(child);\n                        target(mutation.target, child);\n                        siblings.set(child, [\n                            mutation.previousSibling,\n                            mutation.nextSibling,\n                        ]);\n                    }\n                }\n            }\n        }\n        return elements;\n    }, new Set());\n}\n/**\n * Assign the target to an element.\n * @param el - The root element\n * @param child\n */\nfunction target(el, child) {\n    if (!child && !(TGT in el))\n        Object.defineProperty(el, TGT, { value: el });\n    else if (child && !(TGT in child))\n        Object.defineProperty(child, TGT, { value: el });\n}\n/**\n * Determines what kind of change took place on the given element and then\n * performs the proper animation based on that.\n * @param el - The specific element to animate.\n */\nfunction animate(el) {\n    var _a, _b;\n    const isMounted = el.isConnected;\n    const preExisting = coords.has(el);\n    if (isMounted && siblings.has(el))\n        siblings.delete(el);\n    if (((_a = animations.get(el)) === null || _a === void 0 ? void 0 : _a.playState) !== \"finished\") {\n        (_b = animations.get(el)) === null || _b === void 0 ? void 0 : _b.cancel();\n    }\n    if (NEW in el) {\n        add(el);\n    }\n    else if (preExisting && isMounted) {\n        remain(el);\n    }\n    else if (preExisting && !isMounted) {\n        remove(el);\n    }\n    else {\n        add(el);\n    }\n}\n/**\n * Removes all non-digits from a string and casts to a number.\n * @param str - A string containing a pixel value.\n * @returns\n */\nfunction raw(str) {\n    return Number(str.replace(/[^0-9.\\-]/g, \"\"));\n}\n/**\n * Get the scroll offset of elements\n * @param el - Element\n * @returns\n */\nfunction getScrollOffset(el) {\n    let p = el.parentElement;\n    while (p) {\n        if (p.scrollLeft || p.scrollTop) {\n            return { x: p.scrollLeft, y: p.scrollTop };\n        }\n        p = p.parentElement;\n    }\n    return { x: 0, y: 0 };\n}\n/**\n * Get the coordinates of elements adjusted for scroll position.\n * @param el - Element\n * @returns\n */\nfunction getCoords(el) {\n    const rect = el.getBoundingClientRect();\n    const { x, y } = getScrollOffset(el);\n    return {\n        top: rect.top + y,\n        left: rect.left + x,\n        width: rect.width,\n        height: rect.height,\n    };\n}\n/**\n * Returns the width/height that the element should be transitioned between.\n * This takes into account box-sizing.\n * @param el - Element being animated\n * @param oldCoords - Old set of Coordinates coordinates\n * @param newCoords - New set of Coordinates coordinates\n * @returns\n */\nfunction getTransitionSizes(el, oldCoords, newCoords) {\n    let widthFrom = oldCoords.width;\n    let heightFrom = oldCoords.height;\n    let widthTo = newCoords.width;\n    let heightTo = newCoords.height;\n    const styles = getComputedStyle(el);\n    const sizing = styles.getPropertyValue(\"box-sizing\");\n    if (sizing === \"content-box\") {\n        const paddingY = raw(styles.paddingTop) +\n            raw(styles.paddingBottom) +\n            raw(styles.borderTopWidth) +\n            raw(styles.borderBottomWidth);\n        const paddingX = raw(styles.paddingLeft) +\n            raw(styles.paddingRight) +\n            raw(styles.borderRightWidth) +\n            raw(styles.borderLeftWidth);\n        widthFrom -= paddingX;\n        widthTo -= paddingX;\n        heightFrom -= paddingY;\n        heightTo -= paddingY;\n    }\n    return [widthFrom, widthTo, heightFrom, heightTo].map(Math.round);\n}\n/**\n * Retrieves animation options for the current element.\n * @param el - Element to retrieve options for.\n * @returns\n */\nfunction getOptions(el) {\n    return TGT in el && options.has(el[TGT])\n        ? options.get(el[TGT])\n        : { duration: 250, easing: \"ease-in-out\" };\n}\n/**\n * Returns the target of a given animation (generally the parent).\n * @param el - An element to check for a target\n * @returns\n */\nfunction getTarget(el) {\n    if (TGT in el)\n        return el[TGT];\n    return undefined;\n}\n/**\n * Checks if animations are enabled or disabled for a given element.\n * @param el - Any element\n * @returns\n */\nfunction isEnabled(el) {\n    const target = getTarget(el);\n    return target ? enabled.has(target) : false;\n}\n/**\n * Iterate over the children of a given parent.\n * @param parent - A parent element\n * @param callback - A callback\n */\nfunction forEach(parent, ...callbacks) {\n    callbacks.forEach((callback) => callback(parent, options.has(parent)));\n    for (let i = 0; i < parent.children.length; i++) {\n        const child = parent.children.item(i);\n        if (child) {\n            callbacks.forEach((callback) => callback(child, options.has(child)));\n        }\n    }\n}\n/**\n * Always return tuple to provide consistent interface\n */\nfunction getPluginTuple(pluginReturn) {\n    if (Array.isArray(pluginReturn))\n        return pluginReturn;\n    return [pluginReturn];\n}\n/**\n * Determine if config is plugin\n */\nfunction isPlugin(config) {\n    return typeof config === \"function\";\n}\n/**\n * The element in question is remaining in the DOM.\n * @param el - Element to flip\n * @returns\n */\nfunction remain(el) {\n    const oldCoords = coords.get(el);\n    const newCoords = getCoords(el);\n    if (!isEnabled(el))\n        return coords.set(el, newCoords);\n    if (isOffscreen(el)) {\n        // When element is offscreen, skip FLIP to avoid broken transforms\n        coords.set(el, newCoords);\n        observePosition(el);\n        return;\n    }\n    let animation;\n    if (!oldCoords)\n        return;\n    const pluginOrOptions = getOptions(el);\n    if (typeof pluginOrOptions !== \"function\") {\n        let deltaLeft = oldCoords.left - newCoords.left;\n        let deltaTop = oldCoords.top - newCoords.top;\n        const deltaRight = oldCoords.left + oldCoords.width - (newCoords.left + newCoords.width);\n        const deltaBottom = oldCoords.top + oldCoords.height - (newCoords.top + newCoords.height);\n        // element is probably anchored and doesn't need to be offset\n        if (deltaBottom == 0)\n            deltaTop = 0;\n        if (deltaRight == 0)\n            deltaLeft = 0;\n        const [widthFrom, widthTo, heightFrom, heightTo] = getTransitionSizes(el, oldCoords, newCoords);\n        const start = {\n            transform: `translate(${deltaLeft}px, ${deltaTop}px)`,\n        };\n        const end = {\n            transform: `translate(0, 0)`,\n        };\n        if (widthFrom !== widthTo) {\n            start.width = `${widthFrom}px`;\n            end.width = `${widthTo}px`;\n        }\n        if (heightFrom !== heightTo) {\n            start.height = `${heightFrom}px`;\n            end.height = `${heightTo}px`;\n        }\n        animation = el.animate([start, end], {\n            duration: pluginOrOptions.duration,\n            easing: pluginOrOptions.easing,\n        });\n    }\n    else {\n        const [keyframes] = getPluginTuple(pluginOrOptions(el, \"remain\", oldCoords, newCoords));\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    coords.set(el, newCoords);\n    animation.addEventListener(\"finish\", updatePos.bind(null, el, false), {\n        once: true,\n    });\n}\n/**\n * Adds the element with a transition.\n * @param el - Animates the element being added.\n */\nfunction add(el) {\n    if (NEW in el)\n        delete el[NEW];\n    const newCoords = getCoords(el);\n    coords.set(el, newCoords);\n    const pluginOrOptions = getOptions(el);\n    if (!isEnabled(el))\n        return;\n    if (isOffscreen(el)) {\n        // Skip entry animation if element is not visible in viewport\n        observePosition(el);\n        return;\n    }\n    let animation;\n    if (typeof pluginOrOptions !== \"function\") {\n        animation = el.animate([\n            { transform: \"scale(.98)\", opacity: 0 },\n            { transform: \"scale(0.98)\", opacity: 0, offset: 0.5 },\n            { transform: \"scale(1)\", opacity: 1 },\n        ], {\n            duration: pluginOrOptions.duration * 1.5,\n            easing: \"ease-in\",\n        });\n    }\n    else {\n        const [keyframes] = getPluginTuple(pluginOrOptions(el, \"add\", newCoords));\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    animation.addEventListener(\"finish\", updatePos.bind(null, el, false), {\n        once: true,\n    });\n}\n/**\n * Clean up after removing an element from the dom.\n * @param el - Element being removed\n * @param styles - Optional styles that should be removed from the element.\n */\nfunction cleanUp(el, styles) {\n    var _a;\n    el.remove();\n    coords.delete(el);\n    siblings.delete(el);\n    animations.delete(el);\n    (_a = intersections.get(el)) === null || _a === void 0 ? void 0 : _a.disconnect();\n    setTimeout(() => {\n        if (DEL in el)\n            delete el[DEL];\n        Object.defineProperty(el, NEW, { value: true, configurable: true });\n        if (styles && el instanceof HTMLElement) {\n            for (const style in styles) {\n                el.style[style] = \"\";\n            }\n        }\n    }, 0);\n}\n/**\n * Animates the removal of an element.\n * @param el - Element to remove\n */\nfunction remove(el) {\n    var _a;\n    if (!siblings.has(el) || !coords.has(el))\n        return;\n    const [prev, next] = siblings.get(el);\n    Object.defineProperty(el, DEL, { value: true, configurable: true });\n    const finalX = window.scrollX;\n    const finalY = window.scrollY;\n    if (next &&\n        next.parentNode &&\n        next.parentNode instanceof Element) {\n        next.parentNode.insertBefore(el, next);\n    }\n    else if (prev && prev.parentNode) {\n        prev.parentNode.appendChild(el);\n    }\n    else {\n        (_a = getTarget(el)) === null || _a === void 0 ? void 0 : _a.appendChild(el);\n    }\n    if (!isEnabled(el))\n        return cleanUp(el);\n    const [top, left, width, height] = deletePosition(el);\n    const optionsOrPlugin = getOptions(el);\n    const oldCoords = coords.get(el);\n    if (finalX !== scrollX || finalY !== scrollY) {\n        adjustScroll(el, finalX, finalY, optionsOrPlugin);\n    }\n    let animation;\n    let styleReset = {\n        position: \"absolute\",\n        top: `${top}px`,\n        left: `${left}px`,\n        width: `${width}px`,\n        height: `${height}px`,\n        margin: \"0\",\n        pointerEvents: \"none\",\n        transformOrigin: \"center\",\n        zIndex: \"100\",\n    };\n    if (!isPlugin(optionsOrPlugin)) {\n        Object.assign(el.style, styleReset);\n        animation = el.animate([\n            {\n                transform: \"scale(1)\",\n                opacity: 1,\n            },\n            {\n                transform: \"scale(.98)\",\n                opacity: 0,\n            },\n        ], {\n            duration: optionsOrPlugin.duration,\n            easing: \"ease-out\",\n        });\n    }\n    else {\n        const [keyframes, options] = getPluginTuple(optionsOrPlugin(el, \"remove\", oldCoords));\n        if ((options === null || options === void 0 ? void 0 : options.styleReset) !== false) {\n            styleReset =\n                (options === null || options === void 0 ? void 0 : options.styleReset) ||\n                    styleReset;\n            Object.assign(el.style, styleReset);\n        }\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    animation.addEventListener(\"finish\", () => cleanUp(el, styleReset), {\n        once: true,\n    });\n}\n/**\n * If the element being removed is at the very bottom of the page, and the\n * the page was scrolled into a space being \"made available\" by the element\n * that was removed, the page scroll will have jumped up some amount. We need\n * to offset the jump by the amount that the page was \"automatically\" scrolled\n * up. We can do this by comparing the scroll position before and after the\n * element was removed, and then offsetting by that amount.\n *\n * @param el - The element being deleted\n * @param finalX - The final X scroll position\n * @param finalY - The final Y scroll position\n * @param optionsOrPlugin - The options or plugin\n * @returns\n */\nfunction adjustScroll(el, finalX, finalY, optionsOrPlugin) {\n    const scrollDeltaX = scrollX - finalX;\n    const scrollDeltaY = scrollY - finalY;\n    const scrollBefore = document.documentElement.style.scrollBehavior;\n    const scrollBehavior = getComputedStyle(root).scrollBehavior;\n    if (scrollBehavior === \"smooth\") {\n        document.documentElement.style.scrollBehavior = \"auto\";\n    }\n    window.scrollTo(window.scrollX + scrollDeltaX, window.scrollY + scrollDeltaY);\n    if (!el.parentElement)\n        return;\n    const parent = el.parentElement;\n    let lastHeight = parent.clientHeight;\n    let lastWidth = parent.clientWidth;\n    const startScroll = performance.now();\n    // Here we use a manual scroll animation to keep the element using the same\n    // easing and timing as the parents scroll animation.\n    function smoothScroll() {\n        requestAnimationFrame(() => {\n            if (!isPlugin(optionsOrPlugin)) {\n                const deltaY = lastHeight - parent.clientHeight;\n                const deltaX = lastWidth - parent.clientWidth;\n                if (startScroll + optionsOrPlugin.duration >\n                    performance.now()) {\n                    window.scrollTo({\n                        left: window.scrollX - deltaX,\n                        top: window.scrollY - deltaY,\n                    });\n                    lastHeight = parent.clientHeight;\n                    lastWidth = parent.clientWidth;\n                    smoothScroll();\n                }\n                else {\n                    document.documentElement.style.scrollBehavior = scrollBefore;\n                }\n            }\n        });\n    }\n    smoothScroll();\n}\n/**\n * Determines the position of the element being removed.\n * @param el - The element being deleted\n * @returns\n */\nfunction deletePosition(el) {\n    var _a;\n    const oldCoords = coords.get(el);\n    const [width, , height] = getTransitionSizes(el, oldCoords, getCoords(el));\n    let offsetParent = el.parentElement;\n    while (offsetParent &&\n        (getComputedStyle(offsetParent).position === \"static\" ||\n            offsetParent instanceof HTMLBodyElement)) {\n        offsetParent = offsetParent.parentElement;\n    }\n    if (!offsetParent)\n        offsetParent = document.body;\n    const parentStyles = getComputedStyle(offsetParent);\n    const parentCoords = !animations.has(el) || ((_a = animations.get(el)) === null || _a === void 0 ? void 0 : _a.playState) === \"finished\"\n        ? getCoords(offsetParent)\n        : coords.get(offsetParent);\n    const top = Math.round(oldCoords.top - parentCoords.top) -\n        raw(parentStyles.borderTopWidth);\n    const left = Math.round(oldCoords.left - parentCoords.left) -\n        raw(parentStyles.borderLeftWidth);\n    return [top, left, width, height];\n}\n/**\n * A function that automatically adds animation effects to itself and its\n * immediate children. Specifically it adds effects for adding, moving, and\n * removing DOM elements.\n * @param el - A parent element to add animations to.\n * @param options - An optional object of options.\n */\nfunction autoAnimate(el, config = {}) {\n    if (supportedBrowser && resize) {\n        const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n        const isDisabledDueToReduceMotion = mediaQuery.matches &&\n            !isPlugin(config) &&\n            !config.disrespectUserMotionPreference;\n        if (!isDisabledDueToReduceMotion) {\n            enabled.add(el);\n            if (getComputedStyle(el).position === \"static\") {\n                Object.assign(el.style, { position: \"relative\" });\n            }\n            forEach(el, updatePos, poll, (element) => resize === null || resize === void 0 ? void 0 : resize.observe(element));\n            if (isPlugin(config)) {\n                options.set(el, config);\n            }\n            else {\n                options.set(el, {\n                    duration: 250,\n                    easing: \"ease-in-out\",\n                    ...config,\n                });\n            }\n            const mo = new MutationObserver(handleMutations);\n            mo.observe(el, { childList: true });\n            mutationObservers.set(el, mo);\n            parents.add(el);\n        }\n    }\n    const controller = Object.freeze({\n        parent: el,\n        enable: () => {\n            enabled.add(el);\n        },\n        disable: () => {\n            enabled.delete(el);\n            // Cancel any in-flight animations and pending timers for immediate effect\n            forEach(el, (node) => {\n                const a = animations.get(node);\n                try {\n                    a === null || a === void 0 ? void 0 : a.cancel();\n                }\n                catch { }\n                animations.delete(node);\n                const d = debounces.get(node);\n                if (d)\n                    clearTimeout(d);\n                debounces.delete(node);\n                const i = intervals.get(node);\n                if (i)\n                    clearInterval(i);\n                intervals.delete(node);\n            });\n        },\n        isEnabled: () => enabled.has(el),\n        destroy: () => {\n            enabled.delete(el);\n            parents.delete(el);\n            options.delete(el);\n            const mo = mutationObservers.get(el);\n            mo === null || mo === void 0 ? void 0 : mo.disconnect();\n            mutationObservers.delete(el);\n            forEach(el, (node) => {\n                // unobserve resize\n                resize === null || resize === void 0 ? void 0 : resize.unobserve(node);\n                // cancel animations\n                const a = animations.get(node);\n                try {\n                    a === null || a === void 0 ? void 0 : a.cancel();\n                }\n                catch { }\n                animations.delete(node);\n                // disconnect observers\n                const io = intersections.get(node);\n                io === null || io === void 0 ? void 0 : io.disconnect();\n                intersections.delete(node);\n                // clear intervals and debounces\n                const i = intervals.get(node);\n                if (i)\n                    clearInterval(i);\n                intervals.delete(node);\n                const d = debounces.get(node);\n                if (d)\n                    clearTimeout(d);\n                debounces.delete(node);\n                // clear state\n                coords.delete(node);\n                siblings.delete(node);\n            });\n        },\n    });\n    return controller;\n}\n/**\n * The vue directive.\n */\nconst vAutoAnimate = {\n    mounted: (el, binding) => {\n        const ctl = autoAnimate(el, binding.value || {});\n        Object.defineProperty(el, \"__aa_ctl\", { value: ctl, configurable: true });\n    },\n    unmounted: (el) => {\n        var _a;\n        const ctl = el[\"__aa_ctl\"];\n        (_a = ctl === null || ctl === void 0 ? void 0 : ctl.destroy) === null || _a === void 0 ? void 0 : _a.call(ctl);\n        try {\n            delete el[\"__aa_ctl\"];\n        }\n        catch { }\n    },\n    getSSRProps: () => ({}),\n};\n\nexport { autoAnimate, autoAnimate as default, getTransitionSizes, vAutoAnimate };\n","import { useRef, useState, useEffect } from 'preact/hooks';\nimport autoAnimate from '../index.mjs';\n\n/**\n * AutoAnimate hook for adding dead-simple transitions and animations to preact.\n * @param options - Auto animate options or a plugin\n * @returns\n */\nfunction useAutoAnimate(options) {\n    const element = useRef(null);\n    const [controller, setController] = useState();\n    const setEnabled = (enabled) => {\n        if (controller) {\n            enabled ? controller.enable() : controller.disable();\n        }\n    };\n    useEffect(() => {\n        if (element.current instanceof HTMLElement)\n            setController(autoAnimate(element.current, options || {}));\n    }, []);\n    useEffect(() => {\n        return () => {\n            var _a;\n            (_a = controller === null || controller === void 0 ? void 0 : controller.destroy) === null || _a === void 0 ? void 0 : _a.call(controller);\n        };\n    }, [controller]);\n    return [element, setEnabled];\n}\n\nexport { useAutoAnimate };\n","function dec2hex(dec) {\n  return ('0' + dec.toString(16)).slice(-2);\n}\nexport function verifier() {\n  var array = new Uint32Array(56 / 2);\n  window.crypto.getRandomValues(array);\n  return Array.from(array, dec2hex).join('');\n}\nfunction sha256(plain) {\n  // returns promise ArrayBuffer\n  const encoder = new TextEncoder();\n  const data = encoder.encode(plain);\n  return window.crypto.subtle.digest('SHA-256', data);\n}\nfunction base64urlencode(a) {\n  let str = '';\n  const bytes = new Uint8Array(a);\n  const len = bytes.byteLength;\n  for (var i = 0; i < len; i++) {\n    str += String.fromCharCode(bytes[i]);\n  }\n  return btoa(str).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n}\nexport async function generateCodeChallenge(v) {\n  const hashed = await sha256(v);\n  return base64urlencode(hashed);\n}\n\n// If /.well-known/oauth-authorization-server exists and code_challenge_methods_supported includes \"S256\", means support PKCE\nexport async function supportsPKCE({ instanceURL }) {\n  if (!instanceURL) return false;\n  try {\n    const res = await fetch(\n      `https://${instanceURL}/.well-known/oauth-authorization-server`,\n    );\n    if (!res.ok || res.status !== 200) return false;\n    const json = await res.json();\n    if (json.code_challenge_methods_supported?.includes('S256')) return true;\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\n// For debugging\nwindow.__generateCodeChallenge = generateCodeChallenge;\n","import { generateCodeChallenge, verifier } from './oauth-pkce';\n\nconst {\n  DEV,\n  PHANPY_CLIENT_NAME: CLIENT_NAME,\n  PHANPY_WEBSITE: WEBSITE,\n} = import.meta.env;\n\nconst SCOPES = 'read write follow push';\n\n/*\n  PHANPY_WEBSITE is set to the default official site.\n  It's used in pre-built releases, so there's no way to change it dynamically\n  without rebuilding.\n  Therefore, we can't use it as redirect_uri.\n  We only use PHANPY_WEBSITE if it's \"same\" as current location URL.\n  \n  Very basic check based on location.hostname for now\n*/\nconst sameSite = WEBSITE\n  ? WEBSITE.toLowerCase().includes(location.hostname)\n  : false;\nconst currentLocation = location.origin + location.pathname;\nconst REDIRECT_URI = DEV || !sameSite ? currentLocation : WEBSITE;\n\nexport async function registerApplication({ instanceURL }) {\n  const registrationParams = new URLSearchParams({\n    client_name: CLIENT_NAME,\n    redirect_uris: REDIRECT_URI,\n    scopes: SCOPES,\n    website: WEBSITE || REDIRECT_URI,\n  });\n  const registrationResponse = await fetch(\n    `https://${instanceURL}/api/v1/apps`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: registrationParams.toString(),\n    },\n  );\n  const registrationJSON = await registrationResponse.json();\n  if (DEV) console.log({ registrationJSON });\n  return registrationJSON;\n}\n\nexport async function getPKCEAuthorizationURL({\n  instanceURL,\n  client_id,\n  forceLogin = false,\n}) {\n  const codeVerifier = verifier();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const params = new URLSearchParams({\n    client_id,\n    code_challenge_method: 'S256',\n    code_challenge: codeChallenge,\n    redirect_uri: REDIRECT_URI,\n    response_type: 'code',\n    scope: SCOPES,\n  });\n  if (forceLogin) params.append('force_login', true);\n  const authorizationURL = `https://${instanceURL}/oauth/authorize?${params.toString()}`;\n  return [authorizationURL, codeVerifier];\n}\n\nexport async function getAuthorizationURL({\n  instanceURL,\n  client_id,\n  forceLogin = false,\n}) {\n  const authorizationParams = new URLSearchParams({\n    client_id,\n    scope: SCOPES,\n    redirect_uri: REDIRECT_URI,\n    // redirect_uri: 'urn:ietf:wg:oauth:2.0:oob',\n    response_type: 'code',\n  });\n  if (forceLogin) authorizationParams.append('force_login', true);\n  const authorizationURL = `https://${instanceURL}/oauth/authorize?${authorizationParams.toString()}`;\n  return authorizationURL;\n}\n\nexport async function getAccessToken({\n  instanceURL,\n  client_id,\n  client_secret,\n  code,\n  code_verifier,\n}) {\n  const params = new URLSearchParams({\n    client_id,\n    redirect_uri: REDIRECT_URI,\n    grant_type: 'authorization_code',\n    code,\n    // scope: SCOPES, // Not needed\n    // client_secret,\n    // code_verifier,\n  });\n  if (client_secret) {\n    params.append('client_secret', client_secret);\n  }\n  if (code_verifier) {\n    params.append('code_verifier', code_verifier);\n  }\n  const tokenResponse = await fetch(`https://${instanceURL}/oauth/token`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: params.toString(),\n  });\n  const tokenJSON = await tokenResponse.json();\n  if (DEV) console.log({ tokenJSON });\n  return tokenJSON;\n}\n\nexport async function revokeAccessToken({\n  instanceURL,\n  client_id,\n  client_secret,\n  token,\n}) {\n  try {\n    const params = new URLSearchParams({\n      client_id,\n      client_secret,\n      token,\n    });\n\n    const revokeResponse = await fetch(`https://${instanceURL}/oauth/revoke`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n      keepalive: true,\n    });\n\n    return revokeResponse.ok;\n  } catch (error) {\n    console.error('Error revoking token', error);\n    return false;\n  }\n}\n","import './accounts.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useReducer } from 'preact/hooks';\n\nimport Avatar from '../components/avatar';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport MenuConfirm from '../components/menu-confirm';\nimport MenuLink from '../components/menu-link';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport { api } from '../utils/api';\nimport { revokeAccessToken } from '../utils/auth';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport {\n  getAccounts,\n  getCurrentAccountID,\n  saveAccounts,\n  setCurrentAccountID,\n} from '../utils/store-utils';\n\nconst isStandalone = window.matchMedia('(display-mode: standalone)').matches;\n\nfunction Accounts({ onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  // Accounts\n  const accounts = getAccounts();\n  const currentAccount = getCurrentAccountID();\n  const moreThanOneAccount = accounts.length > 1;\n\n  const [_, reload] = useReducer((x) => x + 1, 0);\n  const [accountsListParent] = useAutoAnimate();\n\n  return (\n    <div id=\"accounts-container\" class=\"sheet\" tabIndex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Accounts</Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <ul class=\"accounts-list\" ref={accountsListParent}>\n            {accounts.map((account, i) => {\n              const isCurrent = account.info.id === currentAccount;\n              const isDefault = i === 0; // first account is always default\n              const isLoggedOut = !account.accessToken;\n              return (\n                <li key={account.info.id}>\n                  <div>\n                    {moreThanOneAccount && (\n                      <span class={`current ${isCurrent ? 'is-current' : ''}`}>\n                        <Icon icon=\"check-circle\" alt={t`Current`} />\n                      </span>\n                    )}\n                    <Avatar\n                      url={account.info.avatarStatic}\n                      size=\"xxl\"\n                      onDblClick={async () => {\n                        if (isCurrent) {\n                          try {\n                            const info = await masto.v1.accounts\n                              .$select(account.info.id)\n                              .fetch();\n                            console.log('fetched account info', info);\n                            account.info = info;\n                            saveAccounts(accounts);\n                            reload();\n                          } catch (e) {}\n                        }\n                      }}\n                    />\n                    <NameText\n                      account={\n                        moreThanOneAccount\n                          ? {\n                              ...account.info,\n                              acct: /@/.test(account.info.acct)\n                                ? account.info.acct\n                                : `${account.info.acct}@${account.instanceURL}`,\n                            }\n                          : account.info\n                      }\n                      showAcct\n                      onClick={() => {\n                        if (isLoggedOut) {\n                          location.href = `/#/login?instance=${account.instanceURL}`;\n                          onClose();\n                        } else if (isCurrent) {\n                          states.showAccount = `${account.info.username}@${account.instanceURL}`;\n                        } else {\n                          setCurrentAccountID(account.info.id);\n                          location.reload();\n                        }\n                      }}\n                    />\n                  </div>\n                  <div class=\"actions\">\n                    {isLoggedOut && (\n                      <span class=\"tag\">\n                        <Trans>Logged out</Trans>\n                      </span>\n                    )}\n                    {isDefault && moreThanOneAccount && (\n                      <>\n                        <span class=\"tag\">\n                          <Trans>Default</Trans>\n                        </span>{' '}\n                      </>\n                    )}\n                    <Menu2\n                      align=\"end\"\n                      menuButton={\n                        <button type=\"button\" class=\"plain more-button\">\n                          <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n                        </button>\n                      }\n                    >\n                      {moreThanOneAccount && (\n                        <>\n                          <MenuItem\n                            disabled={isCurrent || isLoggedOut}\n                            onClick={() => {\n                              setCurrentAccountID(account.info.id);\n                              location.reload();\n                            }}\n                          >\n                            <Icon icon=\"transfer\" />{' '}\n                            <Trans>Switch to this account</Trans>\n                          </MenuItem>\n                          {!isStandalone && !isCurrent && !isLoggedOut && (\n                            <MenuLink\n                              href={`./?account=${account.info.id}`}\n                              target=\"_blank\"\n                            >\n                              <Icon icon=\"external\" />\n                              <span>\n                                <Trans>Switch in new tab/window</Trans>\n                              </span>\n                            </MenuLink>\n                          )}\n                          <MenuDivider />\n                        </>\n                      )}\n                      <MenuItem\n                        onClick={() => {\n                          states.showAccount = `${account.info.username}@${account.instanceURL}`;\n                        }}\n                      >\n                        <Icon icon=\"user\" />\n                        <span>\n                          <Trans>View profile</Trans>\n                        </span>\n                      </MenuItem>\n                      <MenuDivider />\n                      {moreThanOneAccount && (\n                        <>\n                          <MenuItem\n                            disabled={isDefault || isLoggedOut}\n                            onClick={() => {\n                              // Move account to the top of the list\n                              accounts.splice(i, 1);\n                              accounts.unshift(account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"check-circle\" />\n                            <span>\n                              <Trans>Set as default</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuItem\n                            disabled={i <= 1}\n                            onClick={() => {\n                              // Move account one position up\n                              accounts.splice(i, 1);\n                              accounts.splice(i - 1, 0, account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"arrow-up\" />\n                            <span>\n                              <Trans>Move up</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuItem\n                            disabled={i === 0 || i === accounts.length - 1}\n                            onClick={() => {\n                              // Move account one position down\n                              accounts.splice(i, 1);\n                              accounts.splice(i + 1, 0, account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"arrow-down\" />\n                            <span>\n                              <Trans>Move down</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuDivider />\n                        </>\n                      )}\n                      <MenuConfirm\n                        subMenu\n                        confirmLabel={\n                          <>\n                            <Icon icon=\"exit\" />\n                            <span>\n                              <Trans>\n                                Log out{' '}\n                                <span class=\"bidi-isolate\">\n                                  @{account.info.acct}\n                                </span>\n                                ?\n                              </Trans>\n                            </span>\n                          </>\n                        }\n                        disabled={!isCurrent || isLoggedOut}\n                        menuItemClassName=\"danger\"\n                        onClick={async () => {\n                          // const yes = confirm('Log out?');\n                          // if (!yes) return;\n                          await revokeAccessToken({\n                            instanceURL: account.instanceURL,\n                            client_id: account.clientId,\n                            client_secret: account.clientSecret,\n                            token: account.accessToken,\n                          });\n                          accounts.splice(i, 1);\n                          saveAccounts(accounts);\n                          // location.reload();\n                          try {\n                            // Clean up session currentAccount if same as deleted\n                            if (\n                              store.session.get('currentAccount') ===\n                              account.info.id\n                            ) {\n                              store.session.del('currentAccount');\n                            }\n                          } catch (e) {}\n                          location.href = location.pathname || '/';\n                        }}\n                      >\n                        <Icon icon=\"exit\" />\n                        <span>\n                          <Trans>Log out</Trans>\n                        </span>\n                      </MenuConfirm>\n                      {!!account?.createdAt && (\n                        <div class=\"footer\">\n                          <Icon icon=\"account-add\" />\n                          <span>\n                            <Trans>\n                              Connected on {niceDateTime(account.createdAt)} (\n                              <RelativeTime datetime={account.createdAt} />)\n                            </Trans>\n                          </span>\n                        </div>\n                      )}\n                    </Menu2>\n                  </div>\n                </li>\n              );\n            })}\n          </ul>\n          <p>\n            <Link to=\"/login\" class=\"button plain2\" onClick={onClose}>\n              <Icon icon=\"plus\" />{' '}\n              <span>\n                <Trans>Add an existing account</Trans>\n              </span>\n            </Link>\n          </p>\n          {moreThanOneAccount && (\n            <p>\n              <small>\n                <Trans>\n                  Note: <i>Default</i> account will always be used for first\n                  load. Switched accounts will persist during the session.\n                </Trans>\n              </small>\n            </p>\n          )}\n          <p>\n            <button\n              type=\"button\"\n              class=\"light\"\n              onClick={() => (states.showImportExportAccounts = true)}\n            >\n              <Trans>Import/export</Trans>\n            </button>\n          </p>\n        </section>\n      </main>\n    </div>\n  );\n}\n\nexport default Accounts;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e\"","// https://adactio.com/journal/22278\n// https://gist.github.com/adactio/a445544723363d37b9c31a74a03ef928\n\nclass ButtonInstall extends HTMLElement {\n  connectedCallback() {\n    this.button = this.querySelector('button');\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      this.button.remove();\n      return;\n    }\n    if (!navigator.install) {\n      this.button.remove();\n      return;\n    }\n    this.button.addEventListener('click', async (ev) => {\n      await navigator.install();\n    });\n  }\n}\n\ncustomElements.define('button-install', ButtonInstall);\n","import { useLingui } from '@lingui/react';\nimport { useMemo } from 'preact/hooks';\n\nimport { CATALOGS, DEFAULT_LANG, DEV_LOCALES, LOCALES } from '../locales';\nimport { activateLang } from '../utils/lang';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport store from '../utils/store';\n\nconst regionMaps = {\n  'zh-CN': 'zh-Hans',\n  'zh-TW': 'zh-Hant',\n  'pt-BR': 'pt-BR',\n};\n\nexport default function LangSelector() {\n  const { i18n } = useLingui();\n\n  // Sorted on render, so the order won't suddenly change based on current locale\n  const populatedLocales = useMemo(() => {\n    return LOCALES.map((lang) => {\n      // Don't need regions for now, it makes text too noisy\n      // Wait till there's too many languages and there are regional clashes\n      const regionlessCode = regionMaps[lang] || lang.replace(/-[a-z]+$/i, '');\n\n      const native = localeCode2Text({\n        code: regionlessCode,\n        locale: lang,\n        fallback: CATALOGS.find((c) => c.code === lang)?.nativeName,\n      });\n\n      // Not used when rendering because it'll change based on current locale\n      // Only used for sorting on render\n      const _common = localeCode2Text({\n        code: regionlessCode,\n        locale: i18n.locale,\n        fallback: CATALOGS.find((c) => c.code === lang)?.name,\n      });\n\n      return {\n        code: lang,\n        regionlessCode,\n        _common,\n        native,\n      };\n    }).sort((a, b) => {\n      // Sort by common name\n      const order = a._common.localeCompare(b._common, i18n.locale);\n      if (order !== 0) return order;\n      // Sort by code (fallback)\n      if (a.code < b.code) return -1;\n      if (a.code > b.code) return 1;\n      return 0;\n    });\n  }, []);\n\n  return (\n    <label class=\"lang-selector\">\n      {' '}\n      <select\n        class=\"small\"\n        value={i18n.locale || DEFAULT_LANG}\n        onChange={(e) => {\n          store.local.set('lang', e.target.value);\n          activateLang(e.target.value);\n        }}\n      >\n        {populatedLocales.map(({ code, regionlessCode, native }) => {\n          // Common name changes based on current locale\n          const common = localeCode2Text({\n            code: regionlessCode,\n            locale: i18n.locale,\n            fallback: CATALOGS.find((c) => c.code === code)?.name,\n          });\n          const showCommon = !!common && common !== native;\n          return (\n            <option\n              value={code}\n              data-regionless-code={regionlessCode}\n              key={code}\n            >\n              {showCommon ? `${native} - ${common}` : native}\n            </option>\n          );\n        })}\n        {(import.meta.env.DEV || import.meta.env.PHANPY_SHOW_DEV_LOCALES) && (\n          <optgroup label=\" Development (<50% translated)\">\n            {DEV_LOCALES.map((code) => {\n              if (code === 'pseudo-LOCALE') {\n                return (\n                  <>\n                    <hr />\n                    <option value={code} key={code}>\n                      Pseudolocalization (test)\n                    </option>\n                  </>\n                );\n              }\n              const nativeName = CATALOGS.find(\n                (c) => c.code === code,\n              )?.nativeName;\n              const completion = CATALOGS.find(\n                (c) => c.code === code,\n              )?.completion;\n              return (\n                <option value={code} key={code}>\n                  {nativeName || code} &lrm;[{completion}%]\n                </option>\n              );\n            })}\n          </optgroup>\n        )}\n      </select>\n    </label>\n  );\n}\n","// Utils for push notifications\nimport { api } from './api';\nimport { getVapidKey } from './store-utils';\n\n// Subscription is an object with the following structure:\n// {\n//   data: {\n//     alerts: {\n//       admin: {\n//         report: boolean,\n//         signUp: boolean,\n//       },\n//       favourite: boolean,\n//       follow: boolean,\n//       mention: boolean,\n//       poll: boolean,\n//       reblog: boolean,\n//       status: boolean,\n//       update: boolean,\n//     }\n//   },\n//   policy: \"all\" | \"followed\" | \"follower\" | \"none\",\n//   subscription: {\n//     endpoint: string,\n//     keys: {\n//       auth: string,\n//       p256dh: string,\n//     },\n//   },\n// }\n\n// Back-end CRUD\n// =============\n\nfunction createBackendPushSubscription(subscription) {\n  const { masto } = api();\n  return masto.v1.push.subscription.create(subscription);\n}\n\nfunction fetchBackendPushSubscription() {\n  const { masto } = api();\n  return masto.v1.push.subscription.fetch();\n}\n\nfunction updateBackendPushSubscription(subscription) {\n  const { masto } = api();\n  return masto.v1.push.subscription.update(subscription);\n}\n\nfunction removeBackendPushSubscription() {\n  const { masto } = api();\n  return masto.v1.push.subscription.remove();\n}\n\n// Front-end\n// =========\n\nexport function isPushSupported() {\n  return 'serviceWorker' in navigator && 'PushManager' in window;\n}\n\nexport function getRegistration() {\n  // return navigator.serviceWorker.ready;\n  return navigator.serviceWorker.getRegistration();\n}\n\nasync function getSubscription() {\n  const registration = await getRegistration();\n  const subscription = registration\n    ? await registration.pushManager.getSubscription()\n    : undefined;\n  return { registration, subscription };\n}\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = `${base64String}${padding}`\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n\n// Front-end <-> back-end\n// ======================\n\nexport async function initSubscription() {\n  if (!isPushSupported()) return;\n  const { subscription } = await getSubscription();\n  let backendSubscription = null;\n  try {\n    backendSubscription = await fetchBackendPushSubscription();\n  } catch (err) {\n    if (/(not found|unknown)/i.test(err.message)) {\n      // No subscription found\n    } else {\n      // Other error\n      throw err;\n    }\n  }\n  console.log('INIT subscription', {\n    subscription,\n    backendSubscription,\n  });\n\n  // Check if the subscription changed\n  if (backendSubscription && subscription) {\n    const sameEndpoint = backendSubscription.endpoint === subscription.endpoint;\n    const vapidKey = getVapidKey();\n    const sameKey = backendSubscription.serverKey === vapidKey;\n    if (!sameEndpoint) {\n      throw new Error('Backend subscription endpoint changed');\n    }\n    if (sameKey) {\n      // Subscription didn't change\n    } else {\n      // Subscription changed\n      console.error(' Subscription changed', {\n        sameEndpoint,\n        serverKey: backendSubscription.serverKey,\n        vapIdKey: vapidKey,\n        endpoint1: backendSubscription.endpoint,\n        endpoint2: subscription.endpoint,\n        sameKey,\n        key1: backendSubscription.serverKey,\n        key2: vapidKey,\n      });\n      throw new Error('Backend subscription key and vapid key changed');\n      // Only unsubscribe from backend, not from browser\n      // await removeBackendPushSubscription();\n      // // Now let's resubscribe\n      // // NOTE: I have no idea if this works\n      // return await updateSubscription({\n      //   data: backendSubscription.data,\n      //   policy: backendSubscription.policy,\n      // });\n    }\n  }\n\n  if (subscription && !backendSubscription) {\n    // check if account's vapidKey is same as subscription's applicationServerKey\n    const vapidKey = getVapidKey();\n    if (vapidKey) {\n      const { applicationServerKey } = subscription.options;\n      const vapidKeyStr = urlBase64ToUint8Array(vapidKey).toString();\n      const applicationServerKeyStr = new Uint8Array(\n        applicationServerKey,\n      ).toString();\n      const sameKey = vapidKeyStr === applicationServerKeyStr;\n      if (sameKey) {\n        // Subscription didn't change\n      } else {\n        // Subscription changed\n        console.error(' Subscription changed', {\n          vapidKeyStr,\n          applicationServerKeyStr,\n          sameKey,\n        });\n        // Unsubscribe since backend doesn't have a subscription\n        await subscription.unsubscribe();\n        throw new Error('Subscription key and vapid key changed');\n      }\n    } else {\n      console.warn('No vapidKey found');\n    }\n  }\n\n  // Check if backend subscription returns 404\n  // if (subscription && !backendSubscription) {\n  //   // Re-subscribe to backend\n  //   backendSubscription = await createBackendPushSubscription({\n  //     subscription,\n  //     data: {},\n  //     policy: 'all',\n  //   });\n  // }\n\n  return { subscription, backendSubscription };\n}\n\nexport async function updateSubscription({ data, policy }) {\n  console.log(' Updating subscription', { data, policy });\n  if (!isPushSupported()) return;\n  let { registration, subscription } = await getSubscription();\n  let backendSubscription = null;\n\n  if (subscription) {\n    try {\n      backendSubscription = await updateBackendPushSubscription({\n        data,\n        policy,\n      });\n      // TODO: save subscription in user settings\n    } catch (error) {\n      // Backend doesn't have a subscription for this user\n      // Create a new one\n      backendSubscription = await createBackendPushSubscription({\n        subscription,\n        data,\n        policy,\n      });\n      // TODO: save subscription in user settings\n    }\n  } else {\n    // User is not subscribed\n    const vapidKey = getVapidKey();\n    if (!vapidKey) throw new Error('No server key found');\n    subscription = await registration.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey: urlBase64ToUint8Array(vapidKey),\n    });\n    backendSubscription = await createBackendPushSubscription({\n      subscription,\n      data,\n      policy,\n    });\n    // TODO: save subscription in user settings\n  }\n\n  return { subscription, backendSubscription };\n}\n\nexport async function removeSubscription() {\n  if (!isPushSupported()) return;\n  const { subscription } = await getSubscription();\n  if (subscription) {\n    await removeBackendPushSubscription();\n    await subscription.unsubscribe();\n  }\n}\n","import './settings.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useDebounce } from 'use-debounce';\nimport { useSnapshot } from 'valtio';\n\nimport logo from '../assets/logo.svg';\n\nimport '../components/button-install';\n\nimport Icon from '../components/icon';\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport RelativeTime from '../components/relative-time';\nimport languages from '../data/translang-languages';\nimport { api, getPreferences, setPreferences } from '../utils/api';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport prettyBytes from '../utils/pretty-bytes';\nimport {\n  initSubscription,\n  isPushSupported,\n  removeSubscription,\n  updateSubscription,\n} from '../utils/push-notifications';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getAPIVersions, getVapidKey } from '../utils/store-utils';\n\nconst DEFAULT_TEXT_SIZE = 16;\nconst TEXT_SIZES = [14, 15, 16, 17, 18, 19, 20];\nconst SMALLEST_TEXT_SIZE = TEXT_SIZES[0];\nconst LARGEST_TEXT_SIZE = TEXT_SIZES[TEXT_SIZES.length - 1];\nconst {\n  PHANPY_WEBSITE: WEBSITE,\n  PHANPY_PRIVACY_POLICY_URL: PRIVACY_POLICY_URL,\n  PHANPY_TRANSLANG_INSTANCES: TRANSLANG_INSTANCES,\n  PHANPY_IMG_ALT_API_URL: IMG_ALT_API_URL,\n  PHANPY_GIPHY_API_KEY: GIPHY_API_KEY,\n  PHANPY_CLIENT_NAME: CLIENT_NAME,\n} = import.meta.env;\n\nconst targetLanguages = Object.entries(languages.tl).map(([code, name]) => ({\n  code,\n  name,\n}));\n\nconst TRANSLATION_API_NAME = 'TransLang API';\n\nfunction Settings({ onClose }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const currentTheme = store.local.get('theme') || 'auto';\n  const themeFormRef = useRef();\n  const targetLanguage =\n    snapStates.settings.contentTranslationTargetLanguage || null;\n  const systemTargetLanguage = getTranslateTargetLanguage();\n  const systemTargetLanguageText = localeCode2Text(systemTargetLanguage);\n  const currentTextSize = store.local.get('textSize') || DEFAULT_TEXT_SIZE;\n\n  const [prefs, setPrefs] = useState(getPreferences());\n  const { masto, authenticated, instance } = api();\n\n  // Get preferences every time Settings is opened\n  // NOTE: Disabled for now because I don't expect this to change often. Also for some reason, the /api/v1/preferences endpoint is cached for a while and return old prefs if refresh immediately after changing them.\n  // useEffect(() => {\n  //   const { masto } = api();\n  //   (async () => {\n  //     try {\n  //       const preferences = await masto.v1.preferences.fetch();\n  //       setPrefs(preferences);\n  //       store.account.set('preferences', preferences);\n  //     } catch (e) {\n  //       // Silently fail\n  //       console.error(e);\n  //     }\n  //   })();\n  // }, []);\n\n  const [expTabBarV2, setExpTabBarV2] = useState(\n    store.local.get('experiments-tabBarV2') ?? false,\n  );\n\n  const disableQuotePolicy = prefs['posting:default:visibility'] === 'private';\n\n  return (\n    <div\n      id=\"settings-container\"\n      class=\"sheet\"\n      tabIndex=\"-1\"\n      style={{\n        '--current-text-size': `${currentTextSize}px`,\n      }}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Settings</Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <ul>\n            <li>\n              <div>\n                <label>\n                  <Trans>Appearance</Trans>\n                </label>\n              </div>\n              <div>\n                <form\n                  ref={themeFormRef}\n                  onInput={(e) => {\n                    console.log(e);\n                    e.preventDefault();\n                    const formData = new FormData(themeFormRef.current);\n                    const theme = formData.get('theme');\n                    const html = document.documentElement;\n\n                    if (theme === 'auto') {\n                      html.classList.remove('is-light', 'is-dark');\n\n                      // Disable manual theme <meta>\n                      const $manualMeta = document.querySelector(\n                        'meta[data-theme-setting=\"manual\"]',\n                      );\n                      if ($manualMeta) {\n                        $manualMeta.name = '';\n                      }\n                      // Enable auto theme <meta>s\n                      const $autoMetas = document.querySelectorAll(\n                        'meta[data-theme-setting=\"auto\"]',\n                      );\n                      $autoMetas.forEach((m) => {\n                        m.name = 'theme-color';\n                      });\n                    } else {\n                      html.classList.toggle('is-light', theme === 'light');\n                      html.classList.toggle('is-dark', theme === 'dark');\n\n                      // Enable manual theme <meta>\n                      const $manualMeta = document.querySelector(\n                        'meta[data-theme-setting=\"manual\"]',\n                      );\n                      if ($manualMeta) {\n                        $manualMeta.name = 'theme-color';\n                        $manualMeta.content =\n                          theme === 'light'\n                            ? $manualMeta.dataset.themeLightColor\n                            : $manualMeta.dataset.themeDarkColor;\n                      }\n                      // Disable auto theme <meta>s\n                      const $autoMetas = document.querySelectorAll(\n                        'meta[data-theme-setting=\"auto\"]',\n                      );\n                      $autoMetas.forEach((m) => {\n                        m.name = '';\n                      });\n                    }\n                    document\n                      .querySelector('meta[name=\"color-scheme\"]')\n                      .setAttribute(\n                        'content',\n                        theme === 'auto' ? 'light dark' : theme,\n                      );\n\n                    if (theme === 'auto') {\n                      store.local.del('theme');\n                    } else {\n                      store.local.set('theme', theme);\n                    }\n                  }}\n                >\n                  <div class=\"radio-group\">\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"light\"\n                        defaultChecked={currentTheme === 'light'}\n                      />\n                      <span>\n                        <Trans>Light</Trans>\n                      </span>\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"dark\"\n                        defaultChecked={currentTheme === 'dark'}\n                      />\n                      <span>\n                        <Trans>Dark</Trans>\n                      </span>\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"auto\"\n                        defaultChecked={\n                          currentTheme !== 'light' && currentTheme !== 'dark'\n                        }\n                      />\n                      <span>\n                        <Trans>Auto</Trans>\n                      </span>\n                    </label>\n                  </div>\n                </form>\n              </div>\n            </li>\n            <li>\n              <div>\n                <label>\n                  <Trans>Text size</Trans>\n                </label>\n              </div>\n              <TextSizeControl currentTextSize={currentTextSize} />\n            </li>\n            <li>\n              <span>\n                <label>\n                  <Trans>Display language</Trans>\n                </label>{' '}\n                <small>\n                  <a\n                    href=\"https://crowdin.com/project/phanpy\"\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                  >\n                    <Trans>Volunteer translations</Trans>\n                  </a>\n                </small>\n              </span>\n              <LangSelector />\n            </li>\n          </ul>\n        </section>\n        {authenticated && (\n          <>\n            <h3>\n              <Trans>Posting</Trans>\n            </h3>\n            <section>\n              <ul>\n                <li>\n                  <label for=\"posting-privacy-field\">\n                    <Trans>Default visibility</Trans>{' '}\n                    <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />\n                  </label>\n                  <select\n                    id=\"posting-privacy-field\"\n                    value={prefs['posting:default:visibility'] || 'public'}\n                    onChange={(e) => {\n                      const { value } = e.target;\n                      (async () => {\n                        try {\n                          await masto.v1.accounts.updateCredentials({\n                            source: {\n                              privacy: value,\n                            },\n                          });\n                          const newPrefs = {\n                            ...prefs,\n                            'posting:default:visibility': value,\n                          };\n                          if (value === 'private') {\n                            newPrefs['posting:default:quote_policy'] = 'nobody';\n                          }\n                          setPrefs(newPrefs);\n                          setPreferences(newPrefs);\n                          showToast(t`Default visibility updated`);\n                        } catch (e) {\n                          alert(t`Failed to update default visibility`);\n                          console.error(e);\n                        }\n                      })();\n                    }}\n                  >\n                    <option value=\"public\">\n                      <Trans>Public</Trans>\n                    </option>\n                    <option value=\"unlisted\">\n                      <Trans>Quiet public</Trans>\n                    </option>\n                    <option value=\"private\">\n                      <Trans>Followers</Trans>\n                    </option>\n                  </select>\n                </li>\n                {supportsNativeQuote() && (\n                  <li>\n                    <label for=\"posting-quote-policy-field\">\n                      <Trans>Quote settings</Trans>{' '}\n                      <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />\n                    </label>\n                    <select\n                      id=\"posting-quote-policy-field\"\n                      value={\n                        disableQuotePolicy\n                          ? 'nobody'\n                          : prefs['posting:default:quote_policy'] || 'public'\n                      }\n                      disabled={disableQuotePolicy}\n                      onChange={(e) => {\n                        const { value } = e.target;\n                        (async () => {\n                          try {\n                            await masto.v1.accounts.updateCredentials({\n                              source: {\n                                quote_policy: value,\n                              },\n                            });\n                            const newPrefs = {\n                              ...prefs,\n                              'posting:default:quote_policy': value,\n                            };\n                            setPrefs(newPrefs);\n                            setPreferences(newPrefs);\n                            showToast(t`Quote settings updated`);\n                          } catch (e) {\n                            alert(t`Failed to update quote settings`);\n                            console.error(e);\n                          }\n                        })();\n                      }}\n                    >\n                      <option value=\"public\" disabled={disableQuotePolicy}>\n                        <Trans>Anyone can quote</Trans>\n                      </option>\n                      <option value=\"followers\" disabled={disableQuotePolicy}>\n                        <Trans>Your followers can quote</Trans>\n                      </option>\n                      <option value=\"nobody\">\n                        <Trans>Only you can quote</Trans>\n                      </option>\n                    </select>\n                  </li>\n                )}\n              </ul>\n            </section>\n            <p class=\"section-postnote\">\n              <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />{' '}\n              <small>\n                <Trans>\n                  Synced to your instance server's settings.{' '}\n                  <a\n                    href={`https://${instance}/`}\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                  >\n                    Go to your instance ({instance}) for more settings.\n                  </a>\n                </Trans>\n              </small>\n            </p>\n          </>\n        )}\n        <h3>\n          <Trans>Experiments</Trans>\n        </h3>\n        <section>\n          <ul>\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.autoRefresh}\n                  onChange={(e) => {\n                    states.settings.autoRefresh = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>Auto refresh timeline posts</Trans>\n              </label>\n            </li>\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.boostsCarousel}\n                  onChange={(e) => {\n                    states.settings.boostsCarousel = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>Boosts carousel</Trans>\n              </label>\n            </li>\n            {!!TRANSLANG_INSTANCES && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.contentTranslation}\n                    onChange={(e) => {\n                      const { checked } = e.target;\n                      states.settings.contentTranslation = checked;\n                      if (!checked) {\n                        states.settings.contentTranslationTargetLanguage = null;\n                      }\n                    }}\n                  />{' '}\n                  <Trans>Post translation</Trans>\n                </label>\n                <div\n                  class={`sub-section ${\n                    !snapStates.settings.contentTranslation\n                      ? 'more-insignificant'\n                      : ''\n                  }`}\n                >\n                  <div>\n                    <label>\n                      <Trans>Translate to </Trans>{' '}\n                      <select\n                        value={targetLanguage || ''}\n                        disabled={!snapStates.settings.contentTranslation}\n                        style={{ width: '10em' }}\n                        onChange={(e) => {\n                          states.settings.contentTranslationTargetLanguage =\n                            e.target.value || null;\n                        }}\n                      >\n                        <option value=\"\">\n                          <Trans>\n                            System language ({systemTargetLanguageText})\n                          </Trans>\n                        </option>\n                        <option disabled></option>\n                        {targetLanguages.map((lang) => {\n                          const common = localeCode2Text({\n                            code: lang.code,\n                            fallback: lang.name,\n                          });\n                          const native = localeCode2Text({\n                            code: lang.code,\n                            locale: lang.code,\n                          });\n                          const showCommon = native && common !== native;\n                          return (\n                            <option value={lang.code}>\n                              {showCommon ? `${native} - ${common}` : common}\n                            </option>\n                          );\n                        })}\n                      </select>\n                    </label>\n                  </div>\n                  <hr />\n                  <div class=\"checkbox-fieldset\">\n                    <Plural\n                      value={\n                        snapStates.settings.contentTranslationHideLanguages\n                          .length\n                      }\n                      _0={`Hide \"Translate\" button for:`}\n                      other={`Hide \"Translate\" button for (#):`}\n                    />\n                    <div class=\"checkbox-fields\">\n                      {targetLanguages.map((lang) => {\n                        const common = localeCode2Text({\n                          code: lang.code,\n                          fallback: lang.name,\n                        });\n                        const native = localeCode2Text({\n                          code: lang.code,\n                          locale: lang.code,\n                        });\n                        const showCommon = native && common !== native;\n                        return (\n                          <label>\n                            <input\n                              type=\"checkbox\"\n                              checked={snapStates.settings.contentTranslationHideLanguages.includes(\n                                lang.code,\n                              )}\n                              onChange={(e) => {\n                                const { checked } = e.target;\n                                if (checked) {\n                                  states.settings.contentTranslationHideLanguages.push(\n                                    lang.code,\n                                  );\n                                } else {\n                                  states.settings.contentTranslationHideLanguages =\n                                    snapStates.settings.contentTranslationHideLanguages.filter(\n                                      (code) => code !== lang.code,\n                                    );\n                                }\n                              }}\n                            />{' '}\n                            {showCommon ? (\n                              <span>\n                                {native}{' '}\n                                <span class=\"insignificant ib\">- {common}</span>\n                              </span>\n                            ) : (\n                              common\n                            )}\n                          </label>\n                        );\n                      })}\n                    </div>\n                  </div>\n                  <p class=\"insignificant\">\n                    <small>\n                      <Trans>\n                        Note: This feature uses external translation services,\n                        powered by{' '}\n                        <a\n                          href=\"https://github.com/cheeaun/translang-api\"\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                        >\n                          {TRANSLATION_API_NAME}\n                        </a>\n                        .\n                      </Trans>\n                    </small>\n                  </p>\n                  <hr />\n                  <div>\n                    <label>\n                      <input\n                        type=\"checkbox\"\n                        checked={\n                          snapStates.settings.contentTranslationAutoInline\n                        }\n                        disabled={!snapStates.settings.contentTranslation}\n                        onChange={(e) => {\n                          states.settings.contentTranslationAutoInline =\n                            e.target.checked;\n                        }}\n                      />{' '}\n                      <Trans>Auto inline translation</Trans>\n                    </label>\n                    <p class=\"insignificant\">\n                      <small>\n                        <Trans>\n                          Automatically show translation for posts in timeline.\n                          Only works for <b>short</b> posts without content\n                          warning, media and poll.\n                        </Trans>\n                      </small>\n                    </p>\n                  </div>\n                </div>\n              </li>\n            )}\n            {!!GIPHY_API_KEY && authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.composerGIFPicker}\n                    onChange={(e) => {\n                      states.settings.composerGIFPicker = e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>GIF Picker for composer</Trans>\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses external GIF search service,\n                      powered by{' '}\n                      <a\n                        href=\"https://developers.giphy.com/\"\n                        target=\"_blank\"\n                        rel=\"noopener\"\n                      >\n                        GIPHY\n                      </a>\n                      . G-rated (suitable for viewing by all ages), tracking\n                      parameters are stripped, referrer information is omitted\n                      from requests, but search queries and IP address\n                      information will still reach their servers.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            {!!IMG_ALT_API_URL && authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.mediaAltGenerator}\n                    onChange={(e) => {\n                      states.settings.mediaAltGenerator = e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>Image description generator</Trans>{' '}\n                  <Icon icon=\"sparkles2\" class=\"more-insignificant\" />\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Only for new images while composing new posts.\n                    </Trans>\n                  </small>\n                </div>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses external AI service, powered by{' '}\n                      <a\n                        href=\"https://github.com/cheeaun/img-alt-api\"\n                        target=\"_blank\"\n                        rel=\"noopener\"\n                      >\n                        img-alt-api\n                      </a>\n                      . May not work well. Only for images and in English.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            {authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={\n                      snapStates.settings.shortcutSettingsCloudImportExport\n                    }\n                    onChange={(e) => {\n                      states.settings.shortcutSettingsCloudImportExport =\n                        e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>\"Cloud\" import/export for shortcuts settings</Trans>{' '}\n                  <Icon icon=\"cloud\" class=\"more-insignificant\" />\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                       Very experimental.\n                      <br />\n                      Stored in your own profiles notes. Profile (private)\n                      notes are mainly used for other profiles, and hidden for\n                      own profile.\n                    </Trans>\n                  </small>\n                </div>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses currently-logged-in instance\n                      server API.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.cloakMode}\n                  onChange={(e) => {\n                    states.settings.cloakMode = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>\n                  Cloak mode{' '}\n                  <span class=\"insignificant\">\n                    (<samp>Text</samp>  <samp></samp>)\n                  </span>\n                </Trans>\n              </label>\n              <div class=\"sub-section insignificant\">\n                <small>\n                  <Trans>\n                    Replace text as blocks, useful when taking screenshots, for\n                    privacy reasons.\n                  </Trans>\n                </small>\n              </div>\n            </li>\n            {authenticated && (\n              <li>\n                <button\n                  type=\"button\"\n                  class=\"light\"\n                  onClick={() => {\n                    states.showDrafts = true;\n                    states.showSettings = false;\n                  }}\n                >\n                  <Trans>Unsent drafts</Trans>\n                </button>\n              </li>\n            )}\n            <li>\n              <Link to=\"/yip\" onClick={onClose} class=\"button light\">\n                Year in Posts\n              </Link>\n            </li>\n            <li>\n              <button-install>\n                <button type=\"button\" class=\"light\">\n                  <Trans>Install {CLIENT_NAME}</Trans>\n                </button>\n              </button-install>\n            </li>\n          </ul>\n        </section>\n        {authenticated && <PushNotificationsSection onClose={onClose} />}\n        <h3>\n          <Trans>About</Trans>\n        </h3>\n        <section>\n          <div\n            style={{\n              display: 'flex',\n              flexWrap: 'wrap',\n              gap: 8,\n              lineHeight: 1.25,\n              alignItems: 'center',\n              marginTop: 8,\n            }}\n          >\n            <img\n              src={logo}\n              alt=\"\"\n              width=\"64\"\n              height=\"64\"\n              style={{\n                aspectRatio: '1/1',\n                verticalAlign: 'middle',\n                background: '#b7cdf9',\n                borderRadius: 12,\n              }}\n            />\n            <div>\n              <b>Phanpy</b>{' '}\n              <a\n                href=\"https://hachyderm.io/@phanpy\"\n                // target=\"_blank\"\n                rel=\"noopener\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  states.showAccount = 'phanpy@hachyderm.io';\n                }}\n              >\n                @phanpy\n              </a>\n              <br />\n              <Trans>\n                <a\n                  href=\"https://github.com/cheeaun/phanpy\"\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  Built\n                </a>{' '}\n                by{' '}\n                <a\n                  href=\"https://mastodon.social/@cheeaun\"\n                  // target=\"_blank\"\n                  rel=\"noopener\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = 'cheeaun@mastodon.social';\n                  }}\n                >\n                  @cheeaun\n                </a>\n              </Trans>\n            </div>\n          </div>\n          <p>\n            <a\n              href=\"https://github.com/sponsors/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>Sponsor</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://www.buymeacoffee.com/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>Donate</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://patreon.com/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              Patreon\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://github.com/cheeaun/phanpy/blob/main/CHANGELOG.md\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>What's new</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a href={PRIVACY_POLICY_URL} target=\"_blank\" rel=\"noopener\">\n              <Trans>Privacy Policy</Trans>\n            </a>\n          </p>\n          {__COMMIT_TIME__ && (\n            <p>\n              {WEBSITE && (\n                <>\n                  <Trans>\n                    <span class=\"insignificant\">Site:</span>{' '}\n                    {WEBSITE.replace(/https?:\\/\\//g, '').replace(/\\/$/, '')}\n                  </Trans>\n                  <br />\n                </>\n              )}\n              <Trans>\n                <span class=\"insignificant\">Version:</span>{' '}\n                <input\n                  type=\"text\"\n                  class=\"version-string\"\n                  readOnly\n                  size=\"18\" // Manually calculated here\n                  value={`${__COMMIT_TIME__.slice(0, 10).replace(/-/g, '.')}${\n                    __COMMIT_HASH__ ? `.${__COMMIT_HASH__}` : ''\n                  }`}\n                  onClick={(e) => {\n                    e.target.select();\n                    // Copy to clipboard\n                    try {\n                      navigator.clipboard.writeText(e.target.value);\n                      showToast(t`Version string copied`);\n                    } catch (e) {\n                      console.warn(e);\n                      showToast(t`Unable to copy version string`);\n                    }\n                  }}\n                />{' '}\n                {!__FAKE_COMMIT_HASH__ && (\n                  <span class=\"ib insignificant\">\n                    (\n                    <a\n                      href={`https://github.com/cheeaun/phanpy/commit/${__COMMIT_HASH__}`}\n                      target=\"_blank\"\n                      rel=\"noopener\"\n                    >\n                      <RelativeTime datetime={new Date(__BUILD_TIME__)} />\n                    </a>\n                    )\n                  </span>\n                )}\n              </Trans>\n            </p>\n          )}\n        </section>\n        {(import.meta.env.DEV || import.meta.env.PHANPY_DEV) && (\n          <details class=\"debug-info\">\n            <summary></summary>\n            <p class=\"side\">\n              <Link\n                to=\"/_sandbox\"\n                onClick={onClose}\n                class=\"button plain6 small\"\n              >\n                Sandbox\n              </Link>\n            </p>\n            <p>Debugging</p>\n            <p>\n              <b>Vapid key</b>: {getVapidKey()}\n            </p>\n            {__BENCH_RESULTS?.size > 0 && (\n              <ul>\n                {Array.from(__BENCH_RESULTS.entries()).map(\n                  ([name, duration]) => (\n                    <li>\n                      <b>{name}</b>: {duration}ms\n                    </li>\n                  ),\n                )}\n              </ul>\n            )}\n            <p>Service Worker Cache</p>\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={async () => alert(await getCachesKeys())}\n            >\n              Show keys count\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={async () => alert(await getCachesSize())}\n            >\n              Show cache size\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={() => {\n                const key = prompt('Enter cache key');\n                if (!key) return;\n                try {\n                  clearCacheKey(key);\n                } catch (e) {\n                  alert(e);\n                }\n              }}\n            >\n              Clear cache key\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={() => {\n                try {\n                  clearCaches();\n                } catch (e) {\n                  alert(e);\n                }\n              }}\n            >\n              Clear all caches\n            </button>\n            <p>Temporary Experiments</p>\n            <label>\n              <input\n                type=\"checkbox\"\n                checked={expTabBarV2}\n                onChange={(e) => {\n                  const { checked } = e.target;\n                  document.body.classList.toggle('exp-tab-bar-v2', checked);\n                  setExpTabBarV2(checked);\n                  if (checked) {\n                    store.local.set('experiments-tabBarV2', true);\n                  } else {\n                    store.local.del('experiments-tabBarV2');\n                  }\n                }}\n              />{' '}\n              Tab bar v2\n            </label>\n          </details>\n        )}\n      </main>\n    </div>\n  );\n}\n\nfunction TextSizeControl({ currentTextSize }) {\n  const textSizeFieldRef = useRef(null);\n  const [size, setSize] = useState(currentTextSize);\n  const [debouncedSize] = useDebounce(size, 1000);\n\n  useEffect(() => {\n    const html = document.documentElement;\n    // set CSS variable\n    html.style.setProperty('--text-size', `${debouncedSize}px`);\n    // save to local storage\n    if (debouncedSize === DEFAULT_TEXT_SIZE) {\n      store.local.del('textSize');\n    } else {\n      store.local.set('textSize', debouncedSize);\n    }\n  }, [debouncedSize]);\n\n  return (\n    <div class={`text-size-control ${size !== debouncedSize ? 'loading' : ''}`}>\n      <button\n        type=\"button\"\n        style={{ fontSize: SMALLEST_TEXT_SIZE }}\n        class={`small light ${size === DEFAULT_TEXT_SIZE ? 'default-size' : ''}`}\n        disabled={size === SMALLEST_TEXT_SIZE}\n        onClick={() => {\n          setSize(Math.max(SMALLEST_TEXT_SIZE, size - 1));\n        }}\n      >\n        <Trans comment=\"Preview of one character, in smallest size\">A</Trans>\n      </button>{' '}\n      <input\n        ref={textSizeFieldRef}\n        type=\"range\"\n        min={SMALLEST_TEXT_SIZE}\n        max={LARGEST_TEXT_SIZE}\n        step=\"1\"\n        value={size}\n        list=\"sizes\"\n        onChange={(e) => {\n          const value = parseInt(e.target.value, 10);\n          setSize(value);\n        }}\n      />{' '}\n      <button\n        type=\"button\"\n        style={{ fontSize: LARGEST_TEXT_SIZE }}\n        class={`small light ${size === DEFAULT_TEXT_SIZE ? 'default-size' : ''}`}\n        disabled={size === LARGEST_TEXT_SIZE}\n        onClick={() => {\n          setSize(Math.min(LARGEST_TEXT_SIZE, size + 1));\n        }}\n      >\n        <Trans comment=\"Preview of one character, in largest size\">A</Trans>\n      </button>\n      <datalist id=\"sizes\">\n        {TEXT_SIZES.map((size) => (\n          <option value={size} />\n        ))}\n      </datalist>\n    </div>\n  );\n}\n\nasync function getCachesKeys() {\n  const keys = await caches.keys();\n  const total = {};\n  for (const key of keys) {\n    const cache = await caches.open(key);\n    const k = await cache.keys();\n    total[key] = k.length;\n  }\n  return total;\n}\n\nasync function getCachesSize() {\n  const keys = await caches.keys();\n  let total = {};\n  let TOTAL = 0;\n  for (const key of keys) {\n    const cache = await caches.open(key);\n    const k = await cache.keys();\n    for (const item of k) {\n      try {\n        const response = await cache.match(item);\n        const blob = await response.blob();\n        total[key] = (total[key] || 0) + blob.size;\n        TOTAL += blob.size;\n      } catch (e) {\n        alert('Failed to get cache size for ' + item);\n        alert(e);\n      }\n    }\n  }\n  return {\n    ...Object.fromEntries(\n      Object.entries(total).map(([k, v]) => [k, prettyBytes(v)]),\n    ),\n    TOTAL: prettyBytes(TOTAL),\n  };\n}\n\nfunction clearCacheKey(key) {\n  return caches.delete(key);\n}\n\nasync function clearCaches() {\n  const keys = await caches.keys();\n  for (const key of keys) {\n    await caches.delete(key);\n  }\n}\n\nfunction PushNotificationsSection({ onClose }) {\n  const { t } = useLingui();\n  if (!isPushSupported()) return null;\n\n  const { instance } = api();\n  const [uiState, setUIState] = useState('default');\n  const pushFormRef = useRef();\n  const [allowNotifications, setAllowNotifications] = useState(false);\n  const [needRelogin, setNeedRelogin] = useState(false);\n  const previousPolicyRef = useRef();\n  useEffect(() => {\n    (async () => {\n      setUIState('loading');\n      try {\n        const { subscription, backendSubscription } = await initSubscription();\n        if (\n          backendSubscription?.policy &&\n          backendSubscription.policy !== 'none'\n        ) {\n          setAllowNotifications(true);\n          const { alerts, policy } = backendSubscription;\n          console.log('backendSubscription', backendSubscription);\n          previousPolicyRef.current = policy;\n          const { elements } = pushFormRef.current;\n          const policyEl = elements.namedItem('policy');\n          if (policyEl) policyEl.value = policy;\n          // alerts is {}, iterate it\n          Object.entries(alerts).forEach(([alert, value]) => {\n            const el = elements.namedItem(alert);\n            if (el?.type === 'checkbox') {\n              el.checked = !!value;\n            }\n          });\n        }\n        setUIState('default');\n      } catch (err) {\n        console.warn(err);\n        if (/outside.*authorized/i.test(err.message)) {\n          setNeedRelogin(true);\n        } else {\n          alert(err?.message || err);\n        }\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  const isLoading = uiState === 'loading';\n\n  return (\n    <form\n      ref={pushFormRef}\n      onChange={() => {\n        setTimeout(() => {\n          const values = Object.fromEntries(new FormData(pushFormRef.current));\n          const allowNotifications = !!values['policy-allow'];\n          const params = {\n            data: {\n              policy: values.policy,\n              alerts: {\n                mention: !!values.mention,\n                favourite: !!values.favourite,\n                reblog: !!values.reblog,\n                follow: !!values.follow,\n                follow_request: !!values.followRequest,\n                poll: !!values.poll,\n                update: !!values.update,\n                status: !!values.status,\n              },\n            },\n          };\n\n          let alertsCount = 0;\n          // Remove false values from data.alerts\n          // API defaults to false anyway\n          Object.keys(params.data.alerts).forEach((key) => {\n            if (!params.data.alerts[key]) {\n              delete params.data.alerts[key];\n            } else {\n              alertsCount++;\n            }\n          });\n          const policyChanged =\n            previousPolicyRef.current !== params.data.policy;\n\n          console.log('PN Form', {\n            values,\n            allowNotifications: allowNotifications,\n            params,\n          });\n\n          if (allowNotifications && alertsCount > 0) {\n            if (policyChanged) {\n              console.debug('Policy changed.');\n              removeSubscription()\n                .then(() => {\n                  updateSubscription(params);\n                })\n                .catch((err) => {\n                  console.warn(err);\n                  alert(t`Failed to update subscription. Please try again.`);\n                });\n            } else {\n              updateSubscription(params).catch((err) => {\n                console.warn(err);\n                alert(t`Failed to update subscription. Please try again.`);\n              });\n            }\n          } else {\n            removeSubscription().catch((err) => {\n              console.warn(err);\n              alert(t`Failed to remove subscription. Please try again.`);\n            });\n          }\n        }, 100);\n      }}\n    >\n      <h3>\n        <Trans>Push Notifications (beta)</Trans>\n      </h3>\n      <section>\n        <ul>\n          <li>\n            <label>\n              <input\n                type=\"checkbox\"\n                disabled={isLoading || needRelogin}\n                name=\"policy-allow\"\n                checked={allowNotifications}\n                onChange={async (e) => {\n                  const { checked } = e.target;\n                  if (checked) {\n                    // Request permission\n                    const permission = await Notification.requestPermission();\n                    if (permission === 'granted') {\n                      setAllowNotifications(true);\n                    } else {\n                      setAllowNotifications(false);\n                      if (permission === 'denied') {\n                        alert(\n                          t`Push notifications are blocked. Please enable them in your browser settings.`,\n                        );\n                      }\n                    }\n                  } else {\n                    setAllowNotifications(false);\n                  }\n                }}\n              />{' '}\n              <Trans>\n                Allow from{' '}\n                <select\n                  name=\"policy\"\n                  disabled={isLoading || needRelogin || !allowNotifications}\n                >\n                  {[\n                    {\n                      value: 'all',\n                      label: t`anyone`,\n                    },\n                    {\n                      value: 'followed',\n                      label: t`people I follow`,\n                    },\n                    {\n                      value: 'follower',\n                      label: t`followers`,\n                    },\n                  ].map((type) => (\n                    <option value={type.value}>{type.label}</option>\n                  ))}\n                </select>\n              </Trans>\n            </label>\n            <div\n              class=\"shazam-container no-animation\"\n              style={{\n                width: '100%',\n              }}\n              hidden={!allowNotifications}\n            >\n              <div class=\"shazam-container-inner\">\n                <div class=\"sub-section\">\n                  <ul>\n                    {[\n                      {\n                        value: 'mention',\n                        label: t`Mentions`,\n                      },\n                      {\n                        value: 'favourite',\n                        label: t`Likes`,\n                      },\n                      {\n                        value: 'reblog',\n                        label: t`Boosts`,\n                      },\n                      {\n                        value: 'follow',\n                        label: t`Follows`,\n                      },\n                      {\n                        value: 'followRequest',\n                        label: t`Follow requests`,\n                      },\n                      {\n                        value: 'poll',\n                        label: t`Polls`,\n                      },\n                      {\n                        value: 'update',\n                        label: t`Post edits`,\n                      },\n                      {\n                        value: 'status',\n                        label: t`New posts`,\n                      },\n                    ].map((alert) => (\n                      <li>\n                        <label>\n                          <input type=\"checkbox\" name={alert.value} />{' '}\n                          {alert.label}\n                        </label>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              </div>\n            </div>\n            {needRelogin && (\n              <div class=\"sub-section\">\n                <p>\n                  <Trans>\n                    Push permission was not granted since your last login.\n                    You'll need to{' '}\n                    <Link to={`/login?instance=${instance}`} onClick={onClose}>\n                      <b>log in</b> again to grant push permission\n                    </Link>\n                    .\n                  </Trans>\n                </p>\n              </div>\n            )}\n          </li>\n        </ul>\n      </section>\n      <p class=\"section-postnote\">\n        <small>\n          <Trans>\n            NOTE: Push notifications only work for <b>one account</b>.\n          </Trans>\n        </small>\n      </p>\n    </form>\n  );\n}\n\nexport default Settings;\n","const focusDeck = () => {\n  let timer = setTimeout(() => {\n    const columns = document.getElementById('columns');\n    if (columns) {\n      // Focus focused column\n      const focusedColumn = columns.querySelector('.deck-container.focus');\n      if (focusedColumn) {\n        focusedColumn.focus();\n      } else {\n        // Focus first column within viewport\n        const firstVisibleColumn = Array.from(\n          columns.querySelectorAll('.deck-container'),\n        ).find((column) => {\n          const columnRect = column.getBoundingClientRect();\n          return columnRect.left >= 0;\n        });\n        if (firstVisibleColumn) {\n          firstVisibleColumn.focus();\n        } else {\n          // Focus first column\n          columns.querySelector('.deck-container')?.focus?.();\n        }\n      }\n    } else {\n      const modals = document.querySelectorAll('#modal-container > *');\n      if (modals?.length) {\n        // Focus last modal\n        const modal = modals[modals.length - 1]; // last one\n        const modalFocusElement =\n          modal.querySelector('[tabindex=\"-1\"]') || modal;\n        if (modalFocusElement) {\n          modalFocusElement.focus();\n          return;\n        }\n      }\n      const backDrop = document.querySelector('.deck-backdrop');\n      if (backDrop) return;\n      // Focus last deck\n      const pages = document.querySelectorAll('.deck-container');\n      const page = pages[pages.length - 1]; // last one\n      if (page && page.tabIndex === -1) {\n        console.log('FOCUS', page);\n        page.focus();\n      }\n    }\n  }, 100);\n  return () => clearTimeout(timer);\n};\n\nexport default focusDeck;\n","import { useEffect, useRef } from 'preact/hooks';\nimport { useLocation } from 'react-router-dom';\n\n// Hook that runs a callback when the location changes\n// Won't run on the first render\n\nexport default function useLocationChange(fn) {\n  if (!fn) return;\n  const location = useLocation();\n  const currentLocationRef = useRef(location.pathname);\n  useEffect(() => {\n    // console.log('location', {\n    //   current: currentLocationRef.current,\n    //   next: location.pathname,\n    // });\n    if (\n      currentLocationRef.current &&\n      location.pathname !== currentLocationRef.current\n    ) {\n      fn?.();\n    }\n  }, [location.pathname, fn]);\n}\n","import { Trans } from '@lingui/react/macro';\nimport punycode from 'punycode/';\n\nfunction AccountHandleInfo({ acct, instance }) {\n  // acct = username or username@server\n  let [username, server] = acct.split('@');\n  if (!server) server = instance;\n  const encodedAcct = punycode.toASCII(acct);\n  return (\n    <div class=\"handle-info\">\n      <span class=\"handle-handle\" title={encodedAcct}>\n        <b class=\"handle-username\">{username}</b>\n        <span class=\"handle-at\">@</span>\n        <b class=\"handle-server\">{server}</b>\n      </span>\n      <div class=\"handle-legend\">\n        <span class=\"ib\">\n          <span class=\"handle-legend-icon username\" /> <Trans>username</Trans>\n        </span>{' '}\n        <span class=\"ib\">\n          <span class=\"handle-legend-icon server\" />{' '}\n          <Trans>server domain name</Trans>\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default AccountHandleInfo;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nconst SUPPORTED_IMAGE_FORMATS = [\n  'image/jpeg',\n  'image/png',\n  'image/gif',\n  'image/webp',\n];\nconst SUPPORTED_IMAGE_FORMATS_STR = SUPPORTED_IMAGE_FORMATS.join(',');\n\nfunction FieldsAttributesRow({ name, value, disabled, index: i }) {\n  const [hasValue, setHasValue] = useState(!!value);\n  return (\n    <tr>\n      <td>\n        <input\n          type=\"text\"\n          name={`fields_attributes[${i}][name]`}\n          defaultValue={name}\n          disabled={disabled}\n          maxLength={255}\n          required={hasValue}\n          dir=\"auto\"\n          enterKeyHint=\"done\"\n        />\n      </td>\n      <td>\n        <input\n          type=\"text\"\n          name={`fields_attributes[${i}][value]`}\n          defaultValue={value}\n          disabled={disabled}\n          maxLength={255}\n          onChange={(e) => setHasValue(!!e.currentTarget.value)}\n          dir=\"auto\"\n          enterKeyHint=\"done\"\n        />\n      </td>\n    </tr>\n  );\n}\n\nfunction EditProfileSheet({ onClose = () => {} }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('loading');\n  const [account, setAccount] = useState(null);\n  const [headerPreview, setHeaderPreview] = useState(null);\n  const [avatarPreview, setAvatarPreview] = useState(null);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const acc = await masto.v1.accounts.verifyCredentials();\n        setAccount(acc);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  console.log('EditProfileSheet', account);\n  const { displayName, source, avatar, header } = account || {};\n  const { note, fields } = source || {};\n  const fieldsAttributesRef = useRef(null);\n\n  const avatarMediaAttachments = [\n    ...(avatar ? [{ type: 'image', url: avatar }] : []),\n    ...(avatarPreview ? [{ type: 'image', url: avatarPreview }] : []),\n  ];\n  const headerMediaAttachments = [\n    ...(header ? [{ type: 'image', url: header }] : []),\n    ...(headerPreview ? [{ type: 'image', url: headerPreview }] : []),\n  ];\n\n  return (\n    <div class=\"sheet\" id=\"edit-profile-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Edit profile</Trans>\n        </b>\n      </header>\n      <main>\n        {uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : (\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              const formData = new FormData(e.target);\n              const header = formData.get('header');\n              const avatar = formData.get('avatar');\n              const displayName = formData.get('display_name');\n              const note = formData.get('note');\n              const fieldsAttributesFields =\n                fieldsAttributesRef.current.querySelectorAll(\n                  'input[name^=\"fields_attributes\"]',\n                );\n              const fieldsAttributes = [];\n              fieldsAttributesFields.forEach((field) => {\n                const name = field.name;\n                const [_, index, key] =\n                  name.match(/fields_attributes\\[(\\d+)\\]\\[(.+)\\]/) || [];\n                const value = field.value ? field.value.trim() : '';\n                if (index && key && value) {\n                  if (!fieldsAttributes[index]) fieldsAttributes[index] = {};\n                  fieldsAttributes[index][key] = value;\n                }\n              });\n              // Fill in the blanks\n              fieldsAttributes.forEach((field) => {\n                if (field.name && !field.value) {\n                  field.value = '';\n                }\n              });\n\n              (async () => {\n                try {\n                  const newAccount = await masto.v1.accounts.updateCredentials({\n                    header,\n                    avatar,\n                    displayName,\n                    note,\n                    fieldsAttributes,\n                  });\n                  console.log('updated account', newAccount);\n                  onClose?.({\n                    state: 'success',\n                    account: newAccount,\n                  });\n                } catch (e) {\n                  console.error(e);\n                  alert(e?.message || t`Unable to update profile.`);\n                }\n              })();\n            }}\n          >\n            <div class=\"edit-profile-media-container\">\n              <label>\n                <Trans>Header picture</Trans>{' '}\n                <input\n                  type=\"file\"\n                  name=\"header\"\n                  accept={SUPPORTED_IMAGE_FORMATS_STR}\n                  onChange={(e) => {\n                    const file = e.target.files[0];\n                    if (file) {\n                      const blob = URL.createObjectURL(file);\n                      setHeaderPreview(blob);\n                    }\n                  }}\n                />\n              </label>\n              <div class=\"edit-profile-media-field\">\n                {header ? (\n                  <div\n                    class=\"edit-media\"\n                    tabIndex=\"0\"\n                    onClick={() => {\n                      states.showMediaModal = {\n                        mediaAttachments: headerMediaAttachments,\n                        mediaIndex: 0,\n                      };\n                    }}\n                  >\n                    <img src={header} alt=\"\" />\n                  </div>\n                ) : (\n                  <div class=\"edit-media\"></div>\n                )}\n                {headerPreview && (\n                  <>\n                    <Icon icon=\"arrow-right\" />\n                    <div\n                      class=\"edit-media\"\n                      tabIndex=\"0\"\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: headerMediaAttachments,\n                          mediaIndex: 1,\n                        };\n                      }}\n                    >\n                      <img src={headerPreview} alt=\"\" />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n            <div class=\"edit-profile-media-container\">\n              <label>\n                <Trans>Profile picture</Trans>{' '}\n                <input\n                  type=\"file\"\n                  name=\"avatar\"\n                  accept={SUPPORTED_IMAGE_FORMATS_STR}\n                  onChange={(e) => {\n                    const file = e.target.files[0];\n                    if (file) {\n                      const blob = URL.createObjectURL(file);\n                      setAvatarPreview(blob);\n                    }\n                  }}\n                />\n              </label>\n              <div class=\"edit-profile-media-field\">\n                {avatar ? (\n                  <div\n                    class=\"edit-media\"\n                    tabIndex=\"0\"\n                    onClick={() => {\n                      states.showMediaModal = {\n                        mediaAttachments: avatarMediaAttachments,\n                        mediaIndex: 0,\n                      };\n                    }}\n                  >\n                    <img src={avatar} alt=\"\" />\n                  </div>\n                ) : (\n                  <div class=\"edit-media\"></div>\n                )}\n                {avatarPreview && (\n                  <>\n                    <Icon icon=\"arrow-right\" />\n                    <div\n                      class=\"edit-media\"\n                      tabIndex=\"0\"\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: avatarMediaAttachments,\n                          mediaIndex: 1,\n                        };\n                      }}\n                    >\n                      <img src={avatarPreview} alt=\"\" />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n            <p>\n              <label>\n                <Trans>Name</Trans>{' '}\n                <input\n                  type=\"text\"\n                  name=\"display_name\"\n                  defaultValue={displayName}\n                  maxLength={30}\n                  disabled={uiState === 'loading'}\n                  dir=\"auto\"\n                  enterKeyHint=\"done\"\n                />\n              </label>\n            </p>\n            <p>\n              <label>\n                <Trans>Bio</Trans>\n                <textarea\n                  defaultValue={note}\n                  name=\"note\"\n                  maxLength={500}\n                  rows=\"5\"\n                  disabled={uiState === 'loading'}\n                  dir=\"auto\"\n                />\n              </label>\n            </p>\n            {/* Table for fields; name and values are in fields, min 4 rows */}\n            <p>\n              <Trans>Extra fields</Trans>\n            </p>\n            <table ref={fieldsAttributesRef}>\n              <thead>\n                <tr>\n                  <th>\n                    <Trans>Label</Trans>\n                  </th>\n                  <th>\n                    <Trans>Content</Trans>\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {Array.from({ length: Math.max(4, fields.length) }).map(\n                  (_, i) => {\n                    const { name = '', value = '' } = fields[i] || {};\n                    return (\n                      <FieldsAttributesRow\n                        key={i}\n                        name={name}\n                        value={value}\n                        index={i}\n                        disabled={uiState === 'loading'}\n                      />\n                    );\n                  },\n                )}\n              </tbody>\n            </table>\n            <footer>\n              <button\n                type=\"button\"\n                class=\"light\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  onClose?.();\n                }}\n              >\n                <Trans>Cancel</Trans>\n              </button>\n              <button type=\"submit\" disabled={uiState === 'loading'}>\n                <Trans>Save</Trans>\n              </button>\n            </footer>\n          </form>\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default EditProfileSheet;\n","import { Trans } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport supports from '../utils/supports';\n\nimport AccountBlock from './account-block';\nimport Loader from './loader';\n\nconst ENDORSEMENTS_LIMIT = 80;\n\nfunction Endorsements({\n  accountID: id,\n  info,\n  open = false,\n  onlyOpenIfHasEndorsements = false,\n}) {\n  const { masto } = api();\n  const endorsementsContainer = useRef();\n  const [endorsementsUIState, setEndorsementsUIState] = useState('default');\n  const [endorsements, setEndorsements] = useState([]);\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n  useEffect(() => {\n    if (!supports('@mastodon/endorsements')) return;\n    if (!open) return;\n    (async () => {\n      setEndorsementsUIState('loading');\n      try {\n        const accounts = await masto.v1.accounts.$select(id).endorsements.list({\n          limit: ENDORSEMENTS_LIMIT,\n        });\n        console.log({ endorsements: accounts });\n        if (!accounts.length) {\n          setEndorsementsUIState('default');\n          return;\n        }\n        setEndorsements(accounts);\n        setEndorsementsUIState('default');\n        setTimeout(() => {\n          endorsementsContainer.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          });\n        }, 300);\n\n        const relationships = await fetchRelationships(\n          accounts,\n          relationshipsMap,\n        );\n        if (relationships) {\n          setRelationshipsMap(relationships);\n        }\n      } catch (e) {\n        console.error(e);\n        setEndorsementsUIState('error');\n      }\n    })();\n  }, [open, id]);\n\n  const reallyOpen = onlyOpenIfHasEndorsements\n    ? open && endorsements.length > 0\n    : open;\n\n  if (!reallyOpen) return null;\n\n  return (\n    <div class=\"shazam-container\">\n      <div class=\"shazam-container-inner\">\n        <div class=\"endorsements-container\" ref={endorsementsContainer}>\n          <h3>\n            <Trans>Profiles featured by @{info.username}</Trans>\n          </h3>\n          {endorsementsUIState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : endorsements.length > 0 ? (\n            <ul\n              class={`endorsements ${\n                endorsements.length > 10 ? 'expanded' : ''\n              }`}\n            >\n              {endorsements.map((account) => (\n                <li>\n                  <AccountBlock\n                    key={account.id}\n                    account={account}\n                    showStats\n                    avatarSize=\"xxl\"\n                    relationship={relationshipsMap[account.id]}\n                  />\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <p class=\"ui-state insignificant\">\n              <Trans>No featured profiles.</Trans>\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Endorsements;\n","import { api } from './api';\nimport pmem from './pmem';\n\nasync function _isSearchEnabled(instance) {\n  const { masto } = api({ instance });\n  const results = await masto.v2.search.list({\n    q: 'from:me',\n    type: 'statuses',\n    limit: 1,\n  });\n  return !!results?.statuses?.length;\n}\n\nexport default pmem(_isSearchEnabled);\n","import { api } from './api';\nimport pmem from './pmem';\nimport store from './store';\n\nconst FETCH_MAX_AGE = 1000 * 60; // 1 minute\nconst MAX_AGE = 24 * 60 * 60 * 1000; // 1 day\n\nexport const fetchLists = pmem(\n  async () => {\n    const { masto } = api();\n    const lists = await masto.v1.lists.list();\n    lists.sort((a, b) => a.title.localeCompare(b.title));\n\n    if (lists.length) {\n      setTimeout(() => {\n        // Save to local storage, with saved timestamp\n        store.account.set('lists', {\n          lists,\n          updatedAt: Date.now(),\n        });\n      }, 1);\n    }\n\n    return lists;\n  },\n  {\n    expires: FETCH_MAX_AGE,\n  },\n);\n\nexport async function getLists() {\n  try {\n    const { lists, updatedAt } = store.account.get('lists') || {};\n    if (!lists?.length) return await fetchLists();\n    if (Date.now() - updatedAt > MAX_AGE) {\n      // Stale-while-revalidate\n      fetchLists();\n      return lists;\n    }\n    return lists;\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const fetchList = pmem(\n  (id) => {\n    const { masto } = api();\n    return masto.v1.lists.$select(id).fetch();\n  },\n  {\n    expires: FETCH_MAX_AGE,\n  },\n);\n\nexport async function getList(id) {\n  const { lists } = store.account.get('lists') || {};\n  console.log({ lists });\n  if (lists?.length) {\n    const theList = lists.find((l) => l.id === id);\n    if (theList) return theList;\n  }\n  try {\n    return fetchList(id);\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function getListTitle(id) {\n  const list = await getList(id);\n  return list?.title || '';\n}\n\nexport function addListStore(list) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    lists.push(list);\n    lists.sort((a, b) => a.title.localeCompare(b.title));\n    store.account.set('lists', {\n      lists,\n      updatedAt: Date.now(),\n    });\n  }\n}\n\nexport function updateListStore(list) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    const index = lists.findIndex((l) => l.id === list.id);\n    if (index !== -1) {\n      lists[index] = list;\n      lists.sort((a, b) => a.title.localeCompare(b.title));\n      store.account.set('lists', {\n        lists,\n        updatedAt: Date.now(),\n      });\n    }\n  }\n}\n\nexport function deleteListStore(listID) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    const index = lists.findIndex((l) => l.id === listID);\n    if (index !== -1) {\n      lists.splice(index, 1);\n      store.account.set('lists', {\n        lists,\n        updatedAt: Date.now(),\n      });\n    }\n  }\n}\n","import './list-exclusive-badge.css';\n\nimport { useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\n\nfunction ListExclusiveBadge({ insignificant }) {\n  const { t } = useLingui();\n  return (\n    <Icon\n      icon=\"filter\"\n      size=\"xs\"\n      class={`list-exclusive-badge ${insignificant ? 'insignificant' : ''}`}\n      title={t`Posts on this list are hidden from Home/Following`}\n    />\n  );\n}\n\nexport default ListExclusiveBadge;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { addListStore, deleteListStore, updateListStore } from '../utils/lists';\nimport supports from '../utils/supports';\n\nimport Icon from './icon';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuConfirm from './menu-confirm';\n\nfunction ListAddEdit({ list, onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const editMode = !!list;\n  const nameFieldRef = useRef();\n  const repliesPolicyFieldRef = useRef();\n  const exclusiveFieldRef = useRef();\n  useEffect(() => {\n    if (editMode) {\n      nameFieldRef.current.value = list.title;\n      repliesPolicyFieldRef.current.value = list.repliesPolicy;\n      if (exclusiveFieldRef.current) {\n        exclusiveFieldRef.current.checked = list.exclusive;\n      }\n    }\n  }, [editMode]);\n  const supportsExclusive =\n    supports('@mastodon/list-exclusive') ||\n    supports('@gotosocial/list-exclusive');\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}{' '}\n      <header>\n        <h2>{editMode ? t`Edit list` : t`New list`}</h2>\n      </header>\n      <main>\n        <form\n          class=\"list-form\"\n          onSubmit={(e) => {\n            e.preventDefault(); // Get form values\n\n            const formData = new FormData(e.target);\n            const title = formData.get('title');\n            const repliesPolicy = formData.get('replies_policy');\n            const exclusive = formData.get('exclusive') === 'on';\n            console.log({\n              title,\n              repliesPolicy,\n              exclusive,\n            });\n            setUIState('loading');\n\n            (async () => {\n              try {\n                let listResult;\n\n                if (editMode) {\n                  listResult = await masto.v1.lists.$select(list.id).update({\n                    title,\n                    replies_policy: repliesPolicy,\n                    exclusive,\n                  });\n                } else {\n                  listResult = await masto.v1.lists.create({\n                    title,\n                    replies_policy: repliesPolicy,\n                    exclusive,\n                  });\n                }\n\n                console.log(listResult);\n                setUIState('default');\n                onClose?.({\n                  state: 'success',\n                  list: listResult,\n                });\n\n                setTimeout(() => {\n                  if (editMode) {\n                    updateListStore(listResult);\n                  } else {\n                    addListStore(listResult);\n                  }\n                }, 1);\n              } catch (e) {\n                console.error(e);\n                setUIState('error');\n                alert(\n                  editMode\n                    ? t`Unable to edit list.`\n                    : t`Unable to create list.`,\n                );\n              }\n            })();\n          }}\n        >\n          <div class=\"list-form-row\">\n            <label for=\"list-title\">\n              <Trans>Name</Trans>{' '}\n              <input\n                ref={nameFieldRef}\n                type=\"text\"\n                id=\"list-title\"\n                name=\"title\"\n                required\n                disabled={uiState === 'loading'}\n                dir=\"auto\"\n              />\n            </label>\n          </div>\n          <div class=\"list-form-row\">\n            <select\n              ref={repliesPolicyFieldRef}\n              name=\"replies_policy\"\n              required\n              disabled={uiState === 'loading'}\n            >\n              <option value=\"list\">\n                <Trans>Show replies to list members</Trans>\n              </option>\n              <option value=\"followed\">\n                <Trans>Show replies to people I follow</Trans>\n              </option>\n              <option value=\"none\">\n                <Trans>Don't show replies</Trans>\n              </option>\n            </select>\n          </div>\n          {supportsExclusive && (\n            <div class=\"list-form-row\">\n              <label class=\"label-block\">\n                <input\n                  ref={exclusiveFieldRef}\n                  type=\"checkbox\"\n                  name=\"exclusive\"\n                  disabled={uiState === 'loading'}\n                />{' '}\n                <ListExclusiveBadge insignificant />{' '}\n                <Trans>Hide posts on this list from Home/Following</Trans>\n              </label>\n            </div>\n          )}\n          <div class=\"list-form-footer\">\n            <button type=\"submit\" disabled={uiState === 'loading'}>\n              {editMode ? t`Save` : t`Create`}\n            </button>\n            {editMode && (\n              <MenuConfirm\n                disabled={uiState === 'loading'}\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete this list?`}\n                onClick={() => {\n                  // const yes = confirm('Delete this list?');\n                  // if (!yes) return;\n                  setUIState('loading');\n\n                  (async () => {\n                    try {\n                      await masto.v1.lists.$select(list.id).remove();\n                      setUIState('default');\n                      onClose?.({\n                        state: 'deleted',\n                      });\n                      setTimeout(() => {\n                        deleteListStore(list.id);\n                      }, 1);\n                    } catch (e) {\n                      console.error(e);\n                      setUIState('error');\n                      alert(t`Unable to delete list.`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  disabled={uiState === 'loading'}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            )}\n          </div>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default ListAddEdit;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\n\nimport Icon from './icon';\nimport ListAddEdit from './list-add-edit';\nimport Loader from './loader';\nimport Modal from './modal';\n\nfunction AddRemoveListsSheet({ accountID, onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [lists, setLists] = useState([]);\n  const [listsContainingAccount, setListsContainingAccount] = useState([]);\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const lists = await getLists();\n        setLists(lists);\n        const listsContainingAccount = await masto.v1.accounts\n          .$select(accountID)\n          .lists.list();\n        console.log({ lists, listsContainingAccount });\n        setListsContainingAccount(listsContainingAccount);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n\n  return (\n    <div class=\"sheet\" id=\"list-add-remove-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Add/Remove from Lists</Trans>\n        </h2>\n      </header>\n      <main>\n        {lists.length > 0 ? (\n          <ul class=\"list-add-remove\">\n            {lists.map((list) => {\n              const inList = listsContainingAccount.some(\n                (l) => l.id === list.id,\n              );\n              return (\n                <li>\n                  <button\n                    type=\"button\"\n                    class={`light ${inList ? 'checked' : ''}`}\n                    disabled={uiState === 'loading'}\n                    onClick={() => {\n                      setUIState('loading');\n                      (async () => {\n                        try {\n                          if (inList) {\n                            await masto.v1.lists\n                              .$select(list.id)\n                              .accounts.remove({\n                                accountIds: [accountID],\n                              });\n                          } else {\n                            await masto.v1.lists\n                              .$select(list.id)\n                              .accounts.create({\n                                accountIds: [accountID],\n                              });\n                          }\n                          // setUIState('default');\n                          reload();\n                        } catch (e) {\n                          console.error(e);\n                          setUIState('error');\n                          alert(\n                            inList\n                              ? t`Unable to remove from list.`\n                              : t`Unable to add to list.`,\n                          );\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"check-circle\" alt=\"\" />\n                    <span>{list.title}</span>\n                  </button>\n                </li>\n              );\n            })}\n          </ul>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">\n            <Trans>Unable to load lists.</Trans>\n          </p>\n        ) : (\n          <p class=\"ui-state\">\n            <Trans>No lists.</Trans>\n          </p>\n        )}\n        <button\n          type=\"button\"\n          class=\"plain2\"\n          onClick={() => setShowListAddEditModal(true)}\n          disabled={uiState !== 'default'}\n        >\n          <Icon icon=\"plus\" size=\"l\" />{' '}\n          <span>\n            <Trans>New list</Trans>\n          </span>\n        </button>\n      </main>\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nexport default AddRemoveListsSheet;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nfunction PrivateNoteSheet({\n  account,\n  note: initialNote,\n  onRelationshipChange = () => {},\n  onClose = () => {},\n}) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const textareaRef = useRef(null);\n\n  useEffect(() => {\n    let timer;\n    if (textareaRef.current && !initialNote) {\n      timer = setTimeout(() => {\n        textareaRef.current.focus?.();\n      }, 100);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, []);\n\n  return (\n    <div class=\"sheet\" id=\"private-note-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Notes</Trans>\n        </b>{' '}\n        <small class=\"insignificant\">\n          <Trans>Only visible to you</Trans>\n        </small>\n      </header>\n      <main>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const note = formData.get('note');\n            if (note?.trim() !== initialNote?.trim()) {\n              setUIState('loading');\n              (async () => {\n                try {\n                  const newRelationship = await masto.v1.accounts\n                    .$select(account?.id)\n                    .note.create({\n                      comment: note,\n                    });\n                  console.log('updated relationship', newRelationship);\n                  setUIState('default');\n                  onRelationshipChange(newRelationship);\n                  onClose();\n                } catch (e) {\n                  console.error(e);\n                  setUIState('error');\n                  alert(e?.message || t`Unable to update private note.`);\n                }\n              })();\n            }\n          }}\n        >\n          <textarea\n            ref={textareaRef}\n            name=\"note\"\n            disabled={uiState === 'loading'}\n            dir=\"auto\"\n          >\n            {initialNote}\n          </textarea>\n          <footer>\n            <button\n              type=\"button\"\n              class=\"light\"\n              disabled={uiState === 'loading'}\n              onClick={() => {\n                onClose?.();\n              }}\n            >\n              <Trans>Cancel</Trans>\n            </button>\n            <span>\n              <Loader abrupt hidden={uiState !== 'loading'} />\n              <button disabled={uiState === 'loading'} type=\"submit\">\n                <Trans>Save &amp; close</Trans>\n              </button>\n            </span>\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default PrivateNoteSheet;\n","import { Trans, useLingui } from '@lingui/react/macro';\n\nimport getHTMLText from '../utils/getHTMLText';\n\nimport Icon from './icon';\nimport TranslationBlock from './translation-block';\n\nfunction TranslatedBioSheet({ note, fields, onClose }) {\n  const { t } = useLingui();\n  const fieldsText =\n    fields\n      ?.map(({ name, value }) => `${name}\\n${getHTMLText(value)}`)\n      .join('\\n\\n') || '';\n\n  const text = getHTMLText(note) + (fieldsText ? `\\n\\n${fieldsText}` : '');\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Translated Bio</Trans>\n        </h2>\n      </header>\n      <main>\n        <p\n          style={{\n            whiteSpace: 'pre-wrap',\n          }}\n        >\n          {text}\n        </p>\n        <TranslationBlock forceTranslate text={text} />\n      </main>\n    </div>\n  );\n}\n\nexport default TranslatedBioSheet;\n","import { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport punycode from 'punycode/';\n\nimport { api } from '../utils/api';\nimport i18nDuration from '../utils/i18n-duration';\nimport isSearchEnabled from '../utils/is-search-enabled';\nimport niceDateTime from '../utils/nice-date-time';\nimport showCompose from '../utils/show-compose';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport { getCurrentAccountID, updateAccount } from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport { handleScannerClick } from './account-info';\nimport AddRemoveListsSheet from './add-remove-lists-sheet';\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuConfirm from './menu-confirm';\nimport Menu2 from './menu2';\nimport Modal from './modal';\nimport PrivateNoteSheet from './private-note-sheet';\nimport SubMenu2 from './submenu2';\nimport TranslatedBioSheet from './translated-bio-sheet';\n\nconst MUTE_DURATIONS = [\n  60 * 5, // 5 minutes\n  60 * 30, // 30 minutes\n  60 * 60, // 1 hour\n  60 * 60 * 6, // 6 hours\n  60 * 60 * 24, // 1 day\n  60 * 60 * 24 * 3, // 3 days\n  60 * 60 * 24 * 7, // 1 week\n  60 * 60 * 24 * 30, // 30 days\n  0, // forever\n];\nconst MUTE_DURATIONS_LABELS = {\n  0: msg`Forever`,\n  300: i18nDuration(5, 'minute'),\n  1_800: i18nDuration(30, 'minute'),\n  3_600: i18nDuration(1, 'hour'),\n  21_600: i18nDuration(6, 'hour'),\n  86_400: i18nDuration(1, 'day'),\n  259_200: i18nDuration(3, 'day'),\n  604_800: i18nDuration(1, 'week'),\n  2592_000: i18nDuration(30, 'day'),\n};\n\nfunction RelatedActions({\n  info,\n  instance,\n  standalone,\n  authenticated,\n  onRelationshipChange = () => {},\n  setShowEditProfile = () => {},\n  showEndorsements = false,\n  renderEndorsements = false,\n  setRenderEndorsements = () => {},\n}) {\n  if (!info) return null;\n  const { _, t } = useLingui();\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated: currentAuthenticated,\n  } = api();\n  const sameInstance = instance === currentInstance;\n\n  const [relationshipUIState, setRelationshipUIState] = useState('default');\n  const [relationship, setRelationship] = useState(null);\n\n  const { id, acct, url, username, locked, lastStatusAt, note, fields, moved } =\n    info;\n  const accountID = useRef(id);\n\n  const {\n    following,\n    showingReblogs,\n    notifying,\n    followedBy,\n    blocking,\n    blockedBy,\n    muting,\n    mutingNotifications,\n    requested,\n    domainBlocking,\n    endorsed,\n    note: privateNote,\n  } = relationship || {};\n\n  const [currentInfo, setCurrentInfo] = useState(null);\n  const [isSelf, setIsSelf] = useState(false);\n\n  const acctWithInstance = acct.includes('@') ? acct : `${acct}@${instance}`;\n\n  const supportsEndorsements = supports('@mastodon/endorsements');\n\n  useEffect(() => {\n    if (info) {\n      const currentAccount = getCurrentAccountID();\n      let currentID;\n      (async () => {\n        if (sameInstance && authenticated) {\n          currentID = id;\n        } else if (!sameInstance && currentAuthenticated) {\n          // Grab this account from my logged-in instance\n          const acctHasInstance = info.acct.includes('@');\n          try {\n            const results = await currentMasto.v2.search.list({\n              q: acctHasInstance ? info.acct : `${info.username}@${instance}`,\n              type: 'accounts',\n              limit: 1,\n              resolve: true,\n            });\n            console.log(' Fetched account from logged-in instance', results);\n            if (results.accounts.length) {\n              currentID = results.accounts[0].id;\n              setCurrentInfo(results.accounts[0]);\n            }\n          } catch (e) {\n            console.error(e);\n          }\n        }\n\n        if (!currentID) return;\n\n        if (currentAccount === currentID) {\n          // It's myself!\n          setIsSelf(true);\n          return;\n        }\n\n        accountID.current = currentID;\n\n        // if (moved) return;\n\n        setRelationshipUIState('loading');\n\n        const fetchRelationships = currentMasto.v1.accounts.relationships.fetch(\n          {\n            id: [currentID],\n          },\n        );\n\n        try {\n          const relationships = await fetchRelationships;\n          console.log('fetched relationship', relationships);\n          setRelationshipUIState('default');\n\n          if (relationships.length) {\n            const relationship = relationships[0];\n            setRelationship(relationship);\n            onRelationshipChange({ relationship, currentID });\n          }\n        } catch (e) {\n          console.error(e);\n          setRelationshipUIState('error');\n        }\n      })();\n    }\n  }, [info, authenticated]);\n\n  useEffect(() => {\n    if (info && isSelf) {\n      updateAccount(info);\n    }\n  }, [info, isSelf]);\n\n  const loading = relationshipUIState === 'loading';\n\n  const [showTranslatedBio, setShowTranslatedBio] = useState(false);\n  const [showAddRemoveLists, setShowAddRemoveLists] = useState(false);\n  const [showPrivateNoteModal, setShowPrivateNoteModal] = useState(false);\n  const [lists, setLists] = useState([]);\n  const [searchEnabled, setSearchEnabled] = useState(false);\n\n  useEffect(() => {\n    if (!currentAuthenticated) return;\n    (async () => {\n      const enabled = await isSearchEnabled(currentInstance);\n      setSearchEnabled(enabled);\n    })();\n  }, [currentInstance, currentAuthenticated]);\n\n  let { headerStatic, avatarStatic } = info;\n  if (!headerStatic || /missing\\.png$/.test(headerStatic)) {\n    if (avatarStatic && !/missing\\.png$/.test(avatarStatic)) {\n      headerStatic = avatarStatic;\n    }\n  }\n\n  return (\n    <>\n      <div class=\"actions\">\n        <span>\n          {followedBy ? (\n            <span class=\"tag\">\n              <Trans>Follows you</Trans>\n            </span>\n          ) : !!lastStatusAt ? (\n            <small class=\"insignificant\">\n              <Trans>\n                Last post:{' '}\n                <span class=\"ib\">\n                  {niceDateTime(lastStatusAt, {\n                    hideTime: true,\n                  })}\n                </span>\n              </Trans>\n            </small>\n          ) : (\n            <span />\n          )}\n          {muting && (\n            <span class=\"tag danger\">\n              <Trans>Muted</Trans>\n            </span>\n          )}\n          {blocking && (\n            <span class=\"tag danger\">\n              <Trans>Blocked</Trans>\n            </span>\n          )}\n        </span>{' '}\n        <span class=\"buttons\">\n          {!!privateNote && (\n            <button\n              type=\"button\"\n              class=\"private-note-tag\"\n              title={t`Notes`}\n              onClick={() => {\n                setShowPrivateNoteModal(true);\n              }}\n              dir=\"auto\"\n            >\n              <span>{privateNote}</span>\n            </button>\n          )}\n          {currentAuthenticated && isSelf && (\n            <button\n              type=\"button\"\n              class=\"plain\"\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: url,\n                  arena: avatarStatic,\n                  backgroundMask: headerStatic,\n                  caption: acct.includes('@') ? acct : `${acct}@${instance}`,\n                  onScannerClick: handleScannerClick,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" alt={t`QR code`} />\n            </button>\n          )}\n          <Menu2\n            portal={{\n              target: document.body,\n            }}\n            containerProps={{\n              style: {\n                // Higher than the backdrop\n                zIndex: 1001,\n              },\n            }}\n            align=\"center\"\n            position=\"anchor\"\n            overflow=\"auto\"\n            menuButton={\n              <button type=\"button\" class=\"plain4\" disabled={loading}>\n                <Icon icon=\"more2\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n            onMenuChange={(e) => {\n              if (following && e.open) {\n                // Fetch lists that have this account\n                (async () => {\n                  try {\n                    const lists = await currentMasto.v1.accounts\n                      .$select(accountID.current)\n                      .lists.list();\n                    console.log('fetched account lists', lists);\n                    setLists(lists);\n                  } catch (e) {\n                    console.error(e);\n                  }\n                })();\n              }\n            }}\n          >\n            {currentAuthenticated && !isSelf ? (\n              <>\n                <MenuItem\n                  onClick={() => {\n                    showCompose({\n                      draftStatus: {\n                        status: `@${currentInfo?.acct || acct} `,\n                      },\n                    });\n                  }}\n                >\n                  <Icon icon=\"at\" />\n                  <span>\n                    <Trans>\n                      Mention <span class=\"bidi-isolate\">@{username}</span>\n                    </Trans>\n                  </span>\n                </MenuItem>\n                {searchEnabled && (\n                  <MenuItem\n                    onClick={() => {\n                      states.showSearchCommand = { query: `from:${acct} ` };\n                    }}\n                  >\n                    <Icon icon=\"search\" />\n                    <span>\n                      <Trans>\n                        Search <span class=\"bidi-isolate\">@{username}</span>'s\n                        posts\n                      </Trans>\n                    </span>\n                  </MenuItem>\n                )}\n                <MenuItem\n                  onClick={() => {\n                    setShowTranslatedBio(true);\n                  }}\n                >\n                  <Icon icon=\"translate\" />\n                  <span>\n                    <Trans>Translate bio</Trans>\n                  </span>\n                </MenuItem>\n                {supports('@mastodon/profile-private-note') && (\n                  <MenuItem\n                    onClick={() => {\n                      setShowPrivateNoteModal(true);\n                    }}\n                  >\n                    <Icon icon=\"note\" />\n                    <span>{privateNote ? t`Edit notes` : t`Add notes`}</span>\n                  </MenuItem>\n                )}\n                {following && !!relationship && (\n                  <>\n                    <MenuItem\n                      onClick={() => {\n                        setRelationshipUIState('loading');\n                        (async () => {\n                          try {\n                            const rel = await currentMasto.v1.accounts\n                              .$select(accountID.current)\n                              .follow({\n                                notify: !notifying,\n                              });\n                            if (rel) setRelationship(rel);\n                            setRelationshipUIState('default');\n                            showToast(\n                              rel.notifying\n                                ? t`Notifications enabled for @${username}'s posts.`\n                                : t` Notifications disabled for @${username}'s posts.`,\n                            );\n                          } catch (e) {\n                            alert(e);\n                            setRelationshipUIState('error');\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"notification\" />\n                      <span>\n                        {notifying\n                          ? t`Disable notifications`\n                          : t`Enable notifications`}\n                      </span>\n                    </MenuItem>\n                    <MenuItem\n                      onClick={() => {\n                        setRelationshipUIState('loading');\n                        (async () => {\n                          try {\n                            const rel = await currentMasto.v1.accounts\n                              .$select(accountID.current)\n                              .follow({\n                                reblogs: !showingReblogs,\n                              });\n                            if (rel) setRelationship(rel);\n                            setRelationshipUIState('default');\n                            showToast(\n                              rel.showingReblogs\n                                ? t`Boosts from @${username} enabled.`\n                                : t`Boosts from @${username} disabled.`,\n                            );\n                          } catch (e) {\n                            alert(e);\n                            setRelationshipUIState('error');\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"rocket\" />\n                      <span>\n                        {showingReblogs ? t`Disable boosts` : t`Enable boosts`}\n                      </span>\n                    </MenuItem>\n                  </>\n                )}\n                {supportsEndorsements && following && (\n                  <MenuItem\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          if (endorsed) {\n                            const newRelationship =\n                              await currentMasto.v1.accounts\n                                .$select(currentInfo?.id || id)\n                                .unpin();\n                            setRelationship(newRelationship);\n                            setRelationshipUIState('default');\n                            showToast(\n                              t`@${username} is no longer featured on your profile.`,\n                            );\n                          } else {\n                            const newRelationship =\n                              await currentMasto.v1.accounts\n                                .$select(currentInfo?.id || id)\n                                .pin();\n                            setRelationship(newRelationship);\n                            setRelationshipUIState('default');\n                            showToast(\n                              t`@${username} is now featured on your profile.`,\n                            );\n                          }\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                          if (endorsed) {\n                            showToast(\n                              t`Unable to unfeature @${username} on your profile.`,\n                            );\n                          } else {\n                            showToast(\n                              t`Unable to feature @${username} on your profile.`,\n                            );\n                          }\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"endorsement\" />\n                    {endorsed\n                      ? t`Don't feature on profile`\n                      : t`Feature on profile`}\n                  </MenuItem>\n                )}\n                {showEndorsements &&\n                  supportsEndorsements &&\n                  !renderEndorsements && (\n                    <MenuItem onClick={() => setRenderEndorsements(true)}>\n                      <Icon icon=\"endorsement\" />\n                      <span>\n                        <Trans>Show featured profiles</Trans>\n                      </span>\n                    </MenuItem>\n                  )}\n                {/* Add/remove from lists is only possible if following the account */}\n                {following && (\n                  <MenuItem\n                    onClick={() => {\n                      setShowAddRemoveLists(true);\n                    }}\n                  >\n                    <Icon icon=\"list\" />\n                    {lists.length ? (\n                      <>\n                        <small class=\"menu-grow\">\n                          <Trans>Add/Remove from Lists</Trans>\n                          <br />\n                          <span class=\"more-insignificant\">\n                            {lists.map((list) => list.title).join(', ')}\n                          </span>\n                        </small>\n                        <small class=\"more-insignificant\">{lists.length}</small>\n                      </>\n                    ) : (\n                      <span>\n                        <Trans>Add/Remove from Lists</Trans>\n                      </span>\n                    )}\n                  </MenuItem>\n                )}\n                <MenuDivider />\n              </>\n            ) : (\n              <>\n                {searchEnabled && isSelf && (\n                  <MenuItem\n                    onClick={() => {\n                      states.showSearchCommand = { query: 'from:me ' };\n                    }}\n                  >\n                    <Icon icon=\"search\" />\n                    <span>\n                      <Trans>Search my posts</Trans>\n                    </span>\n                  </MenuItem>\n                )}\n                {supportsEndorsements && !renderEndorsements && (\n                  <>\n                    <MenuItem onClick={() => setRenderEndorsements(true)}>\n                      <Icon icon=\"endorsement\" />\n                      <Trans>Show featured profiles</Trans>\n                    </MenuItem>\n                  </>\n                )}\n                {((searchEnabled && isSelf) ||\n                  (supportsEndorsements && !renderEndorsements)) && (\n                  <MenuDivider />\n                )}\n              </>\n            )}\n            <MenuItem\n              onClick={() => {\n                const handle = `@${currentInfo?.acct || acctWithInstance}`;\n                try {\n                  navigator.clipboard.writeText(handle);\n                  showToast(t`Handle copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy handle`);\n                }\n              }}\n            >\n              <Icon icon=\"copy\" />\n              <small>\n                <Trans>Copy handle</Trans>\n                <br />\n                <span class=\"more-insignificant bidi-isolate\">\n                  @{currentInfo?.acct || acctWithInstance}\n                </span>\n              </small>\n            </MenuItem>\n            <MenuItem href={url} target=\"_blank\">\n              <Icon icon=\"external\" />\n              <small class=\"menu-double-lines\">{niceAccountURL(url)}</small>\n            </MenuItem>\n            <div class=\"menu-horizontal\">\n              <MenuItem\n                onClick={() => {\n                  // Copy url to clipboard\n                  try {\n                    navigator.clipboard.writeText(url);\n                    showToast(t`Link copied`);\n                  } catch (e) {\n                    console.error(e);\n                    showToast(t`Unable to copy link`);\n                  }\n                }}\n              >\n                <Icon icon=\"link\" />\n                <span>\n                  <Trans>Copy</Trans>\n                </span>\n              </MenuItem>\n              {navigator?.share &&\n                navigator?.canShare?.({\n                  url,\n                }) && (\n                  <MenuItem\n                    onClick={() => {\n                      try {\n                        navigator.share({\n                          url,\n                        });\n                      } catch (e) {\n                        console.error(e);\n                        alert(t`Sharing doesn't seem to work.`);\n                      }\n                    }}\n                  >\n                    <Icon icon=\"share\" />\n                    <span>\n                      <Trans>Share</Trans>\n                    </span>\n                  </MenuItem>\n                )}\n            </div>\n            <MenuItem\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: url,\n                  arena: avatarStatic,\n                  backgroundMask: headerStatic,\n                  caption: acct.includes('@') ? acct : `${acct}@${instance}`,\n                  onScannerClick: handleScannerClick,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" />\n              <span>\n                <Trans>QR code</Trans>\n              </span>\n            </MenuItem>\n            {!!relationship && (\n              <>\n                <MenuDivider />\n                {muting ? (\n                  <MenuItem\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .unmute();\n                          console.log('unmuting', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Unmuted @${username}`);\n                          states.reloadGenericAccounts.id = 'mute';\n                          states.reloadGenericAccounts.counter++;\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"unmute\" />\n                    <span>\n                      <Trans>\n                        Unmute <span class=\"bidi-isolate\">@{username}</span>\n                      </Trans>\n                    </span>\n                  </MenuItem>\n                ) : (\n                  <SubMenu2\n                    menuClassName=\"menu-blur\"\n                    openTrigger=\"clickOnly\"\n                    direction=\"bottom\"\n                    overflow=\"auto\"\n                    shift={16}\n                    label={\n                      <>\n                        <Icon icon=\"mute\" />\n                        <span class=\"menu-grow\">\n                          <Trans>\n                            Mute <span class=\"bidi-isolate\">@{username}</span>\n                          </Trans>\n                        </span>\n                        <span\n                          style={{\n                            textOverflow: 'clip',\n                          }}\n                        >\n                          <Icon icon=\"time\" />\n                          <Icon icon=\"chevron-right\" />\n                        </span>\n                      </>\n                    }\n                  >\n                    <div class=\"menu-wrap\">\n                      {MUTE_DURATIONS.map((duration) => (\n                        <MenuItem\n                          onClick={() => {\n                            setRelationshipUIState('loading');\n                            (async () => {\n                              try {\n                                const newRelationship =\n                                  await currentMasto.v1.accounts\n                                    .$select(currentInfo?.id || id)\n                                    .mute({\n                                      duration,\n                                    });\n                                console.log('muting', newRelationship);\n                                setRelationship(newRelationship);\n                                setRelationshipUIState('default');\n                                showToast(\n                                  t`Muted @${username} for ${\n                                    typeof MUTE_DURATIONS_LABELS[duration] ===\n                                    'function'\n                                      ? MUTE_DURATIONS_LABELS[duration]()\n                                      : _(MUTE_DURATIONS_LABELS[duration])\n                                  }`,\n                                );\n                                states.reloadGenericAccounts.id = 'mute';\n                                states.reloadGenericAccounts.counter++;\n                              } catch (e) {\n                                console.error(e);\n                                setRelationshipUIState('error');\n                                showToast(t`Unable to mute @${username}`);\n                              }\n                            })();\n                          }}\n                        >\n                          {typeof MUTE_DURATIONS_LABELS[duration] === 'function'\n                            ? MUTE_DURATIONS_LABELS[duration]()\n                            : _(MUTE_DURATIONS_LABELS[duration])}\n                        </MenuItem>\n                      ))}\n                    </div>\n                  </SubMenu2>\n                )}\n                {followedBy && (\n                  <MenuConfirm\n                    subMenu\n                    menuItemClassName=\"danger\"\n                    confirmLabel={\n                      <>\n                        <Icon icon=\"user-x\" />\n                        <span>\n                          <Trans>\n                            Remove <span class=\"bidi-isolate\">@{username}</span>{' '}\n                            from followers?\n                          </Trans>\n                        </span>\n                      </>\n                    }\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .removeFromFollowers();\n                          console.log(\n                            'removing from followers',\n                            newRelationship,\n                          );\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`@${username} removed from followers`);\n                          states.reloadGenericAccounts.id = 'followers';\n                          states.reloadGenericAccounts.counter++;\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"user-x\" />\n                    <span>\n                      <Trans>Remove follower</Trans>\n                    </span>\n                  </MenuConfirm>\n                )}\n                <MenuConfirm\n                  subMenu\n                  confirm={!blocking}\n                  confirmLabel={\n                    <>\n                      <Icon icon=\"block\" />\n                      <span>\n                        <Trans>\n                          Block <span class=\"bidi-isolate\">@{username}</span>?\n                        </Trans>\n                      </span>\n                    </>\n                  }\n                  itemProps={{\n                    className: 'danger',\n                  }}\n                  menuItemClassName=\"danger\"\n                  onClick={() => {\n                    // if (!blocking && !confirm(`Block @${username}?`)) {\n                    //   return;\n                    // }\n                    setRelationshipUIState('loading');\n                    (async () => {\n                      try {\n                        if (blocking) {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .unblock();\n                          console.log('unblocking', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Unblocked @${username}`);\n                        } else {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .block();\n                          console.log('blocking', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Blocked @${username}`);\n                        }\n                        states.reloadGenericAccounts.id = 'block';\n                        states.reloadGenericAccounts.counter++;\n                      } catch (e) {\n                        console.error(e);\n                        setRelationshipUIState('error');\n                        if (blocking) {\n                          showToast(t`Unable to unblock @${username}`);\n                        } else {\n                          showToast(t`Unable to block @${username}`);\n                        }\n                      }\n                    })();\n                  }}\n                >\n                  {blocking ? (\n                    <>\n                      <Icon icon=\"unblock\" />\n                      <span>\n                        <Trans>\n                          Unblock <span class=\"bidi-isolate\">@{username}</span>\n                        </Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"block\" />\n                      <span>\n                        <Trans>\n                          Block <span class=\"bidi-isolate\">@{username}</span>\n                        </Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuConfirm>\n                <MenuItem\n                  className=\"danger\"\n                  onClick={() => {\n                    states.showReportModal = {\n                      account: currentInfo || info,\n                    };\n                  }}\n                >\n                  <Icon icon=\"flag\" />\n                  <span>\n                    <Trans>\n                      Report <span class=\"bidi-isolate\">@{username}</span>\n                    </Trans>\n                  </span>\n                </MenuItem>\n              </>\n            )}\n            {currentAuthenticated &&\n              isSelf &&\n              standalone &&\n              supports('@mastodon/profile-edit') && (\n                <>\n                  <MenuDivider />\n                  <MenuItem\n                    onClick={() => {\n                      setShowEditProfile(true);\n                    }}\n                  >\n                    <Icon icon=\"pencil\" />\n                    <span>\n                      <Trans>Edit profile</Trans>\n                    </span>\n                  </MenuItem>\n                </>\n              )}\n            {import.meta.env.DEV && currentAuthenticated && isSelf && (\n              <>\n                <MenuDivider />\n                <MenuItem\n                  onClick={async () => {\n                    const relationships =\n                      await currentMasto.v1.accounts.relationships.fetch({\n                        id: [accountID.current],\n                      });\n                    const { note } = relationships[0] || {};\n                    if (note) {\n                      alert(note);\n                      console.log(note);\n                    }\n                  }}\n                >\n                  <Icon icon=\"pencil\" />\n                  <span>See note</span>\n                </MenuItem>\n              </>\n            )}\n          </Menu2>\n          {!relationship && relationshipUIState === 'loading' && (\n            <Loader abrupt />\n          )}\n          {!!relationship && !moved && (\n            <MenuConfirm\n              confirm={following || requested}\n              confirmLabel={\n                <span>\n                  {requested\n                    ? t`Withdraw follow request?`\n                    : t`Unfollow @${info.acct || info.username}?`}\n                </span>\n              }\n              menuItemClassName=\"danger\"\n              align=\"end\"\n              disabled={loading}\n              onClick={() => {\n                setRelationshipUIState('loading');\n                (async () => {\n                  try {\n                    let newRelationship;\n\n                    if (following || requested) {\n                      // const yes = confirm(\n                      //   requested\n                      //     ? 'Withdraw follow request?'\n                      //     : `Unfollow @${info.acct || info.username}?`,\n                      // );\n\n                      // if (yes) {\n                      newRelationship = await currentMasto.v1.accounts\n                        .$select(accountID.current)\n                        .unfollow();\n                      // }\n                    } else {\n                      newRelationship = await currentMasto.v1.accounts\n                        .$select(accountID.current)\n                        .follow();\n                    }\n\n                    if (newRelationship) {\n                      setRelationship(newRelationship);\n\n                      // Show endorsements if start following\n                      if (\n                        showEndorsements &&\n                        supportsEndorsements &&\n                        !renderEndorsements &&\n                        newRelationship.following\n                      ) {\n                        setRenderEndorsements('onlyOpenIfHasEndorsements');\n                      }\n                    }\n                    setRelationshipUIState('default');\n                  } catch (e) {\n                    alert(e);\n                    setRelationshipUIState('error');\n                  }\n                })();\n              }}\n            >\n              <button\n                type=\"button\"\n                class={`${following || requested ? 'light swap' : ''}`}\n                data-swap-state={following || requested ? 'danger' : ''}\n                disabled={loading}\n              >\n                {following ? (\n                  <>\n                    <span>\n                      <Trans>Following</Trans>\n                    </span>\n                    <span>\n                      <Trans>Unfollow</Trans>\n                    </span>\n                  </>\n                ) : requested ? (\n                  <>\n                    <span>\n                      <Trans>Requested</Trans>\n                    </span>\n                    <span>\n                      <Trans>Withdraw</Trans>\n                    </span>\n                  </>\n                ) : locked ? (\n                  <>\n                    <Icon icon=\"lock\" />{' '}\n                    <span>\n                      <Trans>Follow</Trans>\n                    </span>\n                  </>\n                ) : (\n                  t`Follow`\n                )}\n              </button>\n            </MenuConfirm>\n          )}\n        </span>\n      </div>\n      {!!showTranslatedBio && (\n        <Modal\n          onClose={() => {\n            setShowTranslatedBio(false);\n          }}\n        >\n          <TranslatedBioSheet\n            note={note}\n            fields={fields}\n            onClose={() => setShowTranslatedBio(false)}\n          />\n        </Modal>\n      )}\n      {!!showAddRemoveLists && (\n        <Modal\n          onClose={() => {\n            setShowAddRemoveLists(false);\n          }}\n        >\n          <AddRemoveListsSheet\n            accountID={accountID.current}\n            onClose={() => setShowAddRemoveLists(false)}\n          />\n        </Modal>\n      )}\n      {!!showPrivateNoteModal && (\n        <Modal\n          onClose={() => {\n            setShowPrivateNoteModal(false);\n          }}\n        >\n          <PrivateNoteSheet\n            account={info}\n            note={privateNote}\n            onRelationshipChange={(relationship) => {\n              setRelationship(relationship);\n              // onRelationshipChange({ relationship, currentID: accountID.current });\n            }}\n            onClose={() => setShowPrivateNoteModal(false)}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction niceAccountURL(url) {\n  if (!url) return;\n  const urlObj = URL.parse(url);\n  if (!urlObj) return;\n  const { host, pathname } = urlObj;\n  const path = pathname.replace(/\\/$/, '').replace(/^\\//, '');\n  return (\n    <>\n      <span class=\"more-insignificant\">{punycode.toUnicode(host)}/</span>\n      <wbr />\n      <span>{path}</span>\n    </>\n  );\n}\n\nexport default RelatedActions;\n","import './account-info.css';\n\nimport { msg, plural } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport getDomain from '../utils/get-domain';\nimport handleContentLinks from '../utils/handle-content-links';\nimport niceDateTime from '../utils/nice-date-time';\nimport pmem from '../utils/pmem';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { hideAllModals } from '../utils/states';\nimport {\n  getAccounts,\n  getCurrentAccountID,\n  saveAccounts,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport AccountBlock from './account-block';\nimport AccountHandleInfo from './account-handle-info';\nimport Avatar from './avatar';\nimport EditProfileSheet from './edit-profile-sheet';\nimport EmojiText from './emoji-text';\nimport Endorsements from './endorsements';\nimport Icon from './icon';\nimport Link from './link';\nimport Menu2 from './menu2';\nimport Modal from './modal';\nimport RelatedActions from './related-actions';\n\nconst LIMIT = 80;\n\nconst ACCOUNT_INFO_MAX_AGE = 1000 * 60 * 10; // 10 mins\n\nfunction fetchFamiliarFollowers(currentID, masto) {\n  return masto.v1.accounts.familiarFollowers.fetch({\n    id: [currentID],\n  });\n}\nconst memFetchFamiliarFollowers = pmem(fetchFamiliarFollowers, {\n  expires: ACCOUNT_INFO_MAX_AGE,\n});\n\nasync function fetchPostingStats(accountID, masto) {\n  const fetchStatuses = masto.v1.accounts\n    .$select(accountID)\n    .statuses.list({\n      limit: 20,\n    })\n    .values()\n    .next();\n\n  const { value: statuses } = await fetchStatuses;\n  console.log('fetched statuses', statuses);\n  const stats = {\n    total: statuses.length,\n    originals: 0,\n    replies: 0,\n    boosts: 0,\n    quotes: 0,\n  };\n  // Categories statuses by type\n  // - Original posts (not replies to others)\n  // - Threads (self-replies + 1st original post)\n  // - Boosts (reblogs)\n  // - Replies (not-self replies)\n  // - Quotes\n  statuses.forEach((status) => {\n    if (status.reblog) {\n      stats.boosts++;\n    } else if (\n      !!status.inReplyToId &&\n      status.inReplyToAccountId !== status.account.id // Not self-reply\n    ) {\n      stats.replies++;\n    } else if (\n      supportsNativeQuote() &&\n      (status.quote?.id || status.quote?.quotedStatus?.id)\n    ) {\n      stats.quotes++;\n    } else {\n      stats.originals++;\n    }\n  });\n\n  // Count days since last post\n  if (statuses.length) {\n    stats.daysSinceLastPost = Math.ceil(\n      (Date.now() - Date.parse(statuses[statuses.length - 1].createdAt)) /\n        86400000,\n    );\n  }\n\n  console.log('posting stats', stats);\n  return stats;\n}\nconst memFetchPostingStats = pmem(fetchPostingStats, {\n  expires: ACCOUNT_INFO_MAX_AGE,\n});\n\nconst isValidUrl = (string) => {\n  try {\n    new URL(string);\n    return true;\n  } catch (_) {\n    return false;\n  }\n};\nexport const handleScannerClick = () => {\n  states.showQrScannerModal = {\n    checkValidity: isValidUrl,\n    actionableText: msg`View profile`,\n    onClose: ({ text } = {}) => {\n      if (text) {\n        hideAllModals();\n        location.hash = `/${text}`;\n      }\n    },\n  };\n};\n\nfunction AccountInfo({\n  account,\n  fetchAccount = () => {},\n  standalone,\n  instance,\n  authenticated,\n  showEndorsements = false,\n}) {\n  const { i18n, t } = useLingui();\n  const { masto, authenticated: currentAuthenticated } = api({\n    instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const [uiState, setUIState] = useState('default');\n  const isString = typeof account === 'string';\n  const [info, setInfo] = useState(isString ? null : account);\n\n  const sameCurrentInstance = useMemo(\n    () => instance === currentInstance,\n    [instance, currentInstance],\n  );\n\n  useEffect(() => {\n    if (!isString) {\n      setInfo(account);\n      return;\n    }\n    setUIState('loading');\n    (async () => {\n      try {\n        const info = await fetchAccount();\n        states.accounts[`${info.id}@${instance}`] = info;\n        setInfo(info);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setInfo(null);\n        setUIState('error');\n      }\n    })();\n  }, [isString, account, fetchAccount]);\n\n  const {\n    acct,\n    avatar,\n    avatarStatic,\n    bot,\n    createdAt,\n    displayName,\n    emojis,\n    fields,\n    followersCount,\n    followingCount,\n    group,\n    // header,\n    // headerStatic,\n    id,\n    lastStatusAt,\n    locked,\n    note,\n    statusesCount,\n    url,\n    username,\n    memorial,\n    moved,\n    roles,\n    hideCollections,\n  } = info || {};\n  let headerIsAvatar = false;\n  let { header, headerStatic } = info || {};\n  if (!header || /missing\\.png$/.test(header)) {\n    if (avatar && !/missing\\.png$/.test(avatar)) {\n      header = avatar;\n      headerIsAvatar = true;\n      if (avatarStatic && !/missing\\.png$/.test(avatarStatic)) {\n        headerStatic = avatarStatic;\n      }\n    }\n  }\n\n  const isSelf = useMemo(() => id === getCurrentAccountID(), [id]);\n\n  useEffect(() => {\n    const infoHasEssentials = !!(\n      info?.id &&\n      info?.username &&\n      info?.acct &&\n      info?.avatar &&\n      info?.avatarStatic &&\n      info?.displayName &&\n      info?.url\n    );\n    if (isSelf && instance && infoHasEssentials) {\n      const accounts = getAccounts();\n      let updated = false;\n      accounts.forEach((account) => {\n        if (account.info.id === info.id && account.instanceURL === instance) {\n          account.info = info;\n          updated = true;\n        }\n      });\n      if (updated) {\n        console.log('Updated account info', info);\n        saveAccounts(accounts);\n      }\n    }\n  }, [isSelf, info, instance]);\n\n  const accountInstance = getDomain(url);\n\n  const [headerCornerColors, setHeaderCornerColors] = useState([]);\n\n  const followersIterator = useRef();\n  const familiarFollowersCache = useRef([]);\n  async function fetchFollowers(firstLoad) {\n    if (firstLoad || !followersIterator.current) {\n      followersIterator.current = masto.v1.accounts\n        .$select(id)\n        .followers.list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await followersIterator.current.next();\n    if (isSelf) return results;\n    if (!sameCurrentInstance) return results;\n\n    const { value } = results;\n    let newValue = [];\n    // On first load, fetch familiar followers, merge to top of results' `value`\n    // Remove dups on every fetch\n    if (firstLoad) {\n      let familiarFollowers = [];\n      try {\n        familiarFollowers = await masto.v1.accounts.familiarFollowers.fetch({\n          id: [id],\n        });\n      } catch (e) {}\n      familiarFollowersCache.current = familiarFollowers?.[0]?.accounts || [];\n      newValue = [\n        ...familiarFollowersCache.current,\n        ...value.filter(\n          (account) =>\n            !familiarFollowersCache.current.some(\n              (familiar) => familiar.id === account.id,\n            ),\n        ),\n      ];\n    } else if (value?.length) {\n      newValue = value.filter(\n        (account) =>\n          !familiarFollowersCache.current.some(\n            (familiar) => familiar.id === account.id,\n          ),\n      );\n    }\n\n    return {\n      ...results,\n      value: newValue,\n    };\n  }\n\n  const followingIterator = useRef();\n  async function fetchFollowing(firstLoad) {\n    if (firstLoad || !followingIterator.current) {\n      followingIterator.current = masto.v1.accounts\n        .$select(id)\n        .following.list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await followingIterator.current.next();\n    return results;\n  }\n\n  const LinkOrDiv = standalone ? 'div' : Link;\n  const accountLink = instance ? `/${instance}/a/${id}` : `/a/${id}`;\n\n  const [familiarFollowers, setFamiliarFollowers] = useState([]);\n  const [postingStats, setPostingStats] = useState();\n  const [postingStatsUIState, setPostingStatsUIState] = useState('default');\n  const hasPostingStats = !!postingStats?.total;\n\n  const renderFamiliarFollowers = async (currentID) => {\n    try {\n      const followers = await memFetchFamiliarFollowers(\n        currentID,\n        currentMasto,\n      );\n      console.log('fetched familiar followers', followers);\n      setFamiliarFollowers(\n        followers[0].accounts.slice(0, FAMILIAR_FOLLOWERS_LIMIT),\n      );\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const renderPostingStats = async () => {\n    if (!id) return;\n    setPostingStatsUIState('loading');\n    try {\n      const stats = await memFetchPostingStats(id, masto);\n      setPostingStats(stats);\n      setPostingStatsUIState('default');\n    } catch (e) {\n      console.error(e);\n      setPostingStatsUIState('error');\n    }\n  };\n\n  const onRelationshipChange = useCallback(\n    ({ relationship, currentID }) => {\n      if (!relationship.following) {\n        renderFamiliarFollowers(currentID);\n        if (!standalone && statusesCount > 0) {\n          // Only render posting stats if not standalone and has posts\n          renderPostingStats();\n        }\n      }\n    },\n    [standalone, id, statusesCount],\n  );\n\n  const onProfileUpdate = useCallback(\n    (newAccount) => {\n      if (newAccount.id === id) {\n        console.log('Updated account info', newAccount);\n        setInfo(newAccount);\n        states.accounts[`${newAccount.id}@${instance}`] = newAccount;\n      }\n    },\n    [id, instance],\n  );\n\n  const isStringURL = isString && account && /^https?:\\/\\//.test(account);\n\n  const [showEditProfile, setShowEditProfile] = useState(false);\n\n  const [renderEndorsements, setRenderEndorsements] = useState(false);\n\n  return (\n    <>\n      <div\n        tabIndex=\"-1\"\n        class={`account-container ${uiState === 'loading' ? 'skeleton' : ''}`}\n        style={{\n          '--header-color-1': headerCornerColors[0],\n          '--header-color-2': headerCornerColors[1],\n          '--header-color-3': headerCornerColors[2],\n          '--header-color-4': headerCornerColors[3],\n        }}\n      >\n        {uiState === 'error' && (\n          <div class=\"ui-state\">\n            <p>\n              <Trans>Unable to load account.</Trans>\n            </p>\n            {isString ? (\n              <p>\n                {isStringURL ? (\n                  <a href={account} target=\"_blank\" rel=\"noopener\">\n                    {account}\n                  </a>\n                ) : (\n                  <code class=\"insignificant\">{account}</code>\n                )}\n              </p>\n            ) : (\n              <p>\n                <a href={url} target=\"_blank\" rel=\"noopener\">\n                  <Trans>Go to account page</Trans> <Icon icon=\"external\" />\n                </a>\n              </p>\n            )}\n          </div>\n        )}\n        {uiState === 'loading' ? (\n          <>\n            <header>\n              <AccountBlock avatarSize=\"xxxl\" skeleton />\n            </header>\n            <main>\n              <div class=\"note\">\n                <p>  </p>\n                <p>     </p>\n              </div>\n              <div class=\"account-metadata-box\">\n                <div class=\"profile-metadata\">\n                  <div class=\"profile-field\">\n                    <b class=\"more-insignificant\"></b>\n                    <p></p>\n                  </div>\n                  <div class=\"profile-field\">\n                    <b class=\"more-insignificant\"></b>\n                    <p></p>\n                  </div>\n                </div>\n                <div class=\"stats\">\n                  <div>\n                    <span></span> \n                  </div>\n                  <div>\n                    <span></span> \n                  </div>\n                  <div>\n                    <span></span> \n                  </div>\n                </div>\n              </div>\n              <div class=\"actions\">\n                <span />\n                <span class=\"buttons\">\n                  <button type=\"button\" class=\"plain4\" disabled>\n                    <Icon icon=\"more2\" size=\"l\" />\n                  </button>\n                </span>\n              </div>\n            </main>\n          </>\n        ) : (\n          info && (\n            <>\n              {!!moved && (\n                <div class=\"account-moved\">\n                  <p>\n                    <Trans>\n                      <b>{displayName}</b> has indicated that their new account\n                      is now:\n                    </Trans>\n                  </p>\n                  <AccountBlock\n                    account={moved}\n                    instance={instance}\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      states.showAccount = moved;\n                    }}\n                  />\n                </div>\n              )}\n              {!!header && !/missing\\.png$/.test(header) && (\n                <img\n                  src={header}\n                  alt=\"\"\n                  class={`header-banner ${\n                    headerIsAvatar ? 'header-is-avatar' : ''\n                  }`}\n                  onError={(e) => {\n                    if (e.target.crossOrigin) {\n                      if (e.target.src !== headerStatic) {\n                        e.target.src = headerStatic;\n                      } else {\n                        e.target.removeAttribute('crossorigin');\n                        e.target.src = header;\n                      }\n                    } else if (e.target.src !== headerStatic) {\n                      e.target.src = headerStatic;\n                    } else {\n                      e.target.remove();\n                    }\n                  }}\n                  crossOrigin=\"anonymous\"\n                  onLoad={(e) => {\n                    e.target.classList.add('loaded');\n                    try {\n                      // Get color from four corners of image\n                      const canvas = window.OffscreenCanvas\n                        ? new OffscreenCanvas(1, 1)\n                        : document.createElement('canvas');\n                      const ctx = canvas.getContext('2d', {\n                        willReadFrequently: true,\n                      });\n                      canvas.width = e.target.width;\n                      canvas.height = e.target.height;\n                      ctx.imageSmoothingEnabled = false;\n                      ctx.drawImage(e.target, 0, 0);\n                      // const colors = [\n                      //   ctx.getImageData(0, 0, 1, 1).data,\n                      //   ctx.getImageData(e.target.width - 1, 0, 1, 1).data,\n                      //   ctx.getImageData(0, e.target.height - 1, 1, 1).data,\n                      //   ctx.getImageData(\n                      //     e.target.width - 1,\n                      //     e.target.height - 1,\n                      //     1,\n                      //     1,\n                      //   ).data,\n                      // ];\n                      // Get 10x10 pixels from corners, get average color from each\n                      const pixelDimension = 10;\n                      const colors = [\n                        ctx.getImageData(0, 0, pixelDimension, pixelDimension)\n                          .data,\n                        ctx.getImageData(\n                          e.target.width - pixelDimension,\n                          0,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                        ctx.getImageData(\n                          0,\n                          e.target.height - pixelDimension,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                        ctx.getImageData(\n                          e.target.width - pixelDimension,\n                          e.target.height - pixelDimension,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                      ].map((data) => {\n                        let r = 0;\n                        let g = 0;\n                        let b = 0;\n                        let a = 0;\n                        for (let i = 0; i < data.length; i += 4) {\n                          r += data[i];\n                          g += data[i + 1];\n                          b += data[i + 2];\n                          a += data[i + 3];\n                        }\n                        const dataLength = data.length / 4;\n                        return [\n                          r / dataLength,\n                          g / dataLength,\n                          b / dataLength,\n                          a / dataLength,\n                        ];\n                      });\n                      const rgbColors = colors.map((color) => {\n                        const [r, g, b, a] = lightenRGB(color);\n                        return `rgba(${r}, ${g}, ${b}, ${a})`;\n                      });\n                      setHeaderCornerColors(rgbColors);\n                      console.log({ colors, rgbColors });\n                    } catch (e) {\n                      // Silently fail\n                    }\n                  }}\n                />\n              )}\n              <header>\n                {standalone ? (\n                  <Menu2\n                    shift={\n                      window.matchMedia('(min-width: calc(40em))').matches\n                        ? 114\n                        : 64\n                    }\n                    menuButton={\n                      <div>\n                        <AccountBlock\n                          account={info}\n                          instance={instance}\n                          avatarSize=\"xxxl\"\n                          onClick={() => {}}\n                        />\n                      </div>\n                    }\n                  >\n                    <div class=\"szh-menu__header\">\n                      <AccountHandleInfo acct={acct} instance={instance} />\n                    </div>\n                    <MenuItem\n                      onClick={() => {\n                        const handleWithInstance = acct.includes('@')\n                          ? `@${acct}`\n                          : `@${acct}@${instance}`;\n                        try {\n                          navigator.clipboard.writeText(handleWithInstance);\n                          showToast(t`Handle copied`);\n                        } catch (e) {\n                          console.error(e);\n                          showToast(t`Unable to copy handle`);\n                        }\n                      }}\n                    >\n                      <Icon icon=\"link\" />\n                      <span>\n                        <Trans>Copy handle</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuItem\n                      onClick={() => {\n                        states.showQrCodeModal = {\n                          text: url,\n                          arena: avatarStatic,\n                          backgroundMask: headerStatic,\n                          caption: acct.includes('@')\n                            ? acct\n                            : `${acct}@${instance}`,\n                          onScannerClick: handleScannerClick,\n                        };\n                      }}\n                    >\n                      <Icon icon=\"qrcode\" />\n                      <span>\n                        <Trans>QR code</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuItem href={url} target=\"_blank\">\n                      <Icon icon=\"external\" />\n                      <span>\n                        <Trans>Go to original profile page</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuDivider />\n                    <MenuItem\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: [\n                            {\n                              type: 'image',\n                              url: avatarStatic,\n                            },\n                          ],\n                        };\n                      }}\n                    >\n                      <Icon icon=\"user\" />\n                      <span>\n                        <Trans>View profile image</Trans>\n                      </span>\n                    </MenuItem>\n                    {!!headerStatic && !headerIsAvatar && (\n                      <MenuItem\n                        onClick={() => {\n                          states.showMediaModal = {\n                            mediaAttachments: [\n                              {\n                                type: 'image',\n                                url: headerStatic,\n                              },\n                            ],\n                          };\n                        }}\n                      >\n                        <Icon icon=\"media\" />\n                        <span>\n                          <Trans>View profile header</Trans>\n                        </span>\n                      </MenuItem>\n                    )}\n                    {currentAuthenticated &&\n                      isSelf &&\n                      supports('@mastodon/profile-edit') && (\n                        <>\n                          <MenuDivider />\n                          <MenuItem\n                            onClick={() => {\n                              setShowEditProfile(true);\n                            }}\n                          >\n                            <Icon icon=\"pencil\" />\n                            <span>\n                              <Trans>Edit profile</Trans>\n                            </span>\n                          </MenuItem>\n                        </>\n                      )}\n                  </Menu2>\n                ) : (\n                  <AccountBlock\n                    account={info}\n                    instance={instance}\n                    avatarSize=\"xxxl\"\n                    internal\n                  />\n                )}\n              </header>\n              <div class=\"faux-header-bg\" aria-hidden=\"true\" />\n              <main>\n                {!!memorial && (\n                  <span class=\"tag\">\n                    <Trans>In Memoriam</Trans>\n                  </span>\n                )}\n                {!!bot && (\n                  <span class=\"tag\">\n                    <Icon icon=\"bot\" /> <Trans>Automated</Trans>\n                  </span>\n                )}\n                {!!group && (\n                  <span class=\"tag\">\n                    <Icon icon=\"group\" /> <Trans>Group</Trans>\n                  </span>\n                )}\n                {/* {roles?.map((role) => (\n                  <span class=\"tag\">\n                    {role.name}\n                    {!!accountInstance && (\n                      <>\n                        {' '}\n                        <span class=\"more-insignificant\">\n                          {accountInstance}\n                        </span>\n                      </>\n                    )}\n                  </span>\n                ))} */}\n                <div\n                  class=\"note\"\n                  dir=\"auto\"\n                  onClick={handleContentLinks({\n                    instance: currentInstance,\n                  })}\n                  dangerouslySetInnerHTML={{\n                    __html: enhanceContent(note, { emojis }),\n                  }}\n                />\n                <div class=\"account-metadata-box\">\n                  {fields?.length > 0 && (\n                    <div class=\"profile-metadata\">\n                      {fields.map(({ name, value, verifiedAt }, i) => (\n                        <div\n                          class={`profile-field ${\n                            verifiedAt ? 'profile-verified' : ''\n                          }`}\n                          key={name + i}\n                          dir=\"auto\"\n                        >\n                          <b>\n                            <EmojiText text={name} emojis={emojis} />{' '}\n                            {!!verifiedAt && (\n                              <Icon\n                                icon=\"check-circle\"\n                                size=\"s\"\n                                alt={t`Verified`}\n                              />\n                            )}\n                          </b>\n                          <p\n                            dangerouslySetInnerHTML={{\n                              __html: enhanceContent(value, { emojis }),\n                            }}\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  <div class=\"stats\">\n                    <LinkOrDiv\n                      tabIndex={0}\n                      to={accountLink}\n                      onClick={() => {\n                        // states.showAccount = false;\n                        setTimeout(() => {\n                          states.showGenericAccounts = {\n                            id: 'followers',\n                            heading: t`Followers`,\n                            fetchAccounts: fetchFollowers,\n                            instance,\n                            excludeRelationshipAttrs: isSelf\n                              ? ['followedBy']\n                              : [],\n                            blankCopy: hideCollections\n                              ? t`This user has chosen to not make this information available.`\n                              : undefined,\n                          };\n                        }, 0);\n                      }}\n                    >\n                      {!!familiarFollowers.length && (\n                        <span class=\"shazam-container-horizontal\">\n                          <span class=\"shazam-container-inner stats-avatars-bunch\">\n                            {familiarFollowers.map((follower) => (\n                              <Avatar\n                                url={follower.avatarStatic}\n                                size=\"s\"\n                                alt={`${follower.displayName} @${follower.acct}`}\n                                squircle={follower?.bot}\n                              />\n                            ))}\n                          </span>\n                        </span>\n                      )}\n                      <Plural\n                        value={followersCount}\n                        one={\n                          <Trans>\n                            <span title={followersCount}>\n                              {shortenNumber(followersCount)}\n                            </span>{' '}\n                            Follower\n                          </Trans>\n                        }\n                        other={\n                          <Trans>\n                            <span title={followersCount}>\n                              {shortenNumber(followersCount)}\n                            </span>{' '}\n                            Followers\n                          </Trans>\n                        }\n                      />\n                    </LinkOrDiv>\n                    <LinkOrDiv\n                      class=\"insignificant\"\n                      tabIndex={0}\n                      to={accountLink}\n                      onClick={() => {\n                        // states.showAccount = false;\n                        setTimeout(() => {\n                          states.showGenericAccounts = {\n                            heading: t({\n                              id: 'following.stats',\n                              message: 'Following',\n                            }),\n                            fetchAccounts: fetchFollowing,\n                            instance,\n                            excludeRelationshipAttrs: isSelf\n                              ? ['following']\n                              : [],\n                            blankCopy: hideCollections\n                              ? t`This user has chosen to not make this information available.`\n                              : undefined,\n                          };\n                        }, 0);\n                      }}\n                    >\n                      <Plural\n                        value={followingCount}\n                        other={\n                          <Trans>\n                            <span title={followingCount}>\n                              {shortenNumber(followingCount)}\n                            </span>{' '}\n                            Following\n                          </Trans>\n                        }\n                      />\n                      <br />\n                    </LinkOrDiv>\n                    <LinkOrDiv\n                      class=\"insignificant\"\n                      to={accountLink}\n                      // onClick={\n                      //   standalone\n                      //     ? undefined\n                      //     : () => {\n                      //         hideAllModals();\n                      //       }\n                      // }\n                    >\n                      <Plural\n                        value={statusesCount}\n                        one={\n                          <Trans>\n                            <span title={statusesCount}>\n                              {shortenNumber(statusesCount)}\n                            </span>{' '}\n                            Post\n                          </Trans>\n                        }\n                        other={\n                          <Trans>\n                            <span title={statusesCount}>\n                              {shortenNumber(statusesCount)}\n                            </span>{' '}\n                            Posts\n                          </Trans>\n                        }\n                      />\n                    </LinkOrDiv>\n                    {!!createdAt && (\n                      <div class=\"insignificant\">\n                        <Trans>\n                          Joined{' '}\n                          <time datetime={createdAt}>\n                            {niceDateTime(createdAt, {\n                              hideTime: true,\n                            })}\n                          </time>\n                        </Trans>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                {!!postingStats && (\n                  <LinkOrDiv\n                    to={accountLink}\n                    class=\"account-metadata-box\"\n                    // onClick={() => {\n                    //   states.showAccount = false;\n                    // }}\n                    onClick={\n                      import.meta.env.DEV && standalone\n                        ? () => {\n                            // Debug: undo back\n                            setPostingStats(null);\n                          }\n                        : undefined\n                    }\n                  >\n                    <div class=\"shazam-container\">\n                      <div class=\"shazam-container-inner\">\n                        {hasPostingStats ? (\n                          <div\n                            class=\"posting-stats\"\n                            title={\n                              supportsNativeQuote()\n                                ? t`${(\n                                    postingStats.originals / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} original posts, ${(\n                                    postingStats.replies / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} replies, ${(\n                                    postingStats.quotes / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} quotes, ${(\n                                    postingStats.boosts / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} boosts`\n                                : t`${(\n                                    postingStats.originals / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} original posts, ${(\n                                    postingStats.replies / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} replies, ${(\n                                    postingStats.boosts / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} boosts`\n                            }\n                          >\n                            <div>\n                              {postingStats.daysSinceLastPost < 365\n                                ? plural(postingStats.total, {\n                                    one: plural(\n                                      postingStats.daysSinceLastPost,\n                                      {\n                                        one: `Last 1 post in the past 1 day`,\n                                        other: `Last 1 post in the past ${postingStats.daysSinceLastPost} days`,\n                                      },\n                                    ),\n                                    other: plural(\n                                      postingStats.daysSinceLastPost,\n                                      {\n                                        one: `Last ${postingStats.total} posts in the past 1 day`,\n                                        other: `Last ${postingStats.total} posts in the past ${postingStats.daysSinceLastPost} days`,\n                                      },\n                                    ),\n                                  })\n                                : plural(postingStats.total, {\n                                    one: 'Last 1 post in the past year(s)',\n                                    other: `Last ${postingStats.total} posts in the past year(s)`,\n                                  })}\n                            </div>\n                            <div class=\"posting-stats-bar\">\n                              {postingStats.originals > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-originals\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.originals /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.replies > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-replies\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.replies /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.quotes > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-quotes\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.quotes /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.boosts > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-boosts\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.boosts /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                            </div>\n                            <div class=\"posting-stats-legends\">\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-originals\" />{' '}\n                                <Trans>Original</Trans>\n                              </span>{' '}\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-replies\" />{' '}\n                                <Trans>Replies</Trans>\n                              </span>{' '}\n                              {supportsNativeQuote() && (\n                                <span class=\"ib\">\n                                  <span class=\"posting-stats-legend-item posting-stats-bar-quotes\" />{' '}\n                                  <Trans>Quotes</Trans>\n                                </span>\n                              )}\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-boosts\" />{' '}\n                                <Trans>Boosts</Trans>\n                              </span>\n                            </div>\n                          </div>\n                        ) : (\n                          <div class=\"posting-stats\">\n                            <Trans>Post stats unavailable.</Trans>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </LinkOrDiv>\n                )}\n                {!moved && (\n                  <div class=\"account-metadata-box\">\n                    <div\n                      class=\"shazam-container no-animation\"\n                      hidden={!!postingStats}\n                    >\n                      <div class=\"shazam-container-inner\">\n                        <button\n                          type=\"button\"\n                          class=\"posting-stats-button\"\n                          disabled={postingStatsUIState === 'loading'}\n                          onClick={() => {\n                            renderPostingStats();\n                          }}\n                        >\n                          <div\n                            class={`posting-stats-icon ${\n                              postingStatsUIState === 'loading' ? 'loading' : ''\n                            }`}\n                          />\n                          <Trans>View post stats</Trans>{' '}\n                          {/* <Loader\n                        abrupt\n                        hidden={postingStatsUIState !== 'loading'}\n                      /> */}\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </main>\n              <footer>\n                <RelatedActions\n                  info={info}\n                  instance={instance}\n                  standalone={standalone}\n                  authenticated={authenticated}\n                  onRelationshipChange={onRelationshipChange}\n                  onProfileUpdate={onProfileUpdate}\n                  setShowEditProfile={setShowEditProfile}\n                  showEndorsements={showEndorsements}\n                  renderEndorsements={renderEndorsements}\n                  setRenderEndorsements={setRenderEndorsements}\n                />\n              </footer>\n              <Endorsements\n                accountID={id}\n                info={info}\n                open={renderEndorsements}\n                onlyOpenIfHasEndorsements={\n                  renderEndorsements === 'onlyOpenIfHasEndorsements'\n                }\n              />\n            </>\n          )\n        )}\n      </div>\n      {!!showEditProfile && (\n        <Modal\n          onClose={() => {\n            setShowEditProfile(false);\n          }}\n        >\n          <EditProfileSheet\n            onClose={({ state, account } = {}) => {\n              setShowEditProfile(false);\n              if (state === 'success' && account) {\n                onProfileUpdate(account);\n              }\n            }}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nconst FAMILIAR_FOLLOWERS_LIMIT = 3;\n\nfunction lightenRGB([r, g, b]) {\n  const luminence = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  console.log('luminence', luminence);\n  let alpha;\n  if (luminence >= 220) {\n    alpha = 1;\n  } else if (luminence <= 50) {\n    alpha = 0.1;\n  } else {\n    alpha = luminence / 255;\n  }\n  alpha = Math.min(1, alpha);\n  return [r, g, b, alpha];\n}\n\nexport default AccountInfo;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\nimport useLocationChange from '../utils/useLocationChange';\n\nimport AccountInfo from './account-info';\nimport Icon from './icon';\n\nfunction AccountSheet({ account, instance: propInstance, onClose }) {\n  const { t } = useLingui();\n  const { masto, instance, authenticated } = api({ instance: propInstance });\n  const isString = typeof account === 'string';\n\n  useEffect(() => {\n    if (!isString) {\n      states.accounts[`${account.id}@${instance}`] = account;\n    }\n  }, [account]);\n\n  useLocationChange(onClose);\n\n  return (\n    <div\n      class=\"sheet\"\n      // onClick={(e) => {\n      //   const accountBlock = e.target.closest('.account-block');\n      //   if (accountBlock) {\n      //     onClose({\n      //       destination: 'account-statuses',\n      //     });\n      //   }\n      // }}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close outer\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <AccountInfo\n        instance={instance}\n        authenticated={authenticated}\n        account={account}\n        fetchAccount={async () => {\n          if (isString) {\n            try {\n              const info = await masto.v1.accounts.lookup({\n                acct: account,\n                skip_webfinger: false,\n              });\n              return info;\n            } catch (e) {\n              const result = await masto.v2.search.list({\n                q: account,\n                type: 'accounts',\n                limit: authenticated ? 1 : 11, // Magic number\n                resolve: authenticated,\n              });\n              if (result.accounts.length) {\n                const accountWithSameString = result.accounts.find(\n                  (a) => a.url === account || account.startsWith(a.url),\n                );\n                if (accountWithSameString) {\n                  return accountWithSameString;\n                }\n              }\n              if (/^https?:\\/\\/[^/]+\\/@[^/]+$/.test(account)) {\n                const accountURL = URL.parse(account);\n                if (accountURL) {\n                  const { hostname, pathname } = accountURL;\n                  const acct =\n                    pathname.replace(/^\\//, '').replace(/\\/$/, '') +\n                    '@' +\n                    hostname;\n                  const result = await masto.v2.search.list({\n                    q: acct,\n                    type: 'accounts',\n                    limit: 1,\n                    resolve: authenticated,\n                  });\n                  if (result.accounts.length) {\n                    return result.accounts[0];\n                  }\n                }\n              }\n            }\n          } else {\n            return account;\n          }\n        }}\n      />\n    </div>\n  );\n}\n\nexport default AccountSheet;\n","import './drafts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\nimport { getCurrentAccountNS } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuConfirm from './menu-confirm';\n\nfunction Drafts({ onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [drafts, setDrafts] = useState([]);\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const keys = await db.drafts.keys();\n        if (keys.length) {\n          const ns = getCurrentAccountNS();\n          const ownKeys = keys.filter((key) => key.startsWith(ns));\n          if (ownKeys.length) {\n            const drafts = await db.drafts.getMany(ownKeys);\n            drafts.sort(\n              (a, b) => Date.parse(b.updatedAt) - Date.parse(a.updatedAt),\n            );\n            setDrafts(drafts);\n          } else {\n            setDrafts([]);\n          }\n        } else {\n          setDrafts([]);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const hasDrafts = drafts?.length > 0;\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Unsent drafts</Trans>{' '}\n          <Loader abrupt hidden={uiState !== 'loading'} />\n        </h2>\n        {hasDrafts && (\n          <div class=\"insignificant\">\n            <Trans>\n              Looks like you have unsent drafts. Let's continue where you left\n              off.\n            </Trans>\n          </div>\n        )}\n      </header>\n      <main>\n        {hasDrafts ? (\n          <>\n            <ul class=\"drafts-list\">\n              {drafts.map((draft) => {\n                const { updatedAt, key, draftStatus, replyTo, quote } = draft;\n                const updatedAtDate = new Date(updatedAt);\n                return (\n                  <li key={updatedAt}>\n                    <div class=\"mini-draft-meta\">\n                      <b>\n                        <Icon icon={replyTo ? 'reply' : 'quill'} size=\"s\" />{' '}\n                        <time>\n                          {!!replyTo && (\n                            <>\n                              <span class=\"bidi-isolate\">\n                                @{replyTo.account.acct}\n                              </span>\n                              <br />\n                            </>\n                          )}\n                          {niceDateTime(updatedAtDate)}\n                        </time>\n                      </b>\n                      <MenuConfirm\n                        confirmLabel={\n                          <span>\n                            <Trans>Delete this draft?</Trans>\n                          </span>\n                        }\n                        menuItemClassName=\"danger\"\n                        align=\"end\"\n                        disabled={uiState === 'loading'}\n                        onClick={() => {\n                          (async () => {\n                            try {\n                              // const yes = confirm('Delete this draft?');\n                              // if (yes) {\n                              await db.drafts.del(key);\n                              reload();\n                              // }\n                            } catch (e) {\n                              alert(t`Error deleting draft! Please try again.`);\n                            }\n                          })();\n                        }}\n                      >\n                        <button\n                          type=\"button\"\n                          class=\"small light\"\n                          disabled={uiState === 'loading'}\n                        >\n                          <Trans>Delete</Trans>\n                        </button>\n                      </MenuConfirm>\n                    </div>\n                    <button\n                      type=\"button\"\n                      disabled={uiState === 'loading'}\n                      class=\"draft-item\"\n                      onClick={async () => {\n                        // console.log({ draftStatus });\n                        let replyToStatus;\n                        let quoteStatus;\n                        if (replyTo?.id || quote?.id) {\n                          setUIState('loading');\n                          if (replyTo) {\n                            try {\n                              replyToStatus = await masto.v1.statuses\n                                .$select(replyTo.id)\n                                .fetch();\n                            } catch (e) {\n                              console.error(e);\n                              alert(t`Error fetching reply-to status!`);\n                              setUIState('default');\n                              return;\n                            }\n                          }\n                          if (quote) {\n                            try {\n                              quoteStatus = await masto.v1.statuses\n                                .$select(quote.id)\n                                .fetch();\n                            } catch (e) {\n                              console.error(e);\n                              alert(t`Error fetching quoted status!`);\n                              setUIState('default');\n                              // Don't return. Fail and still allow draft without quote\n                              // return;\n                            }\n                          }\n                          setUIState('default');\n                        }\n                        window.__COMPOSE__ = {\n                          draftStatus,\n                          replyToStatus,\n                          quoteStatus,\n                        };\n                        states.showCompose = true;\n                        states.showDrafts = false;\n                      }}\n                    >\n                      <MiniDraft draft={draft} />\n                    </button>\n                  </li>\n                );\n              })}\n            </ul>\n            {drafts.length > 1 && (\n              <p>\n                <MenuConfirm\n                  confirmLabel={\n                    <span>\n                      <Trans>Delete all drafts?</Trans>\n                    </span>\n                  }\n                  menuItemClassName=\"danger\"\n                  disabled={uiState === 'loading'}\n                  onClick={() => {\n                    (async () => {\n                      // const yes = confirm('Delete all drafts?');\n                      // if (yes) {\n                      setUIState('loading');\n                      try {\n                        await db.drafts.delMany(\n                          drafts.map((draft) => draft.key),\n                        );\n                        setUIState('default');\n                        reload();\n                      } catch (e) {\n                        console.error(e);\n                        alert(t`Error deleting drafts! Please try again.`);\n                        setUIState('error');\n                      }\n                      // }\n                    })();\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"light danger\"\n                    disabled={uiState === 'loading'}\n                  >\n                    <Trans>Delete all</Trans>\n                  </button>\n                </MenuConfirm>\n              </p>\n            )}\n          </>\n        ) : (\n          <p>\n            <Trans>No drafts found.</Trans>\n          </p>\n        )}\n      </main>\n    </div>\n  );\n}\n\nfunction MiniDraft({ draft }) {\n  const { t } = useLingui();\n  const { draftStatus, replyTo, quote } = draft;\n  const { status, spoilerText, poll, mediaAttachments } = draftStatus;\n  const hasPoll = poll?.options?.length > 0;\n  const hasMedia = mediaAttachments?.length > 0;\n  const hasQuote = !!quote?.id;\n  const hasPollOrMedia = hasPoll || hasMedia || hasQuote;\n  const firstImageMedia = useMemo(() => {\n    if (!hasMedia) return;\n    const image = mediaAttachments.find((media) => /image/.test(media.type));\n    if (!image) return;\n    const { file } = image;\n    const objectURL = URL.createObjectURL(file);\n    return objectURL;\n  }, [hasMedia, mediaAttachments]);\n  return (\n    <>\n      <div class=\"mini-draft\">\n        {hasPollOrMedia && (\n          <div\n            class={`mini-draft-aside ${firstImageMedia ? 'has-image' : ''}`}\n            style={\n              firstImageMedia\n                ? {\n                    '--bg-image': `url(${firstImageMedia})`,\n                  }\n                : {}\n            }\n          >\n            {hasPoll && <Icon icon=\"poll\" alt={t`Poll`} />}\n            {hasMedia && (\n              <span>\n                <Icon icon=\"attachment\" alt={t`Media`} />{' '}\n                <small>{mediaAttachments?.length}</small>\n              </span>\n            )}\n            {hasQuote && <Icon icon=\"quote\" alt={t`Quote`} />}\n          </div>\n        )}\n        <div class=\"mini-draft-main\">\n          {!!spoilerText && <div class=\"mini-draft-spoiler\">{spoilerText}</div>}\n          {!!status && <div class=\"mini-draft-status\">{status}</div>}\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default Drafts;\n","import './embed-modal.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\n\nfunction EmbedModal({ html, url, width, height, onClose = () => {} }) {\n  const { t } = useLingui();\n  return (\n    <div class=\"embed-modal-container\">\n      <div class=\"top-controls\">\n        <button type=\"button\" class=\"light\" onClick={() => onClose()}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n        {url && (\n          <a href={url} target=\"_blank\" rel=\"noopener\" class=\"button plain\">\n            <span>\n              <Trans>Open in new window</Trans>\n            </span>{' '}\n            <Icon icon=\"external\" />\n          </a>\n        )}\n      </div>\n      <div\n        class=\"embed-content\"\n        dangerouslySetInnerHTML={{ __html: html }}\n        style={{\n          '--width': width + 'px',\n          '--height': height + 'px',\n          '--aspect-ratio': `${width}/${height}`,\n        }}\n      />\n    </div>\n  );\n}\n\nexport default EmbedModal;\n","import './generic-accounts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport states from '../utils/states';\nimport useLocationChange from '../utils/useLocationChange';\n\nimport AccountBlock from './account-block';\nimport Icon from './icon';\nimport Link from './link';\nimport Loader from './loader';\nimport Status from './status';\n\nexport default function GenericAccounts({\n  instance,\n  excludeRelationshipAttrs = [],\n  postID,\n  onClose = () => {},\n  blankCopy,\n}) {\n  const { t } = useLingui();\n  const { masto, instance: currentInstance } = api();\n  const isCurrentInstance = instance ? instance === currentInstance : true;\n  const snapStates = useSnapshot(states);\n  ``;\n  const [uiState, setUIState] = useState('default');\n  const [showMore, setShowMore] = useState(false);\n\n  useLocationChange(onClose);\n\n  if (!snapStates.showGenericAccounts) {\n    return null;\n  }\n\n  const {\n    id,\n    heading,\n    fetchAccounts,\n    accounts: staticAccounts,\n    showReactions,\n  } = snapStates.showGenericAccounts;\n\n  const [accounts, setAccounts] = useState(\n    staticAccounts?.length ? staticAccounts : [],\n  );\n\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n\n  const loadRelationships = async (accounts) => {\n    if (!accounts?.length) return;\n    if (!isCurrentInstance) return;\n    const relationships = await fetchRelationships(accounts, relationshipsMap);\n    if (relationships) {\n      setRelationshipsMap({\n        ...relationshipsMap,\n        ...relationships,\n      });\n    }\n  };\n\n  const loadAccounts = (firstLoad) => {\n    if (!fetchAccounts) return;\n    if (firstLoad && !accounts?.length) setAccounts([]);\n    setUIState('loading');\n    (async () => {\n      try {\n        const { done, value } = await fetchAccounts(firstLoad);\n        if (Array.isArray(value)) {\n          if (firstLoad) {\n            const accounts = [];\n            for (let i = 0; i < value.length; i++) {\n              const account = value[i];\n              const theAccount = accounts.find(\n                (a, j) => a.id === account.id && i !== j,\n              );\n              if (!theAccount) {\n                accounts.push({\n                  _types: [],\n                  ...account,\n                });\n              } else {\n                theAccount._types.push(...account._types);\n              }\n            }\n            setAccounts(accounts);\n          } else {\n            // setAccounts((prev) => [...prev, ...value]);\n            // Merge accounts by id and _types\n            setAccounts((prev) => {\n              const newAccounts = prev;\n              for (const account of value) {\n                const theAccount = newAccounts.find((a) => a.id === account.id);\n                if (!theAccount) {\n                  newAccounts.push(account);\n                } else {\n                  theAccount._types.push(...account._types);\n                }\n              }\n              return newAccounts;\n            });\n          }\n          setShowMore(!done);\n\n          loadRelationships(value);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    if (accounts?.length > 0) {\n      // setAccounts(staticAccounts);\n      if (fetchAccounts) {\n        loadAccounts(true);\n        firstLoad.current = false;\n      } else {\n        loadRelationships(accounts);\n      }\n    } else {\n      loadAccounts(true);\n      firstLoad.current = false;\n    }\n  }, [fetchAccounts]);\n\n  useEffect(() => {\n    if (firstLoad.current) return;\n    // reloadGenericAccounts contains value like {id: 'mute', counter: 1}\n    // We only need to reload if the id matches\n    if (snapStates.reloadGenericAccounts?.id === id) {\n      loadAccounts(true);\n    }\n  }, [snapStates.reloadGenericAccounts.counter]);\n\n  const post = states.statuses[postID];\n\n  return (\n    <div id=\"generic-accounts-container\" class=\"sheet\" tabindex=\"-1\">\n      <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n        <Icon icon=\"x\" alt={t`Close`} />\n      </button>\n      <header>\n        <h2>{heading || t`Accounts`}</h2>\n      </header>\n      <main>\n        {post && (\n          <Link\n            to={`/${instance || currentInstance}/s/${post.id}`}\n            class=\"post-preview\"\n          >\n            <Status status={post} size=\"s\" readOnly />\n          </Link>\n        )}\n        {accounts.length > 0 ? (\n          <>\n            <ul class=\"accounts-list\">\n              {accounts.map((account) => {\n                const relationship = relationshipsMap[account.id];\n                const key = `${account.id}-${account._types?.length || ''}`;\n                return (\n                  <li key={key}>\n                    {showReactions && account._types?.length > 0 && (\n                      <div class=\"reactions-block\">\n                        {account._types.map((type) => (\n                          <Icon\n                            icon={\n                              {\n                                reblog: 'rocket',\n                                favourite: 'heart',\n                              }[type]\n                            }\n                            class={`${type}-icon`}\n                          />\n                        ))}\n                      </div>\n                    )}\n                    <div class=\"account-relationships\">\n                      <AccountBlock\n                        account={account}\n                        showStats\n                        relationship={relationship}\n                        excludeRelationshipAttrs={excludeRelationshipAttrs}\n                      />\n                    </div>\n                  </li>\n                );\n              })}\n            </ul>\n            {uiState === 'default' ? (\n              showMore ? (\n                <InView\n                  onChange={(inView) => {\n                    if (inView) {\n                      loadAccounts();\n                    }\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain block\"\n                    onClick={() => loadAccounts()}\n                  >\n                    <Trans>Show more</Trans>\n                  </button>\n                </InView>\n              ) : (\n                <p class=\"ui-state insignificant\">\n                  <Trans>The end.</Trans>\n                </p>\n              )\n            ) : (\n              uiState === 'loading' && (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              )\n            )}\n          </>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">\n            <Trans>Error loading accounts</Trans>\n          </p>\n        ) : (\n          <p class=\"ui-state insignificant\">\n            {blankCopy || t`Nothing to show`}\n          </p>\n        )}\n      </main>\n    </div>\n  );\n}\n","import './import-accounts-selection.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useMemo, useState } from 'preact/hooks';\n\nimport states from '../utils/states';\nimport { getAccounts, saveAccounts } from '../utils/store-utils';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport Loader from './loader';\nimport NameText from './name-text';\n\nfunction ImportAccountsSelection({ accounts: importedAccounts, onClose }) {\n  const { t } = useLingui();\n  const existingAccounts = getAccounts();\n\n  const { accountsToImport } = useMemo(() => {\n    if (!importedAccounts) return { accountsToImport: [] };\n\n    const statusOrder = { duplicate: 0, new: 1 };\n    const accountsToImport = importedAccounts\n      .map((account) => {\n        const existing = existingAccounts.find(\n          (a) =>\n            a.info.id === account.info.id &&\n            a.instanceURL === account.instanceURL,\n        );\n        const status = existing ? 'duplicate' : 'new';\n        return {\n          ...account,\n          __status: status,\n        };\n      })\n      .sort((a, b) => {\n        return statusOrder[a.__status] - statusOrder[b.__status];\n      });\n\n    return { accountsToImport };\n  }, [importedAccounts, existingAccounts]);\n\n  const [selectedAccounts, setSelectedAccounts] = useState(() => {\n    const initialSelection = {};\n    accountsToImport.forEach((a) => {\n      if (a.__status === 'duplicate') {\n        initialSelection[a.info.id + a.instanceURL] = false;\n      } else {\n        initialSelection[a.info.id + a.instanceURL] = true;\n      }\n    });\n    return initialSelection;\n  });\n\n  const [uiState, setUIState] = useState('default');\n\n  const handleImportSelection = () => {\n    setUIState('importing');\n    const newAccounts = [\n      ...existingAccounts,\n      ...importedAccounts.filter(\n        (account) => selectedAccounts[account.info.id + account.instanceURL],\n      ),\n    ];\n    saveAccounts(newAccounts);\n    onClose();\n    states.showImportExportAccounts = false;\n    states.showAccounts = true;\n  };\n\n  const selectedCount = Object.values(selectedAccounts).filter(Boolean).length;\n\n  return (\n    <div id=\"import-accounts-selection-container\" class=\"sheet\">\n      {!!onClose && (\n        <button\n          type=\"button\"\n          class=\"sheet-close\"\n          onClick={onClose}\n          disabled={uiState === 'importing'}\n        >\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Select accounts to import</Trans>\n        </b>\n      </header>\n      <main>\n        <div class=\"import-selection\">\n          {accountsToImport.filter((a) => a.__status !== 'duplicate').length >\n            3 && (\n            <div class=\"accounts-list-header\">\n              <label class=\"account-item\">\n                <input\n                  type=\"checkbox\"\n                  checked={\n                    accountsToImport.filter((a) => a.__status !== 'duplicate')\n                      .length > 0 &&\n                    accountsToImport\n                      .filter((a) => a.__status !== 'duplicate')\n                      .every((a) => selectedAccounts[a.info.id + a.instanceURL])\n                  }\n                  onChange={(e) => {\n                    const newSelection = { ...selectedAccounts };\n                    const shouldSelect = e.target.checked;\n                    accountsToImport.forEach((a) => {\n                      if (a.__status !== 'duplicate') {\n                        newSelection[a.info.id + a.instanceURL] = shouldSelect;\n                      }\n                    });\n                    setSelectedAccounts(newSelection);\n                  }}\n                  disabled={uiState === 'importing'}\n                />\n                <span class=\"account-info\">\n                  <Trans>Select all</Trans>\n                </span>\n              </label>\n            </div>\n          )}\n          <ul class=\"accounts-list\">\n            {accountsToImport.map((account) => {\n              const key = account.info.id + account.instanceURL;\n              const isSelected = selectedAccounts[key];\n              const { __status: status } = account;\n              return (\n                <li key={key}>\n                  <label class=\"account-item\">\n                    <input\n                      type=\"checkbox\"\n                      checked={isSelected}\n                      onChange={(e) => {\n                        setSelectedAccounts({\n                          ...selectedAccounts,\n                          [key]: e.target.checked,\n                        });\n                      }}\n                      disabled={\n                        uiState === 'importing' || status === 'duplicate'\n                      }\n                    />\n                    <Avatar url={account.info.avatarStatic} size=\"xl\" />\n                    <div class=\"account-info\">\n                      <NameText\n                        account={{\n                          ...account.info,\n                          acct: /@/.test(account.info.acct)\n                            ? account.info.acct\n                            : `${account.info.acct}@${account.instanceURL}`,\n                        }}\n                        showAcct\n                      />\n                    </div>\n                    <div class=\"account-meta\">\n                      {status === 'duplicate' && (\n                        <span class=\"tag collapsed\">\n                          <Trans>Existing</Trans>\n                        </span>\n                      )}\n                    </div>\n                  </label>\n                </li>\n              );\n            })}\n          </ul>\n\n          <footer>\n            <button\n              type=\"button\"\n              class=\"light\"\n              onClick={onClose}\n              disabled={uiState === 'importing'}\n            >\n              <Trans>Cancel</Trans>\n            </button>\n            <Loader hidden={uiState !== 'importing'} />\n            <button\n              type=\"button\"\n              disabled={selectedCount === 0 || uiState === 'importing'}\n              onClick={handleImportSelection}\n            >\n              <Plural\n                value={selectedCount}\n                one=\"Import # account\"\n                other=\"Import # accounts\"\n              />\n            </button>\n          </footer>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default ImportAccountsSelection;\n","import './import-export-accounts.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useState } from 'preact/hooks';\n\nimport showToast from '../utils/show-toast';\nimport { getAccounts } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport ImportAccountsSelection from './import-accounts-selection';\nimport Modal from './modal';\n\nexport default function ImportExportAccounts({ onClose }) {\n  const { t } = useLingui();\n  const accounts = getAccounts();\n  const [uiState, setUIState] = useState('default');\n  const [importedAccounts, setImportedAccounts] = useState(null);\n  const [dragOver, setDragOver] = useState(false);\n\n  const handleExport = async () => {\n    setUIState('exporting');\n    try {\n      const accounts = getAccounts();\n      const accountsToExport = accounts.map((account) => {\n        const { accessToken, ...rest } = account;\n        return rest;\n      });\n\n      const exportData = {\n        accounts: accountsToExport,\n        createdAt: Date.now(),\n      };\n      const json = JSON.stringify(exportData);\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      const now = new Date();\n      const date = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(\n        2,\n        '0',\n      )}-${String(now.getDate()).padStart(2, '0')}_${String(\n        now.getHours(),\n      ).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;\n      a.download = `accounts-${date}.phanpy.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      onClose();\n    } catch (e) {\n      console.error(e);\n      showToast(t`Export failed`);\n      setUIState('error');\n    }\n  };\n\n  const processFile = async (file) => {\n    if (!file) return;\n\n    setUIState('importing');\n    try {\n      const text = await file.text();\n      const json = JSON.parse(text);\n\n      const accounts = json?.accounts;\n      if (!Array.isArray(accounts)) throw new Error('Invalid backup file');\n\n      setImportedAccounts(accounts);\n      setUIState('default');\n    } catch (e) {\n      console.error(e);\n      showToast(t`Import failed`);\n      setUIState('error');\n    }\n  };\n\n  const handleImport = (e) => {\n    const file = e.target.files[0];\n    processFile(file);\n  };\n\n  const onDragOver = (e) => {\n    e.preventDefault();\n    setDragOver(true);\n  };\n\n  const onDragLeave = () => {\n    setDragOver(false);\n  };\n\n  const onDrop = (e) => {\n    e.preventDefault();\n    setDragOver(false);\n    const file = e.dataTransfer.files[0];\n    processFile(file);\n  };\n\n  return (\n    <div\n      id=\"import-export-accounts-container\"\n      class=\"sheet\"\n      onDragOver={onDragOver}\n      onDragLeave={onDragLeave}\n      onDrop={onDrop}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>\n            Import/Export <small class=\"ib insignificant\">Accounts</small>\n          </Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <label\n            class={`section-button button-import button plain4 ${\n              dragOver ? 'drag-over' : ''\n            }`}\n            tabindex=\"0\"\n          >\n            <Icon icon=\"arrow-down-circle\" size=\"xxl\" />\n            <b>\n              <Trans>Import</Trans>\n            </b>\n            <input\n              type=\"file\"\n              accept=\".json\"\n              onChange={handleImport}\n              disabled={uiState === 'importing'}\n              style={{ display: 'none' }}\n            />\n            <div>\n              <small class=\"insignificant\">\n                <Trans>Select file</Trans>\n              </small>\n            </div>\n          </label>{' '}\n          <button\n            type=\"button\"\n            class=\"section-button button-export plain4\"\n            onClick={handleExport}\n            disabled={uiState === 'exporting' || accounts.length === 0}\n          >\n            <Icon icon=\"arrow-up-circle\" size=\"xxl\" />\n            <b>\n              <Trans>Export</Trans>\n            </b>\n            <div>\n              <small class=\"insignificant\">\n                <Plural\n                  value={accounts.length}\n                  one=\"# account\"\n                  other=\"# accounts\"\n                />\n              </small>\n            </div>\n          </button>\n        </section>\n\n        <p class=\"insignificant\">\n          <small>\n            <Trans>\n              No login information or account access details are stored in the\n              exported files. You will need to log in again for each account\n              after importing.\n            </Trans>\n          </small>\n        </p>\n      </main>\n      {importedAccounts && (\n        <Modal\n          onClose={() => {\n            setImportedAccounts(null);\n          }}\n        >\n          <ImportAccountsSelection\n            accounts={importedAccounts}\n            onClose={() => {\n              setImportedAccounts(null);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeMatch from '../utils/locale-match';\nimport { speak, supportsTTS } from '../utils/speech';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Menu2 from './menu2';\nimport TranslationBlock from './translation-block';\n\nconst FORCE_TRANSLATE_LIMIT = 140;\n\nexport default function MediaAltModal({ alt, lang, onClose }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const [forceTranslate, setForceTranslate] = useState(false);\n  const targetLanguage = getTranslateTargetLanguage(true);\n  const contentTranslationHideLanguages =\n    snapStates.settings.contentTranslationHideLanguages || [];\n  const differentLanguage =\n    !!lang &&\n    lang !== targetLanguage &&\n    !localeMatch([lang], [targetLanguage]) &&\n    !contentTranslationHideLanguages.find(\n      (l) => lang === l || localeMatch([lang], [l]),\n    );\n\n  useEffect(() => {\n    const isShortAlt = alt?.length > 0 && alt?.length <= FORCE_TRANSLATE_LIMIT;\n    if (differentLanguage && isShortAlt) {\n      setForceTranslate(true);\n    }\n  }, [differentLanguage, alt]);\n\n  return (\n    <div class=\"sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close outer\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Media description</Trans>\n        </h2>\n        <div class=\"header-side\">\n          <Menu2\n            align=\"end\"\n            menuButton={\n              <button type=\"button\" class=\"plain4\">\n                <Icon icon=\"more\" alt={t`More`} size=\"xl\" />\n              </button>\n            }\n          >\n            <MenuItem\n              disabled={forceTranslate}\n              onClick={() => {\n                setForceTranslate(true);\n              }}\n            >\n              <Icon icon=\"translate\" />\n              <span>\n                <Trans>Translate</Trans>\n              </span>\n            </MenuItem>\n            {supportsTTS && (\n              <MenuItem\n                onClick={() => {\n                  speak(alt, lang);\n                }}\n              >\n                <Icon icon=\"speak\" />\n                <span>\n                  <Trans>Speak</Trans>\n                </span>\n              </MenuItem>\n            )}\n          </Menu2>\n        </div>\n      </header>\n      <main lang={lang} dir=\"auto\">\n        <p\n          style={{\n            whiteSpace: 'pre-wrap',\n            textWrap: 'pretty',\n          }}\n        >\n          {alt}\n        </p>\n        {(differentLanguage || forceTranslate) && (\n          <TranslationBlock\n            forceTranslate={forceTranslate}\n            sourceLanguage={lang}\n            text={alt}\n          />\n        )}\n      </main>\n    </div>\n  );\n}\n","const { min, max } = Math;\n\nexport default (x, low = 0, high = 1) => {\n    return min(max(low, x), high);\n};\n","// ported from jQuery's $.type\nconst classToType = {};\nfor (let name of [\n    'Boolean',\n    'Number',\n    'String',\n    'Function',\n    'Array',\n    'Date',\n    'RegExp',\n    'Undefined',\n    'Null'\n]) {\n    classToType[`[object ${name}]`] = name.toLowerCase();\n}\nexport default function (obj) {\n    return classToType[Object.prototype.toString.call(obj)] || 'object';\n}\n","import type from './type.js';\n\nexport default (args, keyOrder = null) => {\n    // if called with more than 3 arguments, we return the arguments\n    if (args.length >= 3) return Array.prototype.slice.call(args);\n    // with less than 3 args we check if first arg is object\n    // and use the keyOrder string to extract and sort properties\n    if (type(args[0]) == 'object' && keyOrder) {\n        return keyOrder\n            .split('')\n            .filter((k) => args[0][k] !== undefined)\n            .map((k) => args[0][k]);\n    }\n    // otherwise we just return the first argument\n    // (which we suppose is an array of args)\n    return args[0].slice(0);\n};\n","const { PI, min, max } = Math;\n\nconst rnd2 = (a) => Math.round(a * 100) / 100;\nconst rnd3 = (a) => Math.round(a * 100) / 100;\n\nexport { default as clip_rgb } from './clip_rgb.js';\nexport { default as limit } from './limit.js';\nexport { default as type } from './type.js';\nexport { default as unpack } from './unpack.js';\nexport { default as last } from './last.js';\n\nconst TWOPI = PI * 2;\nconst PITHIRD = PI / 3;\nconst DEG2RAD = PI / 180;\nconst RAD2DEG = 180 / PI;\n\n/**\n * Reverse the first three elements of an array\n *\n * @param {any[]} arr\n * @returns {any[]}\n */\nfunction reverse3(arr) {\n    return [...arr.slice(0, 3).reverse(), ...arr.slice(3)];\n}\n\nexport { PI, TWOPI, PITHIRD, DEG2RAD, RAD2DEG, min, max, rnd2, rnd3, reverse3 };\n","// from https://www.w3.org/TR/css-color-4/multiply-matrices.js\nexport default function multiplyMatrices(A, B) {\n    let m = A.length;\n\n    if (!Array.isArray(A[0])) {\n        // A is vector, convert to [[a, b, c, ...]]\n        A = [A];\n    }\n\n    if (!Array.isArray(B[0])) {\n        // B is vector, convert to [[a], [b], [c], ...]]\n        B = B.map((x) => [x]);\n    }\n\n    let p = B[0].length;\n    let B_cols = B[0].map((_, i) => B.map((x) => x[i])); // transpose B\n    let product = A.map((row) =>\n        B_cols.map((col) => {\n            if (!Array.isArray(row)) {\n                return col.reduce((a, c) => a + c * row, 0);\n            }\n\n            return row.reduce((a, c, i) => a + c * (col[i] || 0), 0);\n        })\n    );\n\n    if (m === 1) {\n        product = product[0]; // Avoid [[a, b, c, ...]]\n    }\n\n    if (p === 1) {\n        return product.map((x) => x[0]); // Avoid [[a], [b], [c], ...]]\n    }\n\n    return product;\n}\n","const labConstants = {\n    // Corresponds roughly to RGB brighter/darker\n    Kn: 18,\n\n    // D65 standard referent\n    labWhitePoint: 'd65',\n    Xn: 0.95047,\n    Yn: 1,\n    Zn: 1.08883,\n\n    t0: 0.137931034, // 4 / 29\n    t1: 0.206896552, // 6 / 29\n    t2: 0.12841855, // 3 * t1 * t1\n    t3: 0.008856452, // t1 * t1 * t1,\n\n    kE: 216.0 / 24389.0,\n    kKE: 8.0,\n    kK: 24389.0 / 27.0,\n\n    RefWhiteRGB: {\n        // sRGB\n        X: 0.95047,\n        Y: 1,\n        Z: 1.08883\n    },\n\n    MtxRGB2XYZ: {\n        m00: 0.4124564390896922,\n        m01: 0.21267285140562253,\n        m02: 0.0193338955823293,\n        m10: 0.357576077643909,\n        m11: 0.715152155287818,\n        m12: 0.11919202588130297,\n        m20: 0.18043748326639894,\n        m21: 0.07217499330655958,\n        m22: 0.9503040785363679\n    },\n\n    MtxXYZ2RGB: {\n        m00: 3.2404541621141045,\n        m01: -0.9692660305051868,\n        m02: 0.055643430959114726,\n        m10: -1.5371385127977166,\n        m11: 1.8760108454466942,\n        m12: -0.2040259135167538,\n        m20: -0.498531409556016,\n        m21: 0.041556017530349834,\n        m22: 1.0572251882231791\n    },\n\n    // used in rgb2xyz\n    As: 0.9414285350000001,\n    Bs: 1.040417467,\n    Cs: 1.089532651,\n\n    MtxAdaptMa: {\n        m00: 0.8951,\n        m01: -0.7502,\n        m02: 0.0389,\n        m10: 0.2664,\n        m11: 1.7135,\n        m12: -0.0685,\n        m20: -0.1614,\n        m21: 0.0367,\n        m22: 1.0296\n    },\n\n    MtxAdaptMaI: {\n        m00: 0.9869929054667123,\n        m01: 0.43230526972339456,\n        m02: -0.008528664575177328,\n        m10: -0.14705425642099013,\n        m11: 0.5183602715367776,\n        m12: 0.04004282165408487,\n        m20: 0.15996265166373125,\n        m21: 0.0492912282128556,\n        m22: 0.9684866957875502\n    }\n};\n\nexport default labConstants;\n\n// taken from https://de.mathworks.com/help/images/ref/whitepoint.html\nconst ILLUMINANTS = new Map([\n    // ASTM E308-01\n    ['a', [1.0985, 0.35585]],\n    // Wyszecki & Stiles, p. 769\n    ['b', [1.0985, 0.35585]],\n    // C ASTM E308-01\n    ['c', [0.98074, 1.18232]],\n    // D50 (ASTM E308-01)\n    ['d50', [0.96422, 0.82521]],\n    // D55 (ASTM E308-01)\n    ['d55', [0.95682, 0.92149]],\n    // D65 (ASTM E308-01)\n    ['d65', [0.95047, 1.08883]],\n    // E (ASTM E308-01)\n    ['e', [1, 1, 1]],\n    // F2 (ASTM E308-01)\n    ['f2', [0.99186, 0.67393]],\n    // F7 (ASTM E308-01)\n    ['f7', [0.95041, 1.08747]],\n    // F11 (ASTM E308-01)\n    ['f11', [1.00962, 0.6435]],\n    ['icc', [0.96422, 0.82521]]\n]);\n\nexport function setLabWhitePoint(name) {\n    const ill = ILLUMINANTS.get(String(name).toLowerCase());\n    if (!ill) {\n        throw new Error('unknown Lab illuminant ' + name);\n    }\n    labConstants.labWhitePoint = name;\n    labConstants.Xn = ill[0];\n    labConstants.Zn = ill[1];\n}\n\nexport function getLabWhitePoint() {\n    return labConstants.labWhitePoint;\n}\n","import LAB_CONSTANTS from './lab-constants.js';\nimport { unpack } from '../../utils/index.js';\n\n/*\n * L* [0..100]\n * a [-100..100]\n * b [-100..100]\n */\nconst lab2rgb = (...args) => {\n    args = unpack(args, 'lab');\n    const [L, a, b] = args;\n    const [x, y, z] = lab2xyz(L, a, b);\n    const [r, g, b_] = xyz2rgb(x, y, z);\n    return [r, g, b_, args.length > 3 ? args[3] : 1];\n};\n\nconst lab2xyz = (L, a, b) => {\n    const { kE, kK, kKE, Xn, Yn, Zn } = LAB_CONSTANTS;\n\n    const fy = (L + 16.0) / 116.0;\n    const fx = 0.002 * a + fy;\n    const fz = fy - 0.005 * b;\n\n    const fx3 = fx * fx * fx;\n    const fz3 = fz * fz * fz;\n\n    const xr = fx3 > kE ? fx3 : (116.0 * fx - 16.0) / kK;\n    const yr = L > kKE ? Math.pow((L + 16.0) / 116.0, 3.0) : L / kK;\n    const zr = fz3 > kE ? fz3 : (116.0 * fz - 16.0) / kK;\n\n    const x = xr * Xn;\n    const y = yr * Yn;\n    const z = zr * Zn;\n\n    return [x, y, z];\n};\n\nconst compand = (linear) => {\n    /* sRGB */\n    const sign = Math.sign(linear);\n    linear = Math.abs(linear);\n    return (\n        (linear <= 0.0031308\n            ? linear * 12.92\n            : 1.055 * Math.pow(linear, 1.0 / 2.4) - 0.055) * sign\n    );\n};\n\nconst xyz2rgb = (x, y, z) => {\n    const { MtxAdaptMa, MtxAdaptMaI, MtxXYZ2RGB, RefWhiteRGB, Xn, Yn, Zn } =\n        LAB_CONSTANTS;\n\n    const As = Xn * MtxAdaptMa.m00 + Yn * MtxAdaptMa.m10 + Zn * MtxAdaptMa.m20;\n    const Bs = Xn * MtxAdaptMa.m01 + Yn * MtxAdaptMa.m11 + Zn * MtxAdaptMa.m21;\n    const Cs = Xn * MtxAdaptMa.m02 + Yn * MtxAdaptMa.m12 + Zn * MtxAdaptMa.m22;\n\n    const Ad =\n        RefWhiteRGB.X * MtxAdaptMa.m00 +\n        RefWhiteRGB.Y * MtxAdaptMa.m10 +\n        RefWhiteRGB.Z * MtxAdaptMa.m20;\n    const Bd =\n        RefWhiteRGB.X * MtxAdaptMa.m01 +\n        RefWhiteRGB.Y * MtxAdaptMa.m11 +\n        RefWhiteRGB.Z * MtxAdaptMa.m21;\n    const Cd =\n        RefWhiteRGB.X * MtxAdaptMa.m02 +\n        RefWhiteRGB.Y * MtxAdaptMa.m12 +\n        RefWhiteRGB.Z * MtxAdaptMa.m22;\n\n    const X1 =\n        (x * MtxAdaptMa.m00 + y * MtxAdaptMa.m10 + z * MtxAdaptMa.m20) *\n        (Ad / As);\n    const Y1 =\n        (x * MtxAdaptMa.m01 + y * MtxAdaptMa.m11 + z * MtxAdaptMa.m21) *\n        (Bd / Bs);\n    const Z1 =\n        (x * MtxAdaptMa.m02 + y * MtxAdaptMa.m12 + z * MtxAdaptMa.m22) *\n        (Cd / Cs);\n\n    const X2 =\n        X1 * MtxAdaptMaI.m00 + Y1 * MtxAdaptMaI.m10 + Z1 * MtxAdaptMaI.m20;\n    const Y2 =\n        X1 * MtxAdaptMaI.m01 + Y1 * MtxAdaptMaI.m11 + Z1 * MtxAdaptMaI.m21;\n    const Z2 =\n        X1 * MtxAdaptMaI.m02 + Y1 * MtxAdaptMaI.m12 + Z1 * MtxAdaptMaI.m22;\n\n    const r = compand(\n        X2 * MtxXYZ2RGB.m00 + Y2 * MtxXYZ2RGB.m10 + Z2 * MtxXYZ2RGB.m20\n    );\n    const g = compand(\n        X2 * MtxXYZ2RGB.m01 + Y2 * MtxXYZ2RGB.m11 + Z2 * MtxXYZ2RGB.m21\n    );\n    const b = compand(\n        X2 * MtxXYZ2RGB.m02 + Y2 * MtxXYZ2RGB.m12 + Z2 * MtxXYZ2RGB.m22\n    );\n\n    return [r * 255, g * 255, b * 255];\n};\n\nexport default lab2rgb;\nexport { xyz2rgb };\n","import { unpack } from '../../utils/index.js';\nimport multiplyMatrices from '../../utils/multiply-matrices.js';\nimport { xyz2rgb } from '../lab/lab2rgb.js';\n\nconst oklab2rgb = (...args) => {\n    args = unpack(args, 'lab');\n    const [L, a, b, ...rest] = args;\n    const [X, Y, Z] = OKLab_to_XYZ([L, a, b]);\n    const [r, g, b_] = xyz2rgb(X, Y, Z);\n    return [r, g, b_, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\n// from https://www.w3.org/TR/css-color-4/#color-conversion-code\nfunction OKLab_to_XYZ(OKLab) {\n    // Given OKLab, convert to XYZ relative to D65\n    var LMStoXYZ = [\n        [1.2268798758459243, -0.5578149944602171, 0.2813910456659647],\n        [-0.0405757452148008, 1.112286803280317, -0.0717110580655164],\n        [-0.0763729366746601, -0.4214933324022432, 1.5869240198367816]\n    ];\n    var OKLabtoLMS = [\n        [1.0, 0.3963377773761749, 0.2158037573099136],\n        [1.0, -0.1055613458156586, -0.0638541728258133],\n        [1.0, -0.0894841775298119, -1.2914855480194092]\n    ];\n\n    var LMSnl = multiplyMatrices(OKLabtoLMS, OKLab);\n    return multiplyMatrices(\n        LMStoXYZ,\n        LMSnl.map((c) => c ** 3)\n    );\n}\n\nexport default oklab2rgb;\n","import LAB_CONSTANTS from './lab-constants.js';\nimport { unpack } from '../../utils/index.js';\n\nconst rgb2lab = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const [x, y, z] = rgb2xyz(r, g, b);\n    const [L, a, b_] = xyz2lab(x, y, z);\n    return [L, a, b_, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nfunction xyz2lab(x, y, z) {\n    const { Xn, Yn, Zn, kE, kK } = LAB_CONSTANTS;\n    const xr = x / Xn;\n    const yr = y / Yn;\n    const zr = z / Zn;\n\n    const fx = xr > kE ? Math.pow(xr, 1.0 / 3.0) : (kK * xr + 16.0) / 116.0;\n    const fy = yr > kE ? Math.pow(yr, 1.0 / 3.0) : (kK * yr + 16.0) / 116.0;\n    const fz = zr > kE ? Math.pow(zr, 1.0 / 3.0) : (kK * zr + 16.0) / 116.0;\n\n    return [116.0 * fy - 16.0, 500.0 * (fx - fy), 200.0 * (fy - fz)];\n}\n\nfunction gammaAdjustSRGB(companded) {\n    const sign = Math.sign(companded);\n    companded = Math.abs(companded);\n    const linear =\n        companded <= 0.04045\n            ? companded / 12.92\n            : Math.pow((companded + 0.055) / 1.055, 2.4);\n    return linear * sign;\n}\n\nconst rgb2xyz = (r, g, b) => {\n    // normalize and gamma adjust\n    r = gammaAdjustSRGB(r / 255);\n    g = gammaAdjustSRGB(g / 255);\n    b = gammaAdjustSRGB(b / 255);\n\n    const { MtxRGB2XYZ, MtxAdaptMa, MtxAdaptMaI, Xn, Yn, Zn, As, Bs, Cs } =\n        LAB_CONSTANTS;\n\n    let x = r * MtxRGB2XYZ.m00 + g * MtxRGB2XYZ.m10 + b * MtxRGB2XYZ.m20;\n    let y = r * MtxRGB2XYZ.m01 + g * MtxRGB2XYZ.m11 + b * MtxRGB2XYZ.m21;\n    let z = r * MtxRGB2XYZ.m02 + g * MtxRGB2XYZ.m12 + b * MtxRGB2XYZ.m22;\n\n    const Ad = Xn * MtxAdaptMa.m00 + Yn * MtxAdaptMa.m10 + Zn * MtxAdaptMa.m20;\n    const Bd = Xn * MtxAdaptMa.m01 + Yn * MtxAdaptMa.m11 + Zn * MtxAdaptMa.m21;\n    const Cd = Xn * MtxAdaptMa.m02 + Yn * MtxAdaptMa.m12 + Zn * MtxAdaptMa.m22;\n\n    let X = x * MtxAdaptMa.m00 + y * MtxAdaptMa.m10 + z * MtxAdaptMa.m20;\n    let Y = x * MtxAdaptMa.m01 + y * MtxAdaptMa.m11 + z * MtxAdaptMa.m21;\n    let Z = x * MtxAdaptMa.m02 + y * MtxAdaptMa.m12 + z * MtxAdaptMa.m22;\n\n    X *= Ad / As;\n    Y *= Bd / Bs;\n    Z *= Cd / Cs;\n\n    x = X * MtxAdaptMaI.m00 + Y * MtxAdaptMaI.m10 + Z * MtxAdaptMaI.m20;\n    y = X * MtxAdaptMaI.m01 + Y * MtxAdaptMaI.m11 + Z * MtxAdaptMaI.m21;\n    z = X * MtxAdaptMaI.m02 + Y * MtxAdaptMaI.m12 + Z * MtxAdaptMaI.m22;\n\n    return [x, y, z];\n};\n\nexport default rgb2lab;\nexport { rgb2xyz };\n","import { unpack } from '../../utils/index.js';\nimport multiplyMatrices from '../../utils/multiply-matrices.js';\nimport { rgb2xyz } from '../lab/rgb2lab.js';\n\nconst rgb2oklab = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const xyz = rgb2xyz(r, g, b);\n    const oklab = XYZ_to_OKLab(xyz);\n    return [...oklab, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\n// from https://www.w3.org/TR/css-color-4/#color-conversion-code\nfunction XYZ_to_OKLab(XYZ) {\n    // Given XYZ relative to D65, convert to OKLab\n    const XYZtoLMS = [\n        [0.819022437996703, 0.3619062600528904, -0.1288737815209879],\n        [0.0329836539323885, 0.9292868615863434, 0.0361446663506424],\n        [0.0481771893596242, 0.2642395317527308, 0.6335478284694309]\n    ];\n    const LMStoOKLab = [\n        [0.210454268309314, 0.7936177747023054, -0.0040720430116193],\n        [1.9779985324311684, -2.4285922420485799, 0.450593709617411],\n        [0.0259040424655478, 0.7827717124575296, -0.8086757549230774]\n    ];\n\n    const LMS = multiplyMatrices(XYZtoLMS, XYZ);\n    // JavaScript Math.cbrt returns a sign-matched cube root\n    // beware if porting to other languages\n    // especially if tempted to use a general power function\n    return multiplyMatrices(\n        LMStoOKLab,\n        LMS.map((c) => Math.cbrt(c))\n    );\n    // L in range [0,1]. For use in CSS, multiply by 100 and add a percent\n}\n\nexport default rgb2oklab;\n","import { unpack, DEG2RAD } from '../../utils/index.js';\nconst { sin, cos } = Math;\n\nconst lch2lab = (...args) => {\n    /*\n    Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n    These formulas were invented by David Dalrymple to obtain maximum contrast without going\n    out of gamut if the parameters are in the range 0-1.\n\n    A saturation multiplier was added by Gregor Aisch\n    */\n    let [l, c, h] = unpack(args, 'lch');\n    if (isNaN(h)) h = 0;\n    h = h * DEG2RAD;\n    return [l, cos(h) * c, sin(h) * c];\n};\n\nexport default lch2lab;\n","import { unpack } from '../../utils/index.js';\nimport lch2lab from '../lch/lch2lab.js';\nimport oklab2rgb from '../oklab/oklab2rgb.js';\n\nconst oklch2rgb = (...args) => {\n    args = unpack(args, 'lch');\n    const [l, c, h, ...rest] = args;\n    const [L, a, b_] = lch2lab(l, c, h);\n    const [r, g, b] = oklab2rgb(L, a, b_);\n    return [r, g, b, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nexport default oklch2rgb;\n","import { unpack, RAD2DEG } from '../../utils/index.js';\nconst { sqrt, atan2, round } = Math;\n\nconst lab2lch = (...args) => {\n    const [l, a, b] = unpack(args, 'lab');\n    const c = sqrt(a * a + b * b);\n    let h = (atan2(b, a) * RAD2DEG + 360) % 360;\n    if (round(c * 10000) === 0) h = Number.NaN;\n    return [l, c, h];\n};\n\nexport default lab2lch;\n","import { unpack } from '../../utils/index.js';\nimport rgb2oklab from '../oklab/rgb2oklab.js';\nimport lab2lch from '../lch/lab2lch.js';\n\nconst rgb2oklch = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const [l, a, b_] = rgb2oklab(r, g, b);\n    const [L, c, h] = lab2lch(l, a, b_);\n    return [L, c, h, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nexport default rgb2oklch;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport { oklch2rgb, rgb2oklch } from '../utils/color-utils';\nimport isRTL from '../utils/is-rtl';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\n\nimport Icon from './icon';\nimport Link from './link';\nimport Media from './media';\nimport MenuLink from './menu-link';\nimport Menu2 from './menu2';\n\nconst { PHANPY_IMG_ALT_API_URL: IMG_ALT_API_URL } = import.meta.env;\n\nfunction MediaModal({\n  mediaAttachments,\n  statusID,\n  instance,\n  lang,\n  index = 0,\n  onClose = () => {},\n}) {\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const carouselRef = useRef(null);\n\n  const [currentIndex, setCurrentIndex] = useState(index);\n  const carouselFocusItem = useRef(null);\n  useLayoutEffect(() => {\n    carouselFocusItem.current?.scrollIntoView();\n\n    // history.pushState({ mediaModal: true }, '');\n    // const handlePopState = (e) => {\n    //   if (e.state?.mediaModal) {\n    //     onClose();\n    //   }\n    // };\n    // window.addEventListener('popstate', handlePopState);\n    // return () => {\n    //   window.removeEventListener('popstate', handlePopState);\n    // };\n  }, []);\n  const prevStatusID = useRef(statusID);\n  useEffect(() => {\n    const scrollLeft = index * carouselRef.current.clientWidth;\n    const differentStatusID = prevStatusID.current !== statusID;\n    if (differentStatusID) prevStatusID.current = statusID;\n    carouselRef.current.focus();\n    carouselRef.current.scrollTo({\n      left: scrollLeft * (isRTL() ? -1 : 1),\n      behavior: differentStatusID ? 'auto' : 'smooth',\n    });\n  }, [index, statusID]);\n\n  const [showControls, setShowControls] = useState(true);\n\n  useEffect(() => {\n    let handleSwipe = (e) => {\n      onClose(e, currentIndex, mediaAttachments, carouselRef);\n    };\n    if (carouselRef.current) {\n      carouselRef.current.addEventListener('swiped-down', handleSwipe);\n    }\n    return () => {\n      if (carouselRef.current) {\n        carouselRef.current.removeEventListener('swiped-down', handleSwipe);\n      }\n    };\n  }, [currentIndex, mediaAttachments]);\n\n  useHotkeys(\n    'esc',\n    (e) => {\n      onClose(e, currentIndex, mediaAttachments, carouselRef);\n    },\n    {\n      ignoreEventWhen: (e) => {\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return hasModal || e.metaKey || e.ctrlKey || e.altKey || e.shiftKey;\n      },\n      useKey: true,\n    },\n    [onClose, currentIndex, mediaAttachments],\n  );\n\n  useEffect(() => {\n    let handleScroll = () => {\n      const { clientWidth, scrollLeft } = carouselRef.current;\n      const index = Math.round(Math.abs(scrollLeft) / clientWidth);\n      setCurrentIndex(index);\n    };\n    if (carouselRef.current) {\n      carouselRef.current.addEventListener('scroll', handleScroll, {\n        passive: true,\n      });\n    }\n    return () => {\n      if (carouselRef.current) {\n        carouselRef.current.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      carouselRef.current?.focus?.();\n    }, 100);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const mediaOkColors = useMemo(() => {\n    return mediaAttachments?.map((media) => {\n      const { blurhash } = media;\n      if (blurhash) {\n        const averageColor = getBlurHashAverageColor(blurhash);\n        return rgb2oklch(averageColor);\n      }\n      return null;\n    });\n  }, [mediaAttachments]);\n  const mediaAccentColors = useMemo(() => {\n    return mediaOkColors?.map((okColor) => {\n      if (okColor) {\n        return {\n          light: oklch2rgb([0.95, 0.01, okColor[2]]),\n          dark: oklch2rgb([0.35, 0.01, okColor[2]]),\n          default: oklch2rgb([0.6, okColor[1], okColor[2]]),\n        };\n      }\n      return null;\n    });\n  });\n  const mediaAccentGradients = useMemo(() => {\n    const gap = 5;\n    const range = 100 / mediaAccentColors.length;\n    const colors = mediaAccentColors.map((color, i) => {\n      const start = i * range + gap;\n      const end = (i + 1) * range - gap;\n      if (color?.light && color?.dark) {\n        return {\n          light: `\n                rgb(${color.light?.join(',')}) ${start}%, \n                rgb(${color.light?.join(',')}) ${end}%\n              `,\n          dark: `\n                rgb(${color.dark?.join(',')}) ${start}%, \n                rgb(${color.dark?.join(',')}) ${end}%\n              `,\n        };\n      }\n\n      return {\n        light: `\n              transparent ${start}%, \n              transparent ${end}%\n            `,\n        dark: `\n              transparent ${start}%, \n              transparent ${end}%\n            `,\n      };\n    });\n    const lightGradient = colors.map((color) => color.light).join(', ');\n    const darkGradient = colors.map((color) => color.dark).join(', ');\n    return {\n      light: lightGradient,\n      dark: darkGradient,\n    };\n  }, [mediaAccentColors]);\n\n  let toastRef = useRef(null);\n  useEffect(() => {\n    return () => {\n      toastRef.current?.hideToast?.();\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    const currentColor = mediaAccentColors[currentIndex];\n    let $meta;\n    let metaColor;\n    if (currentColor) {\n      const theme = store.local.get('theme');\n      if (theme) {\n        const mediaColor = `rgb(${currentColor[theme].join(',')})`;\n        console.log({ mediaColor });\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][data-theme-setting=\"manual\"]`,\n        );\n        if ($meta) {\n          metaColor = $meta.content;\n          $meta.content = mediaColor;\n        }\n        document.documentElement.style.setProperty(\n          '--meta-theme-color',\n          mediaColor,\n        );\n      } else {\n        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        const mediaColor = `rgb(${currentColor[colorScheme].join(',')})`;\n        console.log({ mediaColor });\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][media*=\"${colorScheme}\"]`,\n        );\n        if ($meta) {\n          metaColor = $meta.content;\n          $meta.content = mediaColor;\n        }\n        document.documentElement.style.setProperty(\n          '--meta-theme-color',\n          mediaColor,\n        );\n      }\n    }\n    return () => {\n      // Reset meta color\n      if ($meta && metaColor) {\n        $meta.content = metaColor;\n      }\n      document.documentElement.style.removeProperty('--meta-theme-color');\n    };\n  }, [currentIndex, mediaAccentColors]);\n\n  return (\n    <div\n      class={`media-modal-container media-modal-count-${mediaAttachments?.length}`}\n    >\n      <div\n        ref={carouselRef}\n        tabIndex=\"0\"\n        data-swipe-threshold=\"44\"\n        class=\"carousel\"\n        onClick={(e) => {\n          if (\n            e.target.classList.contains('carousel-item') ||\n            e.target.classList.contains('media') ||\n            e.target.classList.contains('media-zoom')\n          ) {\n            onClose(e, currentIndex, mediaAttachments, carouselRef);\n          }\n        }}\n        style={\n          mediaAttachments.length > 1\n            ? {\n                backgroundAttachment: 'local',\n                '--accent-gradient-light': mediaAccentGradients?.light,\n                '--accent-gradient-dark': mediaAccentGradients?.dark,\n                //     backgroundImage: `linear-gradient(\n                // to ${isRTL() ? 'left' : 'right'}, ${mediaAccentGradient})`,\n              }\n            : {}\n        }\n      >\n        {mediaAttachments?.map((media, i) => {\n          const accentColor =\n            mediaAttachments.length === 1 ? mediaAccentColors[i] : null;\n          return (\n            <div\n              class=\"carousel-item\"\n              style={\n                accentColor\n                  ? {\n                      '--accent-color': `rgb(${accentColor.default.join(',')})`,\n                      '--accent-light-color': `rgb(${accentColor.light?.join(\n                        ',',\n                      )})`,\n                      '--accent-dark-color': `rgb(${accentColor.dark?.join(\n                        ',',\n                      )})`,\n                      '--accent-alpha-color': `rgba(${accentColor.default.join(\n                        ',',\n                      )}, 0.4)`,\n                    }\n                  : {}\n              }\n              tabindex=\"0\"\n              key={media.id}\n              ref={i === currentIndex ? carouselFocusItem : null}\n              onClick={(e) => {\n                // console.log(e);\n                // if (e.target !== e.currentTarget) {\n                //   setShowControls(!showControls);\n                // }\n                if (!e.target.classList.contains('media')) {\n                  setShowControls(!showControls);\n                }\n              }}\n            >\n              {!!media.description && (\n                <button\n                  type=\"button\"\n                  class=\"media-alt\"\n                  hidden={!showControls}\n                  onClick={() => {\n                    states.showMediaAlt = {\n                      alt: media.description,\n                      lang,\n                    };\n                  }}\n                >\n                  <span class=\"alt-badge\">ALT</span>\n                  <span class=\"media-alt-desc\" lang={lang} dir=\"auto\">\n                    {media.description}\n                  </span>\n                </button>\n              )}\n              <Media media={media} showOriginal lang={lang} />\n            </div>\n          );\n        })}\n      </div>\n      <div class=\"carousel-top-controls\" hidden={!showControls}>\n        <span>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            onClick={(e) =>\n              onClose(e, currentIndex, mediaAttachments, carouselRef)\n            }\n          >\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n        </span>\n        {mediaAttachments?.length > 1 ? (\n          <span class=\"carousel-dots\">\n            {mediaAttachments?.map((media, i) => (\n              <button\n                key={media.id}\n                type=\"button\"\n                disabled={i === currentIndex}\n                class={`carousel-dot ${i === currentIndex ? 'active' : ''}`}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  const left =\n                    carouselRef.current.clientWidth * i * (isRTL() ? -1 : 1);\n                  carouselRef.current.focus();\n                  carouselRef.current.scrollTo({ left, behavior: 'smooth' });\n                }}\n              >\n                <Icon icon=\"round\" size=\"s\" alt=\"\" />\n              </button>\n            ))}\n          </span>\n        ) : (\n          <span />\n        )}\n        <span>\n          <Menu2\n            overflow=\"auto\"\n            align=\"end\"\n            position=\"anchor\"\n            gap={4}\n            menuClassName=\"glass-menu\"\n            menuButton={\n              <button type=\"button\" class=\"carousel-button\">\n                <Icon icon=\"more2\" alt={t`More`} />\n              </button>\n            }\n          >\n            <MenuLink\n              href={\n                mediaAttachments[currentIndex]?.remoteUrl ||\n                mediaAttachments[currentIndex]?.url\n              }\n              class=\"carousel-button\"\n              target=\"_blank\"\n              title={t`Open original media in new window`}\n            >\n              <Icon icon=\"popout\" />\n              <span>\n                <Trans>Open original media</Trans>\n              </span>\n            </MenuLink>\n            {import.meta.env.DEV && // Only dev for now\n              !!states.settings.mediaAltGenerator &&\n              !!IMG_ALT_API_URL &&\n              !!mediaAttachments[currentIndex]?.url &&\n              !mediaAttachments[currentIndex]?.description &&\n              mediaAttachments[currentIndex]?.type === 'image' && (\n                <>\n                  <MenuDivider />\n                  <MenuItem\n                    disabled={uiState === 'loading'}\n                    onClick={() => {\n                      setUIState('loading');\n                      toastRef.current = showToast({\n                        text: t`Attempting to describe image. Please wait`,\n                        duration: -1,\n                      });\n                      (async function () {\n                        try {\n                          const response = await fetch(\n                            `${IMG_ALT_API_URL}?image=${encodeURIComponent(\n                              mediaAttachments[currentIndex]?.url,\n                            )}`,\n                          ).then((r) => r.json());\n                          states.showMediaAlt = {\n                            alt: response.description,\n                          };\n                        } catch (e) {\n                          console.error(e);\n                          showToast(t`Failed to describe image`);\n                        } finally {\n                          setUIState('default');\n                          toastRef.current?.hideToast?.();\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"sparkles2\" />\n                    <span>\n                      <Trans>Describe image</Trans>\n                    </span>\n                  </MenuItem>\n                </>\n              )}\n          </Menu2>{' '}\n          {!!statusID && (\n            <Link\n              to={`${instance ? `/${instance}` : ''}/s/${statusID}${\n                window.matchMedia('(min-width: calc(40em + 350px))').matches\n                  ? `?media=${currentIndex + 1}`\n                  : ''\n              }`}\n              class=\"button carousel-button media-post-link\"\n              // onClick={() => {\n              //   // if small screen (not media query min-width 40em + 350px), run onClose\n              //   if (\n              //     !window.matchMedia('(min-width: calc(40em + 350px))').matches\n              //   ) {\n              //     onClose();\n              //   }\n              // }}\n            >\n              <span class=\"button-label\">\n                <Trans>View post</Trans>{' '}\n              </span>\n              &raquo;\n            </Link>\n          )}\n        </span>\n      </div>\n      {mediaAttachments?.length > 1 && (\n        <div class=\"carousel-controls\" hidden={!showControls}>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            hidden={currentIndex === 0}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              carouselRef.current.focus();\n              carouselRef.current.scrollTo({\n                left:\n                  carouselRef.current.clientWidth *\n                  (currentIndex - 1) *\n                  (isRTL() ? -1 : 1),\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"arrow-left\" alt={t`Previous`} />\n          </button>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            hidden={currentIndex === mediaAttachments.length - 1}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              carouselRef.current.focus();\n              carouselRef.current.scrollTo({\n                left:\n                  carouselRef.current.clientWidth *\n                  (currentIndex + 1) *\n                  (isRTL() ? -1 : 1),\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"arrow-right\" alt={t`Next`} />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default MediaModal;\n","import './open-link-sheet.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport showToast from '../utils/show-toast';\n\nimport Icon from './icon';\n\nexport default function OpenLinkSheet({ url, linkText, onClose }) {\n  const { t } = useLingui();\n  if (!url) return null;\n\n  let displayUrl = url;\n  try {\n    const urlObj = URL.parse(url);\n    const protocol = urlObj.protocol;\n    const hostname = urlObj.hostname;\n    const rest = url.slice(urlObj.origin.length);\n    displayUrl = (\n      <>\n        {protocol}//<strong>{hostname}</strong>\n        {rest}\n      </>\n    );\n  } catch (e) {}\n\n  const handleCopy = () => {\n    try {\n      navigator.clipboard.writeText(url);\n      showToast(t`Link copied`);\n    } catch (e) {\n      console.error(e);\n      showToast(t`Unable to copy link`);\n    }\n  };\n\n  const handleShare = () => {\n    if (navigator.share && navigator.canShare({ url })) {\n      try {\n        navigator.share({ url });\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n\n  return (\n    <div class=\"sheet sheet-modal\" id=\"open-link-sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Open link?</Trans>\n        </h2>\n      </header>\n      <main>\n        {!!linkText && (\n          <>\n            <p class=\"link-text\">\n              <Icon icon=\"cursor-hand\" size=\"xl\" /> {linkText}\n            </p>\n            <div class=\"arrow\">\n              <Icon icon=\"arrow-down\" />\n            </div>\n          </>\n        )}\n        <p class=\"full-url\">{displayUrl}</p>\n      </main>\n      <footer>\n        <button type=\"button\" class=\"light\" onClick={onClose}>\n          <Trans>Cancel</Trans>\n        </button>\n        <span class=\"spacer\" />\n        <button type=\"button\" class=\"plain6\" onClick={handleCopy}>\n          <Icon icon=\"copy\" alt={t`Copy`} />\n        </button>\n        {navigator.canShare && navigator.canShare({ url }) && (\n          <button type=\"button\" class=\"plain6\" onClick={handleShare}>\n            <Icon icon=\"share\" alt={t`Share`} />\n          </button>\n        )}\n        <a\n          class=\"button\"\n          href={url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          onClick={onClose}\n        >\n          <Trans>Open</Trans>\n        </a>\n      </footer>\n    </div>\n  );\n}\n","/*!\nCopyright (c) 2023 Paul Miller (paulmillr.com)\nThe library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.\nYou can select a license of your choice.\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Methods for encoding (generating) QR code patterns.\n * Check out decode.ts for decoding (reading).\n * @module\n * @example\n```js\nimport encodeQR from 'qr';\nconst txt = 'Hello world';\nconst ascii = encodeQR(txt, 'ascii'); // Not all fonts are supported\nconst terminalFriendly = encodeQR(txt, 'term'); // 2x larger, all fonts are OK\nconst gifBytes = encodeQR(txt, 'gif'); // Uncompressed GIF\nconst svgElement = encodeQR(txt, 'svg'); // SVG vector image element\nconst array = encodeQR(txt, 'raw'); // 2d array for canvas or other libs\n// import decodeQR from 'qr/decode.js';\n```\n */\nconst R1_RUN_LENGTH_THRESHOLD = 5;\nconst R2_BLOCK_PENALTY = 3;\nconst R3_FINDER_PATTERN_LENGTH = 11;\nconst R3_FINDER_PENALTY = 40;\nconst R4_BALANCE_STEP_PERCENT = 5;\nconst R4_BALANCE_STEP_POINTS = 10;\n// We do not use newline escape code directly in strings because it's not parser-friendly\nconst chCodes = { newline: 10, reset: 27 };\nfunction assertNumber(n) {\n    if (!Number.isSafeInteger(n))\n        throw new Error(`integer expected: ${n}`);\n}\nfunction validateVersion(ver) {\n    if (!Number.isSafeInteger(ver) || ver < 1 || ver > 40)\n        throw new Error(`Invalid version=${ver}. Expected number [1..40]`);\n}\nfunction bin(dec, pad) {\n    return dec.toString(2).padStart(pad, '0');\n}\nfunction mod(a, b) {\n    const result = a % b;\n    return result >= 0 ? result : b + result;\n}\nfunction fillArr(length, val) {\n    return new Array(length).fill(val);\n}\n/**\n * Interleaves byte blocks.\n * @param blocks [[1, 2, 3], [4, 5, 6]]\n * @returns [1, 4, 2, 5, 3, 6]\n */\nfunction interleaveBytes(blocks) {\n    let maxLen = 0;\n    let totalLen = 0;\n    for (const block of blocks) {\n        maxLen = Math.max(maxLen, block.length);\n        totalLen += block.length;\n    }\n    const result = new Uint8Array(totalLen);\n    let idx = 0;\n    for (let i = 0; i < maxLen; i++) {\n        for (const block of blocks) {\n            if (i < block.length)\n                result[idx++] = block[i];\n        }\n    }\n    return result;\n}\n// Optimize for minimal score/penalty\nfunction best() {\n    let best;\n    let bestScore = Infinity;\n    return {\n        add(score, value) {\n            if (score >= bestScore)\n                return;\n            best = value;\n            bestScore = score;\n        },\n        get: () => best,\n        score: () => bestScore,\n    };\n}\n// Based on https://github.com/paulmillr/scure-base/blob/main/index.ts\nfunction alphabet(alphabet) {\n    return {\n        has: (char) => alphabet.includes(char),\n        decode: (input) => {\n            if (!Array.isArray(input) || (input.length && typeof input[0] !== 'string'))\n                throw new Error('alphabet.decode input should be array of strings');\n            return input.map((letter) => {\n                if (typeof letter !== 'string')\n                    throw new Error(`alphabet.decode: not string element=${letter}`);\n                const index = alphabet.indexOf(letter);\n                if (index === -1)\n                    throw new Error(`Unknown letter: \"${letter}\". Allowed: ${alphabet}`);\n                return index;\n            });\n        },\n        encode: (digits) => {\n            if (!Array.isArray(digits) || (digits.length && typeof digits[0] !== 'number'))\n                throw new Error('alphabet.encode input should be an array of numbers');\n            return digits.map((i) => {\n                assertNumber(i);\n                if (i < 0 || i >= alphabet.length)\n                    throw new Error(`Digit index outside alphabet: ${i} (alphabet: ${alphabet.length})`);\n                return alphabet[i];\n            });\n        },\n    };\n}\nexport class Bitmap {\n    static size(size, limit) {\n        if (typeof size === 'number')\n            size = { height: size, width: size };\n        if (!Number.isSafeInteger(size.height) && size.height !== Infinity)\n            throw new Error(`Bitmap: invalid height=${size.height} (${typeof size.height})`);\n        if (!Number.isSafeInteger(size.width) && size.width !== Infinity)\n            throw new Error(`Bitmap: invalid width=${size.width} (${typeof size.width})`);\n        if (limit !== undefined) {\n            // Clamp length, so it won't overflow, also allows to use Infinity, so we draw until end\n            size = {\n                width: Math.min(size.width, limit.width),\n                height: Math.min(size.height, limit.height),\n            };\n        }\n        return size;\n    }\n    static fromString(s) {\n        // Remove linebreaks on start and end, so we draw in `` section\n        s = s.replace(/^\\n+/g, '').replace(/\\n+$/g, '');\n        const lines = s.split(String.fromCharCode(chCodes.newline));\n        const height = lines.length;\n        const data = new Array(height);\n        let width;\n        for (const line of lines) {\n            const row = line.split('').map((i) => {\n                if (i === 'X')\n                    return true;\n                if (i === ' ')\n                    return false;\n                if (i === '?')\n                    return undefined;\n                throw new Error(`Bitmap.fromString: unknown symbol=${i}`);\n            });\n            if (width && row.length !== width)\n                throw new Error(`Bitmap.fromString different row sizes: width=${width} cur=${row.length}`);\n            width = row.length;\n            data.push(row);\n        }\n        if (!width)\n            width = 0;\n        return new Bitmap({ height, width }, data);\n    }\n    data;\n    height;\n    width;\n    constructor(size, data) {\n        const { height, width } = Bitmap.size(size);\n        this.data = data || Array.from({ length: height }, () => fillArr(width, undefined));\n        this.height = height;\n        this.width = width;\n    }\n    point(p) {\n        return this.data[p.y][p.x];\n    }\n    isInside(p) {\n        return 0 <= p.x && p.x < this.width && 0 <= p.y && p.y < this.height;\n    }\n    size(offset) {\n        if (!offset)\n            return { height: this.height, width: this.width };\n        const { x, y } = this.xy(offset);\n        return { height: this.height - y, width: this.width - x };\n    }\n    xy(c) {\n        if (typeof c === 'number')\n            c = { x: c, y: c };\n        if (!Number.isSafeInteger(c.x))\n            throw new Error(`Bitmap: invalid x=${c.x}`);\n        if (!Number.isSafeInteger(c.y))\n            throw new Error(`Bitmap: invalid y=${c.y}`);\n        // Do modulo, so we can use negative positions\n        c.x = mod(c.x, this.width);\n        c.y = mod(c.y, this.height);\n        return c;\n    }\n    // Basically every operation can be represented as rect\n    rect(c, size, value) {\n        const { x, y } = this.xy(c);\n        const { height, width } = Bitmap.size(size, this.size({ x, y }));\n        for (let yPos = 0; yPos < height; yPos++) {\n            for (let xPos = 0; xPos < width; xPos++) {\n                // NOTE: we use give function relative coordinates inside box\n                this.data[y + yPos][x + xPos] =\n                    typeof value === 'function'\n                        ? value({ x: xPos, y: yPos }, this.data[y + yPos][x + xPos])\n                        : value;\n            }\n        }\n        return this;\n    }\n    // returns rectangular part of bitmap\n    rectRead(c, size, fn) {\n        return this.rect(c, size, (c, cur) => {\n            fn(c, cur);\n            return cur;\n        });\n    }\n    // Horizontal & vertical lines\n    hLine(c, len, value) {\n        return this.rect(c, { width: len, height: 1 }, value);\n    }\n    vLine(c, len, value) {\n        return this.rect(c, { width: 1, height: len }, value);\n    }\n    // add border\n    border(border = 2, value) {\n        const height = this.height + 2 * border;\n        const width = this.width + 2 * border;\n        const v = fillArr(border, value);\n        const h = Array.from({ length: border }, () => fillArr(width, value));\n        return new Bitmap({ height, width }, [...h, ...this.data.map((i) => [...v, ...i, ...v]), ...h]);\n    }\n    // Embed another bitmap on coordinates\n    embed(c, bm) {\n        return this.rect(c, bm.size(), ({ x, y }) => bm.data[y][x]);\n    }\n    // returns rectangular part of bitmap\n    rectSlice(c, size = this.size()) {\n        const rect = new Bitmap(Bitmap.size(size, this.size(this.xy(c))));\n        this.rect(c, size, ({ x, y }, cur) => (rect.data[y][x] = cur));\n        return rect;\n    }\n    // Change shape, replace rows with columns (data[y][x] -> data[x][y])\n    inverse() {\n        const { height, width } = this;\n        const res = new Bitmap({ height: width, width: height });\n        return res.rect({ x: 0, y: 0 }, Infinity, ({ x, y }) => this.data[x][y]);\n    }\n    // Each pixel size is multiplied by factor\n    scale(factor) {\n        if (!Number.isSafeInteger(factor) || factor > 1024)\n            throw new Error(`invalid scale factor: ${factor}`);\n        const { height, width } = this;\n        const res = new Bitmap({ height: factor * height, width: factor * width });\n        return res.rect({ x: 0, y: 0 }, Infinity, ({ x, y }) => this.data[Math.floor(y / factor)][Math.floor(x / factor)]);\n    }\n    clone() {\n        const res = new Bitmap(this.size());\n        return res.rect({ x: 0, y: 0 }, this.size(), ({ x, y }) => this.data[y][x]);\n    }\n    // Ensure that there is no undefined values left\n    assertDrawn() {\n        this.rectRead(0, Infinity, (_, cur) => {\n            if (typeof cur !== 'boolean')\n                throw new Error(`Invalid color type=${typeof cur}`);\n        });\n    }\n    // Simple string representation for debugging\n    toString() {\n        return this.data\n            .map((i) => i.map((j) => (j === undefined ? '?' : j ? 'X' : ' ')).join(''))\n            .join(String.fromCharCode(chCodes.newline));\n    }\n    toASCII() {\n        const { height, width, data } = this;\n        let out = '';\n        // Terminal character height is x2 of character width, so we process two rows of bitmap\n        // to produce one row of ASCII\n        for (let y = 0; y < height; y += 2) {\n            for (let x = 0; x < width; x++) {\n                const first = data[y][x];\n                const second = y + 1 >= height ? true : data[y + 1][x]; // if last row outside bitmap, make it black\n                if (!first && !second)\n                    out += ''; // both rows white (empty)\n                else if (!first && second)\n                    out += ''; // top row white\n                else if (first && !second)\n                    out += ''; // down row white\n                else if (first && second)\n                    out += ' '; // both rows black\n            }\n            out += String.fromCharCode(chCodes.newline);\n        }\n        return out;\n    }\n    toTerm() {\n        const cc = String.fromCharCode(chCodes.reset);\n        const reset = cc + '[0m';\n        const whiteBG = cc + '[1;47m  ' + reset;\n        const darkBG = cc + `[40m  ` + reset;\n        return this.data\n            .map((i) => i.map((j) => (j ? darkBG : whiteBG)).join(''))\n            .join(String.fromCharCode(chCodes.newline));\n    }\n    toSVG(optimize = true) {\n        let out = `<svg viewBox=\"0 0 ${this.width} ${this.height}\" xmlns=\"http://www.w3.org/2000/svg\">`;\n        // Construct optimized SVG path data.\n        let pathData = '';\n        let prevPoint;\n        this.rectRead(0, Infinity, (point, val) => {\n            if (!val)\n                return;\n            const { x, y } = point;\n            if (!optimize) {\n                out += `<rect x=\"${x}\" y=\"${y}\" width=\"1\" height=\"1\" />`;\n                return;\n            }\n            // https://developer.mozilla.org/en-US/docs/Web/SVG/Reference/Attribute/d#path_commands\n            // Determine the shortest way to represent the initial cursor movement.\n            // M - Move cursor (without drawing) to absolute coordinate pair.\n            let m = `M${x} ${y}`;\n            // Only allow using the relative cursor move command if previous points\n            // were drawn.\n            if (prevPoint) {\n                // m - Move cursor (without drawing) to relative coordinate pair.\n                const relM = `m${x - prevPoint.x} ${y - prevPoint.y}`;\n                if (relM.length <= m.length)\n                    m = relM;\n            }\n            // Determine the shortest way to represent the cell's bottom line draw.\n            // H - Draw line from cursor position to absolute x coordinate.\n            // h - Draw line from cursor position to relative x coordinate.\n            const bH = x < 10 ? `H${x}` : 'h-1';\n            // v - Draw line from cursor position to relative y coordinate.\n            // Z - Close path (draws line from cursor position to M coordinate).\n            pathData += `${m}h1v1${bH}Z`;\n            prevPoint = point;\n        });\n        if (optimize)\n            out += `<path d=\"${pathData}\"/>`;\n        out += `</svg>`;\n        return out;\n    }\n    toGIF() {\n        // NOTE: Small, but inefficient implementation.\n        // Uses 1 byte per pixel.\n        const u16le = (i) => [i & 0xff, (i >>> 8) & 0xff];\n        const dims = [...u16le(this.width), ...u16le(this.height)];\n        const data = [];\n        this.rectRead(0, Infinity, (_, cur) => data.push(+(cur === true)));\n        const N = 126; // Block size\n        // prettier-ignore\n        const bytes = [\n            0x47, 0x49, 0x46, 0x38, 0x37, 0x61, ...dims, 0xf6, 0x00, 0x00, 0xff, 0xff, 0xff,\n            ...fillArr(3 * 127, 0x00), 0x2c, 0x00, 0x00, 0x00, 0x00, ...dims, 0x00, 0x07\n        ];\n        const fullChunks = Math.floor(data.length / N);\n        // Full blocks\n        for (let i = 0; i < fullChunks; i++)\n            bytes.push(N + 1, 0x80, ...data.slice(N * i, N * (i + 1)).map((i) => +i));\n        // Remaining bytes\n        bytes.push((data.length % N) + 1, 0x80, ...data.slice(fullChunks * N).map((i) => +i));\n        bytes.push(0x01, 0x81, 0x00, 0x3b);\n        return new Uint8Array(bytes);\n    }\n    toImage(isRGB = false) {\n        const { height, width } = this.size();\n        const data = new Uint8Array(height * width * (isRGB ? 3 : 4));\n        let i = 0;\n        for (let y = 0; y < height; y++) {\n            for (let x = 0; x < width; x++) {\n                const value = !!this.data[y][x] ? 0 : 255;\n                data[i++] = value;\n                data[i++] = value;\n                data[i++] = value;\n                if (!isRGB)\n                    data[i++] = 255; // alpha channel\n            }\n        }\n        return { height, width, data };\n    }\n}\n// End of utils\n// Runtime type-checking\n/** Error correction mode. low: 7%, medium: 15%, quartile: 25%, high: 30% */\nexport const ECMode = ['low', 'medium', 'quartile', 'high'];\n/** QR Code encoding */\nexport const Encoding = ['numeric', 'alphanumeric', 'byte', 'kanji', 'eci'];\n// Various constants & tables\n// prettier-ignore\nconst BYTES = [\n    // 1,  2,  3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  16,  17,  18,  19,   20,\n    26, 44, 70, 100, 134, 172, 196, 242, 292, 346, 404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,\n    //  21,   22,   23,   24,   25,   26,   27,   28,   29,   30,   31,   32,   33,   34,   35,   36,   37,   38,   39,   40\n    1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185, 2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706,\n];\n// prettier-ignore\nconst WORDS_PER_BLOCK = {\n    // Version 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40\n    low: [7, 10, 15, 20, 26, 18, 20, 24, 30, 18, 20, 24, 26, 30, 22, 24, 28, 30, 28, 28, 28, 28, 30, 30, 26, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    medium: [10, 16, 26, 18, 24, 16, 18, 22, 22, 26, 30, 22, 22, 24, 24, 28, 28, 26, 26, 26, 26, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28],\n    quartile: [13, 22, 18, 26, 18, 24, 18, 22, 20, 24, 28, 26, 24, 20, 30, 24, 28, 28, 26, 30, 28, 30, 30, 30, 30, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    high: [17, 28, 22, 16, 22, 28, 26, 26, 24, 28, 24, 28, 22, 24, 24, 30, 28, 28, 26, 28, 30, 24, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n};\n// prettier-ignore\nconst ECC_BLOCKS = {\n    // Version   1, 2, 3, 4, 5, 6, 7, 8, 9,10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40\n    low: [1, 1, 1, 1, 1, 2, 2, 2, 2, 4, 4, 4, 4, 4, 6, 6, 6, 6, 7, 8, 8, 9, 9, 10, 12, 12, 12, 13, 14, 15, 16, 17, 18, 19, 19, 20, 21, 22, 24, 25],\n    medium: [1, 1, 1, 2, 2, 4, 4, 4, 5, 5, 5, 8, 9, 9, 10, 10, 11, 13, 14, 16, 17, 17, 18, 20, 21, 23, 25, 26, 28, 29, 31, 33, 35, 37, 38, 40, 43, 45, 47, 49],\n    quartile: [1, 1, 2, 2, 4, 4, 6, 6, 8, 8, 8, 10, 12, 16, 12, 17, 16, 18, 21, 20, 23, 23, 25, 27, 29, 34, 34, 35, 38, 40, 43, 45, 48, 51, 53, 56, 59, 62, 65, 68],\n    high: [1, 1, 2, 4, 4, 4, 5, 6, 8, 8, 11, 11, 16, 16, 18, 16, 19, 21, 25, 25, 25, 34, 30, 32, 35, 37, 40, 42, 45, 48, 51, 54, 57, 60, 63, 66, 70, 74, 77, 81],\n};\nconst info = {\n    size: {\n        encode: (ver) => 21 + 4 * (ver - 1), // ver1 = 21, ver40=177 blocks\n        decode: (size) => (size - 17) / 4,\n    },\n    sizeType: (ver) => Math.floor((ver + 7) / 17),\n    // Based on https://codereview.stackexchange.com/questions/74925/algorithm-to-generate-this-alignment-pattern-locations-table-for-qr-codes\n    alignmentPatterns(ver) {\n        if (ver === 1)\n            return [];\n        const first = 6;\n        const last = info.size.encode(ver) - first - 1;\n        const distance = last - first;\n        const count = Math.ceil(distance / 28);\n        let interval = Math.floor(distance / count);\n        if (interval % 2)\n            interval += 1;\n        else if ((distance % count) * 2 >= count)\n            interval += 2;\n        const res = [first];\n        for (let m = 1; m < count; m++)\n            res.push(last - (count - m) * interval);\n        res.push(last);\n        return res;\n    },\n    ECCode: {\n        low: 0b01,\n        medium: 0b00,\n        quartile: 0b11,\n        high: 0b10,\n    },\n    formatMask: 0b101010000010010,\n    formatBits(ecc, maskIdx) {\n        const data = (info.ECCode[ecc] << 3) | maskIdx;\n        let d = data;\n        for (let i = 0; i < 10; i++)\n            d = (d << 1) ^ ((d >> 9) * 0b10100110111);\n        return ((data << 10) | d) ^ info.formatMask;\n    },\n    versionBits(ver) {\n        let d = ver;\n        for (let i = 0; i < 12; i++)\n            d = (d << 1) ^ ((d >> 11) * 0b1111100100101);\n        return (ver << 12) | d;\n    },\n    alphabet: {\n        numeric: alphabet('0123456789'),\n        alphanumerc: alphabet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:'),\n    }, // as Record<EncodingType, ReturnType<typeof alphabet>>,\n    lengthBits(ver, type) {\n        const table = {\n            numeric: [10, 12, 14],\n            alphanumeric: [9, 11, 13],\n            byte: [8, 16, 16],\n            kanji: [8, 10, 12],\n            eci: [0, 0, 0],\n        };\n        return table[type][info.sizeType(ver)];\n    },\n    modeBits: {\n        numeric: '0001',\n        alphanumeric: '0010',\n        byte: '0100',\n        kanji: '1000',\n        eci: '0111',\n    },\n    capacity(ver, ecc) {\n        const bytes = BYTES[ver - 1];\n        const words = WORDS_PER_BLOCK[ecc][ver - 1];\n        const numBlocks = ECC_BLOCKS[ecc][ver - 1];\n        const blockLen = Math.floor(bytes / numBlocks) - words;\n        const shortBlocks = numBlocks - (bytes % numBlocks);\n        return {\n            words,\n            numBlocks,\n            shortBlocks,\n            blockLen,\n            capacity: (bytes - words * numBlocks) * 8,\n            total: (words + blockLen) * numBlocks + numBlocks - shortBlocks,\n        };\n    },\n};\nconst PATTERNS = [\n    (x, y) => (x + y) % 2 == 0,\n    (_x, y) => y % 2 == 0,\n    (x, _y) => x % 3 == 0,\n    (x, y) => (x + y) % 3 == 0,\n    (x, y) => (Math.floor(y / 2) + Math.floor(x / 3)) % 2 == 0,\n    (x, y) => ((x * y) % 2) + ((x * y) % 3) == 0,\n    (x, y) => (((x * y) % 2) + ((x * y) % 3)) % 2 == 0,\n    (x, y) => (((x + y) % 2) + ((x * y) % 3)) % 2 == 0,\n];\n// Galois field && reed-solomon encoding\nconst GF = {\n    tables: ((p_poly) => {\n        const exp = fillArr(256, 0);\n        const log = fillArr(256, 0);\n        for (let i = 0, x = 1; i < 256; i++) {\n            exp[i] = x;\n            log[x] = i;\n            x <<= 1;\n            if (x & 0x100)\n                x ^= p_poly;\n        }\n        return { exp, log };\n    })(0x11d),\n    exp: (x) => GF.tables.exp[x],\n    log(x) {\n        if (x === 0)\n            throw new Error(`GF.log: invalid arg=${x}`);\n        return GF.tables.log[x] % 255;\n    },\n    mul(x, y) {\n        if (x === 0 || y === 0)\n            return 0;\n        return GF.tables.exp[(GF.tables.log[x] + GF.tables.log[y]) % 255];\n    },\n    add: (x, y) => x ^ y,\n    pow: (x, e) => GF.tables.exp[(GF.tables.log[x] * e) % 255],\n    inv(x) {\n        if (x === 0)\n            throw new Error(`GF.inverse: invalid arg=${x}`);\n        return GF.tables.exp[255 - GF.tables.log[x]];\n    },\n    polynomial(poly) {\n        if (poly.length == 0)\n            throw new Error('GF.polymomial: invalid length');\n        if (poly[0] !== 0)\n            return poly;\n        // Strip leading zeros\n        let i = 0;\n        for (; i < poly.length - 1 && poly[i] == 0; i++)\n            ;\n        return poly.slice(i);\n    },\n    monomial(degree, coefficient) {\n        if (degree < 0)\n            throw new Error(`GF.monomial: invalid degree=${degree}`);\n        if (coefficient == 0)\n            return [0];\n        let coefficients = fillArr(degree + 1, 0);\n        coefficients[0] = coefficient;\n        return GF.polynomial(coefficients);\n    },\n    degree: (a) => a.length - 1,\n    coefficient: (a, degree) => a[GF.degree(a) - degree],\n    mulPoly(a, b) {\n        if (a[0] === 0 || b[0] === 0)\n            return [0];\n        const res = fillArr(a.length + b.length - 1, 0);\n        for (let i = 0; i < a.length; i++) {\n            for (let j = 0; j < b.length; j++) {\n                res[i + j] = GF.add(res[i + j], GF.mul(a[i], b[j]));\n            }\n        }\n        return GF.polynomial(res);\n    },\n    mulPolyScalar(a, scalar) {\n        if (scalar == 0)\n            return [0];\n        if (scalar == 1)\n            return a;\n        const res = fillArr(a.length, 0);\n        for (let i = 0; i < a.length; i++)\n            res[i] = GF.mul(a[i], scalar);\n        return GF.polynomial(res);\n    },\n    mulPolyMonomial(a, degree, coefficient) {\n        if (degree < 0)\n            throw new Error('GF.mulPolyMonomial: invalid degree');\n        if (coefficient == 0)\n            return [0];\n        const res = fillArr(a.length + degree, 0);\n        for (let i = 0; i < a.length; i++)\n            res[i] = GF.mul(a[i], coefficient);\n        return GF.polynomial(res);\n    },\n    addPoly(a, b) {\n        if (a[0] === 0)\n            return b;\n        if (b[0] === 0)\n            return a;\n        let smaller = a;\n        let larger = b;\n        if (smaller.length > larger.length)\n            [smaller, larger] = [larger, smaller];\n        let sumDiff = fillArr(larger.length, 0);\n        let lengthDiff = larger.length - smaller.length;\n        let s = larger.slice(0, lengthDiff);\n        for (let i = 0; i < s.length; i++)\n            sumDiff[i] = s[i];\n        for (let i = lengthDiff; i < larger.length; i++)\n            sumDiff[i] = GF.add(smaller[i - lengthDiff], larger[i]);\n        return GF.polynomial(sumDiff);\n    },\n    remainderPoly(data, divisor) {\n        const out = Array.from(data);\n        for (let i = 0; i < data.length - divisor.length + 1; i++) {\n            const elm = out[i];\n            if (elm === 0)\n                continue;\n            for (let j = 1; j < divisor.length; j++) {\n                if (divisor[j] !== 0)\n                    out[i + j] = GF.add(out[i + j], GF.mul(divisor[j], elm));\n            }\n        }\n        return out.slice(data.length - divisor.length + 1, out.length);\n    },\n    divisorPoly(degree) {\n        let g = [1];\n        for (let i = 0; i < degree; i++)\n            g = GF.mulPoly(g, [1, GF.pow(2, i)]);\n        return g;\n    },\n    evalPoly(poly, a) {\n        if (a == 0)\n            return GF.coefficient(poly, 0); // Just return the x^0 coefficient\n        let res = poly[0];\n        for (let i = 1; i < poly.length; i++)\n            res = GF.add(GF.mul(a, res), poly[i]);\n        return res;\n    },\n    // TODO: cleanup\n    euclidian(a, b, R) {\n        // Force degree(a) >= degree(b)\n        if (GF.degree(a) < GF.degree(b))\n            [a, b] = [b, a];\n        let rLast = a;\n        let r = b;\n        let tLast = [0];\n        let t = [1];\n        // while degree of Ri  t/2\n        while (2 * GF.degree(r) >= R) {\n            let rLastLast = rLast;\n            let tLastLast = tLast;\n            rLast = r;\n            tLast = t;\n            if (rLast[0] === 0)\n                throw new Error('rLast[0] === 0');\n            r = rLastLast;\n            let q = [0];\n            const dltInverse = GF.inv(rLast[0]);\n            while (GF.degree(r) >= GF.degree(rLast) && r[0] !== 0) {\n                const degreeDiff = GF.degree(r) - GF.degree(rLast);\n                const scale = GF.mul(r[0], dltInverse);\n                q = GF.addPoly(q, GF.monomial(degreeDiff, scale));\n                r = GF.addPoly(r, GF.mulPolyMonomial(rLast, degreeDiff, scale));\n            }\n            q = GF.mulPoly(q, tLast);\n            t = GF.addPoly(q, tLastLast);\n            if (GF.degree(r) >= GF.degree(rLast))\n                throw new Error(`Division failed r: ${r}, rLast: ${rLast}`);\n        }\n        const sigmaTildeAtZero = GF.coefficient(t, 0);\n        if (sigmaTildeAtZero == 0)\n            throw new Error('sigmaTilde(0) was zero');\n        const inverse = GF.inv(sigmaTildeAtZero);\n        return [GF.mulPolyScalar(t, inverse), GF.mulPolyScalar(r, inverse)];\n    },\n};\nfunction RS(eccWords) {\n    return {\n        encode(from) {\n            const d = GF.divisorPoly(eccWords);\n            const pol = Array.from(from);\n            pol.push(...d.slice(0, -1).fill(0));\n            return Uint8Array.from(GF.remainderPoly(pol, d));\n        },\n        decode(to) {\n            const res = to.slice();\n            const poly = GF.polynomial(Array.from(to));\n            // Find errors\n            let syndrome = fillArr(eccWords, 0);\n            let hasError = false;\n            for (let i = 0; i < eccWords; i++) {\n                const evl = GF.evalPoly(poly, GF.exp(i));\n                syndrome[syndrome.length - 1 - i] = evl;\n                if (evl !== 0)\n                    hasError = true;\n            }\n            if (!hasError)\n                return res;\n            syndrome = GF.polynomial(syndrome);\n            const monomial = GF.monomial(eccWords, 1);\n            const [errorLocator, errorEvaluator] = GF.euclidian(monomial, syndrome, eccWords);\n            // Error locations\n            const locations = fillArr(GF.degree(errorLocator), 0);\n            let e = 0;\n            for (let i = 1; i < 256 && e < locations.length; i++) {\n                if (GF.evalPoly(errorLocator, i) === 0)\n                    locations[e++] = GF.inv(i);\n            }\n            if (e !== locations.length)\n                throw new Error('RS.decode: invalid errors number');\n            for (let i = 0; i < locations.length; i++) {\n                const pos = res.length - 1 - GF.log(locations[i]);\n                if (pos < 0)\n                    throw new Error('RS.decode: invalid error location');\n                const xiInverse = GF.inv(locations[i]);\n                let denominator = 1;\n                for (let j = 0; j < locations.length; j++) {\n                    if (i === j)\n                        continue;\n                    denominator = GF.mul(denominator, GF.add(1, GF.mul(locations[j], xiInverse)));\n                }\n                res[pos] = GF.add(res[pos], GF.mul(GF.evalPoly(errorEvaluator, xiInverse), GF.inv(denominator)));\n            }\n            return res;\n        },\n    };\n}\n// Interleaves blocks\nfunction interleave(ver, ecc) {\n    const { words, shortBlocks, numBlocks, blockLen, total } = info.capacity(ver, ecc);\n    const rs = RS(words);\n    return {\n        encode(bytes) {\n            // Add error correction to bytes\n            const blocks = [];\n            const eccBlocks = [];\n            for (let i = 0; i < numBlocks; i++) {\n                const isShort = i < shortBlocks;\n                const len = blockLen + (isShort ? 0 : 1);\n                blocks.push(bytes.subarray(0, len));\n                eccBlocks.push(rs.encode(bytes.subarray(0, len)));\n                bytes = bytes.subarray(len);\n            }\n            const resBlocks = interleaveBytes(blocks);\n            const resECC = interleaveBytes(eccBlocks);\n            const res = new Uint8Array(resBlocks.length + resECC.length);\n            res.set(resBlocks);\n            res.set(resECC, resBlocks.length);\n            return res;\n        },\n        decode(data) {\n            if (data.length !== total)\n                throw new Error(`interleave.decode: len(data)=${data.length}, total=${total}`);\n            const blocks = [];\n            for (let i = 0; i < numBlocks; i++) {\n                const isShort = i < shortBlocks;\n                blocks.push(new Uint8Array(words + blockLen + (isShort ? 0 : 1)));\n            }\n            // Short blocks\n            let pos = 0;\n            for (let i = 0; i < blockLen; i++) {\n                for (let j = 0; j < numBlocks; j++)\n                    blocks[j][i] = data[pos++];\n            }\n            // Long blocks\n            for (let j = shortBlocks; j < numBlocks; j++)\n                blocks[j][blockLen] = data[pos++];\n            // ECC\n            for (let i = blockLen; i < blockLen + words; i++) {\n                for (let j = 0; j < numBlocks; j++) {\n                    const isShort = j < shortBlocks;\n                    blocks[j][i + (isShort ? 0 : 1)] = data[pos++];\n                }\n            }\n            // Decode\n            // Error-correct and copy data blocks together into a stream of bytes\n            const res = [];\n            for (const block of blocks)\n                res.push(...Array.from(rs.decode(block)).slice(0, -words));\n            return Uint8Array.from(res);\n        },\n    };\n}\n// Draw\n// Generic template per version+ecc+mask. Can be cached, to speedup calculations.\nfunction drawTemplate(ver, ecc, maskIdx, test = false) {\n    const size = info.size.encode(ver);\n    let b = new Bitmap(size + 2);\n    // Finder patterns\n    // We draw full pattern and later slice, since before addition of borders finder is truncated by one pixel on sides\n    const finder = new Bitmap(3).rect(0, 3, true).border(1, false).border(1, true).border(1, false);\n    b = b\n        .embed(0, finder) // top left\n        .embed({ x: -finder.width, y: 0 }, finder) // top right\n        .embed({ x: 0, y: -finder.height }, finder); // bottom left\n    b = b.rectSlice(1, size);\n    // Alignment patterns\n    const align = new Bitmap(1).rect(0, 1, true).border(1, false).border(1, true);\n    const alignPos = info.alignmentPatterns(ver);\n    for (const y of alignPos) {\n        for (const x of alignPos) {\n            if (b.data[y][x] !== undefined)\n                continue;\n            b.embed({ x: x - 2, y: y - 2 }, align); // center of pattern should be at position\n        }\n    }\n    // Timing patterns\n    b = b\n        .hLine({ x: 0, y: 6 }, Infinity, ({ x }, cur) => (cur === undefined ? x % 2 == 0 : cur))\n        .vLine({ x: 6, y: 0 }, Infinity, ({ y }, cur) => (cur === undefined ? y % 2 == 0 : cur));\n    // Format information\n    {\n        const bits = info.formatBits(ecc, maskIdx);\n        const getBit = (i) => !test && ((bits >> i) & 1) == 1;\n        // vertical\n        for (let i = 0; i < 6; i++)\n            b.data[i][8] = getBit(i); // right of top-left finder\n        // TODO: re-write as lines, like:\n        // b.vLine({ x: 8, y: 0 }, 6, ({ x, y }) => getBit(y));\n        for (let i = 6; i < 8; i++)\n            b.data[i + 1][8] = getBit(i); // after timing pattern\n        for (let i = 8; i < 15; i++)\n            b.data[size - 15 + i][8] = getBit(i); // right of bottom-left finder\n        // horizontal\n        for (let i = 0; i < 8; i++)\n            b.data[8][size - i - 1] = getBit(i); // under top-right finder\n        for (let i = 8; i < 9; i++)\n            b.data[8][15 - i - 1 + 1] = getBit(i); // VVV, after timing\n        for (let i = 9; i < 15; i++)\n            b.data[8][15 - i - 1] = getBit(i); // under top-left finder\n        b.data[size - 8][8] = !test; // bottom-left finder, right\n    }\n    // Version information\n    if (ver >= 7) {\n        const bits = info.versionBits(ver);\n        for (let i = 0; i < 18; i += 1) {\n            const bit = !test && ((bits >> i) & 1) == 1;\n            const x = Math.floor(i / 3);\n            const y = (i % 3) + size - 8 - 3;\n            // two copies\n            b.data[x][y] = bit;\n            b.data[y][x] = bit;\n        }\n    }\n    return b;\n}\n// zigzag: bottom->top && top->bottom\nfunction zigzag(tpl, maskIdx, fn) {\n    const size = tpl.height;\n    const pattern = PATTERNS[maskIdx];\n    // zig-zag pattern\n    let dir = -1;\n    let y = size - 1;\n    // two columns at time\n    for (let xOffset = size - 1; xOffset > 0; xOffset -= 2) {\n        if (xOffset == 6)\n            xOffset = 5; // skip vertical timing pattern\n        for (;; y += dir) {\n            for (let j = 0; j < 2; j += 1) {\n                const x = xOffset - j;\n                if (tpl.data[y][x] !== undefined)\n                    continue; // skip already written elements\n                fn(x, y, pattern(x, y));\n            }\n            if (y + dir < 0 || y + dir >= size)\n                break;\n        }\n        dir = -dir; // change direction\n    }\n}\n// NOTE: byte encoding is just representation, QR works with strings only. Most decoders will fail on raw byte array,\n// since they expect unicode or other text encoding inside bytes\nfunction detectType(str) {\n    let type = 'numeric';\n    for (let x of str) {\n        if (info.alphabet.numeric.has(x))\n            continue;\n        type = 'alphanumeric';\n        if (!info.alphabet.alphanumerc.has(x))\n            return 'byte';\n    }\n    return type;\n}\n/**\n * @example utf8ToBytes('abc') // new Uint8Array([97, 98, 99])\n */\nexport function utf8ToBytes(str) {\n    if (typeof str !== 'string')\n        throw new Error(`utf8ToBytes expected string, got ${typeof str}`);\n    return new Uint8Array(new TextEncoder().encode(str)); // https://bugzil.la/1681809\n}\nfunction encode(ver, ecc, data, type, encoder = utf8ToBytes) {\n    let encoded = '';\n    let dataLen = data.length;\n    if (type === 'numeric') {\n        const t = info.alphabet.numeric.decode(data.split(''));\n        const n = t.length;\n        for (let i = 0; i < n - 2; i += 3)\n            encoded += bin(t[i] * 100 + t[i + 1] * 10 + t[i + 2], 10);\n        if (n % 3 === 1) {\n            encoded += bin(t[n - 1], 4);\n        }\n        else if (n % 3 === 2) {\n            encoded += bin(t[n - 2] * 10 + t[n - 1], 7);\n        }\n    }\n    else if (type === 'alphanumeric') {\n        const t = info.alphabet.alphanumerc.decode(data.split(''));\n        const n = t.length;\n        for (let i = 0; i < n - 1; i += 2)\n            encoded += bin(t[i] * 45 + t[i + 1], 11);\n        if (n % 2 == 1)\n            encoded += bin(t[n - 1], 6); // pad if odd number of chars\n    }\n    else if (type === 'byte') {\n        const utf8 = encoder(data);\n        dataLen = utf8.length;\n        encoded = Array.from(utf8)\n            .map((i) => bin(i, 8))\n            .join('');\n    }\n    else {\n        throw new Error('encode: unsupported type');\n    }\n    const { capacity } = info.capacity(ver, ecc);\n    const len = bin(dataLen, info.lengthBits(ver, type));\n    let bits = info.modeBits[type] + len + encoded;\n    if (bits.length > capacity)\n        throw new Error('Capacity overflow');\n    // Terminator\n    bits += '0'.repeat(Math.min(4, Math.max(0, capacity - bits.length)));\n    // Pad bits string untill full byte\n    if (bits.length % 8)\n        bits += '0'.repeat(8 - (bits.length % 8));\n    // Add padding until capacity is full\n    const padding = '1110110000010001';\n    for (let idx = 0; bits.length !== capacity; idx++)\n        bits += padding[idx % padding.length];\n    // Convert a bitstring to array of bytes\n    const bytes = Uint8Array.from(bits.match(/(.{8})/g).map((i) => Number(`0b${i}`)));\n    return interleave(ver, ecc).encode(bytes);\n}\n// DRAW\nfunction drawQR(ver, ecc, data, maskIdx, test = false) {\n    const b = drawTemplate(ver, ecc, maskIdx, test);\n    let i = 0;\n    const need = 8 * data.length;\n    zigzag(b, maskIdx, (x, y, mask) => {\n        let value = false;\n        if (i < need) {\n            value = ((data[i >>> 3] >> ((7 - i) & 7)) & 1) !== 0;\n            i++;\n        }\n        b.data[y][x] = value !== mask; // !== as xor\n    });\n    if (i !== need)\n        throw new Error('QR: bytes left after draw');\n    return b;\n}\nfunction calculateRowRunPenalty(rowBits) {\n    const moduleCount = rowBits.length;\n    if (moduleCount <= 1)\n        return 0;\n    let penalty = 0;\n    let runLength = 1;\n    let previousColor = rowBits[0];\n    for (let i = 1; i < moduleCount; i++) {\n        const currentColor = rowBits[i];\n        if (currentColor === previousColor) {\n            runLength++;\n        }\n        else {\n            if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n                penalty += runLength - 2;\n            runLength = 1;\n            previousColor = currentColor;\n        }\n    }\n    if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n        penalty += runLength - 2;\n    return penalty;\n}\nfunction calculateColumnRunPenalty(bitmap, columnIndex, columnHeight) {\n    if (columnHeight <= 1)\n        return 0;\n    let penalty = 0;\n    let runLength = 1;\n    let previousColor = bitmap[0][columnIndex];\n    for (let y = 1; y < columnHeight; y++) {\n        const currentColor = bitmap[y][columnIndex];\n        if (currentColor === previousColor) {\n            runLength++;\n        }\n        else {\n            if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n                penalty += runLength - 2;\n            runLength = 1;\n            previousColor = currentColor;\n        }\n    }\n    if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n        penalty += runLength - 2;\n    return penalty;\n}\nfunction calculateRowFinderPenalty(rowBits) {\n    const rowLength = rowBits.length;\n    if (rowLength < R3_FINDER_PATTERN_LENGTH)\n        return 0;\n    let penalty = 0;\n    const lastStart = rowLength - R3_FINDER_PATTERN_LENGTH;\n    for (let i = 0; i <= lastStart; i++) {\n        // Case A: L L L L + 1 0 1 1 1 0 1\n        const light4ThenFinder7 = !rowBits[i] &&\n            !rowBits[i + 1] &&\n            !rowBits[i + 2] &&\n            !rowBits[i + 3] &&\n            rowBits[i + 4] &&\n            !rowBits[i + 5] &&\n            rowBits[i + 6] &&\n            rowBits[i + 7] &&\n            rowBits[i + 8] &&\n            !rowBits[i + 9] &&\n            rowBits[i + 10];\n        // Case B: 1 0 1 1 1 0 1 + L L L L\n        const finder7ThenLight4 = rowBits[i] &&\n            !rowBits[i + 1] &&\n            rowBits[i + 2] &&\n            rowBits[i + 3] &&\n            rowBits[i + 4] &&\n            !rowBits[i + 5] &&\n            rowBits[i + 6] &&\n            !rowBits[i + 7] &&\n            !rowBits[i + 8] &&\n            !rowBits[i + 9] &&\n            !rowBits[i + 10];\n        if (light4ThenFinder7 || finder7ThenLight4)\n            penalty += R3_FINDER_PENALTY;\n    }\n    return penalty;\n}\nfunction calculateColumnFinderPenalty(matrix, rowIndex, width) {\n    if (width < R3_FINDER_PATTERN_LENGTH)\n        return 0;\n    let penalty = 0;\n    const y = rowIndex;\n    const lastStart = width - R3_FINDER_PATTERN_LENGTH;\n    for (let x = 0; x <= lastStart; x++) {\n        // Case A: L L L L + 1 0 1 1 1 0 1\n        const light4ThenFinder7 = !matrix[x][y] &&\n            !matrix[x + 1][y] &&\n            !matrix[x + 2][y] &&\n            !matrix[x + 3][y] &&\n            matrix[x + 4][y] &&\n            !matrix[x + 5][y] &&\n            matrix[x + 6][y] &&\n            matrix[x + 7][y] &&\n            matrix[x + 8][y] &&\n            !matrix[x + 9][y] &&\n            matrix[x + 10][y];\n        // Case B: 1 0 1 1 1 0 1 + L L L L\n        const finder7ThenLight4 = matrix[x][y] &&\n            !matrix[x + 1][y] &&\n            matrix[x + 2][y] &&\n            matrix[x + 3][y] &&\n            matrix[x + 4][y] &&\n            !matrix[x + 5][y] &&\n            matrix[x + 6][y] &&\n            !matrix[x + 7][y] &&\n            !matrix[x + 8][y] &&\n            !matrix[x + 9][y] &&\n            !matrix[x + 10][y];\n        if (light4ThenFinder7 || finder7ThenLight4)\n            penalty += R3_FINDER_PENALTY;\n    }\n    return penalty;\n}\nfunction penalty(bitmap) {\n    const matrix = bitmap.data;\n    const width = bitmap.width | 0;\n    const height = bitmap.height | 0;\n    if (width === 0 || height === 0)\n        return 0;\n    // Rule 1: same-color runs\n    let runPenalty = 0;\n    for (let x = 0; x < width; x++)\n        runPenalty += calculateRowRunPenalty(matrix[x]);\n    for (let y = 0; y < height; y++)\n        runPenalty += calculateColumnRunPenalty(matrix, y, width);\n    // Rule 2: 22 blocks of the same color\n    let blockPenalty = 0;\n    const lastCol = width - 1;\n    const lastRow = height - 1;\n    for (let x = 0; x < lastCol; x++) {\n        const col = matrix[x];\n        const nextCol = matrix[x + 1];\n        for (let y = 0; y < lastRow; y++) {\n            const cell = col[y];\n            if (cell === nextCol[y] && cell === col[y + 1] && cell === nextCol[y + 1]) {\n                blockPenalty += R2_BLOCK_PENALTY;\n            }\n        }\n    }\n    // Rule 3: finder-like 1:1:3:1:1 with 4-light padding\n    let finderPenalty = 0;\n    for (let x = 0; x < width; x++)\n        finderPenalty += calculateRowFinderPenalty(matrix[x]);\n    for (let y = 0; y < height; y++)\n        finderPenalty += calculateColumnFinderPenalty(matrix, y, width);\n    // Rule 4: dark-module balance vs 50%\n    let darkCount = 0;\n    for (let x = 0; x < width; x++) {\n        const col = matrix[x];\n        for (let y = 0; y < height; y++)\n            if (col[y])\n                darkCount++;\n    }\n    const moduleCount = width * height;\n    const darkPercent = (darkCount * 100) / moduleCount;\n    const deviation = Math.abs(darkPercent - 50);\n    const balancePenalty = R4_BALANCE_STEP_POINTS * Math.floor(deviation / R4_BALANCE_STEP_PERCENT);\n    return runPenalty + blockPenalty + finderPenalty + balancePenalty;\n}\n// Selects best mask according to penalty, if no mask is provided\nfunction drawQRBest(ver, ecc, data, maskIdx) {\n    if (maskIdx === undefined) {\n        const bestMask = best();\n        for (let mask = 0; mask < PATTERNS.length; mask++)\n            bestMask.add(penalty(drawQR(ver, ecc, data, mask, true)), mask);\n        maskIdx = bestMask.get();\n    }\n    if (maskIdx === undefined)\n        throw new Error('Cannot find mask'); // Should never happen\n    return drawQR(ver, ecc, data, maskIdx);\n}\nfunction validateECC(ec) {\n    if (!ECMode.includes(ec))\n        throw new Error(`Invalid error correction mode=${ec}. Expected: ${ECMode}`);\n}\nfunction validateEncoding(enc) {\n    if (!Encoding.includes(enc))\n        throw new Error(`Encoding: invalid mode=${enc}. Expected: ${Encoding}`);\n    if (enc === 'kanji' || enc === 'eci')\n        throw new Error(`Encoding: ${enc} is not supported (yet?).`);\n}\nfunction validateMask(mask) {\n    if (![0, 1, 2, 3, 4, 5, 6, 7].includes(mask) || !PATTERNS[mask])\n        throw new Error(`Invalid mask=${mask}. Expected number [0..7]`);\n}\nexport function encodeQR(text, output = 'raw', opts = {}) {\n    const ecc = opts.ecc !== undefined ? opts.ecc : 'medium';\n    validateECC(ecc);\n    const encoding = opts.encoding !== undefined ? opts.encoding : detectType(text);\n    validateEncoding(encoding);\n    if (opts.mask !== undefined)\n        validateMask(opts.mask);\n    let ver = opts.version;\n    let data, err = new Error('Unknown error');\n    if (ver !== undefined) {\n        validateVersion(ver);\n        data = encode(ver, ecc, text, encoding, opts.textEncoder);\n    }\n    else {\n        // If no version is provided, try to find smallest one which fits\n        // Currently just scans all version, can be significantly speedup if needed\n        for (let i = 1; i <= 40; i++) {\n            try {\n                data = encode(i, ecc, text, encoding, opts.textEncoder);\n                ver = i;\n                break;\n            }\n            catch (e) {\n                err = e;\n            }\n        }\n    }\n    if (!ver || !data)\n        throw err;\n    let res = drawQRBest(ver, ecc, data, opts.mask);\n    res.assertDrawn();\n    const border = opts.border === undefined ? 2 : opts.border;\n    if (!Number.isSafeInteger(border))\n        throw new Error(`invalid border type=${typeof border}`);\n    res = res.border(border, false); // Add border\n    if (opts.scale !== undefined)\n        res = res.scale(opts.scale); // Scale image\n    if (output === 'raw')\n        return res.data;\n    else if (output === 'ascii')\n        return res.toASCII();\n    else if (output === 'svg')\n        return res.toSVG(opts.optimize);\n    else if (output === 'gif')\n        return res.toGIF();\n    else if (output === 'term')\n        return res.toTerm();\n    else\n        throw new Error(`Unknown output: ${output}`);\n}\nexport default encodeQR;\nexport const utils = {\n    best,\n    bin,\n    drawTemplate,\n    fillArr,\n    info,\n    interleave,\n    validateVersion,\n    zigzag,\n};\n// Unsafe API utils, exported only for tests\nexport const _tests = {\n    Bitmap,\n    info,\n    detectType,\n    encode,\n    drawQR,\n    penalty,\n    PATTERNS,\n};\n// Type tests\n// const o1 = qr('test', 'ascii');\n// const o2 = qr('test', 'raw');\n// const o3 = qr('test', 'gif');\n// const o4 = qr('test', 'svg');\n// const o5 = qr('test', 'term');\n//# sourceMappingURL=index.js.map","import './qr-code.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport encodeQR from 'qr';\n\nconst canvas = window.OffscreenCanvas\n  ? new OffscreenCanvas(1, 1)\n  : document.createElement('canvas');\nconst ctx = canvas.getContext('2d', {\n  willReadFrequently: true,\n});\nctx.imageSmoothingEnabled = false;\n\nexport default function QrCode({\n  text,\n  arena,\n  backgroundMask,\n  arenaCircle = true,\n  caption,\n}) {\n  const captionRef = useRef(null);\n  const [captionHeight, setCaptionHeight] = useState(0);\n  const [arenaLoaded, setArenaLoaded] = useState(false);\n  const [arenaHasAlpha, setArenaHasAlpha] = useState(false);\n\n  const effectiveArenaCircle = arenaHasAlpha ? false : arenaCircle;\n\n  useEffect(() => {\n    if (caption && captionRef.current) {\n      const height = captionRef.current.offsetHeight;\n      setCaptionHeight(height);\n    }\n  }, [caption]);\n\n  useEffect(() => {\n    if (arena) {\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onload = () => {\n        setArenaLoaded(true);\n        try {\n          const { width, height } = img;\n          canvas.width = width;\n          canvas.height = height;\n          ctx.drawImage(img, 0, 0);\n          const allPixels = ctx.getImageData(0, 0, width, height);\n          const data = allPixels.data;\n          const totalPixels = data.length / 4;\n          let lowAlphaCount = 0;\n          let hasAlpha = false;\n          for (let i = 3; i < data.length; i += 4) {\n            if (data[i] <= 128) lowAlphaCount++;\n            if (lowAlphaCount / totalPixels > 0.1) {\n              hasAlpha = true;\n              break;\n            }\n          }\n          setArenaHasAlpha(hasAlpha);\n        } catch (e) {\n          setArenaHasAlpha(false);\n        }\n      };\n      img.onerror = (error) => {\n        console.error('Failed to load arena image:', error);\n        setArenaLoaded(true); // Still show the image even on CORS error\n      };\n      img.src = arena;\n    } else {\n      setArenaLoaded(false);\n    }\n  }, [arena]);\n\n  if (!text) return null;\n\n  const qrData = useMemo(\n    () =>\n      encodeQR(text, 'raw', {\n        ecc: 'high',\n        border: 0,\n        scale: 1,\n      }),\n    [text],\n  );\n  const gridSize = qrData.length;\n\n  const centerExcludeSize = arenaLoaded ? Math.ceil(gridSize * 0.3) : 0;\n  const centerStart = Math.floor((gridSize - centerExcludeSize) / 2);\n  const centerEnd = centerStart + centerExcludeSize;\n\n  const isFilled = (x, y) => {\n    if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) return false;\n\n    if (\n      arenaLoaded &&\n      x >= centerStart &&\n      x < centerEnd &&\n      y >= centerStart &&\n      y < centerEnd\n    ) {\n      if (arenaCircle) {\n        const centerX = (centerStart + centerEnd) / 2;\n        const centerY = (centerStart + centerEnd) / 2;\n        const radius = centerExcludeSize / 2;\n        const dx = x + 0.5 - centerX;\n        const dy = y + 0.5 - centerY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        if (distance < radius) return false;\n      } else {\n        return false;\n      }\n    }\n\n    return qrData[y][x];\n  };\n\n  const isFilledInGrid = (x, y) => {\n    if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) return false;\n    return isFilled(x, y);\n  };\n\n  const isInPositionMarker = (x, y) => {\n    if (x < 7 && y < 7) return true;\n    if (x >= gridSize - 7 && y < 7) return true;\n    if (x < 7 && y >= gridSize - 7) return true;\n    return false;\n  };\n\n  const pathData = useMemo(() => {\n    let data = '';\n\n    for (let y = 0; y < gridSize; y++) {\n      for (let x = 0; x < gridSize; x++) {\n        if (!isFilledInGrid(x, y)) continue;\n        if (isInPositionMarker(x, y)) continue;\n\n        const cx = x + 0.5;\n        const cy = y + 0.5;\n        const hasTop =\n          isFilledInGrid(x, y - 1) && !isInPositionMarker(x, y - 1);\n        const hasRight =\n          isFilledInGrid(x + 1, y) && !isInPositionMarker(x + 1, y);\n        const hasBottom =\n          isFilledInGrid(x, y + 1) && !isInPositionMarker(x, y + 1);\n        const hasLeft =\n          isFilledInGrid(x - 1, y) && !isInPositionMarker(x - 1, y);\n\n        if (hasRight) {\n          data += `M ${cx} ${cy} L ${cx + 1} ${cy} `;\n        }\n        if (hasBottom) {\n          data += `M ${cx} ${cy} L ${cx} ${cy + 1} `;\n        }\n        if (!hasTop && !hasRight && !hasBottom && !hasLeft) {\n          data += `M ${cx} ${cy} L ${cx} ${cy} `;\n        }\n      }\n    }\n\n    return data;\n  }, [\n    gridSize,\n    qrData,\n    arenaLoaded,\n    centerStart,\n    centerEnd,\n    centerExcludeSize,\n    effectiveArenaCircle,\n  ]);\n\n  const markerPositions = [\n    { x: 0, y: 0 }, // Top-left\n    { x: gridSize - 7, y: 0 }, // Top-right\n    { x: 0, y: gridSize - 7 }, // Bottom-left\n  ];\n\n  const markerOuterRadius = 1.1; // Outer 7x7 square corner radius\n  const markerInnerRadius = 0.6; // Inner 3x3 square corner radius\n\n  const centerImagePadding = 1; // 1 cell width padding around the image\n  const centerImageSize = centerExcludeSize - centerImagePadding * 2;\n  const centerImageX = centerStart + centerImagePadding;\n  const centerImageY = centerStart + centerImagePadding;\n  const padding = 2;\n  const captionSpacing = 2; // Space between QR code and caption\n\n  const viewBoxWidth = gridSize + padding * 2;\n  const viewBoxHeight =\n    gridSize + padding * 2 + (caption ? captionSpacing + captionHeight : 0);\n  const bleed = viewBoxWidth * 0.25;\n\n  return (\n    <svg\n      class=\"qr-code\"\n      viewBox={`${-padding} ${-padding} ${viewBoxWidth} ${viewBoxHeight}`}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      shape-rendering=\"geometricPrecision\"\n    >\n      <defs>\n        <g id=\"position-marker\">\n          <rect\n            x=\"0.5\"\n            y=\"0.5\"\n            width=\"6\"\n            height=\"6\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            stroke-width=\"1\"\n            rx={markerOuterRadius}\n            ry={markerOuterRadius}\n          />\n          <rect\n            x=\"2\"\n            y=\"2\"\n            width=\"3\"\n            height=\"3\"\n            fill=\"currentColor\"\n            rx={markerInnerRadius}\n            ry={markerInnerRadius}\n          />\n        </g>\n        <g id=\"position-marker-mask\">\n          <rect\n            x=\"0.5\"\n            y=\"0.5\"\n            width=\"6\"\n            height=\"6\"\n            fill=\"none\"\n            stroke=\"white\"\n            stroke-width=\"1\"\n            rx={markerOuterRadius}\n            ry={markerOuterRadius}\n          />\n          <rect\n            x=\"2\"\n            y=\"2\"\n            width=\"3\"\n            height=\"3\"\n            fill=\"white\"\n            rx={markerInnerRadius}\n            ry={markerInnerRadius}\n          />\n        </g>\n        {backgroundMask && (\n          <filter id=\"blur-mask\">\n            <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" />\n            <feColorMatrix type=\"saturate\" values=\"2\" />\n            <feComponentTransfer>\n              <feFuncR type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n              <feFuncG type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n              <feFuncB type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n            </feComponentTransfer>\n          </filter>\n        )}\n        {backgroundMask && (\n          <mask id=\"qr-pattern-mask\">\n            <path\n              fill=\"white\"\n              stroke=\"white\"\n              stroke-width=\"1\"\n              stroke-linejoin=\"round\"\n              stroke-linecap=\"round\"\n              d={pathData}\n            />\n            <g id=\"position-markers-mask\">\n              {markerPositions.map((pos) => (\n                <use\n                  key={`${pos.x}-${pos.y}`}\n                  href=\"#position-marker-mask\"\n                  x={pos.x}\n                  y={pos.y}\n                />\n              ))}\n            </g>\n            {arenaLoaded && effectiveArenaCircle && (\n              <circle\n                cx={centerImageX + centerImageSize / 2}\n                cy={centerImageY + centerImageSize / 2}\n                r={centerImageSize / 2}\n                fill=\"black\"\n              />\n            )}\n            {arenaLoaded && !arenaCircle && (\n              <rect\n                x={centerImageX}\n                y={centerImageY}\n                width={centerImageSize}\n                height={centerImageSize}\n                fill=\"black\"\n              />\n            )}\n          </mask>\n        )}\n        <path\n          id=\"qr-pattern\"\n          fill=\"currentColor\"\n          stroke=\"currentColor\"\n          stroke-width=\"1\"\n          stroke-linejoin=\"round\"\n          stroke-linecap=\"round\"\n          d={pathData}\n        />\n      </defs>\n      <use href=\"#qr-pattern\" />\n      <g id=\"position-markers\">\n        {markerPositions.map((pos) => (\n          <use\n            key={`${pos.x}-${pos.y}`}\n            href=\"#position-marker\"\n            x={pos.x}\n            y={pos.y}\n          />\n        ))}\n      </g>\n      {backgroundMask && (\n        <g mask=\"url(#qr-pattern-mask)\">\n          <image\n            href={backgroundMask}\n            x={-padding - bleed}\n            y={-padding - bleed}\n            width={viewBoxWidth + bleed * 2}\n            height={viewBoxWidth + bleed * 2}\n            preserveAspectRatio=\"none\"\n            opacity=\"0.5\"\n            filter=\"url(#blur-mask)\"\n          />\n        </g>\n      )}\n      {arena && arenaLoaded && (\n        <image\n          href={arena}\n          x={centerImageX}\n          y={centerImageY}\n          width={centerImageSize}\n          height={centerImageSize}\n          preserveAspectRatio=\"xMidYMid slice\"\n          clip-path={\n            effectiveArenaCircle\n              ? `circle(${centerImageSize / 2}px at ${centerImageSize / 2}px ${centerImageSize / 2}px)`\n              : undefined\n          }\n        />\n      )}\n      {caption && (\n        <foreignObject\n          x={0}\n          y={gridSize + captionSpacing}\n          width={gridSize}\n          height={captionHeight}\n        >\n          <div\n            ref={captionRef}\n            xmlns=\"http://www.w3.org/1999/xhtml\"\n            class=\"qr-code-caption\"\n            dangerouslySetInnerHTML={{ __html: caption }}\n          />\n        </foreignObject>\n      )}\n    </svg>\n  );\n}\n","import './qr-code-modal.css';\n\nimport { useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\nimport QrCode from './qr-code';\n\nexport const mediaDevicesSupported = !!navigator.mediaDevices?.getUserMedia;\n\nfunction QrCodeModal({\n  text,\n  arena,\n  backgroundMask,\n  caption,\n  onClose,\n  onScannerClick,\n}) {\n  const { t } = useLingui();\n  console.log('onScannerClick', onScannerClick);\n\n  return (\n    <div class=\"qr-code-modal-container\">\n      <div class=\"qr-code-modal-controls\">\n        {mediaDevicesSupported && typeof onScannerClick === 'function' ? (\n          <button type=\"button\" class=\"plain4\" onClick={onScannerClick}>\n            <Icon icon=\"scan\" alt={t`Scan QR code`} />\n          </button>\n        ) : (\n          <span />\n        )}\n        {!!onClose && (\n          <button type=\"button\" class=\"plain4\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n        )}\n      </div>\n      <QrCode\n        text={text}\n        arena={arena}\n        backgroundMask={backgroundMask}\n        caption={caption}\n      />\n      <div class=\"qr-code-text\">{text}</div>\n    </div>\n  );\n}\n\nexport default QrCodeModal;\n","import './qr-scanner-modal.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nconst hasBarcodeDetector = 'BarcodeDetector' in window;\n\nif (!hasBarcodeDetector) {\n  // Prefetch qr/dom.js for caching\n  setTimeout(() => {\n    import('qr/dom.js').catch(() => {});\n  }, 1000);\n}\n\nimport Icon from './icon';\nimport Loader from './loader';\n\n// Copied from qr/dom.js because it's not exported\nclass QRCamera {\n  constructor(stream, player) {\n    this.stream = stream;\n    this.player = player;\n    this.setStream(stream);\n  }\n  setStream(stream) {\n    this.stream = stream;\n    const { player } = this;\n    player.setAttribute('autoplay', '');\n    player.setAttribute('muted', '');\n    player.setAttribute('playsinline', '');\n    player.srcObject = stream;\n  }\n  async listDevices() {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n      throw new Error('Media Devices not supported');\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    return devices\n      .filter((device) => device.kind === 'videoinput')\n      .map((i) => ({\n        deviceId: i.deviceId,\n        label: i.label || `Camera ${i.deviceId}`,\n      }));\n  }\n  async setDevice(deviceId) {\n    this.stop();\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: { deviceId: { exact: deviceId } },\n    });\n    this.setStream(stream);\n  }\n  readFrame(canvas, fullSize = false) {\n    const { player } = this;\n    if (fullSize)\n      return canvas.drawImage(player, player.videoHeight, player.videoWidth);\n    const size = getSize(player);\n    return canvas.drawImage(player, size.height, size.width);\n  }\n  stop() {\n    for (const track of this.stream.getTracks()) track.stop();\n  }\n}\n\n// Copy of frontalCamera from qr/dom.js, but with custom constraints\nconst createQRCamera = async (player) => {\n  if (navigator.permissions?.query) {\n    try {\n      const permission = await navigator.permissions.query({\n        name: 'camera',\n      });\n      console.log('Camera permission status:', permission.state);\n\n      permission.addEventListener('change', () => {\n        console.log('Camera permission changed to:', permission.state);\n      });\n    } catch (err) {\n      console.warn('Permissions API camera query not supported:', err);\n    }\n  }\n\n  const stream = await navigator.mediaDevices.getUserMedia({\n    video: {\n      height: { ideal: 720 },\n      width: { ideal: 1280 },\n      facingMode: 'environment',\n    },\n  });\n  return new QRCamera(stream, player);\n};\n\nfunction QrScannerModal({ onClose, checkValidity, actionableText }) {\n  const { t, _ } = useLingui();\n  const containerRef = useRef(null);\n  const videoRef = useRef(null);\n  const overlayRef = useRef(null);\n  const [decodedText, setDecodedText] = useState('');\n  const [isScanning, setIsScanning] = useState(true);\n  const [uiState, setUIState] = useState('loading');\n\n  // Based on screen, not viewport or window\n  useEffect(() => {\n    // portrait as default\n    let handleScreenOrientationChange;\n    if (screen?.orientation?.type && containerRef.current) {\n      handleScreenOrientationChange = () => {\n        const screenOrientation = /landscape/.test(\n          window.screen.orientation.type,\n        )\n          ? 'landscape'\n          : 'portrait';\n        containerRef.current.classList.toggle(\n          'landscape',\n          screenOrientation === 'landscape',\n        );\n      };\n\n      screen.orientation.addEventListener(\n        'change',\n        handleScreenOrientationChange,\n      );\n      handleScreenOrientationChange();\n    }\n    return () => {\n      if (\n        handleScreenOrientationChange &&\n        screen?.orientation?.removeEventListener\n      ) {\n        screen.orientation.removeEventListener(\n          'change',\n          handleScreenOrientationChange,\n        );\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let cancelMainLoop;\n    let cam;\n    let qrCanvas;\n    let detector;\n    let qrDom;\n\n    const startCamera = async () => {\n      try {\n        cam = await createQRCamera(videoRef.current);\n\n        if (hasBarcodeDetector) {\n          detector = new BarcodeDetector({ formats: ['qr_code'] });\n        } else {\n          qrDom = await import('qr/dom.js');\n          qrCanvas = new qrDom.QRCanvas(\n            {\n              overlay: overlayRef.current,\n            },\n            {\n              cropToSquare: false,\n              overlayMainColor: 'transparent',\n              overlayFinderColor: 'rgba(255, 0, 255, 0.5)',\n            },\n          );\n        }\n\n        // Start scanning loop when video plays (following demo pattern)\n        const video = videoRef.current;\n        if (video) {\n          video.addEventListener('loadedmetadata', () => {\n            setUIState('default');\n          });\n          video.addEventListener('play', () => {\n            // We won't have correct size until video starts playing\n            console.log('Video started playing, beginning scan loop');\n\n            // Get width, height from video\n            const { videoWidth: width, videoHeight: height } = video;\n\n            console.log('', { cam, video });\n\n            if (width && height) {\n              containerRef.current.style.setProperty(\n                '--long-dimension',\n                Math.max(width, height),\n              );\n              containerRef.current.style.setProperty(\n                '--short-dimension',\n                Math.min(width, height),\n              );\n            }\n\n            if (hasBarcodeDetector) {\n              const mainLoop = async () => {\n                try {\n                  const results = await detector.detect(videoRef.current);\n                  if (results.length > 0) {\n                    console.log('Scan result:', results[0].rawValue);\n                    setDecodedText(results[0].rawValue);\n                  }\n                } catch (e) {\n                  console.error('Error in barcode detection:', e);\n                }\n              };\n\n              let animationId;\n              const rafLoop = () => {\n                mainLoop();\n                animationId = requestAnimationFrame(rafLoop);\n              };\n              rafLoop();\n              cancelMainLoop = () => cancelAnimationFrame(animationId);\n            } else {\n              const mainLoop = () => {\n                try {\n                  const result = cam.readFrame(qrCanvas, true);\n                  if (result !== undefined && result !== null) {\n                    console.log('Scan result:', result);\n                    setDecodedText(result);\n                  }\n                } catch (e) {\n                  console.error('Error in scan loop:', e);\n                }\n              };\n\n              cancelMainLoop = qrDom.frameLoop(mainLoop);\n            }\n          });\n        }\n      } catch (err) {\n        console.error('Error accessing camera:', err);\n        setUIState('error');\n        setIsScanning(false);\n      }\n    };\n\n    if (isScanning) {\n      startCamera();\n    }\n\n    return () => {\n      if (cancelMainLoop) cancelMainLoop();\n      if (cam) {\n        cam.stop();\n      }\n      if (qrCanvas) {\n        qrCanvas.clear();\n      }\n    };\n  }, [isScanning]);\n\n  const showActionableButton =\n    typeof checkValidity === 'function'\n      ? checkValidity(decodedText)\n      : !!decodedText;\n\n  return (\n    <div class=\"qr-scanner-modal\">\n      <div class=\"qr-scanner-header\">\n        <Loader abrupt hidden={uiState !== 'loading'} />\n        <button type=\"button\" class=\"plain4\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      </div>\n      {uiState === 'error' ? (\n        <div class=\"ui-state\">\n          <p>\n            <Trans>Unable to access camera. Please check permissions.</Trans>\n          </p>\n        </div>\n      ) : (\n        <>\n          <div ref={containerRef} class=\"qr-scanner-video-container\">\n            <video ref={videoRef} playsInline muted disablepictureinpicture />\n            {!hasBarcodeDetector && (\n              <canvas ref={overlayRef} class=\"qr-scanner-canvas\" />\n            )}\n            <svg\n              class=\"qr-scanner-corner-hint\"\n              viewBox=\"0 0 100 100\"\n              preserveAspectRatio=\"xMidYMid meet\"\n            >\n              <path\n                d=\"M 25 10 L 15 10 Q 10 10 10 15 L 10 25\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 75 10 L 85 10 Q 90 10 90 15 L 90 25\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 25 90 L 15 90 Q 10 90 10 85 L 10 75\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 75 90 L 85 90 Q 90 90 90 85 L 90 75\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n            </svg>\n          </div>\n          <div class=\"qr-scanner-result\">\n            {!!decodedText && (\n              <>\n                <p class=\"qr-scanner-text\">{decodedText}</p>\n                {showActionableButton && (\n                  <button\n                    type=\"button\"\n                    class=\"button plain6\"\n                    onClick={() => {\n                      onClose({ text: decodedText });\n                    }}\n                  >\n                    {actionableText ? (\n                      _(actionableText)\n                    ) : (\n                      <Icon icon=\"arrow-right\" />\n                    )}\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default QrScannerModal;\n","import './report-modal.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { useMemo, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport localeMatch from '../utils/locale-match';\nimport showToast from '../utils/show-toast';\nimport { getCurrentInstance } from '../utils/store-utils';\n\nimport AccountBlock from './account-block';\nimport Icon from './icon';\nimport Loader from './loader';\nimport Status from './status';\n\n// NOTE: `dislike` hidden for now, it's actually not used for reporting\n// Mastodon shows another screen for unfollowing, muting or blocking instead of reporting\n\nconst CATEGORIES = [/*'dislike' ,*/ 'spam', 'legal', 'violation', 'other'];\n// `violation` will be set if there are `rule_ids[]`\n\nconst CATEGORIES_INFO = {\n  // dislike: {\n  //   label: 'Dislike',\n  //   description: 'Not something you want to see',\n  // },\n  spam: {\n    label: msg`Spam`,\n    description: msg`Malicious links, fake engagement, or repetitive replies`,\n  },\n  legal: {\n    label: msg`Illegal`,\n    description: msg`Violates the law of your or the server's country`,\n  },\n  violation: {\n    label: msg`Server rule violation`,\n    description: msg`Breaks specific server rules`,\n    stampLabel: msg`Violation`,\n  },\n  other: {\n    label: msg`Other`,\n    description: msg`Issue doesn't fit other categories`,\n    excludeStamp: true,\n  },\n};\n\nfunction findMatchingLanguage(rule, currentLang) {\n  if (!rule.translations || !currentLang) return null;\n  const availableLanguages = Object.keys(rule.translations);\n  if (!availableLanguages?.length) return null;\n\n  let matchedLang = localeMatch([currentLang], availableLanguages, null);\n  if (!matchedLang) {\n    // localeMatch fails if there are keys like zhCn, zhTw\n    // Convert them something like zh-CN first, try again\n    // Detect uppercase, then split by dash\n    const normalizedLanguages = availableLanguages.map((lang) => {\n      const parts = lang.split(/(?=[A-Z])/);\n      return parts\n        .map((part, i) => (i === 0 ? part : part.toLowerCase()))\n        .join('-');\n    });\n    matchedLang = localeMatch([currentLang], normalizedLanguages, null);\n  }\n\n  // If matchedLang has dash, convert back to original format\n  // E.g. zh-cn to zhCn\n  if (matchedLang && matchedLang.includes('-')) {\n    const [lang, region] = matchedLang.split('-');\n    matchedLang = lang + region.charAt(0).toUpperCase() + region.slice(1);\n  }\n\n  return matchedLang;\n}\n\nfunction translateRules(rules, currentLang) {\n  if (!rules?.length) return [];\n  if (!currentLang) return rules;\n  return rules.map((rule) => {\n    const matchedLang = findMatchingLanguage(rule, currentLang);\n    return {\n      ...rule,\n      _translatedText: rule.translations?.[matchedLang]?.text || null,\n    };\n  });\n}\n\nfunction ReportModal({ account, post, onClose }) {\n  const { _, t, i18n } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [username, domain] = account.acct.split('@');\n\n  const [translatedRules, currentDomain] = useMemo(() => {\n    const { rules, domain } = getCurrentInstance();\n    const rawRules = rules || [];\n    return [translateRules(rawRules, i18n.locale), domain];\n  }, [i18n.locale]);\n\n  const [selectedCategory, setSelectedCategory] = useState(null);\n  const [showRules, setShowRules] = useState(false);\n\n  const rulesRef = useRef(null);\n  const [hasRules, setHasRules] = useState(false);\n\n  return (\n    <div class=\"report-modal-container\">\n      <div class=\"top-controls\">\n        <h1>{post ? t`Report Post` : t`Report @${username}`}</h1>\n        <button\n          type=\"button\"\n          class=\"plain4 small\"\n          disabled={uiState === 'loading'}\n          onClick={() => onClose()}\n        >\n          <Icon icon=\"x\" size=\"xl\" alt={t`Close`} />\n        </button>\n      </div>\n      <main>\n        <div class=\"report-preview\">\n          {post ? (\n            <Status status={post} size=\"s\" previewMode />\n          ) : (\n            <AccountBlock\n              account={account}\n              avatarSize=\"xxl\"\n              useAvatarStatic\n              showStats\n              showActivity\n            />\n          )}\n        </div>\n        {!!selectedCategory &&\n          !CATEGORIES_INFO[selectedCategory].excludeStamp && (\n            <span\n              class=\"rubber-stamp\"\n              key={selectedCategory}\n              aria-hidden=\"true\"\n            >\n              {_(\n                CATEGORIES_INFO[selectedCategory].stampLabel ||\n                  _(CATEGORIES_INFO[selectedCategory].label),\n              )}\n              <small>\n                <Trans>Pending review</Trans>\n              </small>\n            </span>\n          )}\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n\n            const formData = new FormData(e.target);\n            const entries = Object.fromEntries(formData.entries());\n            console.log('ENTRIES', entries);\n\n            let { category, comment, forward } = entries;\n            if (!comment) comment = undefined;\n            if (forward === 'on') forward = true;\n            const ruleIds =\n              category === 'violation'\n                ? Object.entries(entries)\n                    .filter(([key]) => key.startsWith('rule_ids'))\n                    .map(([key, value]) => value)\n                : undefined;\n\n            const params = {\n              category,\n              comment,\n              forward,\n              ruleIds,\n            };\n            console.log('PARAMS', params);\n\n            setUIState('loading');\n            (async () => {\n              try {\n                await masto.v1.reports.create({\n                  accountId: account.id,\n                  statusIds: post?.id ? [post.id] : undefined,\n                  category,\n                  comment,\n                  ruleIds,\n                  forward,\n                });\n                setUIState('success');\n                showToast(post ? t`Post reported` : t`Profile reported`);\n                onClose();\n              } catch (error) {\n                console.error(error);\n                setUIState('error');\n                showToast(\n                  error?.message ||\n                    (post\n                      ? t`Unable to report post`\n                      : t`Unable to report profile`),\n                );\n              }\n            })();\n          }}\n        >\n          <p>\n            {post\n              ? t`What's the issue with this post?`\n              : t`What's the issue with this profile?`}\n          </p>\n          <section class=\"report-categories\">\n            {CATEGORIES.map((category) =>\n              category === 'violation' && !translatedRules?.length ? null : (\n                <Fragment key={category}>\n                  <label class=\"report-category\">\n                    <input\n                      type=\"radio\"\n                      name=\"category\"\n                      value={category}\n                      required\n                      disabled={uiState === 'loading'}\n                      onChange={(e) => {\n                        setSelectedCategory(e.target.value);\n                        setShowRules(e.target.value === 'violation');\n                      }}\n                    />\n                    <span>\n                      {_(CATEGORIES_INFO[category].label)} &nbsp;\n                      <small class=\"ib insignificant\">\n                        {_(CATEGORIES_INFO[category].description)}\n                      </small>\n                    </span>\n                  </label>\n                  {category === 'violation' && !!translatedRules?.length && (\n                    <div\n                      class=\"shazam-container no-animation\"\n                      hidden={!showRules}\n                    >\n                      <div class=\"shazam-container-inner\">\n                        <div class=\"report-rules\" ref={rulesRef}>\n                          {translatedRules.map((rule, i) => (\n                            <label class=\"report-rule\" key={rule.id}>\n                              <input\n                                type=\"checkbox\"\n                                name={`rule_ids[${i}]`}\n                                value={rule.id}\n                                required={showRules && !hasRules}\n                                disabled={uiState === 'loading'}\n                                onChange={(e) => {\n                                  const { checked } = e.target;\n                                  if (checked) {\n                                    setHasRules(true);\n                                  } else {\n                                    const checkedInputs =\n                                      rulesRef.current.querySelectorAll(\n                                        'input:checked',\n                                      );\n                                    if (!checkedInputs.length) {\n                                      setHasRules(false);\n                                    }\n                                  }\n                                }}\n                              />\n                              <span>{rule._translatedText || rule.text}</span>\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </Fragment>\n              ),\n            )}\n          </section>\n          <section class=\"report-comment\">\n            <p>\n              <label for=\"report-comment\">\n                <Trans>Additional info</Trans>\n              </label>\n            </p>\n            <textarea\n              maxlength=\"1000\"\n              rows=\"1\"\n              name=\"comment\"\n              id=\"report-comment\"\n              disabled={uiState === 'loading'}\n              required={!post} // Required if not reporting a post\n            />\n          </section>\n          {!!domain && domain !== currentDomain && (\n            <section>\n              <p>\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    switch\n                    name=\"forward\"\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <span>\n                    <Trans>\n                      Forward to <i>{domain}</i>\n                    </Trans>\n                  </span>\n                </label>\n              </p>\n            </section>\n          )}\n          <footer>\n            <button type=\"submit\" disabled={uiState === 'loading'}>\n              <Trans>Send Report</Trans>\n            </button>{' '}\n            <button\n              type=\"submit\"\n              class=\"plain2\"\n              disabled={uiState === 'loading'}\n              onClick={async () => {\n                try {\n                  await masto.v1.accounts.$select(account.id).mute(); // Infinite duration\n                  showToast(t`Muted ${username}`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to mute ${username}`);\n                }\n                // onSubmit will still run\n              }}\n            >\n              <Trans>\n                Send Report <small class=\"ib\">+ Mute profile</small>\n              </Trans>\n            </button>{' '}\n            <button\n              type=\"submit\"\n              class=\"plain2\"\n              disabled={uiState === 'loading'}\n              onClick={async () => {\n                try {\n                  await masto.v1.accounts.$select(account.id).block();\n                  showToast(t`Blocked ${username}`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to block ${username}`);\n                }\n                // onSubmit will still run\n              }}\n            >\n              <Trans>\n                Send Report <small class=\"ib\">+ Block profile</small>\n              </Trans>\n            </button>\n            <Loader hidden={uiState !== 'loading'} />\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default ReportModal;\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.5\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n} else if( typeof angular !== 'undefined' && angular != null ) {\n  angular.module('LZString', [])\n  .factory('LZString', function () {\n    return LZString;\n  });\n}\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e\"","import { api } from '../utils/api';\nimport store from '../utils/store';\n\nconst LIMIT = 200;\nconst MAX_FETCH = 10;\n\nexport async function fetchFollowedTags() {\n  const { masto } = api();\n  const iterator = masto.v1.followedTags\n    .list({\n      limit: LIMIT,\n    })\n    .values();\n  const tags = [];\n  let fetchCount = 0;\n  do {\n    const { value, done } = await iterator.next();\n    if (done || value?.length === 0) break;\n    tags.push(...value);\n    fetchCount++;\n  } while (fetchCount < MAX_FETCH);\n  tags.sort((a, b) => a.name.localeCompare(b.name));\n  console.log(tags);\n\n  if (tags.length) {\n    setTimeout(() => {\n      // Save to local storage, with saved timestamp\n      store.account.set('followedTags', {\n        tags,\n        updatedAt: Date.now(),\n      });\n    }, 1);\n  }\n\n  return tags;\n}\n\nconst MAX_AGE = 24 * 60 * 60 * 1000; // 1 day\nexport async function getFollowedTags() {\n  try {\n    const { tags, updatedAt } = store.account.get('followedTags') || {};\n    if (!tags?.length) return await fetchFollowedTags();\n    if (Date.now() - updatedAt > MAX_AGE) {\n      // Stale-while-revalidate\n      fetchFollowedTags();\n      return tags;\n    }\n    return tags;\n  } catch (e) {\n    return [];\n  }\n}\n\nconst fauxDiv = document.createElement('div');\nexport const extractTagsFromStatus = (content) => {\n  if (!content) return [];\n  if (content.indexOf('#') === -1) return [];\n  fauxDiv.innerHTML = content;\n  const hashtagLinks = fauxDiv.querySelectorAll('a.hashtag');\n  if (!hashtagLinks.length) return [];\n  return Array.from(hashtagLinks).map((a) =>\n    a.innerText.trim().replace(/^[^#]*#+/, ''),\n  );\n};\n","import { useEffect, useState } from 'preact/hooks';\n\nfunction AsyncText({ children }) {\n  if (typeof children === 'string') return children;\n  const [text, setText] = useState('');\n  useEffect(() => {\n    Promise.resolve(children).then(setText);\n  }, [children]);\n  return text;\n}\n\nexport default AsyncText;\n","import './shortcuts-settings.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { msg, t } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport {\n  compressToEncodedURIComponent,\n  decompressFromEncodedURIComponent,\n} from 'lz-string';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport floatingButtonUrl from '../assets/floating-button.svg';\nimport multiColumnUrl from '../assets/multi-column.svg';\nimport tabMenuBarUrl from '../assets/tab-menu-bar.svg';\n\nimport { api } from '../utils/api';\nimport { fetchFollowedTags } from '../utils/followed-tags';\nimport { getLists, getListTitle } from '../utils/lists';\nimport pmem from '../utils/pmem';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport AsyncText from './AsyncText';\nimport Icon from './icon';\nimport MenuConfirm from './menu-confirm';\nimport Modal from './modal';\nimport { mediaDevicesSupported } from './qr-code-modal';\n\nexport const SHORTCUTS_LIMIT = 9;\n\nconst TYPES = [\n  'following',\n  'mentions',\n  'notifications',\n  'list',\n  'public',\n  'trending',\n  'search',\n  'hashtag',\n  'bookmarks',\n  'favourites',\n  // NOTE: Hide for now\n  // 'account-statuses', // Need @acct search first\n];\nconst TYPE_TEXT = {\n  following: msg`Home / Following`,\n  notifications: msg`Notifications`,\n  list: msg`Lists`,\n  public: msg`Public (Local / Federated)`,\n  search: msg`Search`,\n  'account-statuses': msg`Account`,\n  bookmarks: msg`Bookmarks`,\n  favourites: msg`Likes`,\n  hashtag: msg`Hashtag`,\n  trending: msg`Trending`,\n  mentions: msg`Mentions`,\n};\nconst TYPE_PARAMS = {\n  list: [\n    {\n      text: msg`List ID`,\n      name: 'id',\n      notRequired: true,\n    },\n  ],\n  public: [\n    {\n      text: msg`Local only`,\n      name: 'local',\n      type: 'checkbox',\n    },\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n  trending: [\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n  search: [\n    {\n      text: msg`Search term`,\n      name: 'query',\n      type: 'text',\n      placeholder: msg`Optional, unless for multi-column mode`,\n      notRequired: true,\n    },\n  ],\n  'account-statuses': [\n    {\n      text: '@',\n      name: 'id',\n      type: 'text',\n      placeholder: 'cheeaun@mastodon.social',\n    },\n  ],\n  hashtag: [\n    {\n      text: '#',\n      name: 'hashtag',\n      type: 'text',\n      placeholder: msg`e.g. PixelArt (Max 5, space-separated)`,\n      pattern: '[^#]+',\n    },\n    {\n      text: msg`Media only`,\n      name: 'media',\n      type: 'checkbox',\n    },\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n};\nconst fetchAccountTitle = pmem(async ({ id }) => {\n  const account = await api().masto.v1.accounts.$select(id).fetch();\n  return account.username || account.acct || account.displayName;\n});\nexport const SHORTCUTS_META = {\n  following: {\n    id: 'home',\n    title: (_, index) =>\n      index === 0\n        ? t`Home`\n        : t({ id: 'following.title', message: 'Following' }),\n    path: '/',\n    icon: 'home',\n  },\n  mentions: {\n    id: 'mentions',\n    title: msg`Mentions`,\n    path: '/mentions',\n    icon: 'at',\n  },\n  notifications: {\n    id: 'notifications',\n    title: msg`Notifications`,\n    path: '/notifications',\n    icon: 'notification',\n  },\n  list: {\n    id: ({ id }) => (id ? 'list' : 'lists'),\n    title: ({ id }) => (id ? getListTitle(id) : t`Lists`),\n    path: ({ id }) => (id ? `/l/${id}` : '/l'),\n    icon: 'list',\n    excludeViewMode: ({ id }) => (!id ? ['multi-column'] : []),\n  },\n  public: {\n    id: 'public',\n    title: ({ local }) => (local ? t`Local` : t`Federated`),\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ local, instance }) => `/${instance}/p${local ? '/l' : ''}`,\n    icon: ({ local }) => (local ? 'building' : 'earth'),\n  },\n  trending: {\n    id: 'trending',\n    title: msg`Trending`,\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ instance }) => `/${instance}/trending`,\n    icon: 'chart',\n  },\n  search: {\n    id: 'search',\n    title: ({ query }) => (query ? `${query}` : t`Search`),\n    path: ({ query }) =>\n      query\n        ? `/search?q=${encodeURIComponent(query)}&type=statuses`\n        : '/search',\n    icon: 'search',\n    excludeViewMode: ({ query }) => (!query ? ['multi-column'] : []),\n  },\n  'account-statuses': {\n    id: 'account-statuses',\n    title: fetchAccountTitle,\n    path: ({ id }) => `/a/${id}`,\n    icon: 'user',\n  },\n  bookmarks: {\n    id: 'bookmarks',\n    title: msg`Bookmarks`,\n    path: '/b',\n    icon: 'bookmark',\n  },\n  favourites: {\n    id: 'favourites',\n    title: msg`Likes`,\n    path: '/f',\n    icon: 'heart',\n  },\n  hashtag: {\n    id: 'hashtag',\n    title: ({ hashtag }) => hashtag,\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ hashtag, instance, media }) =>\n      `${instance ? `/${instance}` : ''}/t/${hashtag.split(/\\s+/).join('+')}${\n        media ? '?media=1' : ''\n      }`,\n    icon: 'hashtag',\n  },\n};\n\nfunction ShortcutsSettings({ onClose }) {\n  const { _ } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { shortcuts } = snapStates;\n  const [showForm, setShowForm] = useState(false);\n  const [showImportExport, setShowImportExport] = useState(false);\n\n  const [shortcutsListParent] = useAutoAnimate();\n\n  return (\n    <div id=\"shortcuts-settings-container\" class=\"sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Icon icon=\"shortcut\" /> <Trans>Shortcuts</Trans>{' '}\n          <sup\n            style={{\n              fontSize: 12,\n              opacity: 0.5,\n              textTransform: 'uppercase',\n            }}\n          >\n            <Trans>beta</Trans>\n          </sup>\n        </h2>\n      </header>\n      <main>\n        <p>\n          <Trans>Specify a list of shortcuts that'll appear&nbsp;as:</Trans>\n        </p>\n        <div class=\"shortcuts-view-mode\">\n          {[\n            {\n              value: 'float-button',\n              label: t`Floating button`,\n              imgURL: floatingButtonUrl,\n            },\n            {\n              value: 'tab-menu-bar',\n              label: t`Tab/Menu bar`,\n              imgURL: tabMenuBarUrl,\n            },\n            {\n              value: 'multi-column',\n              label: t`Multi-column`,\n              imgURL: multiColumnUrl,\n            },\n          ].map(({ value, label, imgURL }) => {\n            const checked =\n              snapStates.settings.shortcutsViewMode === value ||\n              (value === 'float-button' &&\n                !snapStates.settings.shortcutsViewMode);\n            return (\n              <label key={value} class={checked ? 'checked' : ''}>\n                <input\n                  type=\"radio\"\n                  name=\"shortcuts-view-mode\"\n                  value={value}\n                  checked={checked}\n                  onChange={(e) => {\n                    states.settings.shortcutsViewMode = e.target.value;\n                  }}\n                />{' '}\n                <img src={imgURL} alt=\"\" width=\"80\" height=\"58\" />{' '}\n                <span>{label}</span>\n              </label>\n            );\n          })}\n        </div>\n        {shortcuts.length > 0 ? (\n          <>\n            <ol class=\"shortcuts-list\" ref={shortcutsListParent}>\n              {shortcuts.filter(Boolean).map((shortcut, i) => {\n                // const key = i + Object.values(shortcut);\n                const key = Object.values(shortcut).join('-');\n                const { type } = shortcut;\n                if (!SHORTCUTS_META[type]) return null;\n                let { icon, title, subtitle, excludeViewMode } =\n                  SHORTCUTS_META[type];\n                if (typeof title === 'function') {\n                  title = title(shortcut, i);\n                } else {\n                  title = _(title);\n                }\n                if (typeof subtitle === 'function') {\n                  subtitle = subtitle(shortcut, i);\n                } else {\n                  subtitle = _(subtitle);\n                }\n                if (typeof icon === 'function') {\n                  icon = icon(shortcut, i);\n                }\n                if (typeof excludeViewMode === 'function') {\n                  excludeViewMode = excludeViewMode(shortcut, i);\n                }\n                const excludedViewMode = excludeViewMode?.includes(\n                  snapStates.settings.shortcutsViewMode,\n                );\n                return (\n                  <li key={key}>\n                    <Icon icon={icon} />\n                    <span class=\"shortcut-text\">\n                      <AsyncText>{title}</AsyncText>\n                      {subtitle && (\n                        <>\n                          {' '}\n                          <small class=\"ib insignificant\">{subtitle}</small>\n                        </>\n                      )}\n                      {excludedViewMode && (\n                        <span class=\"tag\">\n                          <Trans>Not available in current view mode</Trans>\n                        </span>\n                      )}\n                    </span>\n                    <span class=\"shortcut-actions\">\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        disabled={i === 0}\n                        onClick={() => {\n                          const shortcutsArr = Array.from(states.shortcuts);\n                          if (i > 0) {\n                            const temp = states.shortcuts[i - 1];\n                            shortcutsArr[i - 1] = shortcut;\n                            shortcutsArr[i] = temp;\n                            states.shortcuts = shortcutsArr;\n                          }\n                        }}\n                      >\n                        <Icon icon=\"arrow-up\" alt={t`Move up`} />\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        disabled={i === shortcuts.length - 1}\n                        onClick={() => {\n                          const shortcutsArr = Array.from(states.shortcuts);\n                          if (i < states.shortcuts.length - 1) {\n                            const temp = states.shortcuts[i + 1];\n                            shortcutsArr[i + 1] = shortcut;\n                            shortcutsArr[i] = temp;\n                            states.shortcuts = shortcutsArr;\n                          }\n                        }}\n                      >\n                        <Icon icon=\"arrow-down\" alt={t`Move down`} />\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        onClick={() => {\n                          setShowForm({\n                            shortcut,\n                            shortcutIndex: i,\n                          });\n                        }}\n                      >\n                        <Icon icon=\"pencil\" alt={t`Edit`} />\n                      </button>\n                      {/* <button\n                      type=\"button\"\n                      class=\"plain small\"\n                      onClick={() => {\n                        states.shortcuts.splice(i, 1);\n                      }}\n                    >\n                      <Icon icon=\"x\" alt=\"Remove\" />\n                    </button> */}\n                    </span>\n                  </li>\n                );\n              })}\n            </ol>\n            {shortcuts.length === 1 &&\n              snapStates.settings.shortcutsViewMode !== 'float-button' && (\n                <div class=\"ui-state insignificant\">\n                  <Icon icon=\"info\" />{' '}\n                  <small>\n                    <Trans>\n                      Add more than one shortcut/column to make this work.\n                    </Trans>\n                  </small>\n                </div>\n              )}\n          </>\n        ) : (\n          <div class=\"ui-state insignificant\">\n            <p>\n              {snapStates.settings.shortcutsViewMode === 'multi-column'\n                ? t`No columns yet. Tap on the Add column button.`\n                : t`No shortcuts yet. Tap on the Add shortcut button.`}\n            </p>\n            <p>\n              <Trans>\n                Not sure what to add?\n                <br />\n                Try adding{' '}\n                <a\n                  href=\"#\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.shortcuts = [\n                      {\n                        type: 'following',\n                      },\n                      {\n                        type: 'notifications',\n                      },\n                    ];\n                  }}\n                >\n                  Home / Following and Notifications\n                </a>{' '}\n                first.\n              </Trans>\n            </p>\n          </div>\n        )}\n        <p class=\"insignificant\">\n          {shortcuts.length >= SHORTCUTS_LIMIT &&\n            (snapStates.settings.shortcutsViewMode === 'multi-column'\n              ? t`Max ${SHORTCUTS_LIMIT} columns`\n              : t`Max ${SHORTCUTS_LIMIT} shortcuts`)}\n        </p>\n        <p\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <button\n            type=\"button\"\n            class=\"light\"\n            onClick={() => setShowImportExport(true)}\n          >\n            <Trans>Import/export</Trans>\n          </button>\n          <button\n            type=\"button\"\n            disabled={shortcuts.length >= SHORTCUTS_LIMIT}\n            onClick={() => setShowForm(true)}\n          >\n            <Icon icon=\"plus\" />{' '}\n            <span>\n              {snapStates.settings.shortcutsViewMode === 'multi-column'\n                ? t`Add column`\n                : t`Add shortcut`}\n            </span>\n          </button>\n        </p>\n      </main>\n      {showForm && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowForm(false);\n            }\n          }}\n        >\n          <ShortcutForm\n            shortcut={showForm.shortcut}\n            shortcutIndex={showForm.shortcutIndex}\n            onSubmit={({ result, mode }) => {\n              console.log('onSubmit', result);\n              if (mode === 'edit') {\n                states.shortcuts[showForm.shortcutIndex] = result;\n              } else {\n                states.shortcuts.push(result);\n              }\n            }}\n            onClose={() => setShowForm(false)}\n          />\n        </Modal>\n      )}\n      {showImportExport && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowImportExport(false);\n            }\n          }}\n        >\n          <ImportExport\n            shortcuts={shortcuts}\n            onClose={() => setShowImportExport(false)}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst FORM_NOTES = {\n  list: msg`Specific list is optional. For multi-column mode, list is required, else the column will not be shown.`,\n  search: msg`For multi-column mode, search term is required, else the column will not be shown.`,\n  hashtag: msg`Multiple hashtags are supported. Space-separated.`,\n};\n\nfunction ShortcutForm({\n  onSubmit,\n  disabled,\n  shortcut,\n  shortcutIndex,\n  onClose,\n}) {\n  const { _ } = useLingui();\n  console.log('shortcut', shortcut);\n  const editMode = !!shortcut;\n  const [currentType, setCurrentType] = useState(shortcut?.type || null);\n\n  const [uiState, setUIState] = useState('default');\n  const [lists, setLists] = useState([]);\n  const [followedHashtags, setFollowedHashtags] = useState([]);\n  useEffect(() => {\n    (async () => {\n      if (currentType !== 'list') return;\n      try {\n        setUIState('loading');\n        const lists = await getLists();\n        setLists(lists);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n\n    (async () => {\n      if (currentType !== 'hashtag') return;\n      try {\n        const tags = await fetchFollowedTags();\n        setFollowedHashtags(tags);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [currentType]);\n\n  const formRef = useRef();\n  useEffect(() => {\n    if (editMode && currentType && TYPE_PARAMS[currentType]) {\n      // Populate form\n      const form = formRef.current;\n      TYPE_PARAMS[currentType].forEach(({ name, type }) => {\n        const input = form.querySelector(`[name=\"${name}\"]`);\n        if (input && shortcut[name]) {\n          if (type === 'checkbox') {\n            input.checked = shortcut[name] === 'on' ? true : false;\n          } else {\n            input.value = shortcut[name];\n          }\n        }\n      });\n    }\n  }, [editMode, currentType]);\n\n  return (\n    <div id=\"shortcut-settings-form\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>{editMode ? t`Edit shortcut` : t`Add shortcut`}</h2>\n      </header>\n      <main tabindex=\"-1\">\n        <form\n          ref={formRef}\n          onSubmit={(e) => {\n            // Construct a nice object from form\n            e.preventDefault();\n            const data = new FormData(e.target);\n            const result = {};\n            data.forEach((value, key) => {\n              result[key] = value?.trim();\n              if (key === 'instance') {\n                // Remove protocol and trailing slash\n                result[key] = result[key]\n                  .replace(/^https?:\\/\\//, '')\n                  .replace(/\\/+$/, '');\n                // Remove @acct@ or acct@ from instance URL\n                result[key] = result[key].replace(/^@?[^@]+@/, '');\n              }\n            });\n            console.log('result', result);\n            if (!result.type) return;\n            onSubmit({\n              result,\n              mode: editMode ? 'edit' : 'add',\n            });\n            // Reset\n            e.target.reset();\n            setCurrentType(null);\n            onClose?.();\n          }}\n        >\n          <p>\n            <label>\n              <span>\n                <Trans>Timeline</Trans>\n              </span>\n              <select\n                required\n                disabled={disabled}\n                onChange={(e) => {\n                  setCurrentType(e.target.value);\n                }}\n                defaultValue={editMode ? shortcut.type : undefined}\n                name=\"type\"\n                dir=\"auto\"\n              >\n                <option></option>\n                {TYPES.map((type) => (\n                  <option value={type}>{_(TYPE_TEXT[type])}</option>\n                ))}\n              </select>\n            </label>\n          </p>\n          {TYPE_PARAMS[currentType]?.map?.(\n            ({ text, name, type, placeholder, pattern, notRequired }) => {\n              if (currentType === 'list') {\n                return (\n                  <p>\n                    <label>\n                      <span>\n                        <Trans>List</Trans>\n                      </span>\n                      <select\n                        name=\"id\"\n                        required={!notRequired}\n                        disabled={disabled || uiState === 'loading'}\n                        defaultValue={editMode ? shortcut.id : undefined}\n                        dir=\"auto\"\n                      >\n                        <option value=\"\"></option>\n                        {lists.map((list) => (\n                          <option value={list.id}>{list.title}</option>\n                        ))}\n                      </select>\n                    </label>\n                  </p>\n                );\n              }\n\n              return (\n                <p>\n                  <label>\n                    <span>{_(text)}</span>{' '}\n                    <input\n                      type={type}\n                      switch={type === 'checkbox' || undefined}\n                      name={name}\n                      placeholder={_(placeholder)}\n                      required={type === 'text' && !notRequired}\n                      disabled={disabled}\n                      list={\n                        currentType === 'hashtag'\n                          ? 'followed-hashtags-datalist'\n                          : null\n                      }\n                      autocorrect=\"off\"\n                      autocapitalize=\"off\"\n                      spellCheck={false}\n                      pattern={pattern}\n                      dir=\"auto\"\n                    />\n                    {currentType === 'hashtag' &&\n                      followedHashtags.length > 0 && (\n                        <datalist id=\"followed-hashtags-datalist\">\n                          {followedHashtags.map((tag) => (\n                            <option value={tag.name} />\n                          ))}\n                        </datalist>\n                      )}\n                  </label>\n                </p>\n              );\n            },\n          )}\n          {!!FORM_NOTES[currentType] && (\n            <p class=\"form-note insignificant\">\n              <Icon icon=\"info\" />\n              {_(FORM_NOTES[currentType])}\n            </p>\n          )}\n          <footer>\n            <button\n              type=\"submit\"\n              class=\"block\"\n              disabled={disabled || uiState === 'loading'}\n            >\n              {editMode ? t`Save` : t`Add`}\n            </button>\n            {editMode && (\n              <button\n                type=\"button\"\n                class=\"light danger\"\n                onClick={() => {\n                  states.shortcuts.splice(shortcutIndex, 1);\n                  onClose?.();\n                }}\n              >\n                <Trans>Remove</Trans>\n              </button>\n            )}\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nfunction ImportExport({ shortcuts, onClose }) {\n  const { _ } = useLingui();\n  const { masto } = api();\n  const shortcutsStr = useMemo(() => {\n    if (!shortcuts) return '';\n    if (!shortcuts.filter(Boolean).length) return '';\n    return compressToEncodedURIComponent(\n      JSON.stringify(shortcuts.filter(Boolean)),\n    );\n  }, [shortcuts]);\n  const [importShortcutStr, setImportShortcutStr] = useState('');\n  const [importUIState, setImportUIState] = useState('default');\n  const parsedImportShortcutStr = useMemo(() => {\n    if (!importShortcutStr) {\n      setImportUIState('default');\n      return null;\n    }\n    try {\n      const parsed = JSON.parse(\n        decompressFromEncodedURIComponent(importShortcutStr),\n      );\n      // Very basic validation, I know\n      if (!Array.isArray(parsed)) throw new Error('Not an array');\n      setImportUIState('default');\n      console.log(' Parsed imported shortcuts', parsed);\n      return parsed;\n    } catch (err) {\n      // Fallback to JSON string parsing\n      // There's a chance that someone might want to import a JSON string instead of the compressed version\n      try {\n        const parsed = JSON.parse(importShortcutStr);\n        if (!Array.isArray(parsed)) throw new Error('Not an array');\n        setImportUIState('default');\n        return parsed;\n      } catch (err) {\n        setImportUIState('error');\n        return null;\n      }\n    }\n  }, [importShortcutStr]);\n  const hasCurrentSettings = states.shortcuts.length > 0;\n\n  const shortcutsImportFieldRef = useRef();\n\n  return (\n    <div id=\"import-export-container\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>\n            Import/Export <small class=\"ib insignificant\">Shortcuts</small>\n          </Trans>\n        </h2>\n      </header>\n      <main tabindex=\"-1\">\n        <section>\n          <h3>\n            <Icon icon=\"arrow-down-circle\" size=\"l\" class=\"insignificant\" />{' '}\n            <span>\n              <Trans>Import</Trans>\n            </span>\n          </h3>\n          <p class=\"field-button\">\n            <input\n              ref={shortcutsImportFieldRef}\n              type=\"text\"\n              name=\"import\"\n              placeholder={t`Paste shortcuts here`}\n              class=\"block\"\n              onInput={(e) => {\n                setImportShortcutStr(e.target.value);\n              }}\n              dir=\"auto\"\n            />\n            {mediaDevicesSupported && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                onClick={() => {\n                  states.showQrScannerModal = {\n                    onClose: ({ text } = {}) => {\n                      if (text) {\n                        setImportShortcutStr(text);\n                        shortcutsImportFieldRef.current.value = text;\n                        shortcutsImportFieldRef.current.dispatchEvent(\n                          new Event('input'),\n                        );\n                      }\n                    },\n                  };\n                }}\n              >\n                <Icon icon=\"scan\" alt={t`Scan QR code`} />\n              </button>\n            )}\n            {states.settings.shortcutSettingsCloudImportExport && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                disabled={importUIState === 'cloud-downloading'}\n                onClick={async () => {\n                  setImportUIState('cloud-downloading');\n                  const currentAccount = getCurrentAccountID();\n                  showToast(\n                    t`Downloading saved shortcuts from instance server`,\n                  );\n                  try {\n                    const relationships =\n                      await masto.v1.accounts.relationships.fetch({\n                        id: [currentAccount],\n                      });\n                    const relationship = relationships[0];\n                    if (relationship) {\n                      const { note = '' } = relationship;\n                      if (\n                        /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/.test(\n                          note,\n                        )\n                      ) {\n                        const settings = note.match(\n                          /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/,\n                        )[1];\n                        const { v, dt, data } = JSON.parse(settings);\n                        shortcutsImportFieldRef.current.value = data;\n                        shortcutsImportFieldRef.current.dispatchEvent(\n                          new Event('input'),\n                        );\n                      }\n                    }\n                    setImportUIState('default');\n                  } catch (e) {\n                    console.error(e);\n                    setImportUIState('error');\n                    showToast(t`Unable to download shortcuts`);\n                  }\n                }}\n                title={t`Download shortcuts from instance server`}\n              >\n                <Icon icon=\"cloud\" />\n                <Icon icon=\"arrow-down\" size=\"s\" />\n              </button>\n            )}\n          </p>\n          {!!parsedImportShortcutStr &&\n            Array.isArray(parsedImportShortcutStr) && (\n              <>\n                <p>\n                  <b>{parsedImportShortcutStr.length}</b> shortcut\n                  {parsedImportShortcutStr.length > 1 ? 's' : ''}{' '}\n                  <small class=\"insignificant\">\n                    ({importShortcutStr.length} characters)\n                  </small>\n                </p>\n                <ol class=\"import-settings-list\">\n                  {parsedImportShortcutStr.map((shortcut) => (\n                    <li>\n                      <span\n                        style={{\n                          opacity: shortcuts.some((s) =>\n                            // Compare all properties\n                            Object.keys(s).every((key) => {\n                              if (!(key in shortcut)) return true;\n                              const val = shortcut[key];\n                              if (\n                                val === '' ||\n                                val === null ||\n                                val === undefined\n                              ) {\n                                return true;\n                              }\n                              return s[key] === val;\n                            }),\n                          )\n                            ? 1\n                            : 0,\n                        }}\n                      >\n                        *\n                      </span>\n                      <span>\n                        {_(TYPE_TEXT[shortcut.type])}\n                        {shortcut.type === 'list' && !!shortcut.id && ' '}{' '}\n                        {TYPE_PARAMS[shortcut.type]?.map?.(\n                          ({ text, name, type }) =>\n                            shortcut[name] ? (\n                              <>\n                                <span class=\"tag collapsed insignificant\">\n                                  {_(text)}:{' '}\n                                  {type === 'checkbox'\n                                    ? shortcut[name] === 'on'\n                                      ? ''\n                                      : ''\n                                    : shortcut[name]}\n                                </span>{' '}\n                              </>\n                            ) : null,\n                        )}\n                      </span>\n                    </li>\n                  ))}\n                </ol>\n                <p>\n                  <small>\n                    <Trans>* Exists in current shortcuts</Trans>\n                  </small>\n                  <br />\n                  <small>\n                    {' '}\n                    <Trans>\n                      List may not work if it's from a different account.\n                    </Trans>\n                  </small>\n                </p>\n              </>\n            )}\n          {importUIState === 'error' && (\n            <p class=\"error\">\n              <small>\n                 <Trans>Invalid settings format</Trans>\n              </small>\n            </p>\n          )}\n          <p>\n            {hasCurrentSettings && (\n              <>\n                <MenuConfirm\n                  confirmLabel={t`Append to current shortcuts?`}\n                  menuFooter={\n                    <div class=\"footer\">\n                      <Trans>\n                        Only shortcuts that dont exist in current shortcuts\n                        will be appended.\n                      </Trans>\n                    </div>\n                  }\n                  onClick={() => {\n                    // states.shortcuts = [\n                    //   ...states.shortcuts,\n                    //   ...parsedImportShortcutStr,\n                    // ];\n                    // Append non-unique shortcuts only\n                    const nonUniqueShortcuts = parsedImportShortcutStr.filter(\n                      (shortcut) =>\n                        !states.shortcuts.some((s) =>\n                          // Compare all properties\n                          Object.keys(s).every(\n                            (key) => s[key] === shortcut[key],\n                          ),\n                        ),\n                    );\n                    if (!nonUniqueShortcuts.length) {\n                      showToast(t`No new shortcuts to import`);\n                      return;\n                    }\n                    let newShortcuts = [\n                      ...states.shortcuts,\n                      ...nonUniqueShortcuts,\n                    ];\n                    const exceededLimit = newShortcuts.length > SHORTCUTS_LIMIT;\n                    if (exceededLimit) {\n                      // If exceeded, trim it\n                      newShortcuts = newShortcuts.slice(0, SHORTCUTS_LIMIT);\n                    }\n                    states.shortcuts = newShortcuts;\n                    showToast(\n                      exceededLimit\n                        ? t`Shortcuts imported. Exceeded max ${SHORTCUTS_LIMIT}, so the rest are not imported.`\n                        : t`Shortcuts imported`,\n                    );\n                    onClose?.();\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain2\"\n                    disabled={!parsedImportShortcutStr}\n                  >\n                    <Trans>Import & append</Trans>\n                  </button>\n                </MenuConfirm>{' '}\n              </>\n            )}\n            <MenuConfirm\n              confirmLabel={\n                hasCurrentSettings\n                  ? t`Override current shortcuts?`\n                  : t`Import shortcuts?`\n              }\n              menuItemClassName={hasCurrentSettings ? 'danger' : undefined}\n              onClick={() => {\n                states.shortcuts = parsedImportShortcutStr;\n                showToast(t`Shortcuts imported`);\n                onClose?.();\n              }}\n            >\n              <button\n                type=\"button\"\n                class=\"plain2\"\n                disabled={!parsedImportShortcutStr}\n              >\n                {hasCurrentSettings ? t`or override` : t`Import`}\n              </button>\n            </MenuConfirm>\n          </p>\n        </section>\n        <section>\n          <h3>\n            <Icon icon=\"arrow-up-circle\" size=\"l\" class=\"insignificant\" />{' '}\n            <span>\n              <Trans>Export</Trans>\n            </span>\n          </h3>\n          <p class=\"field-button\">\n            <input\n              style={{ width: '100%' }}\n              type=\"text\"\n              value={shortcutsStr}\n              readOnly\n              onClick={(e) => {\n                if (!e.target.value) return;\n                e.target.select();\n                // Copy url to clipboard\n                try {\n                  navigator.clipboard.writeText(e.target.value);\n                  showToast(t`Shortcuts copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy shortcuts`);\n                }\n              }}\n              dir=\"auto\"\n            />\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              disabled={!shortcutsStr}\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: shortcutsStr,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" alt={t`QR code`} />\n            </button>\n            {states.settings.shortcutSettingsCloudImportExport && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                disabled={importUIState === 'cloud-uploading'}\n                onClick={async () => {\n                  setImportUIState('cloud-uploading');\n                  const currentAccount = getCurrentAccountID();\n                  try {\n                    const relationships =\n                      await masto.v1.accounts.relationships.fetch({\n                        id: [currentAccount],\n                      });\n                    const relationship = relationships[0];\n                    if (relationship) {\n                      const { note = '' } = relationship;\n                      // const newNote = `${note}\\n\\n\\n$<phanpy-shortcuts-settings>{shortcutsStr}</phanpy-shortcuts-settings>`;\n                      let newNote = '';\n                      const settingsJSON = JSON.stringify({\n                        v: '1', // version\n                        dt: Date.now(), // datetime stamp\n                        data: shortcutsStr, // shortcuts settings string\n                      });\n                      if (\n                        /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/.test(\n                          note,\n                        )\n                      ) {\n                        newNote = note.replace(\n                          /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/,\n                          `<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`,\n                        );\n                      } else {\n                        newNote = `${note}\\n\\n\\n<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;\n                      }\n                      showToast(t`Saving shortcuts to instance server`);\n                      await masto.v1.accounts\n                        .$select(currentAccount)\n                        .note.create({\n                          comment: newNote,\n                        });\n                      setImportUIState('default');\n                      showToast(t`Shortcuts saved`);\n                    }\n                  } catch (e) {\n                    console.error(e);\n                    setImportUIState('error');\n                    showToast(t`Unable to save shortcuts`);\n                  }\n                }}\n                title={t`Sync to instance server`}\n              >\n                <Icon icon=\"cloud\" />\n                <Icon icon=\"arrow-up\" size=\"s\" />\n              </button>\n            )}\n          </p>\n          <p>\n            <button\n              type=\"button\"\n              class=\"plain2\"\n              disabled={!shortcutsStr}\n              onClick={() => {\n                try {\n                  navigator.clipboard.writeText(shortcutsStr);\n                  showToast(t`Shortcut settings copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy shortcut settings`);\n                }\n              }}\n            >\n              <Icon icon=\"clipboard\" />{' '}\n              <span>\n                <Trans>Copy</Trans>\n              </span>\n            </button>{' '}\n            {navigator?.share &&\n              navigator?.canShare?.({\n                text: shortcutsStr,\n              }) && (\n                <button\n                  type=\"button\"\n                  class=\"plain2\"\n                  disabled={!shortcutsStr}\n                  onClick={() => {\n                    try {\n                      navigator.share({\n                        text: shortcutsStr,\n                      });\n                    } catch (e) {\n                      console.error(e);\n                      alert(t`Sharing doesn't seem to work.`);\n                    }\n                  }}\n                >\n                  <Icon icon=\"share\" />{' '}\n                  <span>\n                    <Trans>Share</Trans>\n                  </span>\n                </button>\n              )}{' '}\n            {shortcutsStr.length > 0 && (\n              <small class=\"insignificant ib\">\n                <Plural\n                  value={shortcutsStr.length}\n                  one=\"# character\"\n                  other=\"# characters\"\n                />\n              </small>\n            )}\n          </p>\n          {!!shortcutsStr && (\n            <details>\n              <summary class=\"insignificant\">\n                <small>\n                  <Trans>Raw Shortcuts JSON</Trans>\n                </small>\n              </summary>\n              <textarea style={{ width: '100%' }} rows={10} readOnly>\n                {JSON.stringify(shortcuts.filter(Boolean), null, 2)}\n              </textarea>\n            </details>\n          )}\n        </section>\n        {states.settings.shortcutSettingsCloudImportExport && (\n          <footer>\n            <p>\n              <Icon icon=\"cloud\" />{' '}\n              <Trans>\n                Import/export settings from/to instance server (Very\n                experimental)\n              </Trans>\n            </p>\n          </footer>\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default ShortcutsSettings;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect } from 'preact/hooks';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { subscribe, useSnapshot } from 'valtio';\n\nimport Accounts from '../pages/accounts';\nimport Settings from '../pages/settings';\nimport focusDeck from '../utils/focus-deck';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\n\nimport AccountSheet from './account-sheet';\nimport ComposeSuspense, { preload } from './compose-suspense';\nimport Drafts from './drafts';\nimport EmbedModal from './embed-modal';\nimport GenericAccounts from './generic-accounts';\nimport ImportExportAccounts from './import-export-accounts';\nimport MediaAltModal from './media-alt-modal';\nimport MediaModal from './media-modal';\nimport Modal from './modal';\nimport OpenLinkSheet from './open-link-sheet';\nimport QrCodeModal from './qr-code-modal';\nimport QrScannerModal from './qr-scanner-modal';\nimport ReportModal from './report-modal';\nimport ShortcutsSettings from './shortcuts-settings';\n\nsubscribe(states, (changes) => {\n  for (const [action, path, value, prevValue] of changes) {\n    // When closing modal, focus on deck\n    if (/^show/i.test(path) && !value) {\n      focusDeck();\n    }\n  }\n});\n\nexport default function Modals() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  useEffect(() => {\n    setTimeout(preload, 1000);\n  }, []);\n\n  return (\n    <>\n      {!!snapStates.showCompose && (\n        <Modal\n          class={`solid ${snapStates.composerState.minimized ? 'min' : ''}`}\n          minimized={!!snapStates.composerState.minimized}\n        >\n          <ComposeSuspense\n            replyToStatus={\n              typeof snapStates.showCompose !== 'boolean'\n                ? snapStates.showCompose.replyToStatus\n                : window.__COMPOSE__?.replyToStatus || null\n            }\n            replyMode={\n              states.showCompose?.replyMode ||\n              window.__COMPOSE__?.replyMode ||\n              'all'\n            }\n            editStatus={\n              states.showCompose?.editStatus ||\n              window.__COMPOSE__?.editStatus ||\n              null\n            }\n            draftStatus={\n              states.showCompose?.draftStatus ||\n              window.__COMPOSE__?.draftStatus ||\n              null\n            }\n            quoteStatus={\n              states.showCompose?.quoteStatus ||\n              window.__COMPOSE__?.quoteStatus ||\n              null\n            }\n            onClose={(results) => {\n              const { newStatus, instance, type, scheduledAt } = results || {};\n              states.showCompose = false;\n              window.__COMPOSE__ = null;\n              if (newStatus) {\n                states.reloadStatusPage++;\n                if (scheduledAt) states.reloadScheduledPosts++;\n                showToast({\n                  text: {\n                    post: scheduledAt\n                      ? t`Post scheduled`\n                      : t`Post published. Check it out.`,\n                    reply: scheduledAt\n                      ? t`Reply scheduled`\n                      : t`Reply posted. Check it out.`,\n                    edit: t`Post updated. Check it out.`,\n                  }[type || 'post'],\n                  delay: 1000,\n                  duration: 10_000, // 10 seconds\n                  onClick: (toast) => {\n                    toast.hideToast();\n                    states.prevLocation = location;\n                    if (scheduledAt) {\n                      navigate('/sp');\n                    } else {\n                      navigate(\n                        instance\n                          ? `/${instance}/s/${newStatus.id}`\n                          : `/s/${newStatus.id}`,\n                      );\n                    }\n                  },\n                });\n              }\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showSettings && (\n        <Modal\n          onClose={() => {\n            states.showSettings = false;\n          }}\n        >\n          <Settings\n            onClose={() => {\n              states.showSettings = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showAccounts && (\n        <Modal\n          onClose={() => {\n            states.showAccounts = false;\n          }}\n        >\n          <Accounts\n            onClose={() => {\n              states.showAccounts = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showAccount && (\n        <Modal\n          onClose={() => {\n            states.showAccount = false;\n          }}\n        >\n          <AccountSheet\n            account={snapStates.showAccount?.account || snapStates.showAccount}\n            instance={snapStates.showAccount?.instance}\n            onClose={({ destination } = {}) => {\n              states.showAccount = false;\n              // states.showGenericAccounts = false;\n              // if (destination) {\n              //   states.showAccounts = false;\n              // }\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showOpenLink && (\n        <Modal\n          onClose={() => {\n            states.showOpenLink = false;\n          }}\n        >\n          <OpenLinkSheet\n            url={snapStates.showOpenLink.url}\n            linkText={snapStates.showOpenLink.linkText}\n            onClose={() => {\n              states.showOpenLink = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showDrafts && (\n        <Modal\n          onClose={() => {\n            states.showDrafts = false;\n          }}\n        >\n          <Drafts onClose={() => (states.showDrafts = false)} />\n        </Modal>\n      )}\n      {!!snapStates.showMediaModal && (\n        <Modal\n          onClick={(e) => {\n            if (\n              e.target === e.currentTarget ||\n              e.target.classList.contains('media')\n            ) {\n              states.showMediaModal = false;\n            }\n          }}\n        >\n          <MediaModal\n            mediaAttachments={snapStates.showMediaModal.mediaAttachments}\n            instance={snapStates.showMediaModal.instance}\n            index={snapStates.showMediaModal.mediaIndex}\n            statusID={snapStates.showMediaModal.statusID}\n            onClose={() => {\n              states.showMediaModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showShortcutsSettings && (\n        <Modal\n          onClose={() => {\n            states.showShortcutsSettings = false;\n          }}\n        >\n          <ShortcutsSettings\n            onClose={() => (states.showShortcutsSettings = false)}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showGenericAccounts && (\n        <Modal\n          onClose={() => {\n            states.showGenericAccounts = false;\n          }}\n        >\n          <GenericAccounts\n            instance={snapStates.showGenericAccounts.instance}\n            excludeRelationshipAttrs={\n              snapStates.showGenericAccounts.excludeRelationshipAttrs\n            }\n            postID={snapStates.showGenericAccounts.postID}\n            onClose={() => (states.showGenericAccounts = false)}\n            blankCopy={snapStates.showGenericAccounts.blankCopy}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showMediaAlt && (\n        <Modal\n          onClose={(e) => {\n            states.showMediaAlt = false;\n          }}\n        >\n          <MediaAltModal\n            alt={snapStates.showMediaAlt.alt || snapStates.showMediaAlt}\n            lang={snapStates.showMediaAlt?.lang}\n            onClose={() => {\n              states.showMediaAlt = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showEmbedModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showEmbedModal = false;\n          }}\n        >\n          <EmbedModal\n            html={snapStates.showEmbedModal.html}\n            url={snapStates.showEmbedModal.url}\n            width={snapStates.showEmbedModal.width}\n            height={snapStates.showEmbedModal.height}\n            onClose={() => {\n              states.showEmbedModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showReportModal && (\n        <Modal\n          onClose={() => {\n            states.showReportModal = false;\n          }}\n        >\n          <ReportModal\n            account={snapStates.showReportModal.account}\n            post={snapStates.showReportModal.post}\n            onClose={() => {\n              states.showReportModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showQrCodeModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showQrCodeModal = false;\n          }}\n        >\n          <QrCodeModal\n            text={snapStates.showQrCodeModal.text}\n            arena={snapStates.showQrCodeModal.arena}\n            backgroundMask={snapStates.showQrCodeModal.backgroundMask}\n            caption={snapStates.showQrCodeModal.caption}\n            onClose={() => {\n              states.showQrCodeModal = false;\n            }}\n            onScannerClick={snapStates.showQrCodeModal.onScannerClick}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showQrScannerModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showQrScannerModal = false;\n          }}\n        >\n          <QrScannerModal\n            checkValidity={snapStates.showQrScannerModal.checkValidity}\n            actionableText={snapStates.showQrScannerModal.actionableText}\n            onClose={(...args) => {\n              if (snapStates.showQrScannerModal.onClose) {\n                snapStates.showQrScannerModal.onClose(...args);\n              }\n              states.showQrScannerModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showImportExportAccounts && (\n        <Modal\n          onClose={() => {\n            states.showImportExportAccounts = false;\n          }}\n        >\n          <ImportExportAccounts\n            onClose={() => {\n              states.showImportExportAccounts = false;\n            }}\n            exportDisabled={\n              typeof snapStates.showImportExportAccounts === 'object'\n                ? snapStates.showImportExportAccounts.exportDisabled\n                : false\n            }\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n","import { memo } from 'preact/compat';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useNavigate } from 'react-router-dom';\n\nexport default memo(function NavigationCommand() {\n  const navigate = useNavigate();\n\n  const hotkeyOptions = {\n    useKey: true,\n    ignoreEventWhen: (e) => {\n      const hasModal = !!document.querySelector('#modal-container > *');\n      return hasModal || e.metaKey || e.ctrlKey || e.altKey;\n    },\n  };\n\n  useHotkeys('g>h', () => navigate('/'), hotkeyOptions);\n  useHotkeys('g>n', () => navigate('/notifications'), hotkeyOptions);\n\n  return null;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nfunction FollowRequestButtons({ accountID, onChange }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [requestState, setRequestState] = useState(null); // accept, reject\n  const [relationship, setRelationship] = useState(null);\n\n  const hasRelationship = relationship !== null;\n\n  return (\n    <p class=\"follow-request-buttons\">\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRelationship}\n        onClick={() => {\n          setUIState('loading');\n          setRequestState('accept');\n          (async () => {\n            try {\n              const rel = await masto.v1.followRequests\n                .$select(accountID)\n                .authorize();\n              if (!rel?.followedBy) {\n                throw new Error('Follow request not accepted');\n              }\n              setRelationship(rel);\n              onChange();\n            } catch (e) {\n              console.error(e);\n            }\n            setUIState('default');\n          })();\n        }}\n      >\n        <Trans>Accept</Trans>\n      </button>{' '}\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRelationship}\n        class=\"light danger\"\n        onClick={() => {\n          setUIState('loading');\n          setRequestState('reject');\n          (async () => {\n            try {\n              const rel = await masto.v1.followRequests\n                .$select(accountID)\n                .reject();\n              if (rel?.followedBy) {\n                throw new Error('Follow request not rejected');\n              }\n              setRelationship(rel);\n              onChange();\n            } catch (e) {\n              console.error(e);\n              setUIState('default');\n            }\n          })();\n        }}\n      >\n        <Trans>Reject</Trans>\n      </button>\n      <span class=\"follow-request-states\">\n        {hasRelationship && requestState ? (\n          requestState === 'accept' ? (\n            <Icon\n              icon=\"check-circle\"\n              alt={t`Accepted`}\n              class=\"follow-accepted\"\n            />\n          ) : (\n            <Icon icon=\"x-circle\" alt={t`Rejected`} class=\"follow-rejected\" />\n          )\n        ) : (\n          <Loader hidden={uiState !== 'loading'} />\n        )}\n      </span>\n    </p>\n  );\n}\n\nexport default FollowRequestButtons;\n","import { msg, t } from '@lingui/core/macro';\nimport { Plural, Select, Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\n\nimport { api } from '../utils/api';\nimport { isFiltered } from '../utils/filters';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { statusKey } from '../utils/states';\nimport { getCurrentAccountID } from '../utils/store-utils';\nimport useTruncated from '../utils/useTruncated';\n\nimport Avatar from './avatar';\nimport CustomEmoji from './custom-emoji';\nimport FollowRequestButtons from './follow-request-buttons';\nimport Icon from './icon';\nimport Link from './link';\nimport NameText from './name-text';\nimport Status from './status';\n\nconst NOTIFICATION_ICONS = {\n  mention: 'comment',\n  status: 'notification',\n  reblog: 'rocket',\n  follow: 'follow',\n  follow_request: 'follow-add',\n  favourite: 'heart',\n  poll: 'poll',\n  update: 'pencil',\n  'admin.signup': 'account-edit',\n  'admin.report': 'account-warning',\n  severed_relationships: 'heart-break',\n  moderation_warning: 'alert',\n  emoji_reaction: 'emoji2',\n  'pleroma:emoji_reaction': 'emoji2',\n  annual_report: 'celebrate',\n  quote: 'quote',\n  quoted_update: 'pencil',\n};\n\n/*\nNotification types\n==================\nmention = Someone mentioned you in their status\nstatus = Someone you enabled notifications for has posted a status\nreblog = Someone boosted one of your statuses\nfollow = Someone followed you\nfollow_request = Someone requested to follow you\nfavourite = Someone favourited one of your statuses\npoll = A poll you have voted in or created has ended\nupdate = A status you interacted with has been edited\nadmin.sign_up = Someone signed up (optionally sent to admins)\nadmin.report = A new report has been filed\nsevered_relationships = Severed relationships\nmoderation_warning = Moderation warning\nquote = Someone quoted one of your statuses\nquoted_update = A status you have quoted has been edited\n*/\n\nfunction emojiText({ account, emoji, emoji_url }) {\n  let url;\n  let staticUrl;\n  if (typeof emoji_url === 'string') {\n    url = emoji_url;\n  } else {\n    url = emoji_url?.url;\n    staticUrl = emoji_url?.staticUrl;\n  }\n  const emojiObject = url ? (\n    <CustomEmoji url={url} staticUrl={staticUrl} alt={emoji} />\n  ) : (\n    emoji\n  );\n  return (\n    <Trans>\n      {account} reacted to your post with {emojiObject}\n    </Trans>\n  );\n}\n\nconst contentText = {\n  status: ({ account }) => <Trans>{account} published a post.</Trans>,\n  reblog: ({\n    count,\n    account,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} boosted your reply.</Trans>}\n              other={<Trans>{account} boosted your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} boosted {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  follow: ({ account, count, components: { Subject } }) => (\n    <Plural\n      value={count}\n      _1={<Trans>{account} followed you.</Trans>}\n      other={\n        <Trans>\n          <Subject clickable={count > 1}>\n            <span title={count}>{shortenNumber(count)}</span> people\n          </Subject>{' '}\n          followed you.\n        </Trans>\n      }\n    />\n  ),\n  follow_request: ({ account }) => (\n    <Trans>{account} requested to follow you.</Trans>\n  ),\n  favourite: ({\n    account,\n    count,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} liked your reply.</Trans>}\n              other={<Trans>{account} liked your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} liked {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              liked your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              liked your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  poll: () => t`A poll you have voted in or created has ended.`,\n  'poll-self': () => t`A poll you have created has ended.`,\n  'poll-voted': () => t`A poll you have voted in has ended.`,\n  update: ({ account }) =>\n    account ? (\n      <Trans>{account} edited a post.</Trans>\n    ) : (\n      t`A post you interacted with has been edited.`\n    ),\n  'favourite+reblog': ({\n    count,\n    account,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} boosted & liked your reply.</Trans>}\n              other={<Trans>{account} boosted & liked your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} boosted & liked {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted & liked your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted & liked your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  quoted_update: ({ account }) => (\n    <Trans>{account} edited a post you have quoted.</Trans>\n  ),\n  'admin.sign_up': ({ account }) => <Trans>{account} signed up.</Trans>,\n  'admin.report': ({ account, targetAccount }) => (\n    <Trans>\n      {account} reported {targetAccount}\n    </Trans>\n  ),\n  severed_relationships: ({ name }) => (\n    <Trans>\n      Lost connections with <i>{name}</i>.\n    </Trans>\n  ),\n  moderation_warning: () => (\n    <b>\n      <Trans>Moderation warning</Trans>\n    </b>\n  ),\n  emoji_reaction: emojiText,\n  'pleroma:emoji_reaction': emojiText,\n  annual_report: ({ year }) => <Trans>Your {year} #Wrapstodon is here!</Trans>,\n};\n\n// account_suspension, domain_block, user_domain_block\nconst SEVERED_RELATIONSHIPS_TEXT = {\n  account_suspension: ({ from, targetName }) => (\n    <Trans>\n      An admin from <i>{from}</i> has suspended <i>{targetName}</i>, which means\n      you can no longer receive updates from them or interact with them.\n    </Trans>\n  ),\n  domain_block: ({ from, targetName, followersCount, followingCount }) => (\n    <Trans>\n      An admin from <i>{from}</i> has blocked <i>{targetName}</i>. Affected\n      followers: {followersCount}, followings: {followingCount}.\n    </Trans>\n  ),\n  user_domain_block: ({ targetName, followersCount, followingCount }) => (\n    <Trans>\n      You have blocked <i>{targetName}</i>. Removed followers: {followersCount},\n      followings: {followingCount}.\n    </Trans>\n  ),\n};\n\nconst MODERATION_WARNING_TEXT = {\n  none: msg`Your account has received a moderation warning.`,\n  disable: msg`Your account has been disabled.`,\n  mark_statuses_as_sensitive: msg`Some of your posts have been marked as sensitive.`,\n  delete_statuses: msg`Some of your posts have been deleted.`,\n  sensitive: msg`Your posts will be marked as sensitive from now on.`,\n  silence: msg`Your account has been limited.`,\n  suspend: msg`Your account has been suspended.`,\n};\n\nconst AVATARS_LIMIT = 30;\n\nfunction Notification({\n  notification,\n  instance,\n  isStatic,\n  disableContextMenu,\n}) {\n  const { _ } = useLingui();\n  const { masto } = api();\n  const {\n    id,\n    status,\n    account,\n    report,\n    event,\n    moderation_warning,\n    annualReport,\n    // Client-side grouped notification\n    _ids,\n    _accounts,\n    _statuses,\n    _groupKeys,\n    // Server-side grouped notification\n    sampleAccounts,\n    notificationsCount,\n    groupKey,\n    _notificationsCount,\n    _sampleAccountsCount,\n  } = notification;\n  let { type } = notification;\n\n  if ((type === 'mention' || type === 'quote') && !status) {\n    // Could be deleted\n    return null;\n  }\n\n  // status = Attached when type of the notification is favourite, reblog, status, mention, poll, or update\n  const actualStatus = status?.reblog || status;\n  const actualStatusID = actualStatus?.id;\n\n  const currentAccount = getCurrentAccountID();\n  const isSelf = currentAccount === account?.id;\n  const isVoted = status?.poll?.voted;\n  const isReplyToOthers =\n    !!status?.inReplyToAccountId &&\n    status?.inReplyToAccountId !== currentAccount &&\n    status?.account?.id === currentAccount;\n\n  let favsCount = 0;\n  let reblogsCount = 0;\n  if (type === 'favourite+reblog') {\n    if (_accounts) {\n      for (const account of _accounts) {\n        if (account._types?.includes('favourite')) {\n          favsCount++;\n        }\n        if (account._types?.includes('reblog')) {\n          reblogsCount++;\n        }\n      }\n    }\n    if (!reblogsCount && favsCount) type = 'favourite';\n    if (!favsCount && reblogsCount) type = 'reblog';\n  }\n\n  let text;\n  if (type === 'poll') {\n    text = contentText[isSelf ? 'poll-self' : isVoted ? 'poll-voted' : 'poll'];\n  } else if (contentText[type]) {\n    text = contentText[type];\n  } else {\n    // Anticipate unhandled notification types, possibly from Mastodon forks or non-Mastodon instances\n    // This surfaces the error to the user, hoping that users will report it\n    text = t`[Unknown notification type: ${type}]`;\n  }\n\n  const Subject = ({ clickable, ...props }) =>\n    clickable ? (\n      <b tabIndex=\"0\" onClick={handleOpenGenericAccounts} {...props} />\n    ) : (\n      <b {...props} />\n    );\n\n  const diffCount =\n    notificationsCount > 0 && notificationsCount > sampleAccounts?.length;\n  const expandAccounts = diffCount ? 'remote' : 'local';\n\n  if (typeof text === 'function') {\n    const count =\n      (type === 'favourite' || type === 'reblog') && notificationsCount\n        ? diffCount\n          ? notificationsCount\n          : sampleAccounts?.length\n        : _accounts?.length || sampleAccounts?.length || (account ? 1 : 0);\n    const postsCount = _statuses?.length || (status ? 1 : 0);\n    if (type === 'admin.report') {\n      const targetAccount = report?.targetAccount;\n      if (targetAccount) {\n        text = text({\n          account: <NameText account={account} showAvatar />,\n          targetAccount: <NameText account={targetAccount} showAvatar />,\n        });\n      }\n    } else if (type === 'severed_relationships') {\n      const targetName = event?.targetName;\n      if (targetName) {\n        text = text({ name: targetName });\n      }\n    } else if (\n      (type === 'emoji_reaction' || type === 'pleroma:emoji_reaction') &&\n      notification.emoji\n    ) {\n      const emojiURL =\n        notification.emoji_url || // This is string\n        status?.emojis?.find?.(\n          (emoji) =>\n            emoji?.shortcode ===\n            notification.emoji.replace(/^:/, '').replace(/:$/, ''),\n        ); // Emoji object instead of string\n      text = text({\n        account: <NameText account={account} showAvatar />,\n        emoji: notification.emoji,\n        emojiURL,\n      });\n    } else if (type === 'annual_report') {\n      text = text({\n        ...notification.annualReport,\n      });\n    } else {\n      text = text({\n        account: account ? (\n          <NameText account={account} showAvatar />\n        ) : (\n          sampleAccounts?.[0] && (\n            <NameText account={sampleAccounts[0]} showAvatar />\n          )\n        ),\n        count,\n        postsCount,\n        postType: isReplyToOthers ? 'reply' : 'post',\n        components: { Subject },\n      });\n    }\n  }\n\n  const formattedCreatedAt =\n    notification.createdAt && new Date(notification.createdAt).toLocaleString();\n\n  const genericAccountsHeading =\n    {\n      'favourite+reblog': t`Boosted/Liked by`,\n      favourite: t`Liked by`,\n      reblog: t`Boosted by`,\n      follow: t`Followed by`,\n    }[type] || t`Accounts`;\n  const handleOpenGenericAccounts = () => {\n    states.showGenericAccounts = {\n      heading: genericAccountsHeading,\n      accounts: _accounts,\n      showReactions: type === 'favourite+reblog',\n      excludeRelationshipAttrs: type === 'follow' ? ['followedBy'] : [],\n      postID: statusKey(actualStatusID, instance),\n    };\n  };\n\n  console.debug('RENDER Notification', notification.id);\n\n  // If there's a status and filter action is 'hide', then the notification is hidden\n  if (!!status?.filtered) {\n    const isOwnPost = status?.account?.id === currentAccount;\n    const filterInfo = isFiltered(status.filtered, 'notifications');\n    if (!isSelf && !isOwnPost && filterInfo?.action === 'hide') {\n      return null;\n    }\n  }\n\n  return (\n    <div\n      class={`notification notification-${type}`}\n      data-notification-id={_ids || id}\n      data-group-key={_groupKeys?.join(' ') || groupKey}\n      tabIndex=\"0\"\n    >\n      <div\n        class={`notification-type notification-${type}`}\n        title={formattedCreatedAt}\n      >\n        {type === 'favourite+reblog' ? (\n          <>\n            <Icon icon=\"rocket\" size=\"xl\" alt={type} class=\"reblog-icon\" />\n            <Icon icon=\"heart\" size=\"xl\" alt={type} class=\"favourite-icon\" />\n          </>\n        ) : type === 'mention+quote' ? (\n          <>\n            <Icon icon=\"comment\" size=\"xl\" alt={type} class=\"mention-icon\" />\n            <Icon icon=\"quote\" size=\"xl\" alt={type} class=\"quote-icon\" />\n          </>\n        ) : (\n          <Icon\n            icon={NOTIFICATION_ICONS[type] || 'notification'}\n            size=\"xl\"\n            alt={type}\n          />\n        )}\n      </div>\n      <div class=\"notification-content\">\n        {/* {(type === 'favourite+reblog' ||\n          type === 'favourite' ||\n          type === 'reblog') && (\n          <>\n             {type} {expandAccounts}{' '}\n            <mark>\n              N{_notificationsCount?.join(',')} + A\n              {_sampleAccountsCount?.join(',')}\n            </mark>{' '}\n            {' '}\n            <mark>\n              N{notificationsCount} + A{sampleAccounts?.length}\n            </mark>\n          </>\n        )} */}\n        {type !== 'mention' && type !== 'quote' && type !== 'mention+quote' && (\n          <>\n            <p>{text}</p>\n            {type === 'follow_request' && (\n              <FollowRequestButtons accountID={account.id} />\n            )}\n            {type === 'severed_relationships' && (\n              <div>\n                {SEVERED_RELATIONSHIPS_TEXT[event.type]({\n                  from: instance,\n                  ...event,\n                })}\n                <br />\n                <a\n                  href={`https://${instance}/severed_relationships`}\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  <Trans>\n                    Learn more <Icon icon=\"external\" size=\"s\" />\n                  </Trans>\n                </a>\n                .\n              </div>\n            )}\n            {type === 'moderation_warning' && !!moderation_warning && (\n              <div>\n                {_(MODERATION_WARNING_TEXT[moderation_warning.action]())}\n                <br />\n                <a\n                  href={`/disputes/strikes/${moderation_warning.id}`}\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  <Trans>\n                    Learn more <Icon icon=\"external\" size=\"s\" />\n                  </Trans>\n                </a>\n              </div>\n            )}\n            {type === 'annual_report' && (\n              <div>\n                <Link to={`/annual_report/${annualReport?.year}`}>\n                  <Trans>View #Wrapstodon</Trans>\n                </Link>\n              </div>\n            )}\n          </>\n        )}\n        {_accounts?.length > 1 && (\n          <p class=\"avatars-stack\">\n            {_accounts.slice(0, AVATARS_LIMIT).map((account) => (\n              <Fragment key={account.id}>\n                <a\n                  key={account.id}\n                  href={account.url}\n                  rel=\"noopener\"\n                  class=\"account-avatar-stack\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = account;\n                  }}\n                >\n                  <Avatar\n                    url={account.avatarStatic}\n                    size={\n                      _accounts.length <= 10\n                        ? 'xxl'\n                        : _accounts.length < 20\n                          ? 'xl'\n                          : 'l'\n                    }\n                    key={account.id}\n                    alt={`${account.displayName} @${account.acct}`}\n                    squircle={account?.bot}\n                  />\n                  {type === 'favourite+reblog' && (\n                    <div class=\"account-sub-icons\">\n                      {account._types.map((type) => (\n                        <Icon\n                          icon={NOTIFICATION_ICONS[type]}\n                          size=\"s\"\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </a>{' '}\n              </Fragment>\n            ))}\n            {(type === 'favourite+reblog' ||\n              type === 'favourite' ||\n              type === 'reblog') &&\n            expandAccounts === 'remote' ? (\n              <button\n                type=\"button\"\n                class=\"small plain\"\n                data-group-keys={_groupKeys?.join(' ')}\n                onClick={() => {\n                  states.showGenericAccounts = {\n                    heading: genericAccountsHeading,\n                    accounts: _accounts,\n                    fetchAccounts: async () => {\n                      const keyAccounts = await Promise.allSettled(\n                        _groupKeys.map(async (gKey) => {\n                          const iterator = masto.v2.notifications\n                            .$select(gKey)\n                            .accounts.list()\n                            .values();\n                          return [gKey, (await iterator.next()).value];\n                        }),\n                      );\n                      const accounts = [];\n                      for (const keyAccount of keyAccounts) {\n                        const [key, _accounts] = keyAccount.value;\n                        const type = /^favourite/.test(key)\n                          ? 'favourite'\n                          : /^reblog/.test(key)\n                            ? 'reblog'\n                            : null;\n                        if (!type) continue;\n                        for (const account of _accounts) {\n                          const theAccount = accounts.find(\n                            (a) => a.id === account.id,\n                          );\n                          if (theAccount) {\n                            theAccount._types.push(type);\n                          } else {\n                            account._types = [type];\n                            accounts.push(account);\n                          }\n                        }\n                      }\n                      return {\n                        done: true,\n                        value: accounts,\n                      };\n                    },\n                    showReactions: type === 'favourite+reblog',\n                    postID: statusKey(actualStatusID, instance),\n                  };\n                }}\n              >\n                +\n                {(type === 'favourite' || type === 'reblog') &&\n                  notificationsCount - _accounts.length}\n                <Icon icon=\"chevron-down\" />\n              </button>\n            ) : (\n              <button\n                type=\"button\"\n                class=\"small plain\"\n                onClick={handleOpenGenericAccounts}\n              >\n                {_accounts.length > AVATARS_LIMIT &&\n                  `+${_accounts.length - AVATARS_LIMIT}`}\n                <Icon icon=\"chevron-down\" />\n              </button>\n            )}\n          </p>\n        )}\n        {!_accounts?.length && sampleAccounts?.length > 1 && (\n          <p class=\"avatars-stack\">\n            {sampleAccounts.map((account) => (\n              <Fragment key={account.id}>\n                <a\n                  key={account.id}\n                  href={account.url}\n                  rel=\"noopener\"\n                  class=\"account-avatar-stack\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = account;\n                  }}\n                >\n                  <Avatar\n                    url={account.avatarStatic}\n                    size=\"xxl\"\n                    key={account.id}\n                    alt={`${account.displayName} @${account.acct}`}\n                    squircle={account?.bot}\n                  />\n                  {/* {type === 'favourite+reblog' && (\n                    <div class=\"account-sub-icons\">\n                      {account._types.map((type) => (\n                        <Icon\n                          icon={NOTIFICATION_ICONS[type]}\n                          size=\"s\"\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                  )} */}\n                </a>{' '}\n              </Fragment>\n            ))}\n            {notificationsCount > sampleAccounts.length && (\n              <Link\n                to={\n                  instance ? `/${instance}/s/${status.id}` : `/s/${status.id}`\n                }\n                class=\"button small plain centered\"\n              >\n                +{notificationsCount - sampleAccounts.length}\n                <Icon icon=\"chevron-right\" />\n              </Link>\n            )}\n          </p>\n        )}\n        {_statuses?.length > 1 && (\n          <ul class=\"notification-group-statuses\">\n            {_statuses.map((status) => (\n              <li key={status.id}>\n                <TruncatedLink\n                  class={`status-link status-type-${type}`}\n                  to={\n                    instance ? `/${instance}/s/${status.id}` : `/s/${status.id}`\n                  }\n                >\n                  <Status\n                    status={status}\n                    size=\"s\"\n                    previewMode\n                    allowContextMenu\n                    allowFilters\n                  />\n                </TruncatedLink>\n              </li>\n            ))}\n          </ul>\n        )}\n        {status && (!_statuses?.length || _statuses?.length <= 1) && (\n          <TruncatedLink\n            class={`status-link status-type-${type}`}\n            to={\n              instance\n                ? `/${instance}/s/${actualStatusID}`\n                : `/s/${actualStatusID}`\n            }\n            onContextMenu={\n              !disableContextMenu\n                ? (e) => {\n                    const post = e.target.querySelector('.status');\n                    if (post) {\n                      // Fire a custom event to open the context menu\n                      if (e.metaKey) return;\n                      e.preventDefault();\n                      post.dispatchEvent(\n                        new MouseEvent('contextmenu', {\n                          clientX: e.clientX,\n                          clientY: e.clientY,\n                        }),\n                      );\n                    }\n                  }\n                : undefined\n            }\n          >\n            {isStatic ? (\n              <Status\n                status={actualStatus}\n                size=\"s\"\n                readOnly\n                allowContextMenu\n                allowFilters\n              />\n            ) : (\n              <Status\n                statusID={actualStatusID}\n                size=\"s\"\n                readOnly\n                allowContextMenu\n                allowFilters\n              />\n            )}\n          </TruncatedLink>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction TruncatedLink(props) {\n  const { t } = useLingui();\n  const ref = useTruncated();\n  return <Link {...props} data-read-more={t`Read more `} ref={ref} />;\n}\n\nexport default memo(Notification, (oldProps, newProps) => {\n  return oldProps.notification?.id === newProps.notification?.id;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useLayoutEffect, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\nimport {\n  getAccountByAccessToken,\n  getCurrentAccount,\n} from '../utils/store-utils';\nimport usePageVisibility from '../utils/usePageVisibility';\n\nimport Icon from './icon';\nimport Link from './link';\nimport Modal from './modal';\nimport Notification from './notification';\n\n{\n  if ('serviceWorker' in navigator) {\n    console.log(' Listen to message');\n    navigator.serviceWorker.addEventListener('message', (event) => {\n      console.log(' Message event', event);\n      const { type, id, accessToken } = event?.data || {};\n      if (type === 'notification') {\n        states.routeNotification = {\n          id,\n          accessToken,\n        };\n      }\n    });\n  }\n}\n\nexport default memo(function NotificationService() {\n  const { t } = useLingui();\n  if (!('serviceWorker' in navigator)) return null;\n\n  const snapStates = useSnapshot(states);\n  const { routeNotification } = snapStates;\n\n  console.log(' Notification service', routeNotification);\n\n  const { id, accessToken } = routeNotification || {};\n  const [showNotificationSheet, setShowNotificationSheet] = useState(false);\n\n  useLayoutEffect(() => {\n    if (!id || !accessToken) return;\n    const { instance: currentInstance } = api();\n    const { masto, instance } = api({\n      accessToken,\n    });\n    console.log('API', { accessToken, currentInstance, instance });\n    const sameInstance = currentInstance === instance;\n    const account = accessToken\n      ? getAccountByAccessToken(accessToken)\n      : getCurrentAccount();\n    (async () => {\n      const notification = await masto.v1.notifications.$select(id).fetch();\n      if (notification && account) {\n        console.log(' Notification', { id, notification, account });\n        const accountInstance = account.instanceURL;\n        const { type, status, account: notificationAccount } = notification;\n        const hasModal = !!document.querySelector('#modal-container > *');\n        const isFollow = type === 'follow' && !!notificationAccount?.id;\n        const hasAccount = !!notificationAccount?.id;\n        const hasStatus = !!status?.id;\n        if (isFollow && sameInstance) {\n          // Show account sheet, can handle different instances\n          states.showAccount = {\n            account: notificationAccount,\n            instance: accountInstance,\n          };\n        } else if (hasModal || !sameInstance || (hasAccount && hasStatus)) {\n          // Show sheet of notification, if\n          // - there is a modal open\n          // - the notification is from another instance\n          // - the notification has both account and status, gives choice for users to go to account or status\n          setShowNotificationSheet({\n            id,\n            account,\n            notification,\n            sameInstance,\n          });\n        } else {\n          if (hasStatus) {\n            // Go to status page\n            location.hash = `/${currentInstance}/s/${status.id}`;\n          } else if (isFollow) {\n            // Go to profile page\n            location.hash = `/${currentInstance}/a/${notificationAccount.id}`;\n          } else {\n            // Go to notifications page\n            location.hash = '/notifications';\n          }\n        }\n      } else {\n        console.warn(' Notification not found', id);\n      }\n    })();\n  }, [id, accessToken]);\n\n  // useLayoutEffect(() => {\n  //   // Listen to message from service worker\n  //   const handleMessage = (event) => {\n  //     console.log(' Message event', event);\n  //     const { type, id, accessToken } = event?.data || {};\n  //     if (type === 'notification') {\n  //       states.routeNotification = {\n  //         id,\n  //         accessToken,\n  //       };\n  //     }\n  //   };\n  //   console.log(' Listen to message');\n  //   navigator.serviceWorker.addEventListener('message', handleMessage);\n  //   return () => {\n  //     console.log(' Remove listen to message');\n  //     navigator.serviceWorker.removeEventListener('message', handleMessage);\n  //   };\n  // }, []);\n\n  useLayoutEffect(() => {\n    if (navigator?.clearAppBadge) {\n      navigator.clearAppBadge();\n    }\n  }, []);\n  usePageVisibility((visible) => {\n    if (visible && navigator?.clearAppBadge) {\n      console.log(' Clear app badge');\n      navigator.clearAppBadge();\n    }\n  });\n\n  const onClose = () => {\n    setShowNotificationSheet(false);\n    states.routeNotification = null;\n\n    // If url is #/notifications?id=123, go to #/notifications\n    if (/\\/notifications\\?id=/i.test(location.hash)) {\n      location.hash = '/notifications';\n    }\n  };\n\n  if (showNotificationSheet) {\n    const { id, account, notification, sameInstance } = showNotificationSheet;\n    return (\n      <Modal\n        onClick={(e) => {\n          if (e.target === e.currentTarget) {\n            onClose();\n          }\n        }}\n      >\n        <div class=\"sheet\" tabIndex=\"-1\">\n          <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n          <header>\n            <b>\n              <Trans>Notification</Trans>\n            </b>\n          </header>\n          <main>\n            {!sameInstance && (\n              <p>\n                <Trans>This notification is from your other account.</Trans>\n              </p>\n            )}\n            <div\n              class=\"notification-peek\"\n              // style={{\n              //   pointerEvents: sameInstance ? '' : 'none',\n              // }}\n              onClick={(e) => {\n                const { target } = e;\n                // If button or links\n                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') {\n                  onClose();\n                }\n              }}\n            >\n              <Notification\n                instance={account.instanceURL}\n                notification={notification}\n                isStatic\n              />\n            </div>\n            <div\n              style={{\n                textAlign: 'end',\n              }}\n            >\n              <Link to=\"/notifications\" class=\"button light\" onClick={onClose}>\n                <span>\n                  <Trans>View all notifications</Trans>\n                </span>{' '}\n                <Icon icon=\"arrow-right\" />\n              </Link>\n            </div>\n          </main>\n        </div>\n      </Modal>\n    );\n  }\n\n  return null;\n});\n","import store from './store';\n\nexport const getSearchHistory = ({ limit } = {}) => {\n  const history = store.account.get('searchHistory') || [];\n  return limit ? history.slice(0, limit) : history;\n};\n\nconst MAX_HISTORY_LENGTH = 10;\nexport const addToSearchHistory = (query, queryType = null) => {\n  if (!query?.trim?.()) return;\n\n  const history = getSearchHistory();\n  const existingIndex = history.findIndex(\n    (item) => item.query === query && item.queryType === queryType,\n  );\n\n  // LRU\n  // Remove existing entry if found\n  if (existingIndex !== -1) {\n    history.splice(existingIndex, 1);\n  }\n  // Add to beginning (most recent)\n  history.unshift({\n    query: query.trim(),\n    queryType,\n    timestamp: Date.now(),\n  });\n  const limitedHistory = history.slice(0, MAX_HISTORY_LENGTH);\n\n  store.account.set('searchHistory', limitedHistory);\n};\n\nexport const removeFromSearchHistory = (query, queryType = null) => {\n  const history = getSearchHistory();\n  const filteredHistory = history.filter(\n    (item) => !(item.query === query && item.queryType === queryType),\n  );\n  store.account.set('searchHistory', filteredHistory);\n};\n\nexport const clearAllSearchHistory = () => {\n  store.account.set('searchHistory', []);\n};\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { forwardRef } from 'preact/compat';\nimport { useImperativeHandle, useMemo, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport { api } from '../utils/api';\nimport { addToSearchHistory, getSearchHistory } from '../utils/search-history';\n\nimport Icon from './icon';\nimport Link from './link';\n\n// Helper function to generate search item data (label and URL)\nexport const generateSearchItemData = (query, queryType, instance) => {\n  let label, to, icon;\n\n  if (queryType === 'statuses') {\n    label = (\n      <Trans>\n        Posts with <q>{query}</q>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}&type=statuses`;\n    icon = 'document';\n  } else if (queryType === 'accounts') {\n    label = (\n      <Trans>\n        Accounts with <q>{query}</q>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}&type=accounts`;\n    icon = 'group';\n  } else if (queryType === 'hashtags') {\n    const [, hashSymbol = '#', hashtagText = query] =\n      query.match(/^([#])?(.*)$/);\n    const hashtag = `${hashSymbol}${hashtagText}`;\n    label = (\n      <Trans>\n        Posts tagged with <mark>{hashtag}</mark>\n      </Trans>\n    );\n    to = `/${instance}/t/${hashtagText}`;\n    icon = 'hashtag';\n  } else {\n    // Default/general search\n    label = (\n      <Trans>\n        {query}{' '}\n        <small class=\"insignificant\"> accounts, hashtags &amp; posts</small>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}`;\n    icon = 'search';\n  }\n\n  return { label, to, icon };\n};\n\nconst SearchForm = forwardRef((props, ref) => {\n  const { t } = useLingui();\n  const { instance } = api();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [searchMenuOpen, setSearchMenuOpen] = useState(false);\n  const [query, setQuery] = useState(searchParams.get('q') || '');\n  const type = searchParams.get('type');\n  const formRef = useRef(null);\n\n  const searchFieldRef = useRef(null);\n  useImperativeHandle(ref, () => ({\n    setValue: (value) => {\n      setQuery(value);\n    },\n    focus: () => {\n      searchFieldRef.current.focus();\n    },\n    select: () => {\n      searchFieldRef.current.select();\n    },\n    blur: () => {\n      searchFieldRef.current.blur();\n    },\n  }));\n\n  const searchHistory = useMemo(\n    () => getSearchHistory({ limit: 5 }),\n    [props?.hidden],\n  );\n\n  const searchSuggestionsData = useMemo(() => {\n    if (!query) return [];\n\n    const matchingHistory = searchHistory\n      .filter((historyItem) => {\n        // Filter out exact matches with current query\n        if (historyItem.query === query) return false;\n        // Check if history item contains the current query (case insensitive)\n        return historyItem.query.toLowerCase().includes(query.toLowerCase());\n      })\n      .slice(0, 2); // Max 2 recent searches\n\n    const recentSearchItems = matchingHistory.map((historyItem) => ({\n      ...generateSearchItemData(\n        historyItem.query,\n        historyItem.queryType,\n        instance,\n      ),\n      queryType: historyItem.queryType,\n      isRecentSearch: true,\n      historyItem,\n    }));\n\n    const allItems = [\n      // General search\n      {\n        ...generateSearchItemData(query, null, instance),\n        top: !type && !/\\s/.test(query),\n        hidden: !!type,\n      },\n      // Recent searches\n      ...recentSearchItems,\n      // Posts search\n      {\n        ...generateSearchItemData(query, 'statuses', instance),\n        hidden: /^https?:/.test(query),\n        top: /\\s/.test(query),\n        queryType: 'statuses',\n      },\n      // Hashtag search\n      {\n        ...generateSearchItemData(query, 'hashtags', instance),\n        hidden:\n          /^[@]/.test(query) || /^https?:/.test(query) || /\\s/.test(query),\n        top: /^[#]/.test(query),\n        type: 'link',\n        queryType: 'hashtags',\n      },\n      // URL lookup (unique case)\n      {\n        label: (\n          <Trans>\n            Look up <mark>{query}</mark>\n          </Trans>\n        ),\n        to: `/${query}`,\n        hidden: !/^https?:/.test(query),\n        top: /^https?:/.test(query),\n        type: 'link',\n        icon: 'arrow-right',\n      },\n      // Accounts search\n      {\n        ...generateSearchItemData(query, 'accounts', instance),\n        queryType: 'accounts',\n      },\n    ];\n\n    return allItems\n      .sort((a, b) => {\n        if (type) {\n          if (a.queryType === type) return -1;\n          if (b.queryType === type) return 1;\n        }\n        if (a.top && !b.top) return -1;\n        if (!a.top && b.top) return 1;\n        return 0;\n      })\n      .filter(({ hidden }) => !hidden);\n  }, [query, type, instance]);\n\n  return (\n    <form\n      ref={formRef}\n      class=\"search-popover-container\"\n      onSubmit={(e) => {\n        e.preventDefault();\n\n        const isSearchPage = /\\/search/.test(location.hash);\n        if (isSearchPage) {\n          if (query) {\n            const params = {\n              q: query,\n            };\n            if (type) params.type = type; // Preserve type\n            setSearchParams(params);\n          } else {\n            setSearchParams({});\n          }\n        } else {\n          if (query) {\n            location.hash = `/search?q=${encodeURIComponent(query)}${\n              type ? `&type=${type}` : ''\n            }`;\n          } else {\n            location.hash = `/search`;\n          }\n        }\n\n        addToSearchHistory(query, type);\n\n        props?.onSubmit?.(e);\n      }}\n    >\n      <input\n        ref={searchFieldRef}\n        value={query}\n        name=\"q\"\n        type=\"search\"\n        // autofocus\n        placeholder={t`Search`}\n        dir=\"auto\"\n        autocomplete=\"off\"\n        autocorrect=\"off\"\n        autocapitalize=\"off\"\n        spellCheck=\"false\"\n        enterKeyHint=\"search\"\n        onSearch={(e) => {\n          if (!e.target.value) {\n            setSearchParams({});\n          }\n        }}\n        onInput={(e) => {\n          setQuery(e.target.value);\n          setSearchMenuOpen(true);\n        }}\n        onFocus={() => {\n          setSearchMenuOpen(true);\n          // Focus first item\n          const firstItem = formRef.current?.querySelector(\n            '.search-popover-item',\n          );\n          if (firstItem) {\n            firstItem.classList.add('focus');\n          }\n        }}\n        onBlur={() => {\n          setTimeout(() => {\n            setSearchMenuOpen(false);\n          }, 100);\n          formRef.current\n            ?.querySelector('.search-popover-item.focus')\n            ?.classList.remove('focus');\n        }}\n        onKeyDown={(e) => {\n          const { key } = e;\n          switch (key) {\n            case 'Escape':\n              setSearchMenuOpen(false);\n              break;\n            case 'Down':\n            case 'ArrowDown':\n              e.preventDefault();\n              if (searchMenuOpen) {\n                const focusItem = formRef.current.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  let nextItem = focusItem.nextElementSibling;\n                  while (nextItem && nextItem.hidden) {\n                    nextItem = nextItem.nextElementSibling;\n                  }\n                  if (nextItem) {\n                    nextItem.classList.add('focus');\n                    const siblings = Array.from(\n                      nextItem.parentElement.children,\n                    ).filter((el) => el !== nextItem);\n                    siblings.forEach((el) => {\n                      el.classList.remove('focus');\n                    });\n                  }\n                } else {\n                  const firstItem = formRef.current.querySelector(\n                    '.search-popover-item',\n                  );\n                  if (firstItem) {\n                    firstItem.classList.add('focus');\n                  }\n                }\n              }\n              break;\n            case 'Up':\n            case 'ArrowUp':\n              e.preventDefault();\n              if (searchMenuOpen) {\n                const focusItem = document.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  let prevItem = focusItem.previousElementSibling;\n                  while (prevItem && prevItem.hidden) {\n                    prevItem = prevItem.previousElementSibling;\n                  }\n                  if (prevItem) {\n                    prevItem.classList.add('focus');\n                    const siblings = Array.from(\n                      prevItem.parentElement.children,\n                    ).filter((el) => el !== prevItem);\n                    siblings.forEach((el) => {\n                      el.classList.remove('focus');\n                    });\n                  }\n                } else {\n                  const items = document.querySelectorAll(\n                    '.search-popover-item',\n                  );\n                  const lastItem = items[items.length - 1];\n                  if (lastItem) {\n                    lastItem.classList.add('focus');\n                  }\n                }\n              }\n              break;\n            case 'Enter':\n              if (searchMenuOpen) {\n                const focusItem = document.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  e.preventDefault();\n                  focusItem.click();\n                }\n                setSearchMenuOpen(false);\n                props?.onSubmit?.(e);\n              }\n              break;\n          }\n        }}\n      />\n      <div class=\"search-popover\" hidden={!searchMenuOpen}>\n        {/* Search History - show when no query */}\n        {!query && searchHistory.length > 0 && (\n          <div class=\"search-popover-recent-searches\">\n            <div class=\"search-popover-header\">\n              <Icon icon=\"history\" size=\"s\" />\n              <Trans>Recent searches</Trans>\n            </div>\n            {searchHistory.map((historyItem, i) => {\n              const { label, to, icon } = generateSearchItemData(\n                historyItem.query,\n                historyItem.queryType,\n                instance,\n              );\n\n              return (\n                <Link\n                  key={`${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`}\n                  to={to}\n                  class={`search-popover-item ${i === 0 ? 'focus' : ''}`}\n                  onClick={(e) => {\n                    addToSearchHistory(\n                      historyItem.query,\n                      historyItem.queryType,\n                    );\n                    props?.onSubmit?.(e);\n                  }}\n                >\n                  <Icon icon={icon} class=\"more-insignificant\" />\n                  <span>{label}</span>\n                </Link>\n              );\n            })}\n            <Link\n              to=\"/search\"\n              class=\"search-popover-item search-history-see-all\"\n            >\n              <Icon icon=\"more2\" class=\"more-insignificant\" />\n              <span>\n                <Trans>See all</Trans>\n              </span>\n            </Link>\n          </div>\n        )}\n\n        {/* Search Suggestions - show when there's a query */}\n        {searchSuggestionsData.map(\n          ({ label, to, icon, queryType, isRecentSearch, historyItem }, i) => (\n            <Link\n              key={\n                isRecentSearch\n                  ? `recent-${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`\n                  : `suggestion-${queryType || 'general'}-${i}`\n              }\n              to={to}\n              class={`search-popover-item ${isRecentSearch ? 'search-popover-item-recent' : ''} ${i === 0 ? 'focus' : ''}`}\n              onClick={(e) => {\n                if (!isRecentSearch) {\n                  addToSearchHistory(query, queryType);\n                }\n                props?.onSubmit?.(e);\n              }}\n            >\n              <Icon icon={icon} class=\"more-insignificant\" />\n              <span>{label}</span>\n            </Link>\n          ),\n        )}\n      </div>\n    </form>\n  );\n});\n\nexport default SearchForm;\n","import './search-command.css';\n\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport states from '../utils/states';\n\nimport SearchForm from './search-form';\n\nexport default memo(function SearchCommand({ onClose = () => {} }) {\n  const snapStates = useSnapshot(states);\n  const [showSearch, setShowSearch] = useState(false);\n  const searchFormRef = useRef(null);\n\n  useEffect(() => {\n    if (snapStates.showSearchCommand) {\n      const { query } = snapStates.showSearchCommand;\n      setShowSearch(true);\n      setTimeout(() => {\n        if (query) {\n          searchFormRef.current?.setValue?.(query);\n        }\n        searchFormRef.current?.focus?.();\n      }, 150);\n      states.showSearchCommand = false;\n    }\n  }, [snapStates.showSearchCommand]);\n\n  useHotkeys(\n    ['Slash', '/'],\n    (e) => {\n      setShowSearch(true);\n      setTimeout(() => {\n        searchFormRef.current?.focus?.();\n        searchFormRef.current?.select?.();\n      }, 0);\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => {\n        const isSearchPage = /\\/search/.test(location.hash);\n        const isYearInPostsPage = /\\/yip/.test(location.hash);\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return (\n          isSearchPage ||\n          isYearInPostsPage ||\n          hasModal ||\n          e.metaKey ||\n          e.ctrlKey ||\n          e.altKey ||\n          e.shiftKey\n        );\n      },\n    },\n  );\n\n  const closeSearch = () => {\n    setShowSearch(false);\n    onClose();\n  };\n\n  useHotkeys(\n    'esc',\n    (e) => {\n      searchFormRef.current?.blur?.();\n      closeSearch();\n    },\n    {\n      enabled: showSearch,\n      enableOnFormTags: true,\n      preventDefault: true,\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const hidden = !showSearch;\n\n  return (\n    <div\n      id=\"search-command-container\"\n      hidden={hidden}\n      onClick={(e) => {\n        console.log(e);\n        if (e.target === e.currentTarget) {\n          closeSearch();\n        }\n      }}\n    >\n      <SearchForm\n        ref={searchFormRef}\n        hidden={hidden}\n        onSubmit={() => {\n          closeSearch();\n        }}\n      />\n    </div>\n  );\n});\n","import './shortcuts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useNavigate } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport { SHORTCUTS_META } from '../components/shortcuts-settings';\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\nimport states from '../utils/states';\n\nimport AsyncText from './AsyncText';\nimport Icon from './icon';\nimport Link from './link';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuLink from './menu-link';\nimport Menu2 from './menu2';\nimport SubMenu2 from './submenu2';\n\nfunction Shortcuts() {\n  const { t, _ } = useLingui();\n  const { instance } = api();\n  const snapStates = useSnapshot(states);\n  const { shortcuts, settings } = snapStates;\n\n  if (!shortcuts.length) {\n    return null;\n  }\n  const isMultiColumnMode =\n    settings.shortcutsViewMode === 'multi-column' ||\n    (!settings.shortcutsViewMode && settings.shortcutsColumnsMode);\n\n  const menuRef = useRef();\n  const tabBarRef = useRef();\n\n  const hasLists = useRef(false);\n  const formattedShortcuts = shortcuts\n    .map((pin, i) => {\n      const { type, ...data } = pin;\n      if (!SHORTCUTS_META[type]) return null;\n      let { id, path, title, subtitle, icon } = SHORTCUTS_META[type];\n\n      if (typeof id === 'function') {\n        id = id(data, i);\n      }\n      if (typeof path === 'function') {\n        path = path(\n          {\n            ...data,\n            instance: data.instance || instance,\n          },\n          i,\n        );\n      }\n      if (typeof title === 'function') {\n        title = title(data, i);\n      } else if (title?.id) {\n        // Check if it's MessageDescriptor\n        title = _(title);\n      }\n      if (typeof subtitle === 'function') {\n        subtitle = subtitle(data, i);\n      } else if (subtitle?.id) {\n        // Check if it's MessageDescriptor\n        subtitle = _(subtitle);\n      }\n      if (typeof icon === 'function') {\n        icon = icon(data, i);\n      }\n\n      if (id === 'lists') {\n        hasLists.current = true;\n      }\n\n      return {\n        id,\n        path,\n        title,\n        subtitle,\n        icon,\n      };\n    })\n    .filter(Boolean);\n\n  // Auto-scroll to active tab on first render\n  useEffect(() => {\n    if (\n      snapStates.settings.shortcutsViewMode === 'tab-menu-bar' &&\n      tabBarRef.current\n    ) {\n      const timeoutId = setTimeout(() => {\n        const activeTab = tabBarRef.current?.querySelector('.is-active');\n        if (activeTab) {\n          activeTab.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n            inline: 'center',\n          });\n        }\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, []);\n\n  const navigate = useNavigate();\n  useHotkeys(\n    ['1', '2', '3', '4', '5', '6', '7', '8', '9'],\n    (e) => {\n      const index = parseInt(e.key, 10) - 1;\n      if (index < formattedShortcuts.length) {\n        const { path } = formattedShortcuts[index];\n        if (path) {\n          navigate(path);\n          menuRef.current?.closeMenu?.();\n        }\n      }\n    },\n    {\n      enabled: !isMultiColumnMode,\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [lists, setLists] = useState([]);\n\n  if (isMultiColumnMode) {\n    return null;\n  }\n\n  return (\n    <div id=\"shortcuts\">\n      {snapStates.settings.shortcutsViewMode === 'tab-menu-bar' ? (\n        <nav\n          ref={tabBarRef}\n          class=\"tab-bar\"\n          onContextMenu={(e) => {\n            e.preventDefault();\n            states.showShortcutsSettings = true;\n          }}\n        >\n          <ul>\n            {formattedShortcuts.map(\n              ({ id, path, title, subtitle, icon }, i) => {\n                return (\n                  <li key={`${i}-${id}-${title}-${subtitle}-${path}`}>\n                    <Link\n                      class={subtitle ? 'has-subtitle' : ''}\n                      to={path}\n                      onClick={(e) => {\n                        if (e.target.classList.contains('is-active')) {\n                          e.preventDefault();\n                          const page = document.getElementById(`${id}-page`);\n                          console.log(id, page);\n                          if (page) {\n                            page.scrollTop = 0;\n                            const updatesButton =\n                              page.querySelector('.updates-button');\n                            if (updatesButton) {\n                              updatesButton.click();\n                            }\n                          }\n                        }\n                      }}\n                    >\n                      <Icon icon={icon} size=\"xl\" />\n                      <span>\n                        <AsyncText>{title}</AsyncText>\n                        {subtitle && (\n                          <>\n                            <br />\n                            <small>{subtitle}</small>\n                          </>\n                        )}\n                      </span>\n                    </Link>\n                  </li>\n                );\n              },\n            )}\n          </ul>\n        </nav>\n      ) : (\n        <Menu2\n          instanceRef={menuRef}\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          menuClassName=\"glass-menu shortcuts-menu\"\n          gap={8}\n          position=\"anchor\"\n          onMenuChange={(e) => {\n            if (e.open && hasLists.current) {\n              getLists().then(setLists);\n            }\n          }}\n          menuButton={\n            <button\n              type=\"button\"\n              id=\"shortcuts-button\"\n              class=\"plain\"\n              onContextMenu={(e) => {\n                e.preventDefault();\n                states.showShortcutsSettings = true;\n              }}\n              onTransitionStart={(e) => {\n                // Close menu if the button disappears\n                try {\n                  const { target } = e;\n                  if (getComputedStyle(target).pointerEvents === 'none') {\n                    menuRef.current?.closeMenu?.();\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon icon=\"shortcut\" size=\"xl\" alt={t`Shortcuts`} />\n            </button>\n          }\n        >\n          {formattedShortcuts.map(({ id, path, title, subtitle, icon }, i) => {\n            if (id === 'lists') {\n              return (\n                <SubMenu2\n                  menuClassName=\"glass-menu\"\n                  overflow=\"auto\"\n                  gap={-8}\n                  label={\n                    <>\n                      <Icon icon={icon} size=\"l\" />\n                      <span class=\"menu-grow\">\n                        <AsyncText>{title}</AsyncText>\n                      </span>\n                      <Icon icon=\"chevron-right\" />\n                    </>\n                  }\n                >\n                  <MenuLink to=\"/l\">\n                    <span>\n                      <Trans>All Lists</Trans>\n                    </span>\n                  </MenuLink>\n                  <MenuDivider />\n                  {lists?.map((list) => (\n                    <MenuLink key={list.id} to={`/l/${list.id}`}>\n                      <span>\n                        {list.title}\n                        {list.exclusive && (\n                          <>\n                            {' '}\n                            <ListExclusiveBadge />\n                          </>\n                        )}\n                      </span>\n                    </MenuLink>\n                  ))}\n                </SubMenu2>\n              );\n            }\n\n            return (\n              <MenuLink\n                to={path}\n                key={`${i}-${id}-${title}-${subtitle}-${path}`}\n                class=\"glass-menu-item\"\n              >\n                <Icon icon={icon} size=\"l\" />{' '}\n                <span class=\"menu-grow\">\n                  <span>\n                    <AsyncText>{title}</AsyncText>\n                  </span>\n                  {subtitle && (\n                    <>\n                      {' '}\n                      <small class=\"more-insignificant\">{subtitle}</small>\n                    </>\n                  )}\n                </span>\n                <span class=\"menu-shortcut hide-until-focus-visible\">\n                  {i + 1}\n                </span>\n              </MenuLink>\n            );\n          })}\n        </Menu2>\n      )}\n    </div>\n  );\n}\n\nexport default memo(Shortcuts);\n","import { api } from './api';\nimport { extractTagsFromStatus, getFollowedTags } from './followed-tags';\nimport pmem from './pmem';\nimport { fetchRelationships } from './relationships';\nimport states, { saveStatus, statusKey } from './states';\nimport store from './store';\nimport supports from './supports';\n\nexport function groupBoosts(values) {\n  let newValues = [];\n  let boostStash = [];\n  let serialBoosts = 0;\n  for (let i = 0; i < values.length; i++) {\n    const item = values[i];\n    if (item.reblog && !item.account?.group) {\n      boostStash.push(item);\n      serialBoosts++;\n    } else {\n      newValues.push(item);\n      if (serialBoosts < 3) {\n        serialBoosts = 0;\n      }\n    }\n  }\n  // if boostStash is more than quarter of values\n  // or if there are 3 or more boosts in a row\n  if (\n    values.length > 10 &&\n    (boostStash.length > values.length / 4 || serialBoosts >= 3)\n  ) {\n    // if boostStash is more than 3 quarter of values\n    const boostStashID = boostStash.map((status) => status.id);\n    if (boostStash.length > (values.length * 3) / 4) {\n      // insert boost array at the end of specialHome list\n      newValues = [\n        ...newValues,\n        { id: boostStashID, items: boostStash, type: 'boosts' },\n      ];\n    } else {\n      // insert boosts array in the middle of specialHome list\n      const half = Math.floor(newValues.length / 2);\n      newValues = [\n        ...newValues.slice(0, half),\n        {\n          id: boostStashID,\n          items: boostStash,\n          type: 'boosts',\n        },\n        ...newValues.slice(half),\n      ];\n    }\n    return newValues;\n  } else {\n    return values;\n  }\n}\n\nexport function dedupeBoosts(items, instance) {\n  const boostedStatusIDs = store.account.get('boostedStatusIDs') || {};\n  const filteredItems = items.filter((item) => {\n    if (!item.reblog) return true;\n    const statusKey = `${instance}-${item.reblog.id}`;\n    const boosterID = boostedStatusIDs[statusKey];\n    if (boosterID && boosterID !== item.id) {\n      console.warn(\n        ` Duplicate boost by ${item.account.displayName}`,\n        item,\n        item.reblog,\n      );\n      return false;\n    } else {\n      boostedStatusIDs[statusKey] = item.id;\n    }\n    return true;\n  });\n  // Limit to 50\n  const keys = Object.keys(boostedStatusIDs);\n  if (keys.length > 50) {\n    keys.slice(0, keys.length - 50).forEach((key) => {\n      delete boostedStatusIDs[key];\n    });\n  }\n  store.account.set('boostedStatusIDs', boostedStatusIDs);\n  return filteredItems;\n}\n\nexport function groupContext(items, instance) {\n  const contexts = [];\n  let contextIndex = 0;\n  items.forEach((item) => {\n    for (let i = 0; i < contexts.length; i++) {\n      if (contexts[i].find((t) => t.id === item.id)) return;\n      if (\n        contexts[i].find((t) => t.id === item.inReplyToId) ||\n        contexts[i].find((t) => t.inReplyToId === item.id)\n      ) {\n        contexts[i].push(item);\n        return;\n      }\n    }\n    const repliedItem = items.find((i) => i.id === item.inReplyToId);\n    if (repliedItem) {\n      contexts[contextIndex++] = [item, repliedItem];\n    }\n  });\n\n  // Check for cross-item contexts\n  // Merge contexts into one if they have a common item (same id)\n  for (let i = 0; i < contexts.length; i++) {\n    for (let j = i + 1; j < contexts.length; j++) {\n      const commonItem = contexts[i].find((t) => contexts[j].includes(t));\n      if (commonItem) {\n        contexts[i] = [...contexts[i], ...contexts[j]];\n        // Remove duplicate items\n        contexts[i] = contexts[i].filter(\n          (item, index, self) =>\n            self.findIndex((t) => t.id === item.id) === index,\n        );\n        contexts.splice(j, 1);\n        j--;\n      }\n    }\n  }\n\n  // Sort items by checking inReplyToId\n  contexts.forEach((context) => {\n    context.sort((a, b) => {\n      if (!a.inReplyToId && !b.inReplyToId) {\n        return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n      }\n      if (a.inReplyToId === b.id) return 1;\n      if (b.inReplyToId === a.id) return -1;\n      if (!a.inReplyToId) return -1;\n      if (!b.inReplyToId) return 1;\n      return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n    });\n  });\n\n  // Tag items that has different author than first post's author\n  contexts.forEach((context) => {\n    const firstItemAccountID = context[0].account.id;\n    context.forEach((item) => {\n      if (item.account.id !== firstItemAccountID) {\n        item._differentAuthor = true;\n      }\n    });\n  });\n\n  if (contexts.length) console.log(' Contexts', contexts);\n\n  const newItems = [];\n  const appliedContextIndices = [];\n  const inReplyToIds = [];\n  items.forEach((item) => {\n    if (item.reblog) {\n      newItems.push(item);\n      return;\n    }\n    for (let i = 0; i < contexts.length; i++) {\n      if (contexts[i].find((t) => t.id === item.id)) {\n        if (appliedContextIndices.includes(i)) return;\n        const contextItems = contexts[i];\n        contextItems.sort((a, b) => {\n          return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n        });\n        const firstItemAccountID = contextItems[0].account.id;\n        newItems.push({\n          id: contextItems.map((i) => i.id),\n          items: contextItems,\n          type: contextItems.every((it) => it.account.id === firstItemAccountID)\n            ? 'thread'\n            : 'conversation',\n        });\n        appliedContextIndices.push(i);\n        return;\n      }\n    }\n\n    // PREPARE FOR REPLY HINTS\n    if (item.inReplyToId && item.inReplyToAccountId !== item.account.id) {\n      const sKey = statusKey(item.id, instance);\n      if (!states.statusReply[sKey]) {\n        // If it's a reply and not a thread\n        inReplyToIds.push({\n          sKey,\n          inReplyToId: item.inReplyToId,\n        });\n        // queueMicrotask(async () => {\n        //   try {\n        //     const { masto } = api({ instance });\n        //     // const replyToStatus = await masto.v1.statuses\n        //     //   .$select(item.inReplyToId)\n        //     //   .fetch();\n        //     const replyToStatus = await fetchStatus(item.inReplyToId, masto);\n        //     saveStatus(replyToStatus, instance, {\n        //       skipThreading: true,\n        //       skipUnfurling: true,\n        //     });\n        //     states.statusReply[sKey] = {\n        //       id: replyToStatus.id,\n        //       instance,\n        //     };\n        //   } catch (e) {\n        //     // Silently fail\n        //     console.error(e);\n        //   }\n        // });\n      }\n    }\n\n    newItems.push(item);\n  });\n\n  // FETCH AND SHOW REPLY HINTS\n  if (inReplyToIds?.length) {\n    queueMicrotask(() => {\n      const { masto } = api({ instance });\n      console.log('REPLYHINT', inReplyToIds);\n\n      // Fallback if batch fetch fails or returns nothing or not supported\n      async function fallbackFetch() {\n        for (let i = 0; i < inReplyToIds.length; i++) {\n          const { sKey, inReplyToId } = inReplyToIds[i];\n          try {\n            const replyToStatus = await fetchStatus(inReplyToId, masto);\n            saveStatus(replyToStatus, instance, {\n              skipThreading: true,\n            });\n            states.statusReply[sKey] = {\n              id: replyToStatus.id,\n              instance,\n            };\n            // Pause 1s\n            await new Promise((resolve) => setTimeout(resolve, 1000));\n          } catch (e) {\n            // Silently fail\n            console.error(e);\n          }\n        }\n      }\n\n      if (supports('@mastodon/fetch-multiple-statuses')) {\n        // This is batch fetching yooo, woot\n        // Limit 20, returns 422 if exceeded https://github.com/mastodon/mastodon/pull/27871\n        const ids = inReplyToIds.map(({ inReplyToId }) => inReplyToId);\n        (async () => {\n          try {\n            const replyToStatuses = await masto.v1.statuses.list({ id: ids });\n            if (replyToStatuses?.length) {\n              for (const replyToStatus of replyToStatuses) {\n                saveStatus(replyToStatus, instance, {\n                  skipThreading: true,\n                });\n                const sKey = inReplyToIds.find(\n                  ({ inReplyToId }) => inReplyToId === replyToStatus.id,\n                )?.sKey;\n                if (sKey) {\n                  states.statusReply[sKey] = {\n                    id: replyToStatus.id,\n                    instance,\n                  };\n                }\n              }\n            } else {\n              fallbackFetch();\n            }\n          } catch (e) {\n            // Silently fail\n            console.error(e);\n            fallbackFetch();\n          }\n        })();\n      } else {\n        fallbackFetch();\n      }\n    });\n  }\n\n  return newItems;\n}\n\nconst fetchStatus = pmem((statusID, masto) => {\n  return masto.v1.statuses.$select(statusID).fetch();\n});\n\nexport async function assignFollowedTags(items, instance) {\n  const followedTags = await getFollowedTags(); // [{name: 'tag'}, {...}]\n  if (!followedTags.length) return;\n  const { statusFollowedTags } = states;\n  console.log('statusFollowedTags', statusFollowedTags);\n  const statusWithFollowedTags = [];\n  items.forEach((item) => {\n    if (item.reblog) return;\n    const { id, content, tags = [] } = item;\n    const sKey = statusKey(id, instance);\n    if (statusFollowedTags[sKey]?.length) return;\n    const extractedTags = extractTagsFromStatus(content);\n    if (!extractedTags.length && !tags.length) return;\n    const itemFollowedTags = followedTags.reduce((acc, tag) => {\n      if (\n        extractedTags.some((t) => t.toLowerCase() === tag.name.toLowerCase()) ||\n        tags.some((t) => t.name.toLowerCase() === tag.name.toLowerCase())\n      ) {\n        acc.push(tag.name);\n      }\n      return acc;\n    }, []);\n    if (itemFollowedTags.length) {\n      // statusFollowedTags[sKey] = itemFollowedTags;\n      statusWithFollowedTags.push({\n        item,\n        sKey,\n        followedTags: itemFollowedTags,\n      });\n    }\n  });\n\n  if (statusWithFollowedTags.length) {\n    const accounts = statusWithFollowedTags.map((s) => s.item.account);\n    const relationships = await fetchRelationships(accounts);\n    if (!relationships) return;\n\n    statusWithFollowedTags.forEach((s) => {\n      const { item, sKey, followedTags } = s;\n      const r = relationships[item.account.id];\n      if (r && !r.following) {\n        statusFollowedTags[sKey] = followedTags;\n      }\n    });\n  }\n}\n\nexport function clearFollowedTagsState() {\n  states.statusFollowedTags = {};\n}\n","import { useLayoutEffect, useState } from 'preact/hooks';\n\nexport default function useScroll({\n  scrollableRef,\n  distanceFromStart = 1, // ratio of clientHeight/clientWidth\n  distanceFromEnd = 1, // ratio of clientHeight/clientWidth\n  scrollThresholdStart = 10,\n  scrollThresholdEnd = 10,\n  direction = 'vertical',\n  distanceFromStartPx: _distanceFromStartPx,\n  distanceFromEndPx: _distanceFromEndPx,\n} = {}) {\n  const [scrollDirection, setScrollDirection] = useState(null);\n  const [reachStart, setReachStart] = useState(false);\n  const [reachEnd, setReachEnd] = useState(false);\n  const [nearReachStart, setNearReachStart] = useState(false);\n  const [nearReachEnd, setNearReachEnd] = useState(false);\n  const isVertical = direction === 'vertical';\n\n  useLayoutEffect(() => {\n    const scrollableElement = scrollableRef.current;\n    if (!scrollableElement) return {};\n    let previousScrollStart = isVertical\n      ? scrollableElement.scrollTop\n      : scrollableElement.scrollLeft;\n\n    function onScroll() {\n      const {\n        scrollTop,\n        scrollLeft,\n        scrollHeight,\n        scrollWidth,\n        clientHeight,\n        clientWidth,\n      } = scrollableElement;\n      const scrollStart = isVertical ? scrollTop : scrollLeft;\n      const scrollDimension = isVertical ? scrollHeight : scrollWidth;\n      const clientDimension = isVertical ? clientHeight : clientWidth;\n      const scrollDistance = Math.abs(scrollStart - previousScrollStart);\n      const distanceFromStartPx =\n        _distanceFromStartPx ||\n        Math.min(\n          clientDimension * distanceFromStart,\n          scrollDimension,\n          scrollStart,\n        );\n      const distanceFromEndPx =\n        _distanceFromEndPx ||\n        Math.min(\n          clientDimension * distanceFromEnd,\n          scrollDimension,\n          scrollDimension - scrollStart - clientDimension,\n        );\n\n      if (\n        scrollDistance >=\n        (previousScrollStart < scrollStart\n          ? scrollThresholdEnd\n          : scrollThresholdStart)\n      ) {\n        setScrollDirection(previousScrollStart < scrollStart ? 'end' : 'start');\n        previousScrollStart = scrollStart;\n      }\n\n      setReachStart(scrollStart <= 0);\n      setReachEnd(scrollStart + clientDimension >= scrollDimension);\n      setNearReachStart(scrollStart <= distanceFromStartPx);\n      setNearReachEnd(\n        scrollStart + clientDimension >= scrollDimension - distanceFromEndPx,\n      );\n    }\n\n    scrollableElement.addEventListener('scroll', onScroll, { passive: true });\n\n    return () => scrollableElement.removeEventListener('scroll', onScroll);\n  }, [\n    distanceFromStart,\n    distanceFromEnd,\n    scrollThresholdStart,\n    scrollThresholdEnd,\n  ]);\n\n  return {\n    scrollDirection,\n    reachStart,\n    reachEnd,\n    nearReachStart,\n    nearReachEnd,\n    init: () => {\n      if (scrollableRef.current) {\n        scrollableRef.current.dispatchEvent(new Event('scroll'));\n      }\n    },\n  };\n}\n","import { useEffect, useLayoutEffect, useRef, useState } from 'preact/hooks';\nimport { useThrottledCallback } from 'use-debounce';\n\nexport default function useScrollFn(\n  {\n    scrollableRef,\n    distanceFromStart = 1, // ratio of clientHeight/clientWidth\n    distanceFromEnd = 1, // ratio of clientHeight/clientWidth\n    scrollThresholdStart = 10,\n    scrollThresholdEnd = 10,\n    direction = 'vertical',\n    distanceFromStartPx: _distanceFromStartPx,\n    distanceFromEndPx: _distanceFromEndPx,\n    init,\n  } = {},\n  callback,\n) {\n  if (!callback) return;\n  const isVertical = direction === 'vertical';\n  const previousScrollStart = useRef(null);\n  const scrollDirection = useRef(null);\n\n  const onScroll = useThrottledCallback(\n    () => {\n      let reachStart = false;\n      let reachEnd = false;\n      let nearReachStart = false;\n      let nearReachEnd = false;\n\n      const scrollableElement = scrollableRef.current;\n      const {\n        scrollTop,\n        scrollLeft,\n        scrollHeight,\n        scrollWidth,\n        clientHeight,\n        clientWidth,\n      } = scrollableElement;\n      const scrollStart = isVertical ? scrollTop : scrollLeft;\n      const scrollDimension = isVertical ? scrollHeight : scrollWidth;\n      const clientDimension = isVertical ? clientHeight : clientWidth;\n      const scrollDelta = scrollStart - previousScrollStart.current;\n      const isScrollingForward = scrollDelta > 0;\n      const threshold = isScrollingForward\n        ? scrollThresholdEnd\n        : scrollThresholdStart;\n      const distanceFromStartPx =\n        _distanceFromStartPx ||\n        Math.min(\n          clientDimension * distanceFromStart,\n          scrollDimension,\n          scrollStart,\n        );\n      const distanceFromEndPx =\n        _distanceFromEndPx ||\n        Math.min(\n          clientDimension * distanceFromEnd,\n          scrollDimension,\n          scrollDimension - scrollStart - clientDimension,\n        );\n\n      if (Math.abs(scrollDelta) >= threshold) {\n        scrollDirection.current = isScrollingForward ? 'end' : 'start';\n        previousScrollStart.current = scrollStart;\n      }\n\n      reachStart = scrollStart <= 0;\n      reachEnd = scrollStart + clientDimension >= scrollDimension;\n      nearReachStart = scrollStart <= distanceFromStartPx;\n      nearReachEnd =\n        scrollStart + clientDimension >= scrollDimension - distanceFromEndPx;\n\n      callback({\n        scrollDirection: scrollDirection.current,\n        reachStart,\n        reachEnd,\n        nearReachStart,\n        nearReachEnd,\n      });\n    },\n    500,\n    {\n      leading: false,\n    },\n  );\n\n  useLayoutEffect(() => {\n    const scrollableElement = scrollableRef.current;\n    if (scrollableElement) {\n      previousScrollStart.current =\n        scrollableElement[isVertical ? 'scrollTop' : 'scrollLeft'];\n      scrollableElement.addEventListener('scroll', onScroll, { passive: true });\n    }\n    return () => {\n      if (scrollableElement) {\n        scrollableElement.removeEventListener('scroll', onScroll);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (init && scrollableRef.current) {\n      queueMicrotask(() => {\n        scrollableRef.current.dispatchEvent(new Event('scroll'));\n      });\n    }\n  }, [init]);\n\n  return {\n    resetScrollDirection: () => {\n      scrollDirection.current = null;\n    },\n  };\n}\n","import './media-post.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useContext, useMemo } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport { getPreferences } from '../utils/api';\nimport FilterContext from '../utils/filter-context';\nimport { isFiltered } from '../utils/filters';\nimport states, { statusKey } from '../utils/states';\nimport store from '../utils/store';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport Media from './media';\n\nfunction MediaPost({\n  class: className,\n  statusID,\n  status,\n  instance,\n  parent,\n  // allowFilters,\n  onMediaClick,\n}) {\n  const { t } = useLingui();\n  let sKey = statusKey(statusID, instance);\n  const snapStates = useSnapshot(states);\n  if (!status) {\n    status = snapStates.statuses[sKey] || snapStates.statuses[statusID];\n    sKey = statusKey(status?.id, instance);\n  }\n  if (!status) {\n    return null;\n  }\n\n  const {\n    account: {\n      acct,\n      avatar,\n      avatarStatic,\n      id: accountId,\n      url: accountURL,\n      displayName,\n      username,\n      emojis: accountEmojis,\n      bot,\n      group,\n    },\n    id,\n    repliesCount,\n    reblogged,\n    reblogsCount,\n    favourited,\n    favouritesCount,\n    bookmarked,\n    poll,\n    muted,\n    sensitive,\n    spoilerText,\n    visibility, // public, unlisted, private, direct\n    language,\n    editedAt,\n    filtered,\n    card,\n    createdAt,\n    inReplyToId,\n    inReplyToAccountId,\n    content,\n    mentions,\n    mediaAttachments,\n    reblog,\n    uri,\n    url,\n    emojis,\n    // Non-API props\n    _deleted,\n    _pinned,\n    // _filtered,\n  } = status;\n\n  if (!mediaAttachments?.length) {\n    return null;\n  }\n\n  const debugHover = (e) => {\n    if (e.shiftKey) {\n      console.log({\n        ...status,\n      });\n    }\n  };\n\n  const currentAccount = useMemo(() => {\n    return getCurrentAccountID();\n  }, []);\n  const isSelf = useMemo(() => {\n    return currentAccount && currentAccount === accountId;\n  }, [accountId, currentAccount]);\n\n  const filterContext = useContext(FilterContext);\n  const filterInfo = !isSelf && isFiltered(filtered, filterContext);\n\n  if (filterInfo?.action === 'hide') {\n    return null;\n  }\n\n  console.debug('RENDER Media post', id, status?.account.displayName);\n\n  const hasSpoiler = sensitive;\n  const prefs = getPreferences();\n  const readingExpandMedia =\n    prefs['reading:expand:media']?.toLowerCase() || 'default';\n  const showSpoilerMedia = readingExpandMedia === 'show_all';\n\n  const Parent = parent || 'div';\n\n  return mediaAttachments.map((media, i) => {\n    const mediaKey = `${sKey}-${media.id}`;\n    const filterTitleStr = filterInfo?.titlesStr;\n    return (\n      <Parent\n        data-state-post-id={sKey}\n        onMouseEnter={debugHover}\n        key={mediaKey}\n        data-spoiler-text={\n          spoilerText || (sensitive ? t`Sensitive media` : undefined)\n        }\n        data-filtered-text={\n          filterInfo\n            ? filterTitleStr\n              ? t`Filtered: ${filterTitleStr}`\n              : t`Filtered`\n            : undefined\n        }\n        class={`\n          media-post\n          ${filterInfo ? 'filtered' : ''}\n          ${hasSpoiler ? 'has-spoiler' : ''}\n          ${showSpoilerMedia ? 'show-media' : ''}\n        `}\n      >\n        <Media\n          class={className}\n          media={media}\n          lang={language}\n          to={`/${instance}/s/${id}?media-only=${i + 1}`}\n          onClick={\n            onMediaClick ? (e) => onMediaClick(e, i, media, status) : undefined\n          }\n        />\n      </Parent>\n    );\n  });\n}\n\nexport default memo(MediaPost);\n","import './nav-menu.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getAccounts, getCurrentAccountID } from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuLink from './menu-link';\nimport SubMenu2 from './submenu2';\n\nfunction NavMenu(props) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto, instance, authenticated } = api();\n\n  const [currentAccount, moreThanOneAccount] = useMemo(() => {\n    const accounts = getAccounts();\n    const acc =\n      accounts.find((account) => account.info.id === getCurrentAccountID()) ||\n      accounts[0];\n    return [acc, accounts.length > 1];\n  }, []);\n\n  // Home = Following\n  // But when in multi-column mode, Home becomes columns of anything\n  // User may choose pin or not to pin Following\n  // If user doesn't pin Following, we show it in the menu\n  const showFollowing =\n    (snapStates.settings.shortcutsViewMode === 'multi-column' ||\n      (!snapStates.settings.shortcutsViewMode &&\n        snapStates.settings.shortcutsColumnsMode)) &&\n    !snapStates.shortcuts.find((pin) => pin.type === 'following');\n\n  const bindLongPress = useLongPress(\n    () => {\n      states.showAccounts = true;\n    },\n    {\n      threshold: 600,\n      detect: 'touch',\n      cancelOnMovement: true,\n    },\n  );\n\n  const buttonRef = useRef();\n  const [menuState, setMenuState] = useState(undefined);\n\n  const boundingBoxPadding = safeBoundingBoxPadding([\n    0,\n    0,\n    snapStates.settings.shortcutsViewMode === 'tab-menu-bar' ? 50 : 0,\n    0,\n  ]);\n\n  const mutesIterator = useRef();\n  async function fetchMutes(firstLoad) {\n    if (firstLoad || !mutesIterator.current) {\n      mutesIterator.current = masto.v1.mutes\n        .list({\n          limit: 80,\n        })\n        .values();\n    }\n    const results = await mutesIterator.current.next();\n    return results;\n  }\n\n  const blocksIterator = useRef();\n  async function fetchBlocks(firstLoad) {\n    if (firstLoad || !blocksIterator.current) {\n      blocksIterator.current = masto.v1.blocks\n        .list({\n          limit: 80,\n        })\n        .values();\n    }\n    const results = await blocksIterator.current.next();\n    return results;\n  }\n\n  const buttonClickTS = useRef();\n  return (\n    <>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        class={`button plain nav-menu-button ${\n          moreThanOneAccount ? 'with-avatar' : ''\n        } ${menuState === 'open' ? 'active' : ''}`}\n        style={{ position: 'relative' }}\n        onClick={() => {\n          buttonClickTS.current = Date.now();\n          setMenuState((state) => (!state ? 'open' : undefined));\n        }}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          states.showAccounts = true;\n        }}\n        {...bindLongPress()}\n      >\n        {moreThanOneAccount && (\n          <Avatar\n            url={\n              currentAccount?.info?.avatar || currentAccount?.info?.avatarStatic\n            }\n            size=\"l\"\n            squircle={currentAccount?.info?.bot}\n          />\n        )}\n        <Icon icon=\"menu\" size={moreThanOneAccount ? 's' : 'l'} alt={t`Menu`} />\n      </button>\n      <ControlledMenu\n        menuClassName=\"nav-menu\"\n        state={menuState}\n        anchorRef={buttonRef}\n        onClose={() => {\n          setMenuState(undefined);\n        }}\n        containerProps={{\n          style: {\n            zIndex: 10,\n          },\n          onClick: () => {\n            if (Date.now() - buttonClickTS.current < 300) {\n              return;\n            }\n            // setMenuState(undefined);\n          },\n        }}\n        portal={{\n          target: document.body,\n        }}\n        {...props}\n        overflow=\"auto\"\n        viewScroll=\"close\"\n        position=\"anchor\"\n        align=\"center\"\n        boundingBoxPadding={boundingBoxPadding}\n        unmountOnClose\n      >\n        {!!snapStates.appVersion?.commitHash &&\n          __COMMIT_HASH__ !== snapStates.appVersion.commitHash && (\n            <div class=\"top-menu\">\n              <MenuItem\n                onClick={() => {\n                  const yes = confirm(t`Reload page now to update?`);\n                  if (yes) {\n                    (async () => {\n                      try {\n                        location.reload();\n                      } catch (e) {}\n                    })();\n                  }\n                }}\n              >\n                <Icon icon=\"sparkles\" class=\"sparkle-icon\" size=\"l\" />{' '}\n                <span>\n                  <Trans>New update available</Trans>\n                </span>\n              </MenuItem>\n              <MenuDivider />\n            </div>\n          )}\n        <section>\n          <MenuLink to=\"/\">\n            <Icon icon=\"home\" size=\"l\" />{' '}\n            <span>\n              <Trans>Home</Trans>\n            </span>\n          </MenuLink>\n          {authenticated ? (\n            <>\n              {showFollowing && (\n                <MenuLink to=\"/following\">\n                  <Icon icon=\"following\" size=\"l\" />{' '}\n                  <span>\n                    <Trans id=\"following.title\">Following</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <MenuLink to=\"/catchup\">\n                <Icon icon=\"history2\" size=\"l\" />\n                <span>\n                  <Trans>Catch-up</Trans>\n                </span>\n              </MenuLink>\n              {supports('@mastodon/mentions') && (\n                <MenuLink to=\"/mentions\">\n                  <Icon icon=\"at\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Mentions</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <MenuLink to=\"/notifications\">\n                <Icon icon=\"notification\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Notifications</Trans>\n                </span>\n                {snapStates.notificationsShowNew && (\n                  <sup title={t`New`} style={{ opacity: 0.5 }}>\n                    {' '}\n                    &bull;\n                  </sup>\n                )}\n              </MenuLink>\n              <MenuDivider />\n              {currentAccount?.info?.id && (\n                <MenuLink to={`/${instance}/a/${currentAccount.info.id}`}>\n                  <Icon icon=\"user\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Profile</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <ListMenu menuState={menuState} />\n              <MenuLink to=\"/b\">\n                <Icon icon=\"bookmark\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Bookmarks</Trans>\n                </span>\n              </MenuLink>\n              <SubMenu2\n                menuClassName=\"nav-submenu\"\n                overflow=\"auto\"\n                gap={-8}\n                label={\n                  <>\n                    <Icon icon=\"more\" size=\"l\" />\n                    <span class=\"menu-grow\">\n                      <Trans>More</Trans>\n                    </span>\n                    <Icon icon=\"chevron-right\" />\n                  </>\n                }\n              >\n                <MenuLink to=\"/f\">\n                  <Icon icon=\"heart\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Likes</Trans>\n                  </span>\n                </MenuLink>\n                <MenuLink to=\"/fh\">\n                  <Icon icon=\"hashtag\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Followed Hashtags</Trans>\n                  </span>\n                </MenuLink>\n                <MenuLink to=\"/sp\">\n                  <Icon icon=\"schedule\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Scheduled Posts</Trans>\n                  </span>\n                </MenuLink>\n                <MenuDivider />\n                {supports('@mastodon/filters') && (\n                  <MenuLink to=\"/ft\">\n                    <Icon icon=\"filters\" size=\"l\" />{' '}\n                    <span>\n                      <Trans>Filters</Trans>\n                    </span>\n                  </MenuLink>\n                )}\n                <MenuItem\n                  onClick={() => {\n                    states.showGenericAccounts = {\n                      id: 'mute',\n                      heading: t`Muted users`,\n                      fetchAccounts: fetchMutes,\n                      excludeRelationshipAttrs: ['muting'],\n                    };\n                  }}\n                >\n                  <Icon icon=\"mute\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Muted users</Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    states.showGenericAccounts = {\n                      id: 'block',\n                      heading: t`Blocked users`,\n                      fetchAccounts: fetchBlocks,\n                      excludeRelationshipAttrs: ['blocking'],\n                    };\n                  }}\n                >\n                  <Icon icon=\"block\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Blocked users</Trans>\n                  </span>\n                </MenuItem>{' '}\n              </SubMenu2>\n              <MenuDivider />\n              <MenuItem\n                onClick={() => {\n                  states.showAccounts = true;\n                }}\n              >\n                <Icon icon=\"group\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Accounts</Trans>\n                </span>\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              <MenuDivider />\n              <MenuLink to=\"/login\">\n                <Icon icon=\"user\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Log in</Trans>\n                </span>\n              </MenuLink>\n            </>\n          )}\n        </section>\n        <section>\n          <MenuDivider />\n          <MenuLink to={`/search`}>\n            <Icon icon=\"search\" size=\"l\" />{' '}\n            <span>\n              <Trans>Search</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/trending`}>\n            <Icon icon=\"chart\" size=\"l\" />{' '}\n            <span>\n              <Trans>Trending</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/p/l`}>\n            <Icon icon=\"building\" size=\"l\" />{' '}\n            <span>\n              <Trans>Local</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/p`}>\n            <Icon icon=\"earth\" size=\"l\" />{' '}\n            <span>\n              <Trans>Federated</Trans>\n            </span>\n          </MenuLink>\n          {authenticated ? (\n            <>\n              <MenuDivider className=\"divider-grow\" />\n              <MenuItem\n                onClick={() => {\n                  states.showKeyboardShortcutsHelp = true;\n                }}\n              >\n                <Icon icon=\"keyboard\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Keyboard shortcuts</Trans>\n                </span>\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  states.showShortcutsSettings = true;\n                }}\n              >\n                <Icon icon=\"shortcut\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Shortcuts / Columns</Trans>\n                </span>\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  states.showSettings = true;\n                }}\n              >\n                <Icon icon=\"gear\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Settings</Trans>\n                </span>\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              <MenuDivider />\n              <MenuItem\n                onClick={() => {\n                  states.showSettings = true;\n                }}\n              >\n                <Icon icon=\"gear\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Settings</Trans>\n                </span>\n              </MenuItem>\n            </>\n          )}\n        </section>\n      </ControlledMenu>\n    </>\n  );\n}\n\nfunction ListMenu({ menuState }) {\n  const supportsLists = supports('@mastodon/lists');\n  const [lists, setLists] = useState([]);\n  useEffect(() => {\n    if (!supportsLists) return;\n    if (menuState === 'open') {\n      getLists().then(setLists);\n    }\n  }, [menuState, supportsLists]);\n\n  return lists.length > 0 ? (\n    <SubMenu2\n      menuClassName=\"nav-submenu\"\n      overflow=\"auto\"\n      gap={-8}\n      label={\n        <>\n          <Icon icon=\"list\" size=\"l\" />\n          <span class=\"menu-grow\">\n            <Trans>Lists</Trans>\n          </span>\n          <Icon icon=\"chevron-right\" />\n        </>\n      }\n    >\n      <MenuLink to=\"/l\">\n        <span>\n          <Trans>All Lists</Trans>\n        </span>\n      </MenuLink>\n      {lists?.length > 0 && (\n        <>\n          <MenuDivider />\n          {lists.map((list) => (\n            <MenuLink key={list.id} to={`/l/${list.id}`}>\n              <span>\n                {list.title}\n                {list.exclusive && (\n                  <>\n                    {' '}\n                    <ListExclusiveBadge />\n                  </>\n                )}\n              </span>\n            </MenuLink>\n          ))}\n        </>\n      )}\n    </SubMenu2>\n  ) : (\n    supportsLists && (\n      <MenuLink to=\"/l\">\n        <Icon icon=\"list\" size=\"l\" />\n        <span>\n          <Trans>Lists</Trans>\n        </span>\n      </MenuLink>\n    )\n  );\n}\n\nexport default memo(NavMenu);\n","import { plural } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useDebouncedCallback } from 'use-debounce';\nimport { useSnapshot } from 'valtio';\n\nimport FilterContext from '../utils/filter-context';\nimport { filteredItems, isFiltered } from '../utils/filters';\nimport isRTL from '../utils/is-rtl';\nimport showToast from '../utils/show-toast';\nimport states, { statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { isMediaFirstInstance } from '../utils/store-utils';\nimport { groupBoosts, groupContext } from '../utils/timeline-utils';\nimport useInterval from '../utils/useInterval';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useScroll from '../utils/useScroll';\nimport useScrollFn from '../utils/useScrollFn';\n\nimport Icon from './icon';\nimport Link from './link';\nimport MediaPost from './media-post';\nimport NavMenu from './nav-menu';\nimport Status from './status';\nimport ThreadBadge from './thread-badge';\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'instant',\n};\n\nfunction Timeline({\n  title,\n  titleComponent,\n  id,\n  instance,\n  emptyText,\n  errorText,\n  useItemID, // use statusID instead of status object, assuming it's already in states\n  boostsCarousel,\n  fetchItems = () => {},\n  checkForUpdates = () => {},\n  checkForUpdatesInterval = 15_000, // 15 seconds\n  headerStart,\n  headerEnd,\n  timelineStart,\n  // allowFilters,\n  refresh,\n  view,\n  filterContext,\n  showFollowedTags,\n  showReplyParent,\n  clearWhenRefresh,\n}) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const [items, setItems] = useState([]);\n  const [uiState, setUIState] = useState('start');\n  const [showMore, setShowMore] = useState(false);\n  const [showNew, setShowNew] = useState(false);\n  const [visible, setVisible] = useState(true);\n  const scrollableRef = useRef();\n\n  console.debug('RENDER Timeline', id, refresh);\n  __BENCHMARK.start(`timeline-${id}-load`);\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  const allowGrouping = view !== 'media';\n  const loadItemsTS = useRef(0); // Ensures only one loadItems at a time\n  const loadItems = useDebouncedCallback(\n    (firstLoad) => {\n      setShowNew(false);\n      // if (uiState === 'loading') return;\n      setUIState('loading');\n      (async () => {\n        try {\n          const ts = (loadItemsTS.current = Date.now());\n          let { done, value } = await fetchItems(firstLoad);\n          if (ts !== loadItemsTS.current) return;\n          if (Array.isArray(value)) {\n            // Avoid grouping for pinned posts\n            const [pinnedPosts, otherPosts] = value.reduce(\n              (acc, item) => {\n                if (item._pinned) {\n                  acc[0].push(item);\n                } else {\n                  acc[1].push(item);\n                }\n                return acc;\n              },\n              [[], []],\n            );\n            value = otherPosts;\n            if (allowGrouping) {\n              if (boostsCarousel) {\n                value = groupBoosts(value);\n              }\n              value = groupContext(value, instance);\n            }\n            if (pinnedPosts.length) {\n              value = pinnedPosts.concat(value);\n            }\n            console.log(value);\n            if (firstLoad) {\n              setItems(value);\n            } else {\n              setItems((items) => [...items, ...value]);\n            }\n            if (!value.length) done = true;\n            setShowMore(!done);\n          } else {\n            setShowMore(false);\n          }\n          setUIState('default');\n          __BENCHMARK.end(`timeline-${id}-load`);\n        } catch (e) {\n          console.error(e);\n          setUIState('error');\n          if (firstLoad && !items.length && errorText) {\n            showToast(errorText);\n          }\n        } finally {\n          loadItems.cancel();\n        }\n      })();\n    },\n    1_000,\n    {\n      leading: true,\n      // trailing: false,\n    },\n  );\n\n  const itemsSelector = '.timeline-item, .timeline-item-alt';\n\n  const jRef = useHotkeys(\n    'j, shift+j',\n    (e, handler) => {\n      // Fix bug: shift+j is fired even when j is pressed due to useKey: true\n      if (e.shiftKey !== handler.shift) return;\n\n      // focus on next status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      ).filter((item) => !!item.offsetHeight);\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (handler.shift) {\n          // get next status that's not .timeline-item-alt\n          nextItem = allItems.find(\n            (item, index) =>\n              index > activeItemIndex &&\n              !item.classList.contains('timeline-item-alt'),\n          );\n        }\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k, shift+k',\n    (e, handler) => {\n      // Fix bug: shift+k is fired even when k is pressed due to useKey: true\n      if (e.shiftKey !== handler.shift) return;\n\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      ).filter((item) => !!item.offsetHeight);\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (handler.shift) {\n          // get prev status that's not .timeline-item-alt\n          prevItem = allItems.findLast(\n            (item, index) =>\n              index < activeItemIndex &&\n              !item.classList.contains('timeline-item-alt'),\n          );\n        }\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey,\n    },\n  );\n\n  const oRef = useHotkeys(\n    ['enter', 'o'],\n    () => {\n      // open active status\n      const activeItem = document.activeElement;\n      if (activeItem?.matches(itemsSelector)) {\n        activeItem.click();\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const showNewPostsIndicator =\n    items.length > 0 && uiState !== 'loading' && showNew;\n  const handleLoadNewPosts = useCallback(() => {\n    if (showNewPostsIndicator) loadItems(true);\n    scrollableRef.current?.scrollTo({\n      top: 0,\n      behavior: 'smooth',\n    });\n  }, [loadItems, showNewPostsIndicator]);\n  const dotRef = useHotkeys('.', handleLoadNewPosts, {\n    useKey: true,\n    ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n  });\n\n  // const {\n  //   scrollDirection,\n  //   nearReachStart,\n  //   nearReachEnd,\n  //   reachStart,\n  //   reachEnd,\n  // } = useScroll({\n  //   scrollableRef,\n  //   distanceFromEnd: 2,\n  //   scrollThresholdStart: 44,\n  // });\n  const headerRef = useRef();\n  // const [hiddenUI, setHiddenUI] = useState(false);\n  const [nearReachStart, setNearReachStart] = useState(false);\n  const scrollFnCallback = useCallback(\n    ({ scrollDirection, nearReachStart, reachStart }) => {\n      if (headerRef.current) {\n        const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n        headerRef.current.hidden = hiddenUI;\n      }\n      setNearReachStart(nearReachStart);\n      if (reachStart) {\n        loadItems(true);\n      }\n    },\n    [setNearReachStart, loadItems],\n  );\n  const { resetScrollDirection } = useScrollFn(\n    {\n      scrollableRef,\n      distanceFromEnd: 2,\n      scrollThresholdStart: 44,\n    },\n    scrollFnCallback,\n  );\n\n  useEffect(() => {\n    scrollableRef.current?.scrollTo({ top: 0 });\n    loadItems(true);\n  }, []);\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    if (firstLoad.current) {\n      firstLoad.current = false;\n      return;\n    }\n    if (clearWhenRefresh && items?.length) {\n      loadItems.cancel?.();\n      setItems([]);\n    }\n    loadItems(true);\n  }, [clearWhenRefresh, refresh]);\n\n  // useEffect(() => {\n  //   if (reachStart) {\n  //     loadItems(true);\n  //   }\n  // }, [reachStart]);\n\n  // useEffect(() => {\n  //   if (nearReachEnd || (reachEnd && showMore)) {\n  //     loadItems();\n  //   }\n  // }, [nearReachEnd, showMore]);\n\n  const prevView = useRef(view);\n  useEffect(() => {\n    if (prevView.current !== view) {\n      prevView.current = view;\n      setItems([]);\n    }\n  }, [view]);\n\n  const loadOrCheckUpdates = useCallback(\n    async ({ disableIdleCheck = false } = {}) => {\n      const noPointers = scrollableRef.current\n        ? getComputedStyle(scrollableRef.current).pointerEvents === 'none'\n        : false;\n      console.log(' Load or check updates', id, {\n        autoRefresh: snapStates.settings.autoRefresh,\n        scrollTop: scrollableRef.current.scrollTop,\n        disableIdleCheck,\n        idle: window.__IDLE__,\n        inBackground: inBackground(),\n        noPointers,\n      });\n      if (\n        snapStates.settings.autoRefresh &&\n        scrollableRef.current.scrollTop < 16 &&\n        (disableIdleCheck || window.__IDLE__) &&\n        !inBackground() &&\n        !noPointers\n      ) {\n        console.log(' Load updates', id, snapStates.settings.autoRefresh);\n        loadItems(true);\n      } else {\n        console.log(' Check updates', id, snapStates.settings.autoRefresh);\n        const hasUpdate = await checkForUpdates();\n        if (hasUpdate) {\n          console.log(' Has new updates', id);\n          setShowNew(true);\n        }\n      }\n    },\n    [id, loadItems, checkForUpdates, snapStates.settings.autoRefresh],\n  );\n\n  const lastHiddenTime = useRef();\n  usePageVisibility(\n    (visible) => {\n      if (visible) {\n        const timeDiff = Date.now() - lastHiddenTime.current;\n        if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n          // 3 seconds\n          loadOrCheckUpdates({\n            disableIdleCheck: true,\n          });\n        }\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n      setVisible(visible);\n    },\n    [checkForUpdates, loadOrCheckUpdates, snapStates.settings.autoRefresh],\n  );\n\n  // checkForUpdates interval\n  useInterval(\n    loadOrCheckUpdates,\n    visible && !showNew\n      ? checkForUpdatesInterval * (nearReachStart ? 1 : 2)\n      : null,\n  );\n\n  // const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n\n  return (\n    <FilterContext.Provider value={filterContext}>\n      <div\n        id={`${id}-page`}\n        class={`deck-container ${\n          mediaFirst ? 'deck-container-media-first' : ''\n        }`}\n        ref={(node) => {\n          scrollableRef.current = node;\n          jRef.current = node;\n          kRef.current = node;\n          oRef.current = node;\n          dotRef.current = node;\n        }}\n        tabIndex=\"-1\"\n        onClick={(e) => {\n          // If click on timeline item, unhide header\n          if (\n            headerRef.current &&\n            e.target.closest('.timeline-item, .timeline-item-alt')\n          ) {\n            setTimeout(() => {\n              headerRef.current.hidden = false;\n              resetScrollDirection();\n            }, 250);\n          }\n        }}\n      >\n        <div class=\"timeline-deck deck\">\n          <header\n            ref={headerRef}\n            // hidden={hiddenUI}\n            onClick={(e) => {\n              if (!e.target.closest('a, button')) {\n                scrollableRef.current?.scrollTo({\n                  top: 0,\n                  behavior: 'smooth',\n                });\n              }\n            }}\n            onDblClick={(e) => {\n              if (!e.target.closest('a, button')) {\n                loadItems(true);\n              }\n            }}\n            class={uiState === 'loading' ? 'loading' : ''}\n          >\n            <div class=\"header-grid\">\n              <div class=\"header-side\">\n                <NavMenu />\n                {headerStart !== null && headerStart !== undefined ? (\n                  headerStart\n                ) : (\n                  <Link to=\"/\" class=\"button plain home-button\">\n                    <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n                  </Link>\n                )}\n              </div>\n              {title && (titleComponent ? titleComponent : <h1>{title}</h1>)}\n              <div class=\"header-side\">\n                {/* <Loader hidden={uiState !== 'loading'} /> */}\n                {!!headerEnd && headerEnd}\n              </div>\n            </div>\n            {showNewPostsIndicator && (\n              <button\n                class=\"updates-button shiny-pill\"\n                type=\"button\"\n                onClick={handleLoadNewPosts}\n              >\n                <Icon icon=\"arrow-up\" /> <Trans>New posts</Trans>\n              </button>\n            )}\n          </header>\n          {!!timelineStart && (\n            <div\n              class={`timeline-start ${uiState === 'loading' ? 'loading' : ''}`}\n            >\n              {timelineStart}\n            </div>\n          )}\n          {!!items.length ? (\n            <>\n              <ul class={`timeline ${view ? `timeline-${view}` : ''}`}>\n                {items.map((status) => (\n                  <TimelineItem\n                    status={status}\n                    instance={instance}\n                    useItemID={useItemID}\n                    // allowFilters={allowFilters}\n                    filterContext={filterContext}\n                    key={status.id + status?._pinned + view}\n                    view={view}\n                    showFollowedTags={showFollowedTags}\n                    showReplyParent={showReplyParent}\n                    mediaFirst={mediaFirst}\n                  />\n                ))}\n                {showMore &&\n                  uiState === 'loading' &&\n                  (view === 'media' ? null : (\n                    <>\n                      <li\n                        style={{\n                          height: '20vh',\n                        }}\n                      >\n                        <Status skeleton mediaFirst={mediaFirst} />\n                      </li>\n                      <li\n                        style={{\n                          height: '25vh',\n                        }}\n                      >\n                        <Status skeleton mediaFirst={mediaFirst} />\n                      </li>\n                    </>\n                  ))}\n              </ul>\n              {uiState === 'default' &&\n                (showMore ? (\n                  <InView\n                    root={scrollableRef.current}\n                    rootMargin={`0px 0px ${screen.height * 1.5}px 0px`}\n                    onChange={(inView) => {\n                      if (inView) {\n                        loadItems();\n                      }\n                    }}\n                  >\n                    <button\n                      type=\"button\"\n                      class=\"plain block\"\n                      onClick={() => loadItems()}\n                      style={{ marginBlockEnd: '6em' }}\n                    >\n                      <Trans>Show more</Trans>\n                    </button>\n                  </InView>\n                ) : (\n                  <p class=\"ui-state insignificant\">\n                    <Trans>The end.</Trans>\n                  </p>\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <ul class=\"timeline\">\n              {Array.from({ length: 5 }).map((_, i) =>\n                view === 'media' ? (\n                  <div\n                    style={{\n                      height: '50vh',\n                    }}\n                  />\n                ) : (\n                  <li key={i}>\n                    <Status skeleton mediaFirst={mediaFirst} />\n                  </li>\n                ),\n              )}\n            </ul>\n          ) : (\n            uiState !== 'error' &&\n            uiState !== 'start' && <p class=\"ui-state\">{emptyText}</p>\n          )}\n          {uiState === 'error' && (\n            <p class=\"ui-state\">\n              {errorText}\n              <br />\n              <br />\n              <button type=\"button\" onClick={() => loadItems(!items.length)}>\n                <Trans>Try again</Trans>\n              </button>\n            </p>\n          )}\n        </div>\n      </div>\n    </FilterContext.Provider>\n  );\n}\n\nconst TimelineItem = memo(\n  ({\n    status,\n    instance,\n    useItemID,\n    // allowFilters,\n    filterContext,\n    view,\n    showFollowedTags,\n    showReplyParent,\n    mediaFirst,\n  }) => {\n    const { t } = useLingui();\n    console.debug('RENDER TimelineItem', status.id);\n    const { id: statusID, reblog, items, type, _pinned } = status;\n    if (_pinned) useItemID = false;\n    const actualStatusID = reblog?.id || statusID;\n    const url = instance\n      ? `/${instance}/s/${actualStatusID}`\n      : `/s/${actualStatusID}`;\n\n    if (items) {\n      let fItems = filteredItems(items, filterContext);\n      let title = '';\n      if (type === 'boosts') {\n        title = plural(fItems.length, {\n          one: '# Boost',\n          other: '# Boosts',\n        });\n      } else if (type === 'pinned') {\n        title = t`Pinned posts`;\n      }\n      const isCarousel = type === 'boosts' || type === 'pinned';\n      if (isCarousel) {\n        const filteredItemsIDs = new Set();\n        // Here, we don't hide filtered posts, but we sort them last\n        fItems.sort((a, b) => {\n          // if (a._filtered && !b._filtered) {\n          //   return 1;\n          // }\n          // if (!a._filtered && b._filtered) {\n          //   return -1;\n          // }\n          const aFiltered = isFiltered(a.filtered, filterContext);\n          const bFiltered = isFiltered(b.filtered, filterContext);\n          if (aFiltered && aFiltered?.action !== 'blur') {\n            filteredItemsIDs.add(a.id);\n          }\n          if (bFiltered && bFiltered?.action !== 'blur') {\n            filteredItemsIDs.add(b.id);\n          }\n          if (aFiltered && !bFiltered) {\n            return 1;\n          }\n          if (!aFiltered && bFiltered) {\n            return -1;\n          }\n          return 0;\n        });\n\n        if (filteredItemsIDs.size >= 2) {\n          const GROUP_SIZE = 5;\n          // If 2 or more, group filtered items into one, limit to GROUP_SIZE in a group\n          const unfiltered = [];\n          const filtered = [];\n          fItems.forEach((item) => {\n            if (filteredItemsIDs.has(item.id)) {\n              filtered.push(item);\n            } else {\n              unfiltered.push(item);\n            }\n          });\n          const filteredItems = [];\n          for (let i = 0; i < filtered.length; i += GROUP_SIZE) {\n            filteredItems.push({\n              _grouped: true,\n              posts: filtered.slice(i, i + GROUP_SIZE),\n            });\n          }\n          fItems = unfiltered.concat(filteredItems);\n        }\n\n        return (\n          <li key={`timeline-${statusID}`} class=\"timeline-item-carousel\">\n            <StatusCarousel title={title} class={`${type}-carousel`}>\n              {fItems.map((item) => {\n                const { id: statusID, reblog, _pinned, _grouped } = item;\n                if (_grouped) {\n                  return (\n                    <li key={statusID} class=\"timeline-item-carousel-group\">\n                      {item.posts.map((item) => {\n                        const { id: statusID, reblog, _pinned } = item;\n                        const actualStatusID = reblog?.id || statusID;\n                        const url = instance\n                          ? `/${instance}/s/${actualStatusID}`\n                          : `/s/${actualStatusID}`;\n                        if (_pinned) useItemID = false;\n                        return (\n                          <Link\n                            class=\"status-carousel-link timeline-item-alt\"\n                            to={url}\n                          >\n                            {useItemID ? (\n                              <Status\n                                statusID={statusID}\n                                instance={instance}\n                                size=\"s\"\n                              />\n                            ) : (\n                              <Status\n                                status={item}\n                                instance={instance}\n                                size=\"s\"\n                              />\n                            )}\n                          </Link>\n                        );\n                      })}\n                    </li>\n                  );\n                }\n\n                const actualStatusID = reblog?.id || statusID;\n                const url = instance\n                  ? `/${instance}/s/${actualStatusID}`\n                  : `/s/${actualStatusID}`;\n                if (_pinned) useItemID = false;\n                return (\n                  <li key={statusID}>\n                    <Link\n                      class=\"status-carousel-link timeline-item-alt\"\n                      to={url}\n                    >\n                      {useItemID ? (\n                        <Status\n                          statusID={statusID}\n                          instance={instance}\n                          size=\"s\"\n                          contentTextWeight\n                          enableCommentHint\n                          // allowFilters={allowFilters}\n                          mediaFirst={mediaFirst}\n                        />\n                      ) : (\n                        <Status\n                          status={item}\n                          instance={instance}\n                          size=\"s\"\n                          contentTextWeight\n                          enableCommentHint\n                          // allowFilters={allowFilters}\n                          mediaFirst={mediaFirst}\n                        />\n                      )}\n                    </Link>\n                  </li>\n                );\n              })}\n            </StatusCarousel>\n          </li>\n        );\n      }\n      const manyItems = fItems.length > 3;\n      return fItems.map((item, i) => {\n        const { id: statusID, _differentAuthor } = item;\n        const url = instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`;\n        const isMiddle = i > 0 && i < fItems.length - 1;\n        const isSpoiler = item.sensitive && !!item.spoilerText;\n        const showCompact =\n          (!_differentAuthor && isSpoiler && i > 0) ||\n          (manyItems &&\n            isMiddle &&\n            (type === 'thread' ||\n              (type === 'conversation' &&\n                !_differentAuthor &&\n                !fItems[i - 1]._differentAuthor &&\n                !fItems[i + 1]._differentAuthor)));\n        const isStart = i === 0;\n        const isEnd = i === fItems.length - 1;\n        return (\n          <li\n            key={`timeline-${statusID}`}\n            class={`timeline-item-container timeline-item-container-type-${type} timeline-item-container-${\n              isStart ? 'start' : isEnd ? 'end' : 'middle'\n            } ${_differentAuthor ? 'timeline-item-diff-author' : ''}`}\n          >\n            <Link class=\"status-link timeline-item\" to={url}>\n              {showCompact ? (\n                <TimelineStatusCompact\n                  status={item}\n                  instance={instance}\n                  filterContext={filterContext}\n                />\n              ) : useItemID ? (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  enableCommentHint={isEnd}\n                  showFollowedTags={showFollowedTags}\n                  // allowFilters={allowFilters}\n                />\n              ) : (\n                <Status\n                  status={item}\n                  instance={instance}\n                  enableCommentHint={isEnd}\n                  showFollowedTags={showFollowedTags}\n                  // allowFilters={allowFilters}\n                />\n              )}\n            </Link>\n          </li>\n        );\n      });\n    }\n\n    const itemKey = `timeline-${statusID + _pinned}`;\n\n    if (view === 'media') {\n      return useItemID ? (\n        <MediaPost\n          class=\"timeline-item\"\n          parent=\"li\"\n          key={itemKey}\n          statusID={statusID}\n          instance={instance}\n          // allowFilters={allowFilters}\n        />\n      ) : (\n        <MediaPost\n          class=\"timeline-item\"\n          parent=\"li\"\n          key={itemKey}\n          status={status}\n          instance={instance}\n          // allowFilters={allowFilters}\n        />\n      );\n    }\n\n    return (\n      <li key={itemKey}>\n        <Link class=\"status-link timeline-item\" to={url}>\n          {useItemID ? (\n            <Status\n              statusID={statusID}\n              instance={instance}\n              enableCommentHint\n              showFollowedTags={showFollowedTags}\n              showReplyParent={showReplyParent}\n              // allowFilters={allowFilters}\n              mediaFirst={mediaFirst}\n            />\n          ) : (\n            <Status\n              status={status}\n              instance={instance}\n              enableCommentHint\n              showFollowedTags={showFollowedTags}\n              showReplyParent={showReplyParent}\n              // allowFilters={allowFilters}\n              mediaFirst={mediaFirst}\n            />\n          )}\n        </Link>\n      </li>\n    );\n  },\n  (oldProps, newProps) => {\n    const oldID = (oldProps.status?.id || '').toString();\n    const newID = (newProps.status?.id || '').toString();\n    return (\n      oldID === newID &&\n      oldProps.instance === newProps.instance &&\n      oldProps.view === newProps.view\n    );\n  },\n);\n\nfunction StatusCarousel({ title, class: className, children }) {\n  const { t } = useLingui();\n  const carouselRef = useRef();\n  const startButtonRef = useRef();\n  const endButtonRef = useRef();\n\n  const [render, setRender] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setRender(true);\n    }, 1);\n  }, []);\n\n  return (\n    <div class={`status-carousel ${className}`}>\n      <header>\n        <h3>{title}</h3>\n        <span>\n          <button\n            ref={startButtonRef}\n            type=\"button\"\n            class=\"small plain2\"\n            // disabled={reachStart}\n            onClick={() => {\n              const left =\n                Math.min(320, carouselRef.current?.offsetWidth) *\n                (isRTL() ? 1 : -1);\n              carouselRef.current?.scrollBy({\n                left,\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"chevron-left\" alt={t`Previous`} />\n          </button>{' '}\n          <button\n            ref={endButtonRef}\n            type=\"button\"\n            class=\"small plain2\"\n            // disabled={reachEnd}\n            onClick={() => {\n              const left =\n                Math.min(320, carouselRef.current?.offsetWidth) *\n                (isRTL() ? -1 : 1);\n              carouselRef.current?.scrollBy({\n                left,\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"chevron-right\" alt={t`Next`} />\n          </button>\n        </span>\n      </header>\n      <ul ref={carouselRef}>\n        <InView\n          class=\"status-carousel-beacon\"\n          onChange={(inView) => {\n            if (startButtonRef.current)\n              startButtonRef.current.disabled = inView;\n          }}\n        />\n        {children[0]}\n        {render && children.slice(1)}\n        <InView\n          class=\"status-carousel-beacon\"\n          onChange={(inView) => {\n            if (endButtonRef.current) endButtonRef.current.disabled = inView;\n          }}\n        />\n      </ul>\n    </div>\n  );\n}\n\nfunction TimelineStatusCompact({ status, instance, filterContext }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { id, visibility, language } = status;\n  const statusPeekText = statusPeek(status);\n  const sKey = statusKey(id, instance);\n  const filterInfo = isFiltered(status.filtered, filterContext);\n  return (\n    <article\n      class={`status compact-thread ${\n        visibility === 'direct' ? 'visibility-direct' : ''\n      }`}\n      tabindex=\"-1\"\n    >\n      <div class=\"status-thread-badge-container\">\n        <ThreadBadge index={snapStates.statusThreadNumber[sKey]} />\n      </div>\n      <div\n        class=\"content-compact\"\n        title={statusPeekText}\n        lang={language}\n        dir=\"auto\"\n      >\n        {!!filterInfo && filterInfo?.action !== 'blur' ? (\n          <b\n            class=\"status-filtered-badge badge-meta horizontal\"\n            title={filterInfo?.titlesStr || ''}\n          >\n            {filterInfo?.titlesStr ? (\n              <Trans>\n                <span>Filtered</span>: <span>{filterInfo.titlesStr}</span>\n              </Trans>\n            ) : (\n              <span>\n                <Trans>Filtered</Trans>\n              </span>\n            )}\n          </b>\n        ) : (\n          <>\n            {statusPeekText}\n            {status.sensitive && status.spoilerText && (\n              <>\n                {' '}\n                <span class=\"spoiler-badge\">\n                  <Icon icon=\"eye-close\" size=\"s\" alt={t`Content warning`} />\n                </span>\n              </>\n            )}\n          </>\n        )}\n      </div>\n    </article>\n  );\n}\n\nfunction inBackground() {\n  return !!document.querySelector('.deck-backdrop, #modal-container > *');\n}\n\nexport default Timeline;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useParams, useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport AccountInfo from '../components/account-info';\nimport EmojiText from '../components/emoji-text';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Menu2 from '../components/menu2';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport isSearchEnabled from '../utils/is-search-enabled';\nimport mem from '../utils/mem';\nimport pmem from '../utils/pmem';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport {\n  getCurrentAccountID,\n  isMediaFirstInstance,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst MIN_YEAR = 1983;\nconst MIN_YEAR_MONTH = `${MIN_YEAR}-01`; // Birth of the Internet\n\nconst supportsInputMonth = mem(() => {\n  try {\n    const input = document.createElement('input');\n    input.setAttribute('type', 'month');\n    return input.type === 'month';\n  } catch (e) {\n    return false;\n  }\n});\n\nfunction AccountStatuses() {\n  const { i18n, t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { id, ...params } = useParams();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const month = searchParams.get('month');\n  const excludeReplies = !searchParams.get('replies');\n  const excludeBoosts = !!searchParams.get('boosts');\n  const tagged = searchParams.get('tagged');\n  const media = !!searchParams.get('media');\n  const { masto, instance, authenticated } = api({ instance: params.instance });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const accountStatusesIterator = useRef();\n\n  const allSearchParams = [month, excludeReplies, excludeBoosts, tagged, media];\n  const [account, setAccount] = useState();\n  const searchOffsetRef = useRef(0);\n  useEffect(() => {\n    searchOffsetRef.current = 0;\n  }, allSearchParams);\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  const sameCurrentInstance = useMemo(\n    () => instance === currentInstance,\n    [instance, currentInstance],\n  );\n  const [searchEnabled, setSearchEnabled] = useState(false);\n  useEffect(() => {\n    // Only enable for current logged-in instance\n    // Most remote instances don't allow unauthenticated searches\n    if (!sameCurrentInstance) return;\n    if (!account?.acct) return;\n    (async () => {\n      const enabled = await isSearchEnabled(instance);\n      console.log({ enabled });\n      setSearchEnabled(enabled);\n    })();\n  }, [instance, sameCurrentInstance, account?.acct]);\n\n  async function fetchAccountStatuses(firstLoad) {\n    const isValidMonth = /^\\d{4}-[01]\\d$/.test(month);\n    const isValidYear = month?.split?.('-')?.[0] >= MIN_YEAR;\n    if (isValidMonth && isValidYear) {\n      if (!account) {\n        return {\n          value: [],\n          done: true,\n        };\n      }\n      const [_year, _month] = month.split('-');\n      const monthIndex = parseInt(_month, 10) - 1;\n      // YYYY-MM (no day)\n      // Search options:\n      // - from:account\n      // - after:YYYY-MM-DD (non-inclusive)\n      // - before:YYYY-MM-DD (non-inclusive)\n\n      // Last day of previous month\n      const after = new Date(_year, monthIndex, 0);\n      const afterStr = `${after.getFullYear()}-${(after.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${after.getDate().toString().padStart(2, '0')}`;\n      // First day of next month\n      const before = new Date(_year, monthIndex + 1, 1);\n      const beforeStr = `${before.getFullYear()}-${(before.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${before.getDate().toString().padStart(2, '0')}`;\n      console.log({\n        month,\n        _year,\n        _month,\n        monthIndex,\n        after,\n        before,\n        afterStr,\n        beforeStr,\n      });\n\n      let limit;\n      if (firstLoad) {\n        limit = LIMIT + 1;\n        searchOffsetRef.current = 0;\n      } else {\n        limit = LIMIT + searchOffsetRef.current + 1;\n        searchOffsetRef.current += LIMIT;\n      }\n\n      const searchResults = await masto.v2.search.list({\n        q: `from:${account.acct} after:${afterStr} before:${beforeStr}`,\n        type: 'statuses',\n        limit,\n        offset: searchOffsetRef.current,\n      });\n      if (searchResults?.statuses?.length) {\n        const value = searchResults.statuses.slice(0, LIMIT);\n        value.forEach((item) => {\n          saveStatus(item, instance);\n        });\n        const done = searchResults.statuses.length <= LIMIT;\n        return { value, done };\n      } else {\n        return { value: [], done: true };\n      }\n    }\n\n    let results = [];\n    if (firstLoad) {\n      const { value } = await masto.v1.accounts\n        .$select(id)\n        .statuses.list({\n          pinned: true,\n        })\n        .values()\n        .next();\n      if (value?.length && !tagged && !media) {\n        const pinnedStatuses = value.map((status) => {\n          saveStatus(status, instance);\n          return {\n            ...status,\n            _pinned: true,\n          };\n        });\n        if (pinnedStatuses.length >= 3) {\n          const pinnedStatusesIds = pinnedStatuses.map((status) => status.id);\n          results.push({\n            id: pinnedStatusesIds,\n            items: pinnedStatuses,\n            type: 'pinned',\n          });\n        } else {\n          results.push(...pinnedStatuses);\n        }\n      }\n    }\n    if (firstLoad || !accountStatusesIterator.current) {\n      accountStatusesIterator.current = masto.v1.accounts\n        .$select(id)\n        .statuses.list({\n          limit: LIMIT,\n          exclude_replies: excludeReplies,\n          exclude_reblogs: excludeBoosts,\n          only_media: media || undefined,\n          tagged,\n        })\n        .values();\n    }\n    const { value, done } = await accountStatusesIterator.current.next();\n    if (value?.length) {\n      if (!supports('@mastodon/pinned-posts')) {\n        // Check if value is same as pinned post (results)\n        // If the index for every post is the same, means API might not support pinned posts\n        // TODO: This is a really weird check, fix this at some point\n        if (results.length) {\n          let pinnedStatusesIds = [];\n          if (results[0]?.type === 'pinned') {\n            pinnedStatusesIds = results[0].id;\n          } else {\n            pinnedStatusesIds = results\n              .filter((status) => status._pinned)\n              .map((status) => status.id);\n          }\n          const containsAllPinned = pinnedStatusesIds.every((postId) =>\n            value.some((status) => status.id === postId),\n          );\n          if (containsAllPinned) {\n            // Remove pinned posts\n            results = [];\n          }\n        }\n      }\n\n      results.push(...value);\n\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      value: results,\n      done,\n    };\n  }\n\n  const [featuredTags, setFeaturedTags] = useState([]);\n  let title = t`Account posts`;\n  if (account?.acct) {\n    const acctDisplay = (/@/.test(account.acct) ? '' : '@') + account.acct;\n    const accountDisplay = account?.displayName\n      ? `${account.displayName} (${acctDisplay})`\n      : `${acctDisplay}`;\n    if (!excludeReplies) {\n      title = t`${accountDisplay} (+ Replies)`;\n    } else if (excludeBoosts) {\n      title = t`${accountDisplay} (- Boosts)`;\n    } else if (tagged) {\n      title = t`${accountDisplay} (#${tagged})`;\n    } else if (media) {\n      title = t`${accountDisplay} (Media)`;\n    } else if (month) {\n      const monthYear = new Date(month).toLocaleString(i18n.locale, {\n        month: 'long',\n        year: 'numeric',\n      });\n      title = t`${accountDisplay} (${monthYear})`;\n    } else {\n      title = accountDisplay;\n    }\n  }\n  useTitle(title, '/:instance?/a/:id');\n\n  const fetchAccount = useCallback(() => {\n    return memFetchAccount(id, masto);\n  }, [id, masto]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const acc = await fetchAccount();\n        console.log(acc);\n        setAccount(acc);\n      } catch (e) {\n        console.error(e);\n      }\n      // No need, because the whole filter bar is hidden\n      // TODO: Revisit this\n      if (!mediaFirst) {\n        try {\n          const featuredTags = await masto.v1.accounts\n            .$select(id)\n            .featuredTags.list();\n          console.log({ featuredTags });\n          setFeaturedTags(featuredTags);\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    })();\n  }, [id, mediaFirst]);\n\n  const { displayName, acct, emojis } = account || {};\n\n  const isSelf = useMemo(\n    () => account?.id === getCurrentAccountID(),\n    [account?.id],\n  );\n\n  const filterBarRef = useRef();\n  const TimelineStart = useMemo(() => {\n    const filtered =\n      !excludeReplies || excludeBoosts || tagged || media || !!month;\n    const cachedAccount = snapStates.accounts[`${id}@${instance}`];\n\n    return (\n      <>\n        <AccountInfo\n          instance={instance}\n          account={cachedAccount || id}\n          fetchAccount={fetchAccount}\n          authenticated={authenticated}\n          standalone\n          showEndorsements\n        />\n        {!mediaFirst && (\n          <div\n            class=\"filter-bar\"\n            ref={filterBarRef}\n            style={{\n              position: 'relative',\n            }}\n          >\n            {filtered ? (\n              <Link\n                to={`/${instance}/a/${id}`}\n                class=\"insignificant filter-clear\"\n                title={t`Clear filters`}\n                key=\"clear-filters\"\n              >\n                <Icon icon=\"x\" size=\"l\" alt={t`Clear`} />\n              </Link>\n            ) : (\n              <Icon\n                icon=\"filter\"\n                class=\"insignificant\"\n                size=\"l\"\n                alt={t`Filters`}\n              />\n            )}\n            <Link\n              to={`/${instance}/a/${id}${excludeReplies ? '?replies=1' : ''}`}\n              onClick={() => {\n                if (excludeReplies) {\n                  showToast(t`Showing post with replies`);\n                }\n              }}\n              class={excludeReplies ? '' : 'is-active'}\n            >\n              <Trans>+ Replies</Trans>\n            </Link>\n            <Link\n              to={`/${instance}/a/${id}${excludeBoosts ? '' : '?boosts=0'}`}\n              onClick={() => {\n                if (!excludeBoosts) {\n                  showToast(t`Showing posts without boosts`);\n                }\n              }}\n              class={!excludeBoosts ? '' : 'is-active'}\n            >\n              <Trans>- Boosts</Trans>\n            </Link>\n            <Link\n              to={`/${instance}/a/${id}${media ? '' : '?media=1'}`}\n              onClick={() => {\n                if (!media) {\n                  showToast(t`Showing posts with media`);\n                }\n              }}\n              class={media ? 'is-active' : ''}\n            >\n              <Trans>Media</Trans>\n            </Link>\n            {featuredTags.map((tag) => (\n              <Link\n                key={tag.id}\n                to={`/${instance}/a/${id}${\n                  tagged === tag.name\n                    ? ''\n                    : `?tagged=${encodeURIComponent(tag.name)}`\n                }`}\n                onClick={() => {\n                  if (tagged !== tag.name) {\n                    showToast(t`Showing posts tagged with #${tag.name}`);\n                  }\n                }}\n                class={tagged === tag.name ? 'is-active' : ''}\n              >\n                <span>\n                  <span class=\"more-insignificant\">#</span>\n                  {tag.name}\n                </span>\n                {\n                  // The count differs based on instance \n                }\n                {/* <span class=\"filter-count\">{tag.statusesCount}</span> */}\n              </Link>\n            ))}\n            {searchEnabled && (\n              <>\n                {supportsInputMonth() ? (\n                  <label class={`filter-field ${month ? 'is-active' : ''}`}>\n                    <Icon icon=\"month\" size=\"l\" />\n                    <input\n                      type=\"month\"\n                      disabled={!account?.acct}\n                      value={month || ''}\n                      min={MIN_YEAR_MONTH}\n                      max={new Date().toISOString().slice(0, 7)}\n                      onInput={(e) => {\n                        const { value, validity } = e.currentTarget;\n                        if (!validity.valid) return;\n                        setSearchParams(\n                          value\n                            ? {\n                                month: value,\n                              }\n                            : {},\n                        );\n                        const [year, month] = value.split('-');\n                        const monthIndex = parseInt(month, 10) - 1;\n                        const date = new Date(year, monthIndex);\n                        showToast(\n                          t`Showing posts in ${date.toLocaleString(\n                            i18n.locale,\n                            {\n                              month: 'long',\n                              year: 'numeric',\n                            },\n                          )}`,\n                        );\n                      }}\n                    />\n                  </label>\n                ) : (\n                  // Fallback to <select> for month and <input type=\"number\"> for year\n                  <MonthPicker\n                    class={`filter-field ${month ? 'is-active' : ''}`}\n                    disabled={!account?.acct}\n                    value={month || ''}\n                    min={MIN_YEAR_MONTH}\n                    max={new Date().toISOString().slice(0, 7)}\n                    onInput={(e) => {\n                      const { value, validity } = e;\n                      if (!validity.valid) return;\n                      setSearchParams(\n                        value\n                          ? {\n                              month: value,\n                            }\n                          : {},\n                      );\n                    }}\n                  />\n                )}\n                <button\n                  type=\"button\"\n                  class=\"filter-field\"\n                  onClick={() => {\n                    states.showSearchCommand = {\n                      query: isSelf ? 'from:me ' : `from:${account?.acct} `,\n                    };\n                  }}\n                >\n                  <Icon\n                    icon=\"search\"\n                    size=\"l\"\n                    alt={\n                      isSelf\n                        ? t`Search my posts`\n                        : t`Search @${account?.username}'s posts`\n                    }\n                  />\n                </button>\n              </>\n            )}\n          </div>\n        )}\n      </>\n    );\n  }, [\n    id,\n    instance,\n    authenticated,\n    featuredTags,\n    fetchAccount,\n    searchEnabled,\n    ...allSearchParams,\n  ]);\n\n  useEffect(() => {\n    // Focus on .is-active\n    const active = filterBarRef.current?.querySelector('.is-active');\n    if (active) {\n      console.log('active', active, active.offsetLeft);\n      filterBarRef.current.scrollTo({\n        behavior: 'smooth',\n        left:\n          active.offsetLeft -\n          (filterBarRef.current.offsetWidth - active.offsetWidth) / 2,\n      });\n    }\n  }, [featuredTags, searchEnabled, ...allSearchParams]);\n\n  const accountInstance = useMemo(() => {\n    if (!account?.url) return null;\n    const domain = URL.parse(account.url)?.hostname;\n    return domain;\n  }, [account]);\n  const sameInstance = instance === accountInstance;\n  const allowSwitch = !!account && !sameInstance;\n\n  return (\n    <>\n      <Timeline\n        key={id}\n        title={`${account?.acct ? '@' + account.acct : t`Posts`}`}\n        titleComponent={\n          <h1\n            class=\"header-double-lines header-account\"\n            // onClick={() => {\n            //   states.showAccount = {\n            //     account,\n            //     instance,\n            //   };\n            // }}\n          >\n            <b>\n              <EmojiText\n                text={displayName}\n                emojis={emojis}\n                resolverURL={account?.url}\n              />\n            </b>\n            <div>\n              <span class=\"bidi-isolate\">@{acct}</span>\n            </div>\n          </h1>\n        }\n        id=\"account-statuses\"\n        instance={instance}\n        emptyText={t`Nothing to see here yet.`}\n        errorText={t`Unable to load posts`}\n        fetchItems={fetchAccountStatuses}\n        useItemID\n        view={media || mediaFirst ? 'media' : undefined}\n        boostsCarousel={snapStates.settings.boostsCarousel}\n        timelineStart={TimelineStart}\n        refresh={[\n          excludeReplies,\n          excludeBoosts,\n          tagged,\n          media,\n          month + account?.acct,\n        ].toString()}\n        headerEnd={\n          <Menu2\n            portal\n            // setDownOverflow\n            overflow=\"auto\"\n            viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            <MenuItem\n              disabled={!allowSwitch}\n              onClick={() => {\n                (async () => {\n                  try {\n                    const { masto } = api({\n                      instance: accountInstance,\n                    });\n                    const acc = await masto.v1.accounts.lookup({\n                      acct: account.acct,\n                    });\n                    const { id } = acc;\n                    location.hash = `/${accountInstance}/a/${id}`;\n                  } catch (e) {\n                    console.error(e);\n                    alert(t`Unable to fetch account info`);\n                  }\n                })();\n              }}\n            >\n              <Icon icon=\"transfer\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Switch to account's instance{' '}\n                  {accountInstance ? (\n                    <>\n                      {' '}\n                      (<b>{punycode.toUnicode(accountInstance)}</b>)\n                    </>\n                  ) : null}\n                </Trans>\n              </small>\n            </MenuItem>\n            {!sameCurrentInstance && (\n              <MenuItem\n                onClick={() => {\n                  (async () => {\n                    try {\n                      const acc = await currentMasto.v1.accounts.lookup({\n                        acct: account.acct + '@' + instance,\n                      });\n                      const { id } = acc;\n                      location.hash = `/${currentInstance}/a/${id}`;\n                    } catch (e) {\n                      console.error(e);\n                      alert(t`Unable to fetch account info`);\n                    }\n                  })();\n                }}\n              >\n                <Icon icon=\"transfer\" />{' '}\n                <small class=\"menu-double-lines\">\n                  <Trans>\n                    Switch to my instance (<b>{currentInstance}</b>)\n                  </Trans>\n                </small>\n              </MenuItem>\n            )}\n          </Menu2>\n        }\n      />\n      {acct && !isSelf && (\n        <data\n          class=\"compose-data\"\n          value={JSON.stringify({\n            draftStatus: {\n              status: `@${acct} `,\n            },\n          })}\n        />\n      )}\n    </>\n  );\n}\n\nfunction MonthPicker(props) {\n  const { i18n } = useLingui();\n  const {\n    class: className,\n    disabled,\n    value,\n    min,\n    max,\n    onInput = () => {},\n  } = props;\n  const [_year, _month] = value?.split('-') || [];\n  const monthFieldRef = useRef();\n  const yearFieldRef = useRef();\n\n  const checkValidity = (month, year) => {\n    const [minYear, minMonth] = min?.split('-') || [];\n    const [maxYear, maxMonth] = max?.split('-') || [];\n    if (year < minYear) return false;\n    if (year > maxYear) return false;\n    if (year === minYear && month < minMonth) return false;\n    if (year === maxYear && month > maxMonth) return false;\n    return true;\n  };\n\n  return (\n    <div class={className}>\n      <Icon icon=\"month\" size=\"l\" />\n      <select\n        ref={monthFieldRef}\n        disabled={disabled}\n        value={_month || ''}\n        onInput={(e) => {\n          const { value: month } = e.currentTarget;\n          const year = yearFieldRef.current.value;\n          if (!checkValidity(month, year))\n            return {\n              value: '',\n              validity: {\n                valid: false,\n              },\n            };\n          onInput({\n            value: month ? `${year}-${month}` : '',\n            validity: {\n              valid: true,\n            },\n          });\n        }}\n      >\n        <option value=\"\">\n          <Trans>Month</Trans>\n        </option>\n        <option disabled>-----</option>\n        {Array.from({ length: 12 }, (_, i) => (\n          <option\n            value={\n              // Month is 1-indexed\n              (i + 1)\n                .toString()\n                .padStart(2, '0')\n            }\n            key={i}\n          >\n            {new Date(0, i).toLocaleString(i18n.locale, {\n              month: 'long',\n            })}\n          </option>\n        ))}\n      </select>{' '}\n      <input\n        ref={yearFieldRef}\n        type=\"number\"\n        disabled={disabled}\n        value={_year || new Date().getFullYear()}\n        min={min?.slice(0, 4) || MIN_YEAR}\n        max={max?.slice(0, 4) || new Date().getFullYear()}\n        onInput={(e) => {\n          const { value: year, validity } = e.currentTarget;\n          const month = monthFieldRef.current.value;\n          if (!validity.valid || !checkValidity(month, year))\n            return {\n              value: '',\n              validity: {\n                valid: false,\n              },\n            };\n          onInput({\n            value: year ? `${year}-${month}` : '',\n            validity: {\n              valid: true,\n            },\n          });\n        }}\n        style={{\n          width: '4.5em',\n        }}\n      />\n    </div>\n  );\n}\n\nfunction fetchAccount(id, masto) {\n  return masto.v1.accounts.$select(id).fetch();\n}\nconst memFetchAccount = pmem(fetchAccount, {\n  expires: 30 * 60 * 1000, // 30 minutes\n});\n\nexport default AccountStatuses;\n","import './annual-report.css';\n\nimport { Trans } from '@lingui/react/macro';\nimport { useEffect, useState } from 'preact/hooks';\nimport { useParams } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport NameText from '../components/name-text';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nexport default function AnnualReport() {\n  const params = useParams();\n  const { year } = params;\n  useTitle(\n    year ? `${year} #Wrapstodon` : '#Wrapstodon',\n    '/annual_report/:year',\n  );\n  const { masto, instance } = api();\n  const [results, setResults] = useState(null);\n  const [uiState, setUIState] = useState('default');\n\n  useEffect(() => {\n    if (year) {\n      (async () => {\n        setUIState('loading');\n        const results = await masto.v1.annualReports.$select(year).fetch();\n        console.log('REPORT', results);\n        setResults(results);\n        setUIState('default');\n      })();\n    }\n  }, [year]);\n\n  const { accounts, annualReports, statuses } = results || {};\n  const report = annualReports?.find((report) => report.year == year)?.data;\n\n  const datePlaceholder = new Date();\n\n  return (\n    <div id=\"annual-report-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class={`report ${uiState === 'loading' ? 'loading-mask' : ''}`}>\n        <h1>{year} #Wrapstodon</h1>\n        {!!report && (\n          <dl>\n            {Object.entries(report).map(([key, value]) => {\n              console.log('value', value);\n              const totals = {};\n              if (Array.isArray(value)) {\n                value.forEach((item) => {\n                  Object.entries(item).forEach(([k, v]) => {\n                    if (typeof v === 'number') {\n                      totals[k] = (totals[k] || 0) + v;\n                    }\n                  });\n                });\n              }\n\n              return (\n                <>\n                  <dt>{key}</dt>\n                  <dd class={`report-${key}`}>\n                    {Array.isArray(value) ? (\n                      <table>\n                        <thead>\n                          <tr>\n                            {Object.entries(value[0]).map(([key, value]) => (\n                              <th\n                                class={\n                                  key !== 'month' && typeof value === 'number'\n                                    ? 'number'\n                                    : ''\n                                }\n                              >\n                                {key}\n                              </th>\n                            ))}\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {value.map((item) => (\n                            <tr>\n                              {Object.entries(item).map(([k, value]) => (\n                                <td\n                                  class={\n                                    k !== 'month' && typeof value === 'number'\n                                      ? 'number'\n                                      : ''\n                                  }\n                                  style={{\n                                    '--percentage':\n                                      typeof value === 'number'\n                                        ? `${(value / totals[k]) * 100}%`\n                                        : 0,\n                                  }}\n                                >\n                                  {value &&\n                                  /(accountId)/i.test(k) &&\n                                  /^(mostRebloggedAccounts|commonlyInteractedWithAccounts)$/i.test(\n                                    key,\n                                  ) ? (\n                                    accounts?.find((a) => a.id === value) ? (\n                                      <NameText\n                                        account={accounts?.find(\n                                          (a) => a.id === value,\n                                        )}\n                                        showAvatar\n                                      />\n                                    ) : (\n                                      ''\n                                    )\n                                  ) : k === 'month' ? (\n                                    datePlaceholder.setMonth(value - 1) &&\n                                    datePlaceholder.toLocaleString(undefined, {\n                                      month: 'long',\n                                    })\n                                  ) : typeof value === 'number' ? (\n                                    value.toLocaleString()\n                                  ) : (\n                                    value\n                                  )}\n                                </td>\n                              ))}\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                    ) : typeof value === 'object' ? (\n                      /^(topStatuses)$/i.test(key) ? (\n                        <dl>\n                          {Object.entries(value).map(([k, value]) => (\n                            <>\n                              <dt>{k}</dt>\n                              <dd>\n                                {value && (\n                                  <Link to={`/${instance}/s/${value}`}>\n                                    <Status\n                                      status={statuses?.find(\n                                        (s) => s.id === value,\n                                      )}\n                                      size=\"s\"\n                                      readOnly\n                                      showCommentCount\n                                    />\n                                  </Link>\n                                )}\n                              </dd>\n                            </>\n                          ))}\n                        </dl>\n                      ) : (\n                        <table>\n                          <tbody>\n                            {Object.entries(value).map(([k, value]) => (\n                              <tr>\n                                <th>{k}</th>\n                                <td\n                                  class={\n                                    typeof value === 'number' ? 'number' : ''\n                                  }\n                                >\n                                  {value}\n                                </td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                      )\n                    ) : typeof value === 'string' ? (\n                      value\n                    ) : (\n                      // Last resort\n                      JSON.stringify(value, null, 2)\n                    )}\n                  </dd>\n                </>\n              );\n            })}\n          </dl>\n        )}\n      </div>\n      <hr />\n      <p style={{ textAlign: 'center' }}>\n        <Link to=\"/\">\n          <Trans>Go home</Trans>\n        </Link>\n      </p>\n    </div>\n  );\n}\n","import { useLingui } from '@lingui/react/macro';\nimport { useRef } from 'preact/hooks';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Bookmarks() {\n  const { t } = useLingui();\n  useTitle(t`Bookmarks`, '/b');\n  const { masto, instance } = api();\n  const bookmarksIterator = useRef();\n  async function fetchBookmarks(firstLoad) {\n    if (firstLoad || !bookmarksIterator.current) {\n      bookmarksIterator.current = masto.v1.bookmarks\n        .list({ limit: LIMIT })\n        .values();\n    }\n    return await bookmarksIterator.current.next();\n  }\n\n  return (\n    <Timeline\n      title={t`Bookmarks`}\n      id=\"bookmarks\"\n      emptyText={t`No bookmarks yet. Go bookmark something!`}\n      errorText={t`Unable to load bookmarks.`}\n      instance={instance}\n      fetchItems={fetchBookmarks}\n    />\n  );\n}\n\nexport default Bookmarks;\n","export default \"__VITE_ASSET__BL_1JinT__\"","import '../components/links-bar.css';\nimport './catchup.css';\n\nimport autoAnimate from '@formkit/auto-animate';\nimport { msg, select } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSearchParams } from 'react-router-dom';\nimport { uid } from 'uid/single';\n\nimport catchupUrl from '../assets/features/catch-up.png';\n\nimport Avatar from '../components/avatar';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NameText from '../components/name-text';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport { api, getPreferences } from '../utils/api';\nimport { oklab2rgb, rgb2oklab } from '../utils/color-utils';\nimport db from '../utils/db';\nimport emojifyText from '../utils/emojify-text';\nimport { isFiltered } from '../utils/filters';\nimport getDomain from '../utils/get-domain';\nimport htmlContentLength from '../utils/html-content-length';\nimport mem from '../utils/mem';\nimport niceDateTime from '../utils/nice-date-time';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport store from '../utils/store';\nimport { getCurrentAccountID, getCurrentAccountNS } from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport { assignFollowedTags } from '../utils/timeline-utils';\nimport useTitle from '../utils/useTitle';\n\nconst FILTER_CONTEXT = 'home';\nconst CATCHUP_NS = 'catchup';\n\nconst RANGES = [\n  { label: msg`last 1 hour`, value: 1 },\n  { label: msg`last 2 hours`, value: 2 },\n  { label: msg`last 3 hours`, value: 3 },\n  { label: msg`last 4 hours`, value: 4 },\n  { label: msg`last 5 hours`, value: 5 },\n  { label: msg`last 6 hours`, value: 6 },\n  { label: msg`last 7 hours`, value: 7 },\n  { label: msg`last 8 hours`, value: 8 },\n  { label: msg`last 9 hours`, value: 9 },\n  { label: msg`last 10 hours`, value: 10 },\n  { label: msg`last 11 hours`, value: 11 },\n  { label: msg`last 12 hours`, value: 12 },\n  { label: msg`beyond 12 hours`, value: 13, beyond: true },\n];\n\nconst FILTER_KEYS = {\n  original: msg`Original`,\n  replies: msg`Replies`,\n  quotes: msg`Quotes`,\n  boosts: msg`Boosts`,\n  followedTags: msg`Followed tags`,\n  groups: msg`Groups`,\n  filtered: msg`Filtered`,\n};\nconst FILTER_SORTS = [\n  'createdAt',\n  'repliesCount',\n  'favouritesCount',\n  'reblogsCount',\n  // TODO: Add this later when there's enough usage\n  // Sorting by quotes count seems not useful yet?\n  // And we're combining it with boosts count, so that's even weirder\n  // 'quotesCount',\n  'density',\n];\nconst FILTER_GROUPS = [null, 'account'];\n\nconst DTF = mem(\n  (locale) =>\n    new Intl.DateTimeFormat(locale || undefined, {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n    }),\n);\n\nfunction hasQuote(quote) {\n  return quote?.id || quote?.quotedStatus?.id;\n}\n\nfunction Catchup() {\n  const { i18n, _, t } = useLingui();\n  const dtf = DTF(i18n.locale);\n\n  useTitle(`Catch-up`, '/catchup');\n  const { masto, instance } = api();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const id = searchParams.get('id');\n  const [uiState, setUIState] = useState('start');\n  const [showTopLinks, setShowTopLinks] = useState(false);\n\n  const currentAccount = useMemo(() => {\n    return getCurrentAccountID();\n  }, []);\n  const isSelf = (accountID) => accountID === currentAccount;\n\n  const supportsPixelfed = supports('@pixelfed/home-include-reblogs');\n\n  async function fetchHome({ maxCreatedAt }) {\n    console.debug('fetchHome', maxCreatedAt);\n    const allResults = [];\n    const homeIterable = masto.v1.timelines.home.list({ limit: 40 });\n    const homeIterator = homeIterable.values();\n    mainloop: while (true) {\n      try {\n        if (supportsPixelfed && homeIterable.params) {\n          if (typeof homeIterable.params === 'string') {\n            homeIterable.params += '&include_reblogs=true';\n          } else {\n            homeIterable.params.include_reblogs = true;\n          }\n        }\n        const results = await homeIterator.next();\n        const { value } = results;\n        if (value?.length) {\n          // This ignores maxCreatedAt filter, but it's ok for now\n          await assignFollowedTags(value, instance);\n          let addedResults = false;\n          for (let i = 0; i < value.length; i++) {\n            const item = value[i];\n            const createdAtTime = Date.parse(item.createdAt);\n            if (!maxCreatedAt || createdAtTime >= maxCreatedAt) {\n              // Filtered\n              const selfPost = isSelf(\n                item.reblog?.account?.id || item.account.id,\n              );\n              const filterInfo =\n                !selfPost &&\n                isFiltered(\n                  item.reblog?.filtered || item.filtered,\n                  FILTER_CONTEXT,\n                );\n              if (filterInfo?.action === 'hide') continue;\n              item._filtered = filterInfo;\n\n              // Followed tags\n              const sKey = statusKey(item.id, instance);\n              item._followedTags = states.statusFollowedTags[sKey]\n                ? [...states.statusFollowedTags[sKey]]\n                : [];\n\n              allResults.push(item);\n              addedResults = true;\n            } else {\n              // Don't immediately stop, still add the other items that might still be within range\n              // break mainloop;\n            }\n            // Only stop when ALL items are outside of range\n            if (!addedResults) {\n              break mainloop;\n            }\n          }\n        } else {\n          break mainloop;\n        }\n        // Pause 1s\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n      } catch (e) {\n        console.error(e);\n        break mainloop;\n      }\n    }\n\n    // Post-process all results\n    // 1. Threadify - tag 1st-post in a thread\n    allResults.forEach((status) => {\n      if (status?.inReplyToId) {\n        const replyToStatus = allResults.find(\n          (s) => s.id === status.inReplyToId,\n        );\n        if (replyToStatus && !replyToStatus.inReplyToId) {\n          replyToStatus._thread = true;\n        }\n      }\n    });\n\n    return allResults;\n  }\n\n  const [posts, setPosts] = useState([]);\n  const catchupRangeRef = useRef();\n  const catchupLastRef = useRef();\n  const NS = useMemo(() => getCurrentAccountNS(), []);\n  const handleCatchupClick = useCallback(async ({ duration } = {}) => {\n    const now = Date.now();\n    const maxCreatedAt = duration ? now - duration : null;\n    console.log('CATCHUP', {\n      duration,\n      durationHuman: duration ? `${duration / 1000 / 60 / 60}h` : null,\n      maxCreatedAt,\n      maxCreatedAtHuman: maxCreatedAt\n        ? dtf.format(new Date(maxCreatedAt))\n        : null,\n    });\n    setUIState('loading');\n    const results = await fetchHome({ maxCreatedAt });\n    // Namespaced by account ID\n    // Possible conflict if ID matches between different accounts from different instances\n    const catchupID = `${NS}-${uid()}`;\n    try {\n      await db.catchup.set(catchupID, {\n        id: catchupID,\n        posts: results,\n        count: results.length,\n        startAt: maxCreatedAt,\n        endAt: now,\n      });\n      setSearchParams({ id: catchupID });\n    } catch (e) {\n      console.error(e, results);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (id) {\n      (async () => {\n        const catchup = await db.catchup.get(id);\n        if (catchup) {\n          catchup.posts.sort((a, b) => (a.createdAt > b.createdAt ? 1 : -1));\n          setPosts(catchup.posts);\n          setUIState('results');\n        }\n      })();\n    } else if (uiState === 'results') {\n      setPosts([]);\n      setUIState('start');\n    }\n  }, [id]);\n\n  const [reloadCatchupsCount, reloadCatchups] = useReducer((c) => c + 1, 0);\n  const [lastCatchupEndAt, setLastCatchupEndAt] = useState(null);\n  const [prevCatchups, setPrevCatchups] = useState([]);\n\n  useEffect(() => {\n    const catchupIds = new Set(prevCatchups.map((pc) => pc.id));\n    for (let i = sessionStorage.length - 1; i >= 0; i--) {\n      const key = sessionStorage.key(i);\n      if (key?.startsWith(`${CATCHUP_NS}-`)) {\n        const catchupId = key.replace(`${CATCHUP_NS}-`, '');\n        if (!catchupIds.has(catchupId)) {\n          store.session.del(key);\n        }\n      }\n    }\n  }, [prevCatchups]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const catchups = await db.catchup.keys();\n        if (catchups.length) {\n          const ns = getCurrentAccountNS();\n          const ownKeys = catchups.filter((key) => key.startsWith(`${ns}-`));\n          if (ownKeys.length) {\n            let ownCatchups = await db.catchup.getMany(ownKeys);\n            ownCatchups.sort((a, b) => b.endAt - a.endAt);\n\n            // Split to 1st 3 last catchups, and the rest\n            let lastCatchups = ownCatchups.slice(0, 3);\n            let restCatchups = ownCatchups.slice(3);\n\n            const trimmedCatchups = lastCatchups.map((c) => {\n              const { id, count, startAt, endAt } = c;\n              return {\n                id,\n                count,\n                startAt,\n                endAt,\n              };\n            });\n            setPrevCatchups(trimmedCatchups);\n            setLastCatchupEndAt(lastCatchups[0].endAt);\n\n            // GC time\n            ownCatchups = null;\n            lastCatchups = null;\n\n            queueMicrotask(() => {\n              if (restCatchups.length) {\n                // delete them\n                db.catchup\n                  .delMany(restCatchups.map((c) => c.id))\n                  .then(() => {\n                    // GC time\n                    restCatchups = null;\n                  })\n                  .catch((e) => {\n                    console.error(e);\n                  });\n              }\n            });\n\n            return;\n          }\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      setPrevCatchups([]);\n    })();\n  }, [reloadCatchupsCount]);\n  useEffect(() => {\n    if (uiState === 'start') {\n      reloadCatchups();\n    }\n  }, [uiState === 'start']);\n\n  const [filterCounts, links] = useMemo(() => {\n    let filtered = 0,\n      groups = 0,\n      boosts = 0,\n      quotes = 0,\n      replies = 0,\n      followedTags = 0,\n      original = 0;\n    const links = {};\n    for (const post of posts) {\n      if (post._filtered && post._filtered?.action !== 'blur') {\n        filtered++;\n        post.__FILTER = 'filtered';\n      } else if (post.group) {\n        groups++;\n        post.__FILTER = 'groups';\n      } else if (post.reblog) {\n        boosts++;\n        post.__FILTER = 'boosts';\n      } else if (supportsNativeQuote() && hasQuote(post.quote)) {\n        quotes++;\n        post.__FILTER = 'quotes';\n      } else if (post._followedTags?.length) {\n        followedTags++;\n        post.__FILTER = 'followedTags';\n      } else if (\n        post.inReplyToId &&\n        post.inReplyToAccountId !== post.account?.id\n      ) {\n        replies++;\n        post.__FILTER = 'replies';\n      } else {\n        original++;\n        post.__FILTER = 'original';\n      }\n\n      const thePost = post.reblog || post;\n      if (\n        post.__FILTER !== 'filtered' &&\n        thePost.card?.url &&\n        thePost.card?.image &&\n        thePost.card?.type === 'link'\n      ) {\n        const { card, favouritesCount, reblogsCount } = thePost;\n        let { url } = card;\n        url = url.replace(/\\/$/, '');\n        if (!links[url]) {\n          links[url] = {\n            postID: thePost.id,\n            card,\n            shared: 1,\n            sharers: [post.account],\n            likes: favouritesCount,\n            boosts: reblogsCount,\n          };\n        } else {\n          if (links[url].sharers.find((a) => a.id === post.account.id)) {\n            continue;\n          }\n          links[url].shared++;\n          links[url].sharers.push(post.account);\n          if (links[url].postID !== thePost.id) {\n            links[url].likes += favouritesCount;\n            links[url].boosts += reblogsCount;\n          }\n        }\n      }\n    }\n\n    let topLinks = [];\n    for (const link in links) {\n      topLinks.push({\n        url: link,\n        ...links[link],\n      });\n    }\n    topLinks.sort((a, b) => {\n      if (a.shared > b.shared) return -1;\n      if (a.shared < b.shared) return 1;\n      if (a.boosts > b.boosts) return -1;\n      if (a.boosts < b.boosts) return 1;\n      if (a.likes > b.likes) return -1;\n      if (a.likes < b.likes) return 1;\n      if (a.quotes > b.quotes) return -1;\n      if (a.quotes < b.quotes) return 1;\n      return 0;\n    });\n\n    // Slice links to shared > 1 but min 10 links\n    if (topLinks.length > 10) {\n      linksLoop: for (let i = 10; i < topLinks.length; i++) {\n        const { shared } = topLinks[i];\n        if (shared <= 1) {\n          topLinks = topLinks.slice(0, i);\n          break linksLoop;\n        }\n      }\n    }\n\n    return [\n      {\n        filtered,\n        groups,\n        boosts,\n        quotes,\n        replies,\n        followedTags,\n        original,\n      },\n      topLinks,\n    ];\n  }, [posts]);\n\n  const [selectedFilterCategory, setSelectedFilterCategory] = useState('all');\n  const [selectedAuthor, setSelectedAuthor] = useState(null);\n\n  const [range, setRange] = useState(1);\n\n  const [sortBy, setSortBy] = useState('createdAt');\n  const [sortOrder, setSortOrder] = useState('asc');\n  const [groupBy, setGroupBy] = useState(null);\n\n  useEffect(() => {\n    if (!id) return;\n    const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`);\n    if (savedState) {\n      if (savedState.selectedFilterCategory !== undefined) {\n        setSelectedFilterCategory(savedState.selectedFilterCategory);\n      }\n      if (savedState.selectedAuthor !== undefined) {\n        setSelectedAuthor(savedState.selectedAuthor);\n      }\n      if (savedState.sortBy !== undefined) {\n        setSortBy(savedState.sortBy);\n      }\n      if (savedState.sortOrder !== undefined) {\n        setSortOrder(savedState.sortOrder);\n      }\n      if (savedState.groupBy !== undefined) {\n        setGroupBy(savedState.groupBy);\n      }\n      if (savedState.showTopLinks !== undefined) {\n        setShowTopLinks(savedState.showTopLinks);\n      }\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (!id || uiState !== 'results') return;\n    const state = {\n      selectedFilterCategory,\n      selectedAuthor,\n      sortBy,\n      sortOrder,\n      groupBy,\n      showTopLinks,\n    };\n    store.session.setJSON(`${CATCHUP_NS}-${id}`, state);\n  }, [\n    id,\n    uiState,\n    selectedFilterCategory,\n    selectedAuthor,\n    sortBy,\n    sortOrder,\n    groupBy,\n    showTopLinks,\n  ]);\n\n  const [filteredPosts, authors, authorCounts] = useMemo(() => {\n    const authorsHash = {};\n    const authorCountsMap = new Map();\n\n    let filteredPosts = posts.filter((post) => {\n      const postFilterMatches =\n        selectedFilterCategory === 'all' ||\n        post.__FILTER === selectedFilterCategory;\n\n      if (postFilterMatches) {\n        authorsHash[post.account.id] = post.account;\n        authorCountsMap.set(\n          post.account.id,\n          (authorCountsMap.get(post.account.id) || 0) + 1,\n        );\n      }\n\n      return postFilterMatches;\n    });\n\n    // Deduplicate boosts\n    const boostedPosts = {};\n    filteredPosts.forEach((post) => {\n      if (post.reblog) {\n        if (boostedPosts[post.reblog.id]) {\n          if (boostedPosts[post.reblog.id].__BOOSTERS) {\n            boostedPosts[post.reblog.id].__BOOSTERS.add(post.account);\n          } else {\n            boostedPosts[post.reblog.id].__BOOSTERS = new Set([post.account]);\n          }\n          post.__HIDDEN = true;\n        } else {\n          boostedPosts[post.reblog.id] = post;\n        }\n      }\n    });\n\n    if (selectedAuthor && authorCountsMap.has(selectedAuthor)) {\n      filteredPosts = filteredPosts.filter(\n        (post) =>\n          post.account.id === selectedAuthor ||\n          [...(post.__BOOSTERS || [])].find((a) => a.id === selectedAuthor),\n      );\n    }\n\n    return [filteredPosts, authorsHash, Object.fromEntries(authorCountsMap)];\n  }, [selectedFilterCategory, selectedAuthor, posts]);\n\n  const filteredPostsMap = useMemo(() => {\n    const map = {};\n    filteredPosts.forEach((post) => {\n      map[post.id] = post;\n    });\n    return map;\n  }, [filteredPosts]);\n\n  const authorCountsList = useMemo(\n    () =>\n      Object.keys(authorCounts).sort(\n        (a, b) => authorCounts[b] - authorCounts[a],\n      ),\n    [authorCounts],\n  );\n\n  const sortedFilteredPosts = useMemo(() => {\n    const authorIndices = {};\n    authorCountsList.forEach((authorID, index) => {\n      authorIndices[authorID] = index;\n    });\n    return filteredPosts\n      .filter((post) => !post.__HIDDEN)\n      .sort((a, b) => {\n        if (groupBy === 'account') {\n          const aAccountID = a.account.id;\n          const bAccountID = b.account.id;\n          const aIndex = authorIndices[aAccountID];\n          const bIndex = authorIndices[bAccountID];\n          const order = aIndex - bIndex;\n          if (order !== 0) {\n            return order;\n          }\n        }\n        if (sortBy !== 'createdAt') {\n          a = a.reblog || a;\n          b = b.reblog || b;\n          if (sortBy !== 'density' && a[sortBy] === b[sortBy]) {\n            return a.createdAt > b.createdAt ? 1 : -1;\n          }\n        }\n        if (sortBy === 'density') {\n          const aDensity = postDensity(a);\n          const bDensity = postDensity(b);\n          if (sortOrder === 'asc') {\n            return aDensity > bDensity ? 1 : -1;\n          } else {\n            return bDensity > aDensity ? 1 : -1;\n          }\n        }\n        if (sortOrder === 'asc') {\n          return a[sortBy] > b[sortBy] ? 1 : -1;\n        } else {\n          return b[sortBy] > a[sortBy] ? 1 : -1;\n        }\n      });\n  }, [filteredPosts, sortBy, sortOrder, groupBy, authorCountsList]);\n\n  const prevGroup = useRef(null);\n\n  const authorsListParent = useRef(null);\n  const autoAnimated = useRef(false);\n  useEffect(() => {\n    if (posts.length > 100 || autoAnimated.current) return;\n    if (authorsListParent.current) {\n      autoAnimate(authorsListParent.current, {\n        duration: 200,\n      });\n      autoAnimated.current = true;\n    }\n  }, [posts, authorsListParent]);\n\n  const postsBarType = posts.length > 160 ? '3d' : '2d';\n\n  const postsBar = useMemo(() => {\n    if (postsBarType !== '2d') return null;\n    return posts.map((post) => {\n      // If part of filteredPosts\n      const isFiltered = filteredPostsMap[post.id];\n      return (\n        <span\n          key={post.id}\n          class={`post-dot ${isFiltered ? 'post-dot-highlight' : ''}`}\n        />\n      );\n    });\n  }, [filteredPostsMap]);\n\n  const postsBins = useMemo(() => {\n    if (postsBarType !== '3d') return null;\n    if (!posts?.length) return null;\n    const bins = binByTime(posts, 'createdAt', 320);\n    return bins.map((posts, i) => {\n      return (\n        <div class=\"posts-bin\" key={i}>\n          {posts.map((post) => {\n            const isFiltered = filteredPostsMap[post.id];\n            return (\n              <span\n                key={post.id}\n                class={`post-dot ${isFiltered ? 'post-dot-highlight' : ''}`}\n              />\n            );\n          })}\n        </div>\n      );\n    });\n  }, [filteredPostsMap]);\n\n  const scrollableRef = useRef(null);\n\n  useLayoutEffect(() => {\n    if (!id || uiState !== 'results' || !scrollableRef.current) return;\n    if (!sortedFilteredPosts.length) return;\n\n    const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`);\n    if (savedState?.scrollTop !== undefined && savedState.scrollTop > 0) {\n      const timeoutId = setTimeout(() => {\n        if (scrollableRef.current) {\n          scrollableRef.current.scrollTo({\n            top: savedState.scrollTop,\n            behavior: 'instant',\n          });\n        }\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [id, uiState, sortedFilteredPosts.length]);\n\n  useEffect(() => {\n    if (!id || uiState !== 'results' || !scrollableRef.current) return;\n\n    const handleScroll = () => {\n      if (!scrollableRef.current) return;\n      const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`) || {};\n      savedState.scrollTop = scrollableRef.current.scrollTop;\n      store.session.setJSON(`${CATCHUP_NS}-${id}`, savedState);\n    };\n\n    const scrollElement = scrollableRef.current;\n    scrollElement.addEventListener('scroll', handleScroll, { passive: true });\n\n    return () => {\n      scrollElement.removeEventListener('scroll', handleScroll);\n    };\n  }, [id, uiState]);\n\n  // if range value exceeded lastCatchupEndAt, show error\n  const lastCatchupRange = useMemo(() => {\n    // return hour, not ms\n    if (!lastCatchupEndAt) return null;\n    return (Date.now() - lastCatchupEndAt) / 1000 / 60 / 60;\n  }, [lastCatchupEndAt, range]);\n\n  useEffect(() => {\n    if (uiState !== 'results') return;\n    const authorUsername =\n      selectedAuthor && authors[selectedAuthor]\n        ? authors[selectedAuthor].username\n        : '';\n    const sortOrderIndex = sortOrder === 'asc' ? 0 : 1;\n    const groupByText = {\n      account: 'authors',\n    };\n    let toast = showToast({\n      duration: 5_000, // 5 seconds\n      // Note: I'm sorry, translators\n      text: t`Showing ${select(selectedFilterCategory, {\n        all: 'all posts',\n        original: 'original posts',\n        replies: 'replies',\n        boosts: 'boosts',\n        quotes: 'quotes',\n        followedTags: 'followed tags',\n        groups: 'groups',\n        filtered: 'filtered posts',\n      })}, ${select(sortBy, {\n        createdAt: select(sortOrder, {\n          asc: 'oldest',\n          desc: 'latest',\n        }),\n        reblogsCount: select(sortOrder, {\n          asc: 'fewest boosts',\n          desc: 'most boosts',\n        }),\n        favouritesCount: select(sortOrder, {\n          asc: 'fewest likes',\n          desc: 'most likes',\n        }),\n        repliesCount: select(sortOrder, {\n          asc: 'fewest replies',\n          desc: 'most replies',\n        }),\n        density: select(sortOrder, { asc: 'least dense', desc: 'most dense' }),\n      })} first${select(groupBy, {\n        account: ', grouped by authors',\n        other: '',\n      })}`,\n    });\n    return () => {\n      toast?.hideToast?.();\n    };\n  }, [\n    uiState,\n    selectedFilterCategory,\n    selectedAuthor,\n    sortBy,\n    sortOrder,\n    groupBy,\n    authors,\n  ]);\n\n  useEffect(() => {\n    if (selectedAuthor) {\n      if (authors[selectedAuthor]) {\n        // Check if author is visible and within the scrollable area viewport\n        const authorElement = authorsListParent.current.querySelector(\n          `[data-author=\"${selectedAuthor}\"]`,\n        );\n        const scrollableRect =\n          authorsListParent.current?.getBoundingClientRect();\n        const authorRect = authorElement?.getBoundingClientRect();\n        console.log({\n          sLeft: scrollableRect.left,\n          sRight: scrollableRect.right,\n          aLeft: authorRect.left,\n          aRight: authorRect.right,\n        });\n        if (\n          authorRect.left < scrollableRect.left ||\n          authorRect.right > scrollableRect.right\n        ) {\n          authorElement.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        } else if (authorRect.top < 0) {\n          authorElement.scrollIntoView({\n            block: 'nearest',\n            inline: 'nearest',\n            behavior: 'smooth',\n          });\n        }\n      }\n    }\n  }, [selectedAuthor, authors]);\n\n  const [showHelp, setShowHelp] = useState(false);\n\n  const itemsSelector = '.catchup-list > li > a';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        const nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const hlRef = useHotkeys(\n    'h, l',\n    (_, handler) => {\n      // Go next/prev selectedAuthor in authorCountsList list\n      const key = handler.keys[0];\n      if (selectedAuthor) {\n        const index = authorCountsList.indexOf(selectedAuthor);\n        if (key === 'h') {\n          if (index > 0 && index < authorCountsList.length) {\n            setSelectedAuthor(authorCountsList[index - 1]);\n            scrollableRef.current?.focus();\n          }\n        } else if (key === 'l') {\n          if (index < authorCountsList.length - 1 && index >= 0) {\n            setSelectedAuthor(authorCountsList[index + 1]);\n            scrollableRef.current?.focus();\n          }\n        }\n      } else if (key === 'l') {\n        setSelectedAuthor(authorCountsList[0]);\n        scrollableRef.current?.focus();\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n    },\n  );\n\n  const escRef = useHotkeys(\n    'esc',\n    () => {\n      setSelectedAuthor(null);\n      scrollableRef.current?.focus();\n    },\n    {\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n      useKey: true,\n    },\n  );\n\n  const dotRef = useHotkeys(\n    '.',\n    () => {\n      scrollableRef.current?.scrollTo({\n        top: 0,\n        behavior: 'smooth',\n      });\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n    },\n  );\n\n  const handleArrowKeys = useCallback((e) => {\n    const activeElement = document.activeElement;\n    const isRadio =\n      activeElement?.tagName === 'INPUT' && activeElement.type === 'radio';\n    const isArrowKeys =\n      e.key === 'ArrowDown' ||\n      e.key === 'ArrowUp' ||\n      e.key === 'ArrowLeft' ||\n      e.key === 'ArrowRight';\n    if (isArrowKeys && isRadio) {\n      // Note: page scroll won't trigger on first arrow key press due to this. Subsequent presses will.\n      activeElement.blur();\n      return;\n    }\n  }, []);\n\n  return (\n    <div\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n        hlRef.current = node;\n        escRef.current = node;\n        dotRef.current = node;\n      }}\n      id=\"catchup-page\"\n      class=\"deck-container\"\n      tabIndex=\"-1\"\n    >\n      <div class=\"timeline-deck deck wide\">\n        <header\n          class={`${uiState === 'loading' ? 'loading' : ''}`}\n          onClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              scrollableRef.current?.scrollTo({\n                top: 0,\n                behavior: 'smooth',\n              });\n            }\n          }}\n        >\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              {uiState === 'results' && (\n                <Link to=\"/catchup\" class=\"button plain\">\n                  <Icon icon=\"history2\" size=\"l\" alt={t`Catch-up`} />\n                </Link>\n              )}\n              {uiState === 'start' && (\n                <Link to=\"/\" class=\"button plain\">\n                  <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n                </Link>\n              )}\n            </div>\n            <h1>\n              {uiState !== 'start' && (\n                <Trans>\n                  Catch-up <sup>beta</sup>\n                </Trans>\n              )}\n            </h1>\n            <div class=\"header-side\">\n              {uiState !== 'start' && uiState !== 'loading' && (\n                <button\n                  type=\"button\"\n                  class=\"plain\"\n                  onClick={() => {\n                    setShowHelp(true);\n                  }}\n                >\n                  <Trans>Help</Trans>\n                </button>\n              )}\n            </div>\n          </div>\n        </header>\n        <main onKeyDown={handleArrowKeys}>\n          {uiState === 'start' && (\n            <div class=\"catchup-start\">\n              <h1>\n                <Trans>\n                  Catch-up <sup>beta</sup>\n                </Trans>\n              </h1>\n              <details>\n                <summary>\n                  <Trans>What is this?</Trans>\n                </summary>\n                <p>\n                  <Trans>\n                    Catch-up is a separate timeline for your followings,\n                    offering a high-level view at a glance, with a simple,\n                    email-inspired interface to effortlessly sort and filter\n                    through posts.\n                  </Trans>\n                </p>\n                <img\n                  src={catchupUrl}\n                  width=\"1200\"\n                  height=\"900\"\n                  alt={t`Preview of Catch-up UI`}\n                />\n                <p>\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.target.closest('details').open = false;\n                    }}\n                  >\n                    <Trans>Let's catch up</Trans>\n                  </button>\n                </p>\n              </details>\n              <p>\n                <Trans>Let's catch up on the posts from your followings.</Trans>\n              </p>\n              <p>\n                <b>\n                  <Trans>Show me all posts from</Trans>\n                </b>\n              </p>\n              <div class=\"catchup-form\">\n                <input\n                  ref={catchupRangeRef}\n                  type=\"range\"\n                  value={range}\n                  min={RANGES[0].value}\n                  max={RANGES[RANGES.length - 1].value}\n                  step=\"1\"\n                  list=\"catchup-ranges\"\n                  onChange={(e) => setRange(+e.target.value)}\n                />{' '}\n                <span\n                  style={{\n                    width: '8em',\n                  }}\n                >\n                  {_(RANGES[range - 1].label)}\n                  <br />\n                  <small class=\"insignificant\">\n                    {range == RANGES[RANGES.length - 1].value\n                      ? t`until the max`\n                      : niceDateTime(\n                          new Date(Date.now() - range * 60 * 60 * 1000),\n                        )}\n                  </small>\n                </span>\n                <datalist id=\"catchup-ranges\">\n                  {RANGES.map(({ label, value }) => (\n                    <option value={value} label={_(label)} />\n                  ))}\n                </datalist>{' '}\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    let duration;\n                    const beyondRange = RANGES.find((r) => r.beyond);\n                    if (range < beyondRange.value) {\n                      // Within range\n                      duration = range * 60 * 60 * 1000;\n                    } else {\n                      // Beyond range\n                      const untilLastCatchup = catchupLastRef.current?.checked;\n                      if (untilLastCatchup) {\n                        // Until last catch-up's end time\n                        duration = Date.now() - lastCatchupEndAt;\n                      } else {\n                        // Go beyond range until max, even after last catch-up's end time\n                        // Don't need to set duration\n                      }\n                    }\n                    handleCatchupClick({ duration });\n                  }}\n                >\n                  <Trans>Catch up</Trans>\n                </button>\n              </div>\n              {lastCatchupRange && range > lastCatchupRange ? (\n                <p class=\"catchup-info\">\n                  <Icon icon=\"info\" />{' '}\n                  <Trans>Overlaps with your last catch-up</Trans>\n                </p>\n              ) : range === RANGES[RANGES.length - 1].value &&\n                lastCatchupEndAt ? (\n                <p class=\"catchup-info\">\n                  <label>\n                    <input\n                      type=\"checkbox\"\n                      switch\n                      checked\n                      ref={catchupLastRef}\n                    />{' '}\n                    <Trans>\n                      Until the last catch-up (\n                      {dtf.format(new Date(lastCatchupEndAt))})\n                    </Trans>\n                  </label>\n                </p>\n              ) : null}\n              <p class=\"insignificant\">\n                <small>\n                  <Trans>\n                    Note: your instance might only show a maximum of 800 posts\n                    in the Home timeline regardless of the time range. Could be\n                    less or more.\n                  </Trans>\n                </small>\n              </p>\n              {!!prevCatchups?.length && (\n                <div class=\"catchup-prev\">\n                  <p>\n                    <Trans>Previously</Trans>\n                  </p>\n                  <ul>\n                    {prevCatchups.map((pc) => (\n                      <li key={pc.id}>\n                        <Link to={`/catchup?id=${pc.id}`}>\n                          <Icon icon=\"history2\" />{' '}\n                          <span>\n                            {pc.startAt\n                              ? dtf.formatRange(\n                                  new Date(pc.startAt),\n                                  new Date(pc.endAt),\n                                )\n                              : `${dtf.format(new Date(pc.endAt))}`}\n                          </span>\n                        </Link>{' '}\n                        <span>\n                          <small class=\"ib insignificant\">\n                            <Plural\n                              value={pc.count}\n                              one=\"# post\"\n                              other=\"# posts\"\n                            />\n                          </small>{' '}\n                          <button\n                            type=\"button\"\n                            class=\"light danger small\"\n                            onClick={async () => {\n                              const yes = confirm(t`Remove this catch-up?`);\n                              if (yes) {\n                                let st = showToast(\n                                  t`Removing Catch-up ${pc.id}`,\n                                );\n                                await db.catchup.del(pc.id);\n                                st?.hideToast?.();\n                                showToast(t`Catch-up ${pc.id} removed`);\n                                reloadCatchups();\n                              }\n                            }}\n                          >\n                            <Icon icon=\"x\" alt={t`Remove`} />\n                          </button>\n                        </span>\n                      </li>\n                    ))}\n                  </ul>\n                  {prevCatchups.length >= 3 && (\n                    <p>\n                      <small>\n                        <Trans>\n                          Note: Only max 3 will be stored. The rest will be\n                          automatically removed.\n                        </Trans>\n                      </small>\n                    </p>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n          {uiState === 'loading' && (\n            <div class=\"ui-state catchup-start\">\n              <Loader abrupt />\n              <p class=\"insignificant\">\n                <Trans>Fetching posts</Trans>\n              </p>\n              <p class=\"insignificant\">\n                <Trans>This might take a while.</Trans>\n              </p>\n            </div>\n          )}\n          {uiState === 'results' && (\n            <>\n              <div class=\"catchup-header\">\n                {posts.length > 0 && (\n                  <p>\n                    <b class=\"ib\">\n                      {dtf.formatRange(\n                        new Date(posts[0].createdAt),\n                        new Date(posts[posts.length - 1].createdAt),\n                      )}\n                    </b>\n                  </p>\n                )}\n                <aside>\n                  <button\n                    hidden={\n                      selectedFilterCategory === 'all' &&\n                      !selectedAuthor &&\n                      sortBy === 'createdAt' &&\n                      sortOrder === 'asc'\n                    }\n                    type=\"button\"\n                    class=\"plain4 small\"\n                    onClick={() => {\n                      setSelectedFilterCategory('all');\n                      setSelectedAuthor(null);\n                      setSortBy('createdAt');\n                      setGroupBy(null);\n                      setSortOrder('asc');\n                    }}\n                  >\n                    <Trans>Reset filters</Trans>\n                  </button>\n                  {links?.length > 0 && (\n                    <button\n                      type=\"button\"\n                      class=\"plain small\"\n                      onClick={() => setShowTopLinks(!showTopLinks)}\n                    >\n                      <Trans>Top links</Trans>{' '}\n                      <Icon\n                        icon=\"chevron-down\"\n                        style={{\n                          transform: showTopLinks\n                            ? 'rotate(180deg)'\n                            : 'rotate(0deg)',\n                        }}\n                      />\n                    </button>\n                  )}\n                </aside>\n              </div>\n              <div class=\"shazam-container no-animation\" hidden={!showTopLinks}>\n                <div class=\"shazam-container-inner\">\n                  <div class=\"catchup-top-links links-bar\">\n                    {links.map((link) => {\n                      const { card, shared, sharers, likes, boosts } = link;\n                      const {\n                        blurhash,\n                        title,\n                        description,\n                        url,\n                        image,\n                        imageDescription,\n                        language,\n                        width,\n                        height,\n                        publishedAt,\n                      } = card;\n                      const domain = getDomain(url);\n                      let accentColor;\n                      if (blurhash) {\n                        const averageColor = getBlurHashAverageColor(blurhash);\n                        const labAverageColor = rgb2oklab(averageColor);\n                        accentColor = oklab2rgb([\n                          0.6,\n                          labAverageColor[1],\n                          labAverageColor[2],\n                        ]);\n                      }\n\n                      return (\n                        <a\n                          key={url}\n                          href={url}\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                          class=\"link-block\"\n                          style={\n                            accentColor\n                              ? {\n                                  '--accent-color': `rgb(${accentColor.join(\n                                    ',',\n                                  )})`,\n                                  '--accent-alpha-color': `rgba(${accentColor.join(\n                                    ',',\n                                  )}, 0.4)`,\n                                }\n                              : {}\n                          }\n                        >\n                          <article>\n                            <figure>\n                              <img\n                                src={image}\n                                alt={imageDescription}\n                                width={width}\n                                height={height}\n                                loading=\"lazy\"\n                              />\n                            </figure>\n                            <div class=\"article-body\">\n                              <header>\n                                <div class=\"article-meta\">\n                                  <span class=\"domain\">{domain}</span>{' '}\n                                  {!!publishedAt && <>&middot; </>}\n                                  {!!publishedAt && (\n                                    <>\n                                      <RelativeTime\n                                        datetime={publishedAt}\n                                        format=\"micro\"\n                                      />\n                                    </>\n                                  )}\n                                </div>\n                                {!!title && (\n                                  <h1\n                                    class=\"title\"\n                                    lang={language}\n                                    dir=\"auto\"\n                                    title={title}\n                                  >\n                                    {title}\n                                  </h1>\n                                )}\n                              </header>\n                              {!!description && (\n                                <p\n                                  class=\"description\"\n                                  lang={language}\n                                  dir=\"auto\"\n                                  title={description}\n                                >\n                                  {description}\n                                </p>\n                              )}\n                              <hr />\n                              <p\n                                style={{\n                                  whiteSpace: 'nowrap',\n                                }}\n                              >\n                                <Trans>\n                                  Shared by{' '}\n                                  {sharers.map((s) => {\n                                    const { avatarStatic, displayName } = s;\n                                    return (\n                                      <button\n                                        type=\"button\"\n                                        class=\"plain\"\n                                        style={{\n                                          padding: 0,\n                                        }}\n                                        onClick={(e) => {\n                                          e.preventDefault();\n                                          e.stopPropagation();\n                                          // Reset and filter to author\n                                          const { id } = s;\n                                          setSelectedAuthor(id);\n                                          setSelectedFilterCategory('all');\n                                        }}\n                                      >\n                                        <Avatar\n                                          url={avatarStatic}\n                                          size=\"s\"\n                                          alt={displayName}\n                                        />\n                                      </button>\n                                    );\n                                  })}\n                                </Trans>\n                              </p>\n                            </div>\n                          </article>\n                        </a>\n                      );\n                    })}\n                  </div>\n                </div>\n              </div>\n              {posts.length >= 5 &&\n                (postsBarType === '3d' ? (\n                  <div class=\"catchup-posts-viz-time-bar\">{postsBins}</div>\n                ) : (\n                  <div class=\"catchup-posts-viz-bar\">{postsBar}</div>\n                ))}\n              {posts.length >= 2 && (\n                <div class=\"catchup-filters\">\n                  <label class=\"filter-cat\">\n                    <input\n                      type=\"radio\"\n                      name=\"filter-cat\"\n                      checked={selectedFilterCategory.toLowerCase() === 'all'}\n                      onChange={() => {\n                        setSelectedFilterCategory('all');\n                      }}\n                    />\n                    <Trans>All</Trans> <span class=\"count\">{posts.length}</span>\n                  </label>\n                  {Object.entries(FILTER_KEYS).map(\n                    ([key, label]) =>\n                      !!filterCounts[key] && (\n                        <label\n                          class=\"filter-cat\"\n                          key={_(label)}\n                          title={\n                            ((filterCounts[key] / posts.length) * 100).toFixed(\n                              2,\n                            ) + '%'\n                          }\n                        >\n                          <input\n                            type=\"radio\"\n                            name=\"filter-cat\"\n                            checked={\n                              selectedFilterCategory.toLowerCase() ===\n                              key.toLowerCase()\n                            }\n                            onChange={() => {\n                              setSelectedFilterCategory(key);\n                              if (key === 'boosts') {\n                                setSortBy('reblogsCount');\n                                setSortOrder('desc');\n                                setGroupBy(null);\n                              }\n                              // setSelectedAuthor(null);\n                            }}\n                          />\n                          {_(label)}{' '}\n                          <span class=\"count\">{filterCounts[key]}</span>\n                        </label>\n                      ),\n                  )}\n                </div>\n              )}\n              {posts.length >= 2 && !!authorCounts && (\n                <div\n                  class=\"catchup-filters authors-filters\"\n                  ref={authorsListParent}\n                >\n                  {authorCountsList.map((author) => (\n                    <label\n                      class=\"filter-author\"\n                      data-author={author}\n                      key={`${author}-${authorCounts[author]}`}\n                      // Preact messed up the order sometimes, need additional key besides just `author`\n                      // https://github.com/preactjs/preact/issues/2849\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"filter-author\"\n                        checked={selectedAuthor === author}\n                        onChange={() => {\n                          setSelectedAuthor(author);\n                          // setGroupBy(null);\n                        }}\n                        onClick={() => {\n                          if (selectedAuthor === author) {\n                            setSelectedAuthor(null);\n                          }\n                        }}\n                      />\n                      <Avatar\n                        url={\n                          authors[author].avatarStatic || authors[author].avatar\n                        }\n                        size=\"xxl\"\n                        alt={`${authors[author].displayName} (@${authors[author].acct})`}\n                      />{' '}\n                      <span class=\"count\">{authorCounts[author]}</span>\n                      <span class=\"username\">{authors[author].username}</span>\n                    </label>\n                  ))}\n                  {authorCountsList.length > 5 && (\n                    <small\n                      key=\"authors-count\"\n                      style={{\n                        whiteSpace: 'nowrap',\n                        paddingInline: '1em',\n                        opacity: 0.33,\n                      }}\n                    >\n                      <Plural\n                        value={authorCountsList.length}\n                        one=\"# author\"\n                        other=\"# authors\"\n                      />\n                    </small>\n                  )}\n                </div>\n              )}\n              {posts.length >= 2 && (\n                <div class=\"catchup-filters\">\n                  <span class=\"filter-label\">\n                    <Trans>Sort</Trans>\n                  </span>{' '}\n                  <fieldset class=\"radio-field-group\">\n                    {FILTER_SORTS.map((key) => (\n                      <label\n                        class=\"filter-sort\"\n                        key={key}\n                        onClick={(e) => {\n                          if (sortBy === key) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"radio\"\n                          name=\"filter-sort-cat\"\n                          checked={sortBy === key}\n                          onChange={() => {\n                            setSortBy(key);\n                            const order =\n                              /(replies|favourites|reblogs|quotes)/.test(key)\n                                ? 'desc'\n                                : 'asc';\n                            setSortOrder(order);\n                          }}\n                        />\n                        {\n                          {\n                            createdAt: t`Date`,\n                            repliesCount: t`Replies`,\n                            favouritesCount: t`Likes`,\n                            reblogsCount: t`Boosts`,\n                            quotesCount: t`Quotes`,\n                            density: t`Density`,\n                          }[key]\n                        }\n                        {sortBy === key && (sortOrder === 'asc' ? ' ' : ' ')}\n                      </label>\n                    ))}\n                  </fieldset>\n                  {/* <fieldset class=\"radio-field-group\">\n                    {['asc', 'desc'].map((key) => (\n                      <label class=\"filter-sort\" key={key}>\n                        <input\n                          type=\"radio\"\n                          name=\"filter-sort-dir\"\n                          checked={sortOrder === key}\n                          onChange={() => {\n                            setSortOrder(key);\n                          }}\n                        />\n                        {key === 'asc' ? '' : ''}\n                      </label>\n                    ))}\n                  </fieldset> */}\n                  <span class=\"filter-label\">\n                    <Trans id=\"group.filter\">Group</Trans>\n                  </span>{' '}\n                  <fieldset class=\"radio-field-group\">\n                    {FILTER_GROUPS.map((key) => (\n                      <label class=\"filter-group\" key={key || 'none'}>\n                        <input\n                          type=\"radio\"\n                          name=\"filter-group\"\n                          checked={groupBy === key}\n                          onChange={() => {\n                            setGroupBy(key);\n                          }}\n                          disabled={key === 'account' && selectedAuthor}\n                        />\n                        {{\n                          account: t`Authors`,\n                        }[key] || t`None`}\n                      </label>\n                    ))}\n                  </fieldset>\n                  {\n                    selectedAuthor && authorCountsList.length > 1 ? (\n                      <button\n                        type=\"button\"\n                        class=\"plain6 small\"\n                        onClick={() => {\n                          setSelectedAuthor(null);\n                        }}\n                        style={{\n                          whiteSpace: 'nowrap',\n                        }}\n                      >\n                        <Trans>Show all authors</Trans>\n                      </button>\n                    ) : null\n                    // <button\n                    //   type=\"button\"\n                    //   class=\"plain4 small\"\n                    //   onClick={() => {}}\n                    // >\n                    //   Group by authors\n                    // </button>\n                  }\n                </div>\n              )}\n              <ul\n                class={`catchup-list catchup-filter-${\n                  selectedFilterCategory || ''\n                } ${sortBy ? `catchup-sort-${sortBy}` : ''} ${\n                  selectedAuthor && authors[selectedAuthor]\n                    ? `catchup-selected-author`\n                    : ''\n                } ${groupBy ? `catchup-group-${groupBy}` : ''}`}\n              >\n                {sortedFilteredPosts.map((post, i) => {\n                  const id = post.reblog?.id || post.id;\n                  let showSeparator = false;\n                  if (groupBy === 'account') {\n                    if (\n                      prevGroup.current &&\n                      post.account.id !== prevGroup.current &&\n                      i > 0\n                    ) {\n                      showSeparator = true;\n                    }\n                    prevGroup.current = post.account.id;\n                  }\n                  return (\n                    <Fragment key={`${post.id}-${showSeparator}`}>\n                      {showSeparator && <li class=\"separator\" />}\n                      <IntersectionPostLineItem\n                        to={`/${instance}/s/${id}`}\n                        post={post}\n                        root={scrollableRef.current}\n                      />\n                    </Fragment>\n                  );\n                })}\n              </ul>\n              <footer>\n                {filteredPosts.length > 5 && (\n                  <p>\n                    {selectedFilterCategory === 'boosts'\n                      ? t`You don't have to read everything.`\n                      : t`That's all.`}{' '}\n                    <button\n                      type=\"button\"\n                      class=\"textual\"\n                      onClick={() => {\n                        scrollableRef.current.scrollTop = 0;\n                      }}\n                    >\n                      <Trans>Back to top</Trans>\n                    </button>\n                    .\n                  </p>\n                )}\n              </footer>\n            </>\n          )}\n        </main>\n      </div>\n      {showHelp && (\n        <Modal onClose={() => setShowHelp(false)}>\n          <div class=\"sheet\" id=\"catchup-help-sheet\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowHelp(false)}\n            >\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <h2>\n                <Trans>Help</Trans>\n              </h2>\n            </header>\n            <main>\n              <dl>\n                <dt>\n                  <Trans>Top links</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Links shared by followings, sorted by shared counts, boosts\n                    and likes.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Sort: Density</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Posts are sorted by information density or depth. Shorter\n                    posts are \"lighter\" while longer posts are \"heavier\". Posts\n                    with photos are \"heavier\" than posts without photos.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Group: Authors</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Posts are grouped by authors, sorted by posts count per\n                    author.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Keyboard shortcuts</Trans>\n                </dt>\n                {/* <dd>\n                  <kbd>j</kbd>: <Trans>Next post</Trans>\n                </dd>\n                <dd>\n                  <kbd>k</kbd>: <Trans>Previous post</Trans>\n                </dd>\n                <dd>\n                  <kbd>l</kbd>: <Trans>Next author</Trans>\n                </dd>\n                <dd>\n                  <kbd>h</kbd>: <Trans>Previous author</Trans>\n                </dd>\n                <dd>\n                  <kbd>Enter</kbd>: <Trans>Open post details</Trans>\n                </dd>\n                <dd>\n                  <kbd>.</kbd>: <Trans>Scroll to top</Trans>\n                </dd> */}\n                <dd>\n                  <table>\n                    <tbody>\n                      <tr>\n                        <td>\n                          <Trans>Next post</Trans>\n                        </td>\n                        <td>\n                          <kbd>j</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Previous post</Trans>\n                        </td>\n                        <td>\n                          <kbd>k</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Next author</Trans>\n                        </td>\n                        <td>\n                          <kbd>l</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Previous author</Trans>\n                        </td>\n                        <td>\n                          <kbd>h</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Open post details</Trans>\n                        </td>\n                        <td>\n                          <kbd>Enter</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Scroll to top</Trans>\n                        </td>\n                        <td>\n                          <kbd>.</kbd>\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </dd>\n              </dl>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst PostLine = memo(\n  function ({ post }) {\n    const {\n      id,\n      account,\n      group,\n      reblog,\n      quote,\n      inReplyToId,\n      inReplyToAccountId,\n      _followedTags: isFollowedTags,\n      _filtered: filterInfo,\n      visibility,\n      __BOOSTERS,\n    } = post;\n    const isReplyTo = inReplyToId && inReplyToAccountId !== account.id;\n    const isFiltered = !!filterInfo && filterInfo?.action !== 'blur';\n\n    const debugHover = (e) => {\n      if (e.shiftKey) {\n        console.log({\n          ...post,\n        });\n      }\n    };\n\n    return (\n      <article\n        class={`post-line ${\n          group\n            ? 'group'\n            : reblog\n              ? 'reblog'\n              : supportsNativeQuote() && hasQuote(quote)\n                ? 'quote'\n                : isFollowedTags?.length\n                  ? 'followed-tags'\n                  : ''\n        } ${isReplyTo ? 'reply-to' : ''} ${\n          isFiltered ? 'filtered' : ''\n        } visibility-${visibility}`}\n        onMouseEnter={debugHover}\n      >\n        <span class=\"post-author\">\n          {reblog ? (\n            <span class=\"post-reblog-avatar\">\n              <Avatar\n                url={account.avatarStatic || account.avatar}\n                squircle={account.bot}\n              />\n              {__BOOSTERS?.size > 0\n                ? [...__BOOSTERS].map((b) => (\n                    <Avatar url={b.avatarStatic || b.avatar} squircle={b.bot} />\n                  ))\n                : ''}{' '}\n              <Icon icon=\"rocket\" />{' '}\n              {/* <Avatar\n              url={reblog.account.avatarStatic || reblog.account.avatar}\n              squircle={reblog.account.bot}\n            /> */}\n              <NameText account={reblog.account} showAvatar />\n            </span>\n          ) : hasQuote(quote) ? (\n            <span class=\"post-quote-avatar\">\n              <Avatar\n                url={account.avatarStatic || account.avatar}\n                squircle={account.bot}\n              />{' '}\n              <Icon icon=\"quote\" />{' '}\n              <NameText\n                account={quote.quotedStatus?.account || quote.account}\n                showAvatar\n              />\n            </span>\n          ) : (\n            <NameText account={account} showAvatar />\n          )}\n        </span>\n        <PostPeek post={reblog || post} filterInfo={filterInfo} />\n        <span class=\"post-meta\">\n          <PostStats post={reblog || post} />{' '}\n          <RelativeTime\n            datetime={new Date(reblog?.createdAt || post.createdAt)}\n            format=\"micro\"\n          />\n        </span>\n      </article>\n    );\n  },\n  (oldProps, newProps) => {\n    return oldProps?.post?.id === newProps?.post?.id;\n  },\n);\n\nconst IntersectionPostLineItem = ({ root, to, ...props }) => {\n  const ref = useRef();\n  const [show, setShow] = useState(false);\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const entry = entries[0];\n        if (entry.isIntersecting) {\n          queueMicrotask(() => setShow(true));\n          observer.unobserve(ref.current);\n        }\n      },\n      {\n        root,\n        rootMargin: `${Math.max(320, screen.height * 0.75)}px`,\n      },\n    );\n    if (ref.current) observer.observe(ref.current);\n    return () => {\n      if (ref.current) observer.unobserve(ref.current);\n    };\n  }, []);\n\n  return show ? (\n    <li>\n      <Link to={to}>\n        <PostLine {...props} />\n      </Link>\n    </li>\n  ) : (\n    <li ref={ref} style={{ height: '4em' }} />\n  );\n};\n\n// A media speak a thousand words\nconst MEDIA_DENSITY = 8;\nconst CARD_DENSITY = 8;\nfunction postDensity(post) {\n  const { spoilerText, content, poll, mediaAttachments, card } = post;\n  const pollContent = poll?.options?.length\n    ? poll.options.reduce((acc, cur) => acc + cur.title, '')\n    : '';\n  const density =\n    (spoilerText.length + htmlContentLength(content) + pollContent.length) /\n      140 +\n    (mediaAttachments?.length\n      ? MEDIA_DENSITY * mediaAttachments.length\n      : card?.image\n        ? CARD_DENSITY\n        : 0);\n  return density;\n}\n\nconst MEDIA_SIZE = 48;\n\nfunction PostPeek({ post, filterInfo }) {\n  const { t } = useLingui();\n  let {\n    spoilerText,\n    sensitive,\n    content,\n    emojis,\n    poll,\n    mediaAttachments,\n    card,\n    inReplyToId,\n    inReplyToAccountId,\n    account,\n    _thread,\n    quote,\n  } = post;\n  const isThread =\n    (inReplyToId && inReplyToAccountId === account.id) || !!_thread;\n  let theQuote =\n    supportsNativeQuote() && hasQuote(quote)\n      ? quote.quotedStatus || quote\n      : null;\n  if (theQuote?.spoilerText || theQuote?.sensitive) theQuote = null;\n  if (theQuote?.emojis) emojis.push(...theQuote.emojis);\n  if (!mediaAttachments?.length && theQuote?.mediaAttachments?.length) {\n    mediaAttachments = theQuote.mediaAttachments;\n  }\n\n  const prefs = getPreferences();\n  const readingExpandSpoilers = !!prefs['reading:expand:spoilers'];\n  // const readingExpandSpoilers = true;\n  const showMedia =\n    readingExpandSpoilers ||\n    (!spoilerText && !sensitive && filterInfo?.action !== 'blur');\n  const postText = content ? statusPeek(post) : '';\n\n  const showPostContent = !spoilerText || readingExpandSpoilers;\n\n  return (\n    <div class=\"post-peek\" title={!spoilerText ? postText : ''}>\n      <span class=\"post-peek-content\">\n        {isThread && !showPostContent && (\n          <>\n            <span class=\"post-peek-tag post-peek-thread\">Thread</span>{' '}\n          </>\n        )}\n        {!!filterInfo && filterInfo?.action !== 'blur' ? (\n          <span class=\"post-peek-filtered\">\n            {/* Filtered{filterInfo?.titlesStr ? `: ${filterInfo.titlesStr}` : ''} */}\n            {filterInfo?.titlesStr\n              ? t`Filtered: ${filterInfo.titlesStr}`\n              : t`Filtered`}\n          </span>\n        ) : (\n          <>\n            {!!spoilerText && (\n              <span class=\"post-peek-spoiler\">\n                <Icon\n                  icon={`${readingExpandSpoilers ? 'eye-open' : 'eye-close'}`}\n                />{' '}\n                {spoilerText}\n              </span>\n            )}\n            {showPostContent && (\n              <div class=\"post-peek-html\">\n                {isThread && (\n                  <>\n                    <span class=\"post-peek-tag post-peek-thread\">\n                      <Trans>Thread</Trans>\n                    </span>{' '}\n                  </>\n                )}\n                {!!content && (\n                  <div\n                    dangerouslySetInnerHTML={{\n                      __html:\n                        emojifyText(content, emojis) +\n                        (!!theQuote?.content\n                          ? `<blockquote class=\"post-peek-quote\">${theQuote.content}</blockquote>`\n                          : ''),\n                    }}\n                  />\n                )}\n                {!!poll?.options?.length &&\n                  poll.options.map((o) => (\n                    <div>\n                      {poll.multiple ? '' : ''} {o.title}\n                    </div>\n                  ))}\n                {!content &&\n                  mediaAttachments?.length === 1 &&\n                  mediaAttachments[0].description && (\n                    <>\n                      <span class=\"post-peek-tag post-peek-alt\">ALT</span>{' '}\n                      <div>{mediaAttachments[0].description}</div>\n                    </>\n                  )}\n              </div>\n            )}\n          </>\n        )}\n      </span>\n      {(!filterInfo || filterInfo?.action === 'blur') && (\n        <span class=\"post-peek-post-content\">\n          {!!poll && (\n            <span class=\"post-peek-tag post-peek-poll\">\n              <Icon icon=\"poll\" size=\"s\" />\n              <Trans>Poll</Trans>\n            </span>\n          )}\n          {!!mediaAttachments?.length\n            ? mediaAttachments.map((m) => {\n                const mediaURL = m.previewUrl || m.url;\n                const remoteMediaURL = m.previewRemoteUrl || m.remoteUrl;\n                const width = m.meta?.original\n                  ? m.meta.original.width\n                  : m.meta?.small?.width || m.meta?.original?.width;\n                const height = m.meta?.original\n                  ? m.meta.original.height\n                  : m.meta?.small?.height || m.meta?.original?.height;\n                return (\n                  <span key={m.id} class=\"post-peek-media\">\n                    {{\n                      image:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                            style={{\n                              '--anim-duration': `${Math.min(\n                                Math.max(Math.max(width, height) / 100, 5),\n                                120,\n                              )}s`,\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      gifv:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      video:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      audio: <span class=\"post-peek-faux-media\"></span>,\n                    }[m.type] || null}\n                  </span>\n                );\n              })\n            : !!card &&\n              card.image &&\n              showMedia && (\n                <span\n                  class={`post-peek-media post-peek-card card-${\n                    card.type || ''\n                  }`}\n                >\n                  {card.image ? (\n                    <img\n                      src={card.image}\n                      width={MEDIA_SIZE}\n                      height={MEDIA_SIZE}\n                      alt={\n                        card.title || card.description || card.imageDescription\n                      }\n                      loading=\"lazy\"\n                      style={{\n                        '--anim-duration':\n                          card.width &&\n                          card.height &&\n                          `${Math.min(\n                            Math.max(\n                              Math.max(card.width, card.height) / 100,\n                              5,\n                            ),\n                            120,\n                          )}s`,\n                      }}\n                    />\n                  ) : (\n                    <span class=\"post-peek-faux-media\"></span>\n                  )}\n                </span>\n              )}\n        </span>\n      )}\n    </div>\n  );\n}\n\nfunction PostStats({ post }) {\n  const { t } = useLingui();\n  const { reblogsCount, repliesCount, favouritesCount, quotesCount } = post;\n  return (\n    <span class=\"post-stats\">\n      {repliesCount > 0 && (\n        <span class=\"post-stat-replies\">\n          <Icon icon=\"comment2\" size=\"s\" alt={t`Replies`} />{' '}\n          {shortenNumber(repliesCount)}\n        </span>\n      )}\n      {favouritesCount > 0 && (\n        <span class=\"post-stat-likes\">\n          <Icon icon=\"heart\" size=\"s\" alt={t`Likes`} />{' '}\n          {shortenNumber(favouritesCount)}\n        </span>\n      )}\n      {reblogsCount > 0 || quotesCount > 0 ? (\n        <span class=\"post-stat-boosts\">\n          <Icon icon=\"rocket\" size=\"s\" alt={t`Boosts`} />{' '}\n          {reblogsCount > 0 || quotesCount > 0\n            ? `${reblogsCount > 0 ? shortenNumber(reblogsCount) : ''}${\n                reblogsCount > 0 && quotesCount > 0 ? '+' : ''\n              }${quotesCount > 0 ? shortenNumber(quotesCount) : ''}`\n            : shortenNumber(reblogsCount)}\n        </span>\n      ) : null}\n    </span>\n  );\n}\n\nfunction binByTime(data, key, numBins) {\n  // Extract dates from data objects\n  const dates = data.map((item) => new Date(item[key]));\n\n  // Find minimum and maximum dates directly (avoiding Math.min/max)\n  const minDate = dates.reduce(\n    (acc, date) => (date < acc ? date : acc),\n    dates[0],\n  );\n  const maxDate = dates.reduce(\n    (acc, date) => (date > acc ? date : acc),\n    dates[0],\n  );\n\n  // Calculate the time span in milliseconds\n  const range = Math.min(maxDate.getTime(), Date.now()) - minDate.getTime();\n\n  // Create empty bins and loop through data\n  const bins = Array.from({ length: numBins }, () => []);\n  data.forEach((item) => {\n    const dateTime = Date.parse(item[key]);\n    if (dateTime > Date.now()) {\n      // Future dates go into the last bin\n      bins[bins.length - 1].push(item);\n    } else {\n      const normalized = (dateTime - minDate.getTime()) / range;\n      const binIndex = Math.floor(normalized * (numBins - 1));\n      bins[binIndex].push(item);\n    }\n  });\n\n  return bins;\n}\n\nexport default Catchup;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useRef } from 'preact/hooks';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Favourites() {\n  const { t } = useLingui();\n  useTitle(t`Likes`, '/favourites');\n  const { masto, instance } = api();\n  const favouritesIterator = useRef();\n  async function fetchFavourites(firstLoad) {\n    if (firstLoad || !favouritesIterator.current) {\n      favouritesIterator.current = masto.v1.favourites\n        .list({ limit: LIMIT })\n        .values();\n    }\n    return await favouritesIterator.current.next();\n  }\n\n  return (\n    <Timeline\n      title={t`Likes`}\n      id=\"favourites\"\n      emptyText={t`No likes yet. Go like something!`}\n      errorText={t`Unable to load likes.`}\n      instance={instance}\n      fetchItems={fetchFavourites}\n    />\n  );\n}\n\nexport default Favourites;\n","import './filters.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useRef, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport { api } from '../utils/api';\nimport i18nDuration from '../utils/i18n-duration';\nimport { getAPIVersions } from '../utils/store-utils';\nimport useInterval from '../utils/useInterval';\nimport useTitle from '../utils/useTitle';\n\nconst FILTER_CONTEXT = ['home', 'public', 'notifications', 'thread', 'account'];\nconst FILTER_CONTEXT_UNIMPLEMENTED = ['thread', 'account'];\nconst FILTER_CONTEXT_LABELS = {\n  home: msg`Home and lists`,\n  notifications: msg`Notifications`,\n  public: msg`Public timelines`,\n  thread: msg`Conversations`,\n  account: msg`Profiles`,\n};\n\nconst EXPIRY_DURATIONS = [\n  0, // forever\n  30 * 60, // 30 minutes\n  60 * 60, // 1 hour\n  6 * 60 * 60, // 6 hours\n  12 * 60 * 60, // 12 hours\n  60 * 60 * 24, // 24 hours\n  60 * 60 * 24 * 7, // 7 days\n  60 * 60 * 24 * 30, // 30 days\n];\n\nconst EXPIRY_DURATIONS_LABELS = {\n  0: msg`Never`,\n  1800: i18nDuration(30, 'minute'),\n  3600: i18nDuration(1, 'hour'),\n  21600: i18nDuration(6, 'hour'),\n  43200: i18nDuration(12, 'hour'),\n  86_400: i18nDuration(24, 'hour'),\n  604_800: i18nDuration(7, 'day'),\n  2_592_000: i18nDuration(30, 'day'),\n};\n\nfunction Filters() {\n  const { t } = useLingui();\n  const { masto } = api();\n  useTitle(t`Filters`, `/ft`);\n  const [uiState, setUIState] = useState('default');\n  const [showFiltersAddEditModal, setShowFiltersAddEditModal] = useState(false);\n\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [filters, setFilters] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const filters = await masto.v2.filters.list();\n        filters.sort((a, b) => a.title.localeCompare(b.title));\n        filters.forEach((filter) => {\n          if (filter.keywords?.length) {\n            filter.keywords.sort((a, b) => a.id - b.id);\n          }\n        });\n        console.log(filters);\n        setFilters(filters);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  return (\n    <div id=\"filters-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Filters</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => {\n                  setShowFiltersAddEditModal(true);\n                }}\n              >\n                <Icon icon=\"plus\" size=\"l\" alt={t`New filter`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {filters.length > 0 ? (\n            <>\n              <ul class=\"filters-list\">\n                {filters.map((filter) => {\n                  const { id, title, expiresAt, keywords } = filter;\n                  return (\n                    <li key={id}>\n                      <div>\n                        <h2>{title}</h2>\n                        {keywords?.length > 0 && (\n                          <div>\n                            {keywords.map((k) => (\n                              <>\n                                <span class=\"tag collapsed insignificant\">\n                                  {k.wholeWord ? `${k.keyword}` : k.keyword}\n                                </span>{' '}\n                              </>\n                            ))}\n                          </div>\n                        )}\n                        <small class=\"insignificant\">\n                          <ExpiryStatus expiresAt={expiresAt} />\n                        </small>\n                      </div>\n                      <button\n                        type=\"button\"\n                        class=\"plain\"\n                        onClick={() => {\n                          setShowFiltersAddEditModal({\n                            filter,\n                          });\n                        }}\n                      >\n                        <Icon icon=\"pencil\" size=\"l\" alt=\"Edit filter\" />\n                      </button>\n                    </li>\n                  );\n                })}\n              </ul>\n              {filters.length > 1 && (\n                <footer class=\"ui-state\">\n                  <small class=\"insignificant\">\n                    <Plural\n                      value={filters.length}\n                      one=\"# filter\"\n                      other=\"# filters\"\n                    />\n                  </small>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load filters.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No filters yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n      {!!showFiltersAddEditModal && (\n        <Modal\n          title={t`Add filter`}\n          onClose={() => {\n            setShowFiltersAddEditModal(false);\n          }}\n        >\n          <FiltersAddEdit\n            filter={showFiltersAddEditModal?.filter}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowFiltersAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nlet _id = 1;\nconst incID = () => _id++;\nfunction FiltersAddEdit({ filter, onClose }) {\n  const { _, t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const editMode = !!filter;\n  const { context, expiresAt, id, keywords, title, filterAction } =\n    filter || {};\n  const hasExpiry = !!expiresAt;\n  const expiresAtDate = hasExpiry && new Date(expiresAt);\n  const [editKeywords, setEditKeywords] = useState(keywords || []);\n  const keywordsRef = useRef();\n\n  // Hacky way of handling removed keywords for both existing and new ones\n  const [removedKeywordIDs, setRemovedKeywordIDs] = useState([]);\n  const [removedKeyword_IDs, setRemovedKeyword_IDs] = useState([]);\n\n  const filteredEditKeywords = editKeywords.filter(\n    (k) =>\n      !removedKeywordIDs.includes(k.id) && !removedKeyword_IDs.includes(k._id),\n  );\n\n  return (\n    <div class=\"sheet\" id=\"filters-add-edit-modal\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>{editMode ? t`Edit filter` : t`New filter`}</h2>\n      </header>\n      <main>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const title = formData.get('title');\n            const keywordIDs = formData.getAll('keyword_attributes[][id]');\n            const keywordKeywords = formData.getAll(\n              'keyword_attributes[][keyword]',\n            );\n            // const keywordWholeWords = formData.getAll(\n            //   'keyword_attributes[][whole_word]',\n            // );\n            // Not using getAll because it skips the empty checkboxes\n            const keywordWholeWords = [\n              ...keywordsRef.current.querySelectorAll(\n                'input[name=\"keyword_attributes[][whole_word]\"]',\n              ),\n            ].map((i) => i.checked);\n            const keywordsAttributes = keywordKeywords.map((k, i) => ({\n              id: keywordIDs[i] || undefined,\n              keyword: k,\n              wholeWord: keywordWholeWords[i],\n            }));\n            // if (editMode && keywords?.length) {\n            //   // Find which one got deleted and add to keywordsAttributes\n            //   keywords.forEach((k) => {\n            //     if (!keywordsAttributes.find((ka) => ka.id === k.id)) {\n            //       keywordsAttributes.push({\n            //         ...k,\n            //         _destroy: true,\n            //       });\n            //     }\n            //   });\n            // }\n            if (editMode && removedKeywordIDs?.length) {\n              removedKeywordIDs.forEach((id) => {\n                keywordsAttributes.push({\n                  id,\n                  _destroy: true,\n                });\n              });\n            }\n            const context = formData.getAll('context');\n            let expiresIn = formData.get('expires_in');\n            const filterAction = formData.get('filter_action');\n            console.log({\n              title,\n              keywordIDs,\n              keywords: keywordKeywords,\n              wholeWords: keywordWholeWords,\n              keywordsAttributes,\n              context,\n              expiresIn,\n              filterAction,\n            });\n\n            // Required fields\n            if (!title || !context?.length) {\n              return;\n            }\n\n            setUIState('loading');\n\n            (async () => {\n              try {\n                let filterResult;\n\n                if (editMode) {\n                  if (expiresIn === '' || expiresIn === null) {\n                    // No value\n                    // Preserve existing expiry if not specified\n                    // Seconds from now to expiresAtDate\n                    // Other clients don't do this\n                    if (hasExpiry) {\n                      expiresIn = Math.floor(\n                        (expiresAtDate - Date.now()) / 1000,\n                      );\n                    } else {\n                      expiresIn = null;\n                    }\n                  } else if (expiresIn === '0' || expiresIn === 0) {\n                    // 0 = Never\n                    expiresIn = null;\n                  } else {\n                    expiresIn = +expiresIn;\n                  }\n                  filterResult = await masto.v2.filters.$select(id).update({\n                    title,\n                    context,\n                    expiresIn,\n                    keywordsAttributes,\n                    filterAction,\n                  });\n                } else {\n                  expiresIn = +expiresIn || null;\n                  filterResult = await masto.v2.filters.create({\n                    title,\n                    context,\n                    expiresIn,\n                    keywordsAttributes,\n                    filterAction,\n                  });\n                }\n                console.log({ filterResult });\n                setUIState('default');\n                onClose?.({\n                  state: 'success',\n                  filter: filterResult,\n                });\n              } catch (error) {\n                console.error(error);\n                setUIState('error');\n                alert(\n                  editMode\n                    ? t`Unable to edit filter`\n                    : t`Unable to create filter`,\n                );\n              }\n            })();\n          }}\n        >\n          <div class=\"filter-form-row\">\n            <label>\n              <b>\n                <Trans>Title</Trans>\n              </b>\n              <input\n                type=\"text\"\n                name=\"title\"\n                defaultValue={title}\n                disabled={uiState === 'loading'}\n                dir=\"auto\"\n                enterKeyHint=\"done\"\n                required\n              />\n            </label>\n          </div>\n          <div class=\"filter-form-keywords\" ref={keywordsRef}>\n            {filteredEditKeywords.length ? (\n              <ul class=\"filter-keywords\">\n                {filteredEditKeywords.map((k) => {\n                  const { id, keyword, wholeWord, _id } = k;\n                  return (\n                    <li key={`${id}-${_id}`}>\n                      <input\n                        type=\"hidden\"\n                        name=\"keyword_attributes[][id]\"\n                        value={id}\n                      />\n                      <input\n                        name=\"keyword_attributes[][keyword]\"\n                        type=\"text\"\n                        defaultValue={keyword}\n                        disabled={uiState === 'loading'}\n                        required\n                        dir=\"auto\"\n                        enterKeyHint=\"done\"\n                      />\n                      <div class=\"filter-keyword-actions\">\n                        <label>\n                          <input\n                            name=\"keyword_attributes[][whole_word]\"\n                            type=\"checkbox\"\n                            value={id} // Hacky way to map checkbox boolean to the keyword id\n                            defaultChecked={wholeWord}\n                            disabled={uiState === 'loading'}\n                          />{' '}\n                          <Trans>Whole word</Trans>\n                        </label>\n                        <button\n                          type=\"button\"\n                          class=\"light danger small\"\n                          disabled={uiState === 'loading'}\n                          onClick={() => {\n                            if (id) {\n                              removedKeywordIDs.push(id);\n                              setRemovedKeywordIDs([...removedKeywordIDs]);\n                            } else if (_id) {\n                              removedKeyword_IDs.push(_id);\n                              setRemovedKeyword_IDs([...removedKeyword_IDs]);\n                            }\n                          }}\n                        >\n                          <Icon icon=\"x\" alt={t`Remove`} />\n                        </button>\n                      </div>\n                    </li>\n                  );\n                })}\n              </ul>\n            ) : (\n              <div class=\"filter-keywords\">\n                <div class=\"insignificant\">\n                  <Trans>No keywords. Add one.</Trans>\n                </div>\n              </div>\n            )}\n            <footer class=\"filter-keywords-footer\">\n              <button\n                type=\"button\"\n                class=\"light\"\n                onClick={() => {\n                  setEditKeywords([\n                    ...editKeywords,\n                    {\n                      _id: incID(),\n                      keyword: '',\n                      wholeWord: true,\n                    },\n                  ]);\n                  setTimeout(() => {\n                    // Focus last input\n                    const fields =\n                      keywordsRef.current.querySelectorAll(\n                        'input[type=\"text\"]',\n                      );\n                    fields[fields.length - 1]?.focus?.();\n                  }, 10);\n                }}\n              >\n                <Trans>Add keyword</Trans>\n              </button>{' '}\n              {filteredEditKeywords?.length > 1 && (\n                <small class=\"insignificant\">\n                  <Plural\n                    value={filteredEditKeywords.length}\n                    one=\"# keyword\"\n                    other=\"# keywords\"\n                  />\n                </small>\n              )}\n            </footer>\n          </div>\n          <div class=\"filter-form-cols\">\n            <div class=\"filter-form-col\">\n              <div>\n                <b>\n                  <Trans>Filter from</Trans>\n                </b>\n              </div>\n              {FILTER_CONTEXT.map((ctx) => (\n                <div>\n                  <label\n                    class={\n                      FILTER_CONTEXT_UNIMPLEMENTED.includes(ctx)\n                        ? 'insignificant'\n                        : ''\n                    }\n                  >\n                    <input\n                      type=\"checkbox\"\n                      name=\"context\"\n                      value={ctx}\n                      defaultChecked={!!context ? context.includes(ctx) : true}\n                      disabled={uiState === 'loading'}\n                    />{' '}\n                    {_(FILTER_CONTEXT_LABELS[ctx])}\n                    {FILTER_CONTEXT_UNIMPLEMENTED.includes(ctx) ? '*' : ''}\n                  </label>{' '}\n                </div>\n              ))}\n              <p>\n                <small class=\"insignificant\">\n                  <Trans>* Not implemented yet</Trans>\n                </small>\n              </p>\n            </div>\n            <div class=\"filter-form-col\">\n              {editMode && (\n                <Trans>\n                  Status:{' '}\n                  <b>\n                    <ExpiryStatus expiresAt={expiresAt} showNeverExpires />\n                  </b>\n                </Trans>\n              )}\n              <div>\n                <label for=\"filters-expires_in\">\n                  {editMode ? t`Change expiry` : t`Expiry`}\n                </label>\n                <select\n                  id=\"filters-expires_in\"\n                  name=\"expires_in\"\n                  disabled={uiState === 'loading'}\n                  defaultValue={editMode ? undefined : 0}\n                >\n                  {editMode && <option></option>}\n                  {EXPIRY_DURATIONS.map((v) => (\n                    <option value={v}>\n                      {typeof EXPIRY_DURATIONS_LABELS[v] === 'function'\n                        ? EXPIRY_DURATIONS_LABELS[v]()\n                        : _(EXPIRY_DURATIONS_LABELS[v])}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <p>\n                <Trans>Filtered post will be</Trans>\n                <br />\n                {getAPIVersions()?.mastodon >= 5 && (\n                  <label class=\"ib\">\n                    <input\n                      type=\"radio\"\n                      name=\"filter_action\"\n                      value=\"blur\"\n                      defaultChecked={filterAction === 'blur'}\n                      disabled={uiState === 'loading'}\n                    />{' '}\n                    <Trans>obscured (media only)</Trans>\n                  </label>\n                )}{' '}\n                <label class=\"ib\">\n                  <input\n                    type=\"radio\"\n                    name=\"filter_action\"\n                    value=\"warn\"\n                    defaultChecked={\n                      (filterAction !== 'hide' && filterAction !== 'blur') ||\n                      !editMode\n                    }\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <Trans>minimized</Trans>\n                </label>{' '}\n                <label class=\"ib\">\n                  <input\n                    type=\"radio\"\n                    name=\"filter_action\"\n                    value=\"hide\"\n                    defaultChecked={filterAction === 'hide'}\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <Trans>hidden</Trans>\n                </label>\n              </p>\n            </div>\n          </div>\n          <footer class=\"filter-form-footer\">\n            <span>\n              <button type=\"submit\" disabled={uiState === 'loading'}>\n                {editMode ? t`Save` : t`Create`}\n              </button>{' '}\n              <Loader abrupt hidden={uiState !== 'loading'} />\n            </span>\n            {editMode && (\n              <MenuConfirm\n                disabled={uiState === 'loading'}\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete this filter?`}\n                onClick={() => {\n                  setUIState('loading');\n                  (async () => {\n                    try {\n                      await masto.v2.filters.$select(id).remove();\n                      setUIState('default');\n                      onClose?.({\n                        state: 'success',\n                      });\n                    } catch (e) {\n                      console.error(e);\n                      setUIState('error');\n                      alert(t`Unable to delete filter.`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  onClick={() => {}}\n                  disabled={uiState === 'loading'}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            )}\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nfunction ExpiryStatus({ expiresAt, showNeverExpires }) {\n  const { t } = useLingui();\n  const hasExpiry = !!expiresAt;\n  const expiresAtDate = hasExpiry && new Date(expiresAt);\n  const expired = hasExpiry && Date.parse(expiresAt) <= Date.now();\n\n  // If less than a minute left, re-render interval every second, else every minute\n  const [_, rerender] = useReducer((c) => c + 1, 0);\n  useInterval(rerender, expired || 30_000);\n\n  return expired ? (\n    t`Expired`\n  ) : hasExpiry ? (\n    <Trans>\n      Expiring <RelativeTime datetime={expiresAtDate} />\n    </Trans>\n  ) : (\n    showNeverExpires && t`Never expires`\n  );\n}\n\nexport default Filters;\n","import { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport NavMenu from '../components/nav-menu';\nimport { api } from '../utils/api';\nimport { fetchFollowedTags } from '../utils/followed-tags';\nimport useTitle from '../utils/useTitle';\n\nfunction FollowedHashtags() {\n  const { t } = useLingui();\n  const { masto, instance } = api();\n  useTitle(t`Followed Hashtags`, `/fh`);\n  const [uiState, setUIState] = useState('default');\n\n  const [followedHashtags, setFollowedHashtags] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const tags = await fetchFollowedTags();\n        setFollowedHashtags(tags);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"followed-hashtags-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Followed Hashtags</Trans>\n            </h1>\n            <div class=\"header-side\" />\n          </div>\n        </header>\n        <main>\n          {followedHashtags.length > 0 ? (\n            <>\n              <ul class=\"link-list\">\n                {followedHashtags.map((tag) => (\n                  <li>\n                    <Link\n                      to={\n                        instance\n                          ? `/${instance}/t/${tag.name}`\n                          : `/t/${tag.name}`\n                      }\n                    >\n                      <Icon icon=\"hashtag\" alt=\"#\" /> <span>{tag.name}</span>\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n              {followedHashtags.length > 1 && (\n                <footer class=\"ui-state\">\n                  <small class=\"insignificant\">\n                    <Plural\n                      value={followedHashtags.length}\n                      one=\"# hashtag\"\n                      other=\"# hashtags\"\n                    />\n                  </small>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load followed hashtags.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No hashtags followed yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default FollowedHashtags;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport states, { getStatus, saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport {\n  assignFollowedTags,\n  clearFollowedTagsState,\n  dedupeBoosts,\n} from '../utils/timeline-utils';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Following({ title, path, id, ...props }) {\n  const { t } = useLingui();\n  useTitle(\n    title ||\n      t({\n        id: 'following.title',\n        message: 'Following',\n      }),\n    path || '/following',\n  );\n  const { masto, streaming, instance, client } = api();\n  const [streamingClient, setStreamingClient] = useState(streaming);\n\n  const snapStates = useSnapshot(states);\n  const homeIterable = useRef();\n  const homeIterator = useRef();\n  const latestItem = useRef();\n\n  // Streaming only happens after instance is initialized\n  useEffect(() => {\n    if (!streaming && client?.onStreamingReady) {\n      client.onStreamingReady((streamingClient) => {\n        setStreamingClient(streamingClient);\n      });\n    }\n  }, [client]);\n  __BENCHMARK.end('time-to-following');\n\n  console.debug('RENDER Following', title, id);\n  const supportsPixelfed = supports('@pixelfed/home-include-reblogs');\n\n  async function fetchHome(firstLoad) {\n    if (firstLoad || !homeIterator.current) {\n      __BENCHMARK.start('fetch-home-first');\n      homeIterable.current = masto.v1.timelines.home.list({ limit: LIMIT });\n      homeIterator.current = homeIterable.current.values();\n    }\n    if (supportsPixelfed && homeIterable.current?.params) {\n      if (typeof homeIterable.current.params === 'string') {\n        homeIterable.current.params += '&include_reblogs=true';\n      } else {\n        homeIterable.current.params.include_reblogs = true;\n      }\n    }\n    const results = await homeIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      let latestItemChanged = false;\n      if (firstLoad) {\n        if (value[0].id !== latestItem.current) {\n          latestItemChanged = true;\n        }\n        latestItem.current = value[0].id;\n        console.log('First load', latestItem.current);\n      }\n\n      // value = filteredItems(value, 'home');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n      value = dedupeBoosts(value, instance);\n      if (firstLoad && latestItemChanged) clearFollowedTagsState();\n      setTimeout(() => {\n        assignFollowedTags(value, instance);\n      }, 100);\n\n      // ENFORCE sort by datetime (Latest first)\n      value.sort((a, b) => {\n        return Date.parse(b.createdAt) - Date.parse(a.createdAt);\n      });\n    }\n    __BENCHMARK.end('fetch-home-first');\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const opts = {\n        limit: 5,\n        since_id: latestItem.current,\n      };\n      if (supports('@pixelfed/home-include-reblogs')) {\n        opts.include_reblogs = true;\n      }\n      const results = await masto.v1.timelines.home.list(opts).values().next();\n      let { value } = results;\n      console.log('checkForUpdates', latestItem.current, value);\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        latestItem.current = value[0].id;\n        value = dedupeBoosts(value, instance);\n        value = filteredItems(value, 'home');\n        if (value.some((item) => !item.reblog)) {\n          return true;\n        }\n      }\n      return false;\n    } catch (e) {\n      console.error(e);\n      return false;\n    }\n  }\n\n  useEffect(() => {\n    let sub;\n    (async () => {\n      if (streamingClient) {\n        sub = streamingClient.user.subscribe();\n        console.log(' Streaming user', sub);\n        for await (const entry of sub) {\n          if (!sub) break;\n          if (entry.event === 'status.update') {\n            const status = entry.payload;\n            console.log(` Status ${status.id} updated`);\n            saveStatus(status, instance);\n          } else if (entry.event === 'delete') {\n            const statusID = entry.payload;\n            console.log(` Status ${statusID} deleted`);\n            // delete states.statuses[statusID];\n            const s = getStatus(statusID, instance);\n            if (s) s._deleted = true;\n          }\n        }\n        console.log(' Streaming user loop STOPPED');\n      }\n    })();\n    return () => {\n      sub?.unsubscribe?.();\n      sub = null;\n    };\n  }, [streamingClient]);\n\n  return (\n    <Timeline\n      title={title || t({ id: 'following.title', message: 'Following' })}\n      id={id || 'following'}\n      emptyText={t`Nothing to see here.`}\n      errorText={t`Unable to load posts.`}\n      instance={instance}\n      fetchItems={fetchHome}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      {...props}\n      // allowFilters\n      filterContext=\"home\"\n      showFollowedTags\n      showReplyParent\n    />\n  );\n}\n\nexport default Following;\n","import { plural } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport {\n  FocusableItem,\n  MenuDivider,\n  MenuGroup,\n  MenuHeader,\n  MenuItem,\n} from '@szhsin/react-menu';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useNavigate, useParams, useSearchParams } from 'react-router-dom';\n\nimport Icon from '../components/icon';\nimport MenuConfirm from '../components/menu-confirm';\nimport Menu2 from '../components/menu2';\nimport { SHORTCUTS_LIMIT } from '../components/shortcuts-settings';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport { isMediaFirstInstance } from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\n// Limit is 4 per \"mode\"\n// https://github.com/mastodon/mastodon/issues/15194\n// Hard-coded https://github.com/mastodon/mastodon/blob/19614ba2477f3d12468f5ec251ce1cc5f8c6210c/app/models/tag_feed.rb#L4\nconst TAGS_LIMIT_PER_MODE = 4;\nconst TOTAL_TAGS_LIMIT = TAGS_LIMIT_PER_MODE + 1;\n\nfunction Hashtags({ media: mediaView, columnMode, ...props }) {\n  const { t } = useLingui();\n  // const navigate = useNavigate();\n  let { hashtag, ...params } = columnMode ? {} : useParams();\n  if (props.hashtag) hashtag = props.hashtag;\n  let hashtags = hashtag.trim().split(/[\\s+]+/);\n  hashtags.sort();\n  hashtag = hashtags[0];\n  const [searchParams, setSearchParams] = useSearchParams();\n  const media = mediaView || !!searchParams.get('media');\n  const linkParams = media ? '?media=1' : '';\n\n  const { masto, instance, authenticated } = api({\n    instance: props?.instance || params.instance,\n  });\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated: currentAuthenticated,\n  } = api();\n  const hashtagTitle = hashtags.map((t) => `#${t}`).join(' ');\n  const title = instance\n    ? media\n      ? t`${hashtagTitle} (Media only) on ${instance}`\n      : t`${hashtagTitle} on ${instance}`\n    : media\n      ? t`${hashtagTitle} (Media only)`\n      : t`${hashtagTitle}`;\n  useTitle(title, `/:instance?/t/:hashtag`);\n  const latestItem = useRef();\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  // const hashtagsIterator = useRef();\n  const maxID = useRef(undefined);\n  async function fetchHashtags(firstLoad) {\n    // if (firstLoad || !hashtagsIterator.current) {\n    //   hashtagsIterator.current = masto.v1.timelines.tag.$select(hashtag).list({\n    //     limit: LIMIT,\n    //     any: hashtags.slice(1),\n    //   }).values();\n    // }\n    // const results = await hashtagsIterator.current.next();\n\n    // NOTE: Temporary fix for listHashtag not persisting `any` in subsequent calls.\n    const results = await masto.v1.timelines.tag\n      .$select(hashtag)\n      .list({\n        limit: LIMIT,\n        any: hashtags.slice(1),\n        maxId: firstLoad ? undefined : maxID.current,\n        onlyMedia: media ? true : undefined,\n      })\n      .values()\n      .next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance, {\n          skipThreading: media || mediaFirst, // If media view, no need to form threads\n        });\n      });\n\n      maxID.current = value[value.length - 1].id;\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.tag\n        .$select(hashtag)\n        .list({\n          limit: 1,\n          any: hashtags.slice(1),\n          since_id: latestItem.current,\n          onlyMedia: media,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'public');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const [followUIState, setFollowUIState] = useState('default');\n  const [info, setInfo] = useState();\n  // Get hashtag info\n  useEffect(() => {\n    (async () => {\n      try {\n        const info = await masto.v1.tags.$select(hashtag).fetch();\n        console.log(info);\n        setInfo(info);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [hashtag]);\n\n  const reachLimit = hashtags.length >= TOTAL_TAGS_LIMIT;\n\n  const [featuredUIState, setFeaturedUIState] = useState('default');\n  const [featuredTags, setFeaturedTags] = useState([]);\n  const [isFeaturedTag, setIsFeaturedTag] = useState(false);\n  useEffect(() => {\n    if (!authenticated) return;\n    (async () => {\n      try {\n        const featuredTags = await masto.v1.featuredTags.list();\n        setFeaturedTags(featuredTags);\n        setIsFeaturedTag(\n          featuredTags.some(\n            (tag) => tag.name.toLowerCase() === hashtag.toLowerCase(),\n          ),\n        );\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      <Timeline\n        key={instance + hashtagTitle}\n        title={title}\n        titleComponent={\n          !!instance && (\n            <h1 class=\"header-double-lines\">\n              <b dir=\"auto\">{hashtagTitle}</b>\n              <div>{instance}</div>\n            </h1>\n          )\n        }\n        id=\"hashtag\"\n        instance={instance}\n        emptyText={t`No one has posted anything with this tag yet.`}\n        errorText={t`Unable to load posts with this tag`}\n        fetchItems={fetchHashtags}\n        checkForUpdates={checkForUpdates}\n        useItemID\n        view={media || mediaFirst ? 'media' : undefined}\n        refresh={media}\n        // allowFilters\n        filterContext=\"public\"\n        headerEnd={\n          <Menu2\n            portal\n            setDownOverflow\n            overflow=\"auto\"\n            // viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            {!!info && hashtags.length === 1 && (\n              <>\n                <MenuConfirm\n                  subMenu\n                  confirm={info.following}\n                  confirmLabel={t`Unfollow #${hashtag}?`}\n                  disabled={followUIState === 'loading' || !authenticated}\n                  onClick={() => {\n                    setFollowUIState('loading');\n                    if (info.following) {\n                      // const yes = confirm(`Unfollow #${hashtag}?`);\n                      // if (!yes) {\n                      //   setFollowUIState('default');\n                      //   return;\n                      // }\n                      masto.v1.tags\n                        .$select(hashtag)\n                        .unfollow()\n                        .then(() => {\n                          setInfo({ ...info, following: false });\n                          showToast(t`Unfollowed #${hashtag}`);\n                        })\n                        .catch((e) => {\n                          alert(e);\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFollowUIState('default');\n                        });\n                    } else {\n                      masto.v1.tags\n                        .$select(hashtag)\n                        .follow()\n                        .then(() => {\n                          setInfo({ ...info, following: true });\n                          showToast(t`Followed #${hashtag}`);\n                        })\n                        .catch((e) => {\n                          alert(e);\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFollowUIState('default');\n                        });\n                    }\n                  }}\n                >\n                  {info.following ? (\n                    <>\n                      <Icon icon=\"check-circle\" />{' '}\n                      <span>\n                        <Trans>Following</Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"plus\" />{' '}\n                      <span>\n                        <Trans>Follow</Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuConfirm>\n                <MenuItem\n                  type=\"checkbox\"\n                  checked={isFeaturedTag}\n                  disabled={featuredUIState === 'loading' || !authenticated}\n                  onClick={() => {\n                    setFeaturedUIState('loading');\n                    if (isFeaturedTag) {\n                      const featuredTagID = featuredTags.find(\n                        (tag) =>\n                          tag.name.toLowerCase() === hashtag.toLowerCase(),\n                      ).id;\n                      if (featuredTagID) {\n                        masto.v1.featuredTags\n                          .$select(featuredTagID)\n                          .remove()\n                          .then(() => {\n                            setIsFeaturedTag(false);\n                            showToast(t`Unfeatured on profile`);\n                            setFeaturedTags(\n                              featuredTags.filter(\n                                (tag) => tag.id !== featuredTagID,\n                              ),\n                            );\n                          })\n                          .catch((e) => {\n                            console.error(e);\n                          })\n                          .finally(() => {\n                            setFeaturedUIState('default');\n                          });\n                      } else {\n                        showToast(t`Unable to unfeature on profile`);\n                      }\n                    } else {\n                      masto.v1.featuredTags\n                        .create({\n                          name: hashtag,\n                        })\n                        .then((value) => {\n                          setIsFeaturedTag(true);\n                          showToast(t`Featured on profile`);\n                          setFeaturedTags(featuredTags.concat(value));\n                        })\n                        .catch((e) => {\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFeaturedUIState('default');\n                        });\n                    }\n                  }}\n                >\n                  {isFeaturedTag ? (\n                    <>\n                      <Icon icon=\"check-circle\" />\n                      <span>\n                        <Trans>Featured on profile</Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"check-circle\" />\n                      <span>\n                        <Trans>Feature on profile</Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuItem>\n                <MenuDivider />\n              </>\n            )}\n            {!mediaFirst && (\n              <>\n                <MenuHeader className=\"plain\">\n                  <Trans>Filters</Trans>\n                </MenuHeader>\n                <MenuItem\n                  type=\"checkbox\"\n                  checked={!!media}\n                  onClick={() => {\n                    if (media) {\n                      searchParams.delete('media');\n                    } else {\n                      searchParams.set('media', '1');\n                    }\n                    setSearchParams(searchParams);\n                  }}\n                >\n                  <Icon icon=\"check-circle\" alt=\"\" />{' '}\n                  <span class=\"menu-grow\">\n                    <Trans>Media only</Trans>\n                  </span>\n                </MenuItem>\n                <MenuDivider />\n              </>\n            )}\n            <FocusableItem className=\"menu-field\" disabled={reachLimit}>\n              {({ ref }) => (\n                <form\n                  onSubmit={(e) => {\n                    e.preventDefault();\n                    const newHashtag = e.target[0].value?.trim?.();\n                    // Use includes but need to be case insensitive\n                    if (\n                      newHashtag &&\n                      !hashtags.some(\n                        (t) => t.toLowerCase() === newHashtag.toLowerCase(),\n                      )\n                    ) {\n                      hashtags.push(newHashtag);\n                      hashtags.sort();\n                      // navigate(\n                      //   instance\n                      //     ? `/${instance}/t/${hashtags.join('+')}`\n                      //     : `/t/${hashtags.join('+')}`,\n                      // );\n                      location.hash = instance\n                        ? `/${instance}/t/${hashtags.join('+')}${linkParams}`\n                        : `/t/${hashtags.join('+')}${linkParams}`;\n                    }\n                  }}\n                >\n                  <Icon icon=\"hashtag\" />\n                  <input\n                    ref={ref}\n                    type=\"text\"\n                    placeholder={\n                      reachLimit\n                        ? plural(TOTAL_TAGS_LIMIT, {\n                            other: 'Max # tags',\n                          })\n                        : t`Add hashtag`\n                    }\n                    required\n                    autocorrect=\"off\"\n                    autocapitalize=\"off\"\n                    spellCheck={false}\n                    // no spaces, no hashtags\n                    pattern=\"[^#][^\\s#]+[^#]\"\n                    disabled={reachLimit}\n                    dir=\"auto\"\n                    enterKeyHint=\"go\"\n                  />\n                </form>\n              )}\n            </FocusableItem>\n            <MenuGroup takeOverflow>\n              {hashtags.map((tag, i) => (\n                <MenuItem\n                  key={tag}\n                  disabled={hashtags.length === 1}\n                  onClick={(e) => {\n                    hashtags.splice(i, 1);\n                    hashtags.sort();\n                    // navigate(\n                    //   instance\n                    //     ? `/${instance}/t/${hashtags.join('+')}`\n                    //     : `/t/${hashtags.join('+')}`,\n                    // );\n                    location.hash = instance\n                      ? `/${instance}/t/${hashtags.join('+')}${linkParams}`\n                      : `/t/${hashtags.join('+')}${linkParams}`;\n                  }}\n                >\n                  <Icon icon=\"x\" alt={t`Remove hashtag`} class=\"danger-icon\" />\n                  <span class=\"bidi-isolate\">\n                    <span class=\"more-insignificant\">#</span>\n                    {tag}\n                  </span>\n                </MenuItem>\n              ))}\n            </MenuGroup>\n            <MenuDivider />\n            <MenuItem\n              disabled={!currentAuthenticated}\n              onClick={() => {\n                if (states.shortcuts.length >= SHORTCUTS_LIMIT) {\n                  alert(\n                    plural(SHORTCUTS_LIMIT, {\n                      one: 'Max # shortcut reached. Unable to add shortcut.',\n                      other: 'Max # shortcuts reached. Unable to add shortcut.',\n                    }),\n                  );\n                  return;\n                }\n                const shortcut = {\n                  type: 'hashtag',\n                  hashtag: hashtags.join(' '),\n                  instance,\n                  media: media ? 'on' : undefined,\n                };\n                // Check if already exists\n                const exists = states.shortcuts.some(\n                  (s) =>\n                    s.type === shortcut.type &&\n                    s.hashtag\n                      .split(/[\\s+]+/)\n                      .sort()\n                      .join(' ') ===\n                      shortcut.hashtag\n                        .split(/[\\s+]+/)\n                        .sort()\n                        .join(' ') &&\n                    (s.instance ? s.instance === shortcut.instance : true) &&\n                    (s.media ? !!s.media === !!shortcut.media : true),\n                );\n                if (exists) {\n                  alert(t`This shortcut already exists`);\n                } else {\n                  states.shortcuts.push(shortcut);\n                  showToast(t`Hashtag shortcut added`);\n                }\n              }}\n            >\n              <Icon icon=\"shortcut\" />{' '}\n              <span>\n                <Trans>Add to Shortcuts</Trans>\n              </span>\n            </MenuItem>\n            <MenuItem\n              onClick={() => {\n                let newInstance = prompt(\n                  t`Enter a new instance e.g. \"mastodon.social\"`,\n                );\n                if (!/\\./.test(newInstance)) {\n                  if (newInstance) alert(t`Invalid instance`);\n                  return;\n                }\n                if (newInstance) {\n                  newInstance = newInstance.toLowerCase().trim();\n                  // navigate(`/${newInstance}/t/${hashtags.join('+')}`);\n                  location.hash = `/${newInstance}/t/${hashtags.join(\n                    '+',\n                  )}${linkParams}`;\n                }\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <span>\n                <Trans>Go to another instance</Trans>\n              </span>\n            </MenuItem>\n            {currentInstance !== instance && (\n              <MenuItem\n                onClick={() => {\n                  location.hash = `/${currentInstance}/t/${hashtags.join(\n                    '+',\n                  )}${linkParams}`;\n                }}\n              >\n                <Icon icon=\"bus\" />{' '}\n                <small class=\"menu-double-lines\">\n                  <Trans>\n                    Go to my instance (<b>{currentInstance}</b>)\n                  </Trans>\n                </small>\n              </MenuItem>\n            )}\n          </Menu2>\n        }\n      />\n      {!columnMode && !!hashtags?.length && (\n        <data\n          class=\"compose-data\"\n          value={JSON.stringify({\n            draftStatus: {\n              status: `${hashtags.length > 1 ? '\\n\\n' : ' '}${hashtagTitle}`,\n            },\n          })}\n        />\n      )}\n    </>\n  );\n}\n\nexport default Hashtags;\n","import './lists.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuDivider, MenuHeader, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport AccountBlock from '../components/account-block';\nimport Icon from '../components/icon';\nimport ListAddEdit from '../components/list-add-edit';\nimport ListExclusiveBadge from '../components/list-exclusive-badge';\nimport MenuConfirm from '../components/menu-confirm';\nimport MenuLink from '../components/menu-link';\nimport Menu2 from '../components/menu2';\nimport Modal from '../components/modal';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport { getList, getLists } from '../utils/lists';\nimport states, { saveStatus } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction List(props) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto, instance } = api();\n  const id = props?.id || useParams()?.id;\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n  // const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  const listIterator = useRef();\n  async function fetchList(firstLoad) {\n    if (firstLoad || !listIterator.current) {\n      listIterator.current = masto.v1.timelines.list\n        .$select(id)\n        .list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await listIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'home');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.list.$select(id).list({\n        limit: 1,\n        since_id: latestItem.current,\n      });\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'home');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const [lists, setLists] = useState([]);\n\n  const [list, setList] = useState({ title: 'List' });\n  // const [title, setTitle] = useState(`List`);\n  useTitle(list.title, `/l/:id`);\n  useEffect(() => {\n    (async () => {\n      try {\n        const list = await getList(id);\n        setList(list);\n        // setTitle(list.title);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [id]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n  const [showManageMembersModal, setShowManageMembersModal] = useState(false);\n\n  return (\n    <>\n      <Timeline\n        key={id}\n        title={list.title}\n        id=\"list\"\n        emptyText={t`Nothing yet.`}\n        errorText={t`Unable to load posts.`}\n        instance={instance}\n        fetchItems={fetchList}\n        checkForUpdates={checkForUpdates}\n        useItemID\n        boostsCarousel={snapStates.settings.boostsCarousel}\n        // allowFilters\n        filterContext=\"home\"\n        showReplyParent\n        // refresh={reloadCount}\n        headerStart={\n          // <Link to=\"/l\" class=\"button plain\">\n          //   <Icon icon=\"list\" size=\"l\" />\n          // </Link>\n          <Menu2\n            overflow=\"auto\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"list\" size=\"l\" alt={t`Lists`} />\n                <Icon icon=\"chevron-down\" size=\"s\" />\n              </button>\n            }\n            onMenuChange={(e) => {\n              if (e.open) {\n                getLists().then(setLists);\n              }\n            }}\n          >\n            <MenuLink to=\"/l\">\n              <span>\n                <Trans>All Lists</Trans>\n              </span>\n            </MenuLink>\n            {lists?.length > 0 && (\n              <>\n                <MenuDivider />\n                {lists.map((list) => (\n                  <MenuLink key={list.id} to={`/l/${list.id}`}>\n                    <span>\n                      {list.title}\n                      {list.exclusive && (\n                        <>\n                          {' '}\n                          <ListExclusiveBadge />\n                        </>\n                      )}\n                    </span>\n                  </MenuLink>\n                ))}\n              </>\n            )}\n          </Menu2>\n        }\n        headerEnd={\n          <Menu2\n            portal\n            setDownOverflow\n            overflow=\"auto\"\n            viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            {list?.exclusive && (\n              <>\n                <MenuHeader className=\"plain\">\n                  <ListExclusiveBadge />{' '}\n                  <Trans>\n                    Posts on this list are hidden from Home/Following\n                  </Trans>\n                </MenuHeader>\n                <MenuDivider />\n              </>\n            )}\n            <MenuItem\n              onClick={() =>\n                setShowListAddEditModal({\n                  list,\n                })\n              }\n            >\n              <Icon icon=\"pencil\" size=\"l\" />\n              <span>\n                <Trans>Edit</Trans>\n              </span>\n            </MenuItem>\n            <MenuItem onClick={() => setShowManageMembersModal(true)}>\n              <Icon icon=\"group\" size=\"l\" />\n              <span>\n                <Trans>Manage members</Trans>\n              </span>\n            </MenuItem>\n          </Menu2>\n        }\n      />\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success' && result.list) {\n                setList(result.list);\n                // reload();\n              } else if (result.state === 'deleted') {\n                // navigate('/l');\n                location.hash = '/l';\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n      {showManageMembersModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowManageMembersModal(false);\n            }\n          }}\n        >\n          <ListManageMembers\n            listID={id}\n            onClose={() => setShowManageMembersModal(false)}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nconst MEMBERS_LIMIT = 40;\n\nfunction ListManageMembers({ listID, onClose }) {\n  const { t } = useLingui();\n  // Show list of members with [Remove] button\n  // API only returns 40 members at a time, so this need to be paginated with infinite scroll\n  // Show [Add] button after removing a member\n  const { masto, instance } = api();\n  const [members, setMembers] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const [showMore, setShowMore] = useState(false);\n\n  const membersIterator = useRef();\n\n  async function fetchMembers(firstLoad) {\n    setShowMore(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        if (firstLoad || !membersIterator.current) {\n          membersIterator.current = masto.v1.lists\n            .$select(listID)\n            .accounts.list({\n              limit: MEMBERS_LIMIT,\n            })\n            .values();\n        }\n        const results = await membersIterator.current.next();\n        let { done, value } = results;\n        if (value?.length) {\n          if (firstLoad) {\n            setMembers(value);\n          } else {\n            setMembers(members.concat(value));\n          }\n          setShowMore(!done);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  }\n\n  useEffect(() => {\n    fetchMembers(true);\n  }, []);\n\n  return (\n    <div class=\"sheet\" id=\"list-manage-members-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Manage members</Trans>\n        </h2>\n      </header>\n      <main>\n        <ul>\n          {members.map((member) => (\n            <li key={member.id}>\n              <AccountBlock account={member} instance={instance} />\n              <RemoveAddButton account={member} listID={listID} />\n            </li>\n          ))}\n          {showMore && uiState === 'default' && (\n            <InView as=\"li\" onChange={(inView) => inView && fetchMembers()}>\n              <button type=\"button\" class=\"light block\" onClick={fetchMembers}>\n                <Trans>Show more</Trans>\n              </button>\n            </InView>\n          )}\n        </ul>\n      </main>\n    </div>\n  );\n}\n\nfunction RemoveAddButton({ account, listID }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [removed, setRemoved] = useState(false);\n\n  return (\n    <MenuConfirm\n      confirm={!removed}\n      confirmLabel={\n        <span>\n          <Trans>\n            Remove <span class=\"bidi-isolate\">@{account.username}</span> from\n            list?\n          </Trans>\n        </span>\n      }\n      align=\"end\"\n      menuItemClassName=\"danger\"\n      onClick={() => {\n        if (removed) {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.lists.$select(listID).accounts.create({\n                accountIds: [account.id],\n              });\n              setUIState('default');\n              setRemoved(false);\n            } catch (e) {\n              setUIState('error');\n            }\n          })();\n        } else {\n          // const yes = confirm(`Remove ${account.username} from this list?`);\n          // if (!yes) return;\n          setUIState('loading');\n\n          (async () => {\n            try {\n              await masto.v1.lists.$select(listID).accounts.remove({\n                accountIds: [account.id],\n              });\n              setUIState('default');\n              setRemoved(true);\n            } catch (e) {\n              setUIState('error');\n            }\n          })();\n        }\n      }}\n    >\n      <button\n        type=\"button\"\n        class={`light ${removed ? '' : 'danger'}`}\n        disabled={uiState === 'loading'}\n      >\n        {removed ? t`Add` : t`Remove`}\n      </button>\n    </MenuConfirm>\n  );\n}\n\nexport default List;\n","// This is like very lame \"type-checking\" lol\nconst notificationTypeKeys = {\n  mention: ['account', 'status'],\n  quote: ['account', 'status'],\n  status: ['account', 'status'],\n  reblog: ['account', 'status'],\n  follow: ['account'],\n  follow_request: ['account'],\n  favourite: ['account', 'status'],\n  poll: ['status'],\n  update: ['status'],\n};\n\nconst GROUP_TYPES = ['favourite', 'reblog', 'follow'];\nconst groupable = (type) => GROUP_TYPES.includes(type);\n\nexport function fixNotifications(notifications) {\n  return notifications.filter((notification) => {\n    const { type, id, createdAt } = notification;\n    if (!type) {\n      console.warn('Notification missing type', notification);\n      return false;\n    }\n    if (!id || !createdAt) {\n      console.warn('Notification missing id or createdAt', notification);\n      // Continue processing this despite missing id or createdAt\n    }\n    const keys = notificationTypeKeys[type];\n    if (keys?.length) {\n      return keys.every((key) => !!notification[key]);\n    }\n    return true; // skip other types\n  });\n}\n\nexport function massageNotifications2(notifications) {\n  if (notifications?.notificationGroups) {\n    const {\n      accounts = [],\n      notificationGroups = [],\n      statuses = [],\n    } = notifications;\n    return notificationGroups.map((group) => {\n      const { sampleAccountIds, statusId } = group;\n      const sampleAccounts =\n        sampleAccountIds?.map((id) => accounts.find((a) => a.id === id)) || [];\n      const status = statuses?.find((s) => s.id === statusId) || null;\n      return {\n        ...group,\n        sampleAccounts,\n        status,\n      };\n    });\n  }\n  return notifications;\n}\n\nexport function groupNotifications2(groupNotifications) {\n  // Make grouped notifications to look like faux grouped notifications\n  const newGroupNotifications = groupNotifications.map((gn) => {\n    const {\n      latestPageNotificationAt,\n      mostRecentNotificationId,\n      sampleAccounts,\n      notificationsCount,\n    } = gn;\n\n    return {\n      id: '' + mostRecentNotificationId,\n      createdAt: latestPageNotificationAt,\n      account: sampleAccounts[0],\n      ...gn,\n    };\n  });\n\n  // Merge favourited and reblogged of same status into a single notification\n  // - new type: \"favourite+reblog\"\n  // - sum numbers for `notificationsCount` and `sampleAccounts`\n  const notificationsMap = {};\n  const newGroupNotifications1 = [];\n  for (let i = 0; i < newGroupNotifications.length; i++) {\n    const gn = newGroupNotifications[i];\n    const {\n      type,\n      status,\n      createdAt,\n      notificationsCount,\n      sampleAccounts,\n      groupKey,\n    } = gn;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    let virtualType = type;\n    // const sameCount = notificationsCount > 0 && notificationsCount === sampleAccounts?.length;\n    // if (sameCount && (type === 'favourite' || type === 'reblog')) {\n    const sampleCountDiffNotificationsCount =\n      notificationsCount > 0 &&\n      sampleAccounts?.length > 0 &&\n      notificationsCount > sampleAccounts?.length;\n    if (\n      !sampleCountDiffNotificationsCount &&\n      (type === 'favourite' || type === 'reblog')\n    ) {\n      virtualType = 'favourite+reblog';\n    }\n    // const key = `${status?.id}-${virtualType}-${date}-${sameCount ? 1 : 0}`;\n    const key = `${status?.id}-${virtualType}-${date}`;\n    const mappedNotification = notificationsMap[key];\n    if (!groupable(type)) {\n      // Merge mention and quote if same status\n      // NOTES:\n      // - status.id is definitely the same\n      // - account is definitely the same too and will only be one\n      if ((type === 'mention' || type === 'quote') && status?.id) {\n        const otherGN = newGroupNotifications1.find(\n          (o) =>\n            ((type === 'quote' && o.type === 'mention') ||\n              (type === 'mention' && o.type === 'quote')) &&\n            o.status?.id === status.id,\n        );\n        if (otherGN) {\n          otherGN.type = 'mention+quote';\n          continue; // Skip below logic\n        }\n      }\n\n      newGroupNotifications1.push(gn);\n    } else if (mappedNotification) {\n      // Merge sampleAccounts + merge _types\n      sampleAccounts.forEach((a) => {\n        const mappedAccount = mappedNotification.sampleAccounts.find(\n          (ma) => ma.id === a.id,\n        );\n        if (!mappedAccount) {\n          mappedNotification.sampleAccounts.push({\n            ...a,\n            _types: [type],\n          });\n        } else {\n          mappedAccount._types.push(type);\n          mappedAccount._types.sort().reverse();\n        }\n      });\n      // mappedNotification.notificationsCount =\n      //   mappedNotification.sampleAccounts.length;\n      mappedNotification.notificationsCount = Math.min(\n        mappedNotification.notificationsCount,\n        notificationsCount,\n      );\n      mappedNotification._notificationsCount.push(notificationsCount);\n      mappedNotification._sampleAccountsCount.push(sampleAccounts?.length);\n      mappedNotification._accounts = mappedNotification.sampleAccounts;\n      if (groupKey) mappedNotification._groupKeys.push(groupKey);\n    } else {\n      const accounts = sampleAccounts.map((a) => ({\n        ...a,\n        _types: [type],\n      }));\n      notificationsMap[key] = {\n        ...gn,\n        sampleAccounts: accounts,\n        type: virtualType,\n        _accounts: accounts,\n        _groupKeys: groupKey ? [groupKey] : [],\n        _notificationsCount: [notificationsCount],\n        _sampleAccountsCount: [sampleAccounts?.length],\n      };\n      newGroupNotifications1.push(notificationsMap[key]);\n    }\n  }\n\n  // 2nd pass.\n  // - Group 1 account favourte/reblog multiple posts\n  // - _statuses: [status, status, ...]\n  const notificationsMap2 = {};\n  const newGroupNotifications2 = [];\n  for (let i = 0; i < newGroupNotifications1.length; i++) {\n    const gn = newGroupNotifications1[i];\n    const { type, account, _accounts, sampleAccounts, createdAt, groupKey } =\n      gn;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    const hasOneAccount =\n      sampleAccounts?.length === 1 || _accounts?.length === 1;\n    if (\n      (type === 'favourite' ||\n        type === 'reblog' ||\n        type === 'favourite+reblog') &&\n      hasOneAccount\n    ) {\n      const key = `${account?.id}-${type}-${date}`;\n      const mappedNotification = notificationsMap2[key];\n      if (mappedNotification) {\n        mappedNotification._statuses.push(gn.status);\n        mappedNotification._ids += `-${gn.id}`;\n        mappedNotification._groupKeys.push(groupKey);\n      } else {\n        let n = (notificationsMap2[key] = {\n          ...gn,\n          type,\n          _ids: gn.id,\n          _statuses: [gn.status],\n          _groupKeys: groupKey ? [groupKey] : [],\n        });\n        newGroupNotifications2.push(n);\n      }\n    } else {\n      newGroupNotifications2.push(gn);\n    }\n  }\n\n  console.log('newGroupNotifications2', newGroupNotifications2);\n\n  return newGroupNotifications2;\n}\n\nexport default function groupNotifications(notifications) {\n  // Filter out invalid notifications\n  notifications = fixNotifications(notifications);\n\n  // Create new flat list of notifications\n  // Combine sibling notifications based on type and status id\n  // Concat all notification.account into an array of _accounts\n  const notificationsMap = {};\n  const cleanNotifications = [];\n  for (let i = 0, j = 0; i < notifications.length; i++) {\n    const notification = notifications[i];\n    const { id, status, account, type, createdAt } = notification;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    let virtualType = type;\n    if (type === 'favourite' || type === 'reblog') {\n      virtualType = 'favourite+reblog';\n    }\n    const key = `${status?.id}-${virtualType}-${date}`;\n    const mappedNotification = notificationsMap[key];\n    if (!groupable(type)) {\n      cleanNotifications[j++] = notification;\n    } else if (mappedNotification?.account) {\n      const mappedAccount = mappedNotification._accounts.find(\n        (a) => a.id === account.id,\n      );\n      if (mappedAccount) {\n        mappedAccount._types.push(type);\n        mappedAccount._types.sort().reverse();\n        mappedNotification._ids += `-${id}`;\n      } else {\n        account._types = [type];\n        mappedNotification._accounts.push(account);\n        mappedNotification._ids += `-${id}`;\n      }\n    } else {\n      if (account) account._types = [type];\n      let n = (notificationsMap[key] = {\n        ...notification,\n        type: virtualType,\n        _ids: id,\n        _accounts: account ? [account] : [],\n      });\n      cleanNotifications[j++] = n;\n    }\n  }\n\n  // 2nd pass to group \"favourite+reblog\"-type notifications by account if _accounts.length <= 1\n  // This means one acount has favourited and reblogged the multiple statuses\n  // The grouped notification\n  // - type: \"favourite+reblog+account\"\n  // - _statuses: [status, status, ...]\n  const notificationsMap2 = {};\n  const cleanNotifications2 = [];\n  for (let i = 0, j = 0; i < cleanNotifications.length; i++) {\n    const notification = cleanNotifications[i];\n    const { id, account, _accounts, type, createdAt } = notification;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    if (type === 'favourite+reblog' && account && _accounts.length === 1) {\n      const key = `${account?.id}-${type}-${date}`;\n      const mappedNotification = notificationsMap2[key];\n      if (mappedNotification) {\n        mappedNotification._statuses.push(notification.status);\n        mappedNotification._ids += `-${id}`;\n      } else {\n        let n = (notificationsMap2[key] = {\n          ...notification,\n          type,\n          _ids: id,\n          _statuses: [notification.status],\n        });\n        cleanNotifications2[j++] = n;\n      }\n    } else {\n      cleanNotifications2[j++] = notification;\n    }\n  }\n\n  console.log({ notifications, cleanNotifications, cleanNotifications2 });\n\n  // return cleanNotifications;\n  return cleanNotifications2;\n}\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useMemo, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { fixNotifications } from '../utils/group-notifications';\nimport { saveStatus } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst emptySearchParams = new URLSearchParams();\n\nfunction Mentions({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const { masto, instance } = api();\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const [stateType, setStateType] = useState(null);\n  const type = props?.type || searchParams.get('type') || stateType;\n  useTitle(type === 'private' ? t`Private mentions` : t`Mentions`, '/mentions');\n\n  const mentionsIterator = useRef();\n  const latestItem = useRef();\n\n  async function fetchMentions(firstLoad) {\n    if (firstLoad || !mentionsIterator.current) {\n      mentionsIterator.current = masto.v1.notifications\n        .list({\n          limit: LIMIT,\n          types: ['mention'],\n        })\n        .values();\n    }\n    const results = await mentionsIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      value = fixNotifications(value);\n\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n        console.log('First load', latestItem.current);\n      }\n\n      value.forEach(({ status: item }) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value: value?.map((item) => item.status),\n    };\n  }\n\n  const conversationsIterator = useRef();\n  const latestConversationItem = useRef();\n  async function fetchConversations(firstLoad) {\n    if (firstLoad || !conversationsIterator.current) {\n      conversationsIterator.current = masto.v1.conversations\n        .list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await conversationsIterator.current.next();\n    let { value } = results;\n    value = value?.filter((item) => item.lastStatus);\n    if (value?.length) {\n      if (firstLoad) {\n        latestConversationItem.current = value[0].lastStatus.id;\n        console.log('First load', latestConversationItem.current);\n      }\n\n      value.forEach(({ lastStatus: item }) => {\n        saveStatus(item, instance);\n      });\n    }\n    console.log('results', results);\n    return {\n      ...results,\n      value: value?.map((item) => item.lastStatus),\n    };\n  }\n\n  function fetchItems(...args) {\n    if (type === 'private') {\n      return fetchConversations(...args);\n    }\n    return fetchMentions(...args);\n  }\n\n  async function checkForUpdates() {\n    if (type === 'private') {\n      try {\n        const results = await masto.v1.conversations\n          .list({\n            limit: 1,\n            since_id: latestConversationItem.current,\n          })\n          .values()\n          .next();\n        let { value } = results;\n        console.log(\n          'checkForUpdates PRIVATE',\n          latestConversationItem.current,\n          value,\n        );\n        const valueContainsLatestItem =\n          value[0]?.id === latestConversationItem.current; // since_id might not be supported\n        if (value?.length && !valueContainsLatestItem) {\n          latestConversationItem.current = value[0].lastStatus.id;\n          return true;\n        }\n        return false;\n      } catch (e) {\n        return false;\n      }\n    } else {\n      try {\n        const results = await masto.v1.notifications\n          .list({\n            limit: 1,\n            types: ['mention'],\n            since_id: latestItem.current,\n          })\n          .values()\n          .next();\n        let { value } = results;\n        console.log('checkForUpdates ALL', latestItem.current, value);\n        if (value?.length) {\n          latestItem.current = value[0].id;\n          return true;\n        }\n        return false;\n      } catch (e) {\n        return false;\n      }\n    }\n  }\n\n  const TimelineStart = useMemo(() => {\n    return (\n      <div class=\"filter-bar centered\">\n        <Link\n          to=\"/mentions\"\n          class={!type ? 'is-active' : ''}\n          onClick={(e) => {\n            if (columnMode) {\n              e.preventDefault();\n              setStateType(null);\n            }\n          }}\n        >\n          <Trans>All</Trans>\n        </Link>\n        <Link\n          to=\"/mentions?type=private\"\n          class={type === 'private' ? 'is-active' : ''}\n          onClick={(e) => {\n            if (columnMode) {\n              e.preventDefault();\n              setStateType('private');\n            }\n          }}\n        >\n          <Trans>Private</Trans>\n        </Link>\n      </div>\n    );\n  }, [type]);\n\n  return (\n    <Timeline\n      title={t`Mentions`}\n      id=\"mentions\"\n      emptyText={t`No one mentioned you :(`}\n      errorText={t`Unable to load mentions.`}\n      instance={instance}\n      fetchItems={fetchItems}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      timelineStart={TimelineStart}\n      refresh={type}\n      filterContext=\"notifications\"\n    />\n  );\n}\n\nexport default Mentions;\n","import './notifications.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\nimport { subscribeKey } from 'valtio/utils';\n\nimport AccountBlock from '../components/account-block';\nimport FollowRequestButtons from '../components/follow-request-buttons';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport Notification from '../components/notification';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport FilterContext from '../utils/filter-context';\nimport groupNotifications, {\n  groupNotifications2,\n  massageNotifications2,\n} from '../utils/group-notifications';\nimport handleContentLinks from '../utils/handle-content-links';\nimport mem from '../utils/mem';\nimport niceDateTime from '../utils/nice-date-time';\nimport { getRegistration } from '../utils/push-notifications';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport store from '../utils/store';\nimport { getAPIVersions, getCurrentInstance } from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useScroll from '../utils/useScroll';\nimport useTitle from '../utils/useTitle';\n\nconst NOTIFICATIONS_LIMIT = 80;\nconst NOTIFICATIONS_GROUPED_LIMIT = 20;\nconst emptySearchParams = new URLSearchParams();\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'instant',\n};\n\nconst memSupportsGroupedNotifications = mem(\n  () => getAPIVersions()?.mastodon >= 2,\n  {\n    expires: 1000 * 60 * 5, // 5 minutes\n  },\n);\n\nfunction mastoFetchNotificationsIterable(opts = {}) {\n  const { masto } = api();\n  if (memSupportsGroupedNotifications()) {\n    // https://github.com/mastodon/mastodon/pull/29889\n    return masto.v2.notifications.list({\n      limit: NOTIFICATIONS_GROUPED_LIMIT,\n      ...opts,\n    });\n  } else {\n    return masto.v1.notifications.list({\n      limit: NOTIFICATIONS_LIMIT,\n      ...opts,\n    });\n  }\n}\nexport function mastoFetchNotifications(opts = {}) {\n  return mastoFetchNotificationsIterable(opts).values();\n}\n\nexport function getGroupedNotifications(notifications) {\n  if (memSupportsGroupedNotifications()) {\n    return groupNotifications2(notifications);\n  } else {\n    return groupNotifications(notifications);\n  }\n}\n\nconst NOTIFICATIONS_POLICIES = [\n  'forNotFollowing',\n  'forNotFollowers',\n  'forNewAccounts',\n  'forPrivateMentions',\n  'forLimitedAccounts',\n];\nconst NOTIFICATIONS_POLICIES_TEXT = {\n  forNotFollowing: msg`You don't follow`,\n  forNotFollowers: msg`Who don't follow you`,\n  forNewAccounts: msg`With a new account`,\n  forPrivateMentions: msg`Who unsolicitedly private mention you`,\n  forLimitedAccounts: msg`Who are limited by server moderators`,\n};\n\nfunction Notifications({ columnMode }) {\n  const { _, t } = useLingui();\n  useTitle(t`Notifications`, '/notifications');\n  const { masto, instance } = api();\n  const snapStates = useSnapshot(states);\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const notificationID = searchParams.get('id');\n  const notificationAccessToken = searchParams.get('access_token');\n  const [showMore, setShowMore] = useState(false);\n  const [onlyMentions, setOnlyMentions] = useState(false);\n  const scrollableRef = useRef();\n  const { nearReachEnd, scrollDirection, reachStart, nearReachStart } =\n    useScroll({\n      scrollableRef,\n    });\n  const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n  const [followRequests, setFollowRequests] = useState([]);\n  const [announcements, setAnnouncements] = useState([]);\n\n  console.debug('RENDER Notifications');\n\n  const notificationsIterable = useRef();\n  const notificationsIterator = useRef();\n  async function fetchNotifications(firstLoad) {\n    if (firstLoad || !notificationsIterator.current) {\n      // Reset iterator\n      notificationsIterable.current = mastoFetchNotificationsIterable({\n        excludeTypes: ['follow_request'],\n      });\n      notificationsIterator.current = notificationsIterable.current.values();\n    }\n    if (/max_id=($|&)/i.test(notificationsIterator.current?.nextParams)) {\n      // Pixelfed returns next paginationed link with empty max_id\n      // I assume, it's done (end of list)\n      return {\n        done: true,\n      };\n    }\n    const allNotifications = await notificationsIterator.current.next();\n    const notifications = massageNotifications2(allNotifications.value);\n\n    if (notifications?.length) {\n      notifications.forEach((notification) => {\n        saveStatus(notification.status, instance, {\n          skipThreading: true,\n        });\n      });\n\n      // TEST: Slot in a fake notification to test 'severed_relationships'\n      // notifications.unshift({\n      //   id: '123123',\n      //   type: 'severed_relationships',\n      //   createdAt: '2024-03-22T19:20:08.316Z',\n      //   event: {\n      //     type: 'account_suspension',\n      //     targetName: 'mastodon.dev',\n      //     followersCount: 0,\n      //     followingCount: 0,\n      //   },\n      // });\n\n      // TEST: Slot in a fake notification to test 'moderation_warning'\n      // notifications.unshift({\n      //   id: '123123',\n      //   type: 'moderation_warning',\n      //   createdAt: new Date().toISOString(),\n      //   moderation_warning: {\n      //     id: '1231234',\n      //     action: 'mark_statuses_as_sensitive',\n      //   },\n      // });\n\n      // console.log({ notifications });\n\n      const groupedNotifications = getGroupedNotifications(notifications);\n\n      if (firstLoad) {\n        states.notificationsLast = groupedNotifications[0];\n        states.notifications = groupedNotifications;\n\n        // Update last read marker\n        masto.v1.markers\n          .create({\n            notifications: {\n              lastReadId: groupedNotifications[0].id,\n            },\n          })\n          .catch(() => {});\n      } else {\n        states.notifications.push(...groupedNotifications);\n      }\n    }\n\n    states.notificationsShowNew = false;\n    states.notificationsLastFetchTime = Date.now();\n    return allNotifications;\n  }\n\n  async function fetchFollowRequests() {\n    // Note: no pagination here yet because this better be on a separate page. Should be rare use-case???\n    try {\n      return await masto.v1.followRequests.list({\n        limit: 80,\n      });\n    } catch (e) {\n      // Silently fail\n      return [];\n    }\n  }\n\n  const loadFollowRequests = () => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const requests = await fetchFollowRequests();\n        setFollowRequests(requests);\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  };\n\n  async function fetchAnnouncements() {\n    try {\n      return await masto.v1.announcements.list();\n    } catch (e) {\n      // Silently fail\n      return [];\n    }\n  }\n\n  const supportsFilteredNotifications = supports(\n    '@mastodon/filtered-notifications',\n  );\n  const [showNotificationsSettings, setShowNotificationsSettings] =\n    useState(false);\n  const [notificationsPolicy, setNotificationsPolicy] = useState({});\n  function fetchNotificationsPolicy() {\n    return masto.v2.notifications.policy.fetch().catch(() => {});\n  }\n  function loadNotificationsPolicy() {\n    fetchNotificationsPolicy()\n      .then((policy) => {\n        console.log(' Notifications policy', policy);\n        setNotificationsPolicy(policy);\n      })\n      .catch(() => {});\n  }\n  const [notificationsRequests, setNotificationsRequests] = useState(null);\n  function fetchNotificationsRequest() {\n    return masto.v1.notifications.requests.list();\n  }\n\n  const loadNotifications = (firstLoad) => {\n    setShowNew(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        const fetchNotificationsPromise = fetchNotifications(firstLoad);\n\n        if (firstLoad) {\n          fetchAnnouncements()\n            .then((announcements) => {\n              announcements.sort((a, b) => {\n                // Sort by updatedAt first, then createdAt\n                return (\n                  Date.parse(b.updatedAt || b.createdAt) -\n                  Date.parse(a.updatedAt || a.createdAt)\n                );\n              });\n              setAnnouncements(announcements);\n            })\n            .catch(() => {});\n\n          fetchFollowRequests()\n            .then((requests) => {\n              setFollowRequests(requests);\n            })\n            .catch(() => {});\n\n          if (supportsFilteredNotifications) {\n            loadNotificationsPolicy();\n          }\n        }\n\n        const { done } = await fetchNotificationsPromise;\n        setShowMore(!done);\n\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  useEffect(() => {\n    loadNotifications(true);\n  }, []);\n  useEffect(() => {\n    if (reachStart) {\n      loadNotifications(true);\n    }\n  }, [reachStart]);\n\n  // useEffect(() => {\n  //   if (nearReachEnd && showMore) {\n  //     loadNotifications();\n  //   }\n  // }, [nearReachEnd, showMore]);\n\n  const [showNew, setShowNew] = useState(false);\n\n  const loadUpdates = useCallback(\n    ({ disableIdleCheck = false } = {}) => {\n      if (uiState === 'loading') {\n        return;\n      }\n      console.log(' Load updates', {\n        autoRefresh: snapStates.settings.autoRefresh,\n        scrollTop: scrollableRef.current?.scrollTop,\n        inBackground: inBackground(),\n        disableIdleCheck,\n      });\n      if (\n        snapStates.settings.autoRefresh &&\n        scrollableRef.current?.scrollTop < 16 &&\n        (disableIdleCheck || window.__IDLE__) &&\n        !inBackground()\n      ) {\n        loadNotifications(true);\n      }\n    },\n    [snapStates.notificationsShowNew, snapStates.settings.autoRefresh, uiState],\n  );\n  // useEffect(loadUpdates, [snapStates.notificationsShowNew]);\n\n  const lastHiddenTime = useRef();\n  usePageVisibility((visible) => {\n    if (visible) {\n      const timeDiff = Date.now() - lastHiddenTime.current;\n      if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n        // 3 seconds\n        loadUpdates({\n          disableIdleCheck: true,\n        });\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n    }\n  });\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    let unsub = subscribeKey(states, 'notificationsShowNew', (v) => {\n      if (firstLoad.current) {\n        firstLoad.current = false;\n        return;\n      }\n      if (uiState === 'loading') return;\n      if (v) loadUpdates();\n      setShowNew(v);\n    });\n    return () => unsub?.();\n  }, []);\n\n  const todayDate = new Date();\n  const yesterdayDate = new Date(todayDate - 24 * 60 * 60 * 1000);\n  let currentDay = new Date();\n  const showTodayEmpty = !snapStates.notifications.some(\n    (notification) =>\n      new Date(notification.createdAt).toDateString() ===\n      todayDate.toDateString(),\n  );\n\n  const announcementsListRef = useRef();\n\n  useEffect(() => {\n    if (notificationID) {\n      states.routeNotification = {\n        id: notificationID,\n        accessToken: atob(notificationAccessToken),\n      };\n    }\n  }, [notificationID, notificationAccessToken]);\n\n  // useEffect(() => {\n  //   if (uiState === 'default') {\n  //     (async () => {\n  //       try {\n  //         const registration = await getRegistration();\n  //         if (registration?.getNotifications) {\n  //           const notifications = await registration.getNotifications();\n  //           console.log(' Push notifications', notifications);\n  //           // Close all notifications?\n  //           // notifications.forEach((notification) => {\n  //           //   notification.close();\n  //           // });\n  //         }\n  //       } catch (e) {}\n  //     })();\n  //   }\n  // }, [uiState]);\n\n  const [annualReportNotification, setAnnualReportNotification] =\n    useState(null);\n  useEffect(async () => {\n    // Skip this if not in December\n    const date = new Date();\n    if (date.getMonth() !== 11) return;\n    const dateYear = date.getFullYear();\n\n    // Skip if doesn't support annual report\n    if (!supports('@mastodon/annual-report')) return;\n\n    let annualReportNotification = store.account.get(\n      'annualReportNotification',\n    );\n    if (annualReportNotification) {\n      const annualReportYear = annualReportNotification?.annualReport?.year;\n      if (annualReportYear == dateYear) {\n        setAnnualReportNotification(annualReportNotification);\n        return;\n      }\n    }\n    const notificationIterator = mastoFetchNotifications({\n      types: ['annual_report'],\n    });\n    try {\n      const notification = await notificationIterator.next();\n      annualReportNotification = notification?.value?.notificationGroups?.[0];\n      const annualReportYear = annualReportNotification?.annualReport?.year;\n      // If same year, show the annual report\n      if (annualReportYear == dateYear) {\n        console.log(\n          'ANNUAL REPORT',\n          annualReportYear,\n          annualReportNotification,\n        );\n        setAnnualReportNotification(annualReportNotification);\n        store.account.set('annualReportNotification', annualReportNotification);\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  }, []);\n\n  const itemsSelector = '.notification';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const oRef = useHotkeys(\n    ['enter', 'o'],\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const statusLink = activeItem?.querySelector('.status-link');\n      if (statusLink) {\n        statusLink.click();\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const today = new Date();\n  const todaySubHeading = useMemo(() => {\n    return niceDateTime(today, {\n      forceOpts: {\n        weekday: 'long',\n      },\n    });\n  }, [today]);\n\n  return (\n    <div\n      id=\"notifications-page\"\n      class=\"deck-container\"\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n        oRef.current = node;\n      }}\n      tabIndex=\"-1\"\n    >\n      <div class={`timeline-deck deck ${onlyMentions ? 'only-mentions' : ''}`}>\n        <header\n          hidden={hiddenUI}\n          onClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              scrollableRef.current?.scrollTo({ top: 0, behavior: 'smooth' });\n            }\n          }}\n          onDblClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              loadNotifications(true);\n            }\n          }}\n          class={uiState === 'loading' ? 'loading' : ''}\n        >\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Notifications</Trans>\n            </h1>\n            <div class=\"header-side\">\n              {supportsFilteredNotifications && (\n                <button\n                  type=\"button\"\n                  class=\"button plain4\"\n                  onClick={() => {\n                    setShowNotificationsSettings(true);\n                  }}\n                >\n                  <Icon\n                    icon=\"settings\"\n                    size=\"l\"\n                    alt={t`Notifications settings`}\n                  />\n                </button>\n              )}\n            </div>\n          </div>\n          {showNew && uiState !== 'loading' && (\n            <button\n              class=\"updates-button shiny-pill\"\n              type=\"button\"\n              onClick={() => {\n                loadNotifications(true);\n                scrollableRef.current?.scrollTo({\n                  top: 0,\n                  behavior: 'smooth',\n                });\n              }}\n            >\n              <Icon icon=\"arrow-up\" /> <Trans>New notifications</Trans>\n            </button>\n          )}\n        </header>\n        {announcements.length > 0 && (\n          <div class=\"shazam-container\">\n            <div class=\"shazam-container-inner\">\n              <details class=\"announcements\">\n                <summary>\n                  <span>\n                    <Icon icon=\"announce\" class=\"announcement-icon\" size=\"l\" />{' '}\n                    <Plural\n                      value={announcements.length}\n                      one=\"Announcement\"\n                      other=\"Announcements\"\n                    />{' '}\n                    <small class=\"insignificant\">{instance}</small>\n                  </span>\n                  {announcements.length > 1 && (\n                    <span class=\"announcements-nav-buttons\">\n                      {announcements.map((announcement, index) => (\n                        <button\n                          type=\"button\"\n                          class=\"plain2 small\"\n                          onClick={() => {\n                            announcementsListRef.current?.children[\n                              index\n                            ].scrollIntoView({\n                              behavior: 'smooth',\n                              block: 'nearest',\n                            });\n                          }}\n                        >\n                          {index + 1}\n                        </button>\n                      ))}\n                    </span>\n                  )}\n                </summary>\n                <ul\n                  class={`announcements-list-${\n                    announcements.length > 1 ? 'multiple' : 'single'\n                  }`}\n                  ref={announcementsListRef}\n                >\n                  {announcements.map((announcement) => (\n                    <li>\n                      <AnnouncementBlock announcement={announcement} />\n                    </li>\n                  ))}\n                </ul>\n              </details>\n            </div>\n          </div>\n        )}\n        {followRequests.length > 0 && (\n          <div class=\"follow-requests\">\n            <h2 class=\"timeline-header\">\n              <Trans>Follow requests</Trans>\n            </h2>\n            {followRequests.length > 5 ? (\n              <details>\n                <summary>\n                  <Plural\n                    value={followRequests.length}\n                    one=\"# follow request\"\n                    other=\"# follow requests\"\n                  />\n                </summary>\n                <ul>\n                  {followRequests.map((account) => (\n                    <li key={account.id}>\n                      <AccountBlock account={account} />\n                      <FollowRequestButtons\n                        accountID={account.id}\n                        onChange={() => {\n                          // loadFollowRequests();\n                          // loadNotifications(true);\n                        }}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              </details>\n            ) : (\n              <ul>\n                {followRequests.map((account) => (\n                  <li key={account.id}>\n                    <AccountBlock account={account} />\n                    <FollowRequestButtons\n                      accountID={account.id}\n                      onChange={() => {\n                        // loadFollowRequests();\n                        // loadNotifications(true);\n                      }}\n                    />\n                  </li>\n                ))}\n              </ul>\n            )}\n          </div>\n        )}\n        {supportsFilteredNotifications &&\n          notificationsPolicy?.summary?.pendingRequestsCount > 0 && (\n            <div class=\"shazam-container\">\n              <div class=\"shazam-container-inner\">\n                <div class=\"filtered-notifications\">\n                  <details\n                    onToggle={async (e) => {\n                      const { open } = e.target;\n                      if (open) {\n                        const requests = await fetchNotificationsRequest();\n                        setNotificationsRequests(requests);\n                        console.log({ open, requests });\n                      }\n                    }}\n                  >\n                    <summary>\n                      <Plural\n                        value={notificationsPolicy.summary.pendingRequestsCount}\n                        one=\"Filtered notifications from # person\"\n                        other=\"Filtered notifications from # people\"\n                      />\n                    </summary>\n                    {!notificationsRequests ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      notificationsRequests?.length > 0 && (\n                        <ul>\n                          {notificationsRequests.map((request) => (\n                            <li key={request.id}>\n                              <div class=\"request-notifcations\">\n                                {!request.lastStatus?.id && (\n                                  <AccountBlock\n                                    useAvatarStatic\n                                    showStats\n                                    account={request.account}\n                                  />\n                                )}\n                                {request.lastStatus?.id && (\n                                  <div class=\"last-post\">\n                                    <Link\n                                      class=\"status-link\"\n                                      to={`/${instance}/s/${request.lastStatus.id}`}\n                                    >\n                                      <Status\n                                        status={request.lastStatus}\n                                        size=\"s\"\n                                        readOnly\n                                      />\n                                    </Link>\n                                  </div>\n                                )}\n                                <NotificationRequestModalButton\n                                  request={request}\n                                />\n                              </div>\n                              <NotificationRequestButtons\n                                request={request}\n                                onChange={() => {\n                                  loadNotifications(true);\n                                }}\n                              />\n                            </li>\n                          ))}\n                        </ul>\n                      )\n                    )}\n                  </details>\n                </div>\n              </div>\n            </div>\n          )}\n        {annualReportNotification && (\n          <div class=\"shazam-container\">\n            <div class=\"shazam-container-inner\">\n              <Notification notification={annualReportNotification} />\n            </div>\n          </div>\n        )}\n        <div id=\"mentions-option\">\n          <label>\n            <input\n              type=\"checkbox\"\n              checked={onlyMentions}\n              onChange={(e) => {\n                setOnlyMentions(e.target.checked);\n              }}\n            />{' '}\n            <Trans>Only mentions</Trans>\n          </label>\n        </div>\n        <h2 class=\"timeline-header\">\n          <Trans>Today</Trans>{' '}\n          <small class=\"insignificant bidi-isolate\">{todaySubHeading}</small>\n        </h2>\n        {showTodayEmpty && (\n          <p class=\"ui-state insignificant\">\n            {uiState === 'default' ? t`You're all caught up.` : <>&hellip;</>}\n          </p>\n        )}\n        {snapStates.notifications.length ? (\n          <FilterContext.Provider value=\"notifications\">\n            {snapStates.notifications\n              // This is leaked from Notifications popover\n              .filter((n) => n.type !== 'follow_request')\n              .map((notification) => {\n                if (onlyMentions && notification.type !== 'mention') {\n                  return null;\n                }\n                const notificationDay = new Date(notification.createdAt);\n                const differentDay =\n                  notificationDay.toDateString() !== currentDay.toDateString();\n                if (differentDay) {\n                  currentDay = notificationDay;\n                }\n                // if notificationDay is yesterday, show \"Yesterday\"\n                // if notificationDay is before yesterday, show date\n                const heading =\n                  notificationDay.toDateString() ===\n                  yesterdayDate.toDateString()\n                    ? t`Yesterday`\n                    : niceDateTime(currentDay, {\n                        hideTime: true,\n                      });\n                const subHeading = niceDateTime(currentDay, {\n                  forceOpts: {\n                    weekday: 'long',\n                  },\n                });\n                return (\n                  <Fragment key={notification._ids || notification.id}>\n                    {differentDay && (\n                      <h2 class=\"timeline-header\">\n                        <span>{heading}</span>{' '}\n                        <small class=\"insignificant bidi-isolate\">\n                          {subHeading}\n                        </small>\n                      </h2>\n                    )}\n                    <Notification\n                      instance={instance}\n                      notification={notification}\n                      key={notification._ids || notification.id}\n                    />\n                  </Fragment>\n                );\n              })}\n          </FilterContext.Provider>\n        ) : (\n          <>\n            {uiState === 'loading' && (\n              <>\n                <ul class=\"timeline flat\">\n                  {Array.from({ length: 5 }).map((_, i) => (\n                    <li class=\"notification skeleton\">\n                      <div class=\"notification-type\">\n                        <Icon icon=\"notification\" size=\"xl\" />\n                      </div>\n                      <div class=\"notification-content\">\n                        <p> </p>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </>\n            )}\n            {uiState === 'error' && (\n              <p class=\"ui-state\">\n                <Trans>Unable to load notifications</Trans>\n                <br />\n                <br />\n                <button type=\"button\" onClick={() => loadNotifications(true)}>\n                  <Trans>Try again</Trans>\n                </button>\n              </p>\n            )}\n          </>\n        )}\n        {showMore && (\n          <InView\n            onChange={(inView) => {\n              if (inView) {\n                loadNotifications();\n              }\n            }}\n          >\n            <button\n              type=\"button\"\n              class=\"plain block\"\n              disabled={uiState === 'loading'}\n              onClick={() => loadNotifications()}\n              style={{ marginBlockEnd: '6em' }}\n            >\n              {uiState === 'loading' ? (\n                <Loader abrupt />\n              ) : (\n                <Trans>Show more</Trans>\n              )}\n            </button>\n          </InView>\n        )}\n      </div>\n      {supportsFilteredNotifications && showNotificationsSettings && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowNotificationsSettings(false);\n            }\n          }}\n        >\n          <div class=\"sheet\" id=\"notifications-settings\" tabIndex=\"-1\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowNotificationsSettings(false)}\n            >\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <h2>\n                <Trans>Notifications settings</Trans>\n              </h2>\n            </header>\n            <main>\n              <form\n                onSubmit={(e) => {\n                  e.preventDefault();\n                  const {\n                    forNotFollowing,\n                    forNotFollowers,\n                    forNewAccounts,\n                    forPrivateMentions,\n                    forLimitedAccounts,\n                  } = e.target;\n                  const newPolicy = {\n                    ...notificationsPolicy,\n                    forNotFollowing: forNotFollowing.value,\n                    forNotFollowers: forNotFollowers.value,\n                    forNewAccounts: forNewAccounts.value,\n                    forPrivateMentions: forPrivateMentions.value,\n                    forLimitedAccounts: forLimitedAccounts.value,\n                  };\n                  setNotificationsPolicy(newPolicy);\n                  setShowNotificationsSettings(false);\n                  (async () => {\n                    try {\n                      await masto.v2.notifications.policy.update(newPolicy);\n                      showToast(t`Notifications settings updated`);\n                    } catch (e) {\n                      console.error(e);\n                    }\n                  })();\n                }}\n              >\n                <p>\n                  <Trans>Filter out notifications from people:</Trans>\n                </p>\n                <div class=\"notification-policy-fields\">\n                  {NOTIFICATIONS_POLICIES.map((key) => {\n                    const value = notificationsPolicy[key];\n                    return (\n                      <div key={key}>\n                        <label>\n                          {_(NOTIFICATIONS_POLICIES_TEXT[key])}\n                          <select name={key} defaultValue={value} class=\"small\">\n                            <option value=\"accept\">\n                              <Trans>Accept</Trans>\n                            </option>\n                            <option value=\"filter\">\n                              <Trans>Filter</Trans>\n                            </option>\n                            <option value=\"drop\">\n                              <Trans>Ignore</Trans>\n                            </option>\n                          </select>\n                        </label>\n                      </div>\n                    );\n                  })}\n                </div>\n                <p>\n                  <button type=\"submit\">\n                    <Trans>Save</Trans>\n                  </button>\n                </p>\n              </form>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nfunction inBackground() {\n  return !!document.querySelector('.deck-backdrop, #modal-container > *');\n}\n\nfunction AnnouncementBlock({ announcement }) {\n  const { instance } = api();\n  const { contact } = getCurrentInstance();\n  const contactAccount = contact?.account;\n  const {\n    id,\n    content,\n    startsAt,\n    endsAt,\n    published,\n    allDay,\n    publishedAt,\n    updatedAt,\n    read,\n    mentions,\n    statuses,\n    tags,\n    emojis,\n    reactions,\n  } = announcement;\n\n  const publishedAtDate = new Date(publishedAt);\n  const publishedDateText = niceDateTime(publishedAtDate);\n  const updatedAtDate = new Date(updatedAt);\n  const updatedAtText = niceDateTime(updatedAtDate);\n\n  return (\n    <div class=\"announcement-block\">\n      <AccountBlock account={contactAccount} />\n      <div\n        class=\"announcement-content\"\n        onClick={handleContentLinks({ mentions, instance })}\n        dangerouslySetInnerHTML={{\n          __html: enhanceContent(content, {\n            emojis,\n          }),\n        }}\n      />\n      <p class=\"insignificant\">\n        <time datetime={publishedAtDate.toISOString()}>\n          {niceDateTime(publishedAtDate)}\n        </time>\n        {updatedAt && updatedAtText !== publishedDateText && (\n          <>\n            {' '}\n            &bull;{' '}\n            <span class=\"ib\">\n              <Trans>\n                Updated{' '}\n                <time datetime={updatedAtDate.toISOString()}>\n                  {niceDateTime(updatedAtDate)}\n                </time>\n              </Trans>\n            </span>\n          </>\n        )}\n      </p>\n      <div class=\"announcement-reactions\" hidden>\n        {reactions.map((reaction) => {\n          const { name, count, me, staticUrl, url } = reaction;\n          return (\n            <button type=\"button\" class={`plain4 small ${me ? 'reacted' : ''}`}>\n              {url || staticUrl ? (\n                <img src={url || staticUrl} alt={name} width=\"16\" height=\"16\" />\n              ) : (\n                <span>{name}</span>\n              )}{' '}\n              <span class=\"count\">{shortenNumber(count)}</span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nfunction fetchNotficationsByAccount(accountID) {\n  const { masto } = api();\n  return masto.v1.notifications.list({\n    accountID,\n  });\n}\nfunction NotificationRequestModalButton({ request }) {\n  const { instance } = api();\n  const [uiState, setUIState] = useState('loading');\n  const { account, lastStatus } = request;\n  const [showModal, setShowModal] = useState(false);\n  const [notifications, setNotifications] = useState([]);\n\n  function onClose() {\n    setShowModal(false);\n  }\n\n  useEffect(() => {\n    if (!request?.account?.id) return;\n    if (!showModal) return;\n    setUIState('loading');\n    (async () => {\n      const notifs = await fetchNotficationsByAccount(request.account.id);\n      setNotifications(notifs || []);\n      setUIState('default');\n    })();\n  }, [showModal, request?.account?.id]);\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        class=\"plain4 request-notifications-account\"\n        onClick={() => {\n          setShowModal(true);\n        }}\n      >\n        <Icon icon=\"notification\" class=\"more-insignificant\" />{' '}\n        <small>\n          <Trans>\n            View notifications from{' '}\n            <span class=\"bidi-isolate\">@{account.username}</span>\n          </Trans>\n        </small>{' '}\n        <Icon icon=\"chevron-down\" />\n      </button>\n      {showModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              onClose();\n            }\n          }}\n        >\n          <div class=\"sheet\" tabIndex=\"-1\">\n            <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <b>\n                <Trans>\n                  Notifications from{' '}\n                  <span class=\"bidi-isolate\">@{account.username}</span>\n                </Trans>\n              </b>\n            </header>\n            <main>\n              {uiState === 'loading' ? (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              ) : (\n                notifications.map((notification) => (\n                  <div\n                    class=\"notification-peek\"\n                    onClick={(e) => {\n                      const { target } = e;\n                      // If button or links\n                      if (\n                        e.target.tagName === 'BUTTON' ||\n                        e.target.tagName === 'A'\n                      ) {\n                        onClose();\n                      }\n                    }}\n                  >\n                    <Notification\n                      instance={instance}\n                      notification={notification}\n                      isStatic\n                    />\n                  </div>\n                ))\n              )}\n            </main>\n          </div>\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction NotificationRequestButtons({ request, onChange }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [requestState, setRequestState] = useState(null); // accept, dismiss\n  const hasRequestState = requestState !== null;\n\n  return (\n    <p class=\"notification-request-buttons\">\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRequestState}\n        onClick={() => {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.notifications.requests\n                .$select(request.id)\n                .accept();\n              setRequestState('accept');\n              setUIState('default');\n              onChange({\n                request,\n                state: 'accept',\n              });\n              showToast(\n                t`Notifications from @${request.account.username} will not be filtered from now on.`,\n              );\n            } catch (error) {\n              setUIState('error');\n              console.error(error);\n              showToast(t`Unable to accept notification request`);\n            }\n          })();\n        }}\n      >\n        <Trans>Allow</Trans>\n      </button>{' '}\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRequestState}\n        class=\"light danger\"\n        onClick={() => {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.notifications.requests\n                .$select(request.id)\n                .dismiss();\n              setRequestState('dismiss');\n              setUIState('default');\n              onChange({\n                request,\n                state: 'dismiss',\n              });\n              showToast(\n                t`Notifications from @${request.account.username} will not show up in Filtered notifications from now on.`,\n              );\n            } catch (error) {\n              setUIState('error');\n              console.error(error);\n              showToast(t`Unable to dismiss notification request`);\n            }\n          })();\n        }}\n      >\n        <Trans>Dismiss</Trans>\n      </button>\n      <span class=\"notification-request-states\">\n        {uiState === 'loading' ? (\n          <Loader abrupt />\n        ) : requestState === 'accept' ? (\n          <Icon\n            icon=\"check-circle\"\n            alt={t`Accepted`}\n            class=\"notification-accepted\"\n          />\n        ) : (\n          requestState === 'dismiss' && (\n            <Icon\n              icon=\"x-circle\"\n              alt={t`Dismissed`}\n              class=\"notification-dismissed\"\n            />\n          )\n        )}\n      </span>\n    </p>\n  );\n}\n\nexport default memo(Notifications);\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useRef } from 'preact/hooks';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Menu2 from '../components/menu2';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport states, { saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Public({ local, columnMode, ...props }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const isLocal = !!local;\n  const params = columnMode ? {} : useParams();\n  const { masto, instance } = api({\n    instance: props?.instance || params.instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const title = isLocal\n    ? t`Local timeline (${instance})`\n    : t`Federated timeline (${instance})`;\n  useTitle(title, isLocal ? `/:instance?/p/l` : `/:instance?/p`);\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n\n  const publicIterator = useRef();\n  async function fetchPublic(firstLoad) {\n    if (firstLoad || !publicIterator.current) {\n      const opts = {\n        limit: LIMIT,\n        local: isLocal || undefined,\n      };\n      if (!isLocal && supports('@pixelfed/global-feed')) {\n        opts.remote = true;\n      }\n      publicIterator.current = masto.v1.timelines.public.list(opts).values();\n    }\n    const results = await publicIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.public\n        .list({\n          limit: 1,\n          local: isLocal,\n          since_id: latestItem.current,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'public');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return (\n    <Timeline\n      key={instance + isLocal}\n      title={title}\n      titleComponent={\n        <h1 class=\"header-double-lines\">\n          <b>{isLocal ? t`Local timeline` : t`Federated timeline`}</b>\n          <div>{instance}</div>\n        </h1>\n      }\n      id=\"public\"\n      instance={instance}\n      emptyText={t`No one has posted anything yet.`}\n      errorText={t`Unable to load posts`}\n      fetchItems={fetchPublic}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      headerStart={<></>}\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      // allowFilters\n      filterContext=\"public\"\n      headerEnd={\n        <Menu2\n          portal\n          // setDownOverflow\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          position=\"anchor\"\n          menuButton={\n            <button type=\"button\" class=\"plain\">\n              <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n            </button>\n          }\n        >\n          <MenuItem href={isLocal ? `/#/${instance}/p` : `/#/${instance}/p/l`}>\n            {isLocal ? (\n              <>\n                <Icon icon=\"transfer\" />{' '}\n                <span>\n                  <Trans>Switch to Federated</Trans>\n                </span>\n              </>\n            ) : (\n              <>\n                <Icon icon=\"transfer\" />{' '}\n                <span>\n                  <Trans>Switch to Local</Trans>\n                </span>\n              </>\n            )}\n          </MenuItem>\n          <MenuDivider />\n          <MenuItem\n            onClick={() => {\n              let newInstance = prompt(\n                t`Enter a new instance e.g. \"mastodon.social\"`,\n              );\n              if (!/\\./.test(newInstance)) {\n                if (newInstance) alert(t`Invalid instance`);\n                return;\n              }\n              if (newInstance) {\n                newInstance = newInstance.toLowerCase().trim();\n                // navigate(isLocal ? `/${newInstance}/p/l` : `/${newInstance}/p`);\n                location.hash = isLocal\n                  ? `/${newInstance}/p/l`\n                  : `/${newInstance}/p`;\n              }\n            }}\n          >\n            <Icon icon=\"bus\" />{' '}\n            <span>\n              <Trans>Go to another instance</Trans>\n            </span>\n          </MenuItem>\n          {currentInstance !== instance && (\n            <MenuItem\n              onClick={() => {\n                location.hash = isLocal\n                  ? `/${currentInstance}/p/l`\n                  : `/${currentInstance}/p`;\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Go to my instance (<b>{currentInstance}</b>)\n                </Trans>\n              </small>\n            </MenuItem>\n          )}\n        </Menu2>\n      }\n    />\n  );\n}\n\nexport default Public;\n","import { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useReducer } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport {\n  addToSearchHistory,\n  clearAllSearchHistory,\n  getSearchHistory,\n  removeFromSearchHistory,\n} from '../utils/search-history';\nimport showToast from '../utils/show-toast';\n\nimport Icon from './icon';\nimport Link from './link';\nimport { generateSearchItemData } from './search-form';\n\nexport default function RecentSearches({ onItemClick }) {\n  const { t } = useLingui();\n  const { instance } = api();\n  const [, reload] = useReducer((c) => c + 1, 0);\n  const history = getSearchHistory();\n\n  const handleClearAll = () => {\n    clearAllSearchHistory();\n    showToast({\n      text: t`Cleared recent searches`,\n      delay: 1000,\n    });\n    reload();\n  };\n\n  const handleRemoveItem = (query, queryType) => {\n    removeFromSearchHistory(query, queryType);\n    reload();\n  };\n\n  const [listRef] = useAutoAnimate();\n\n  if (history.length === 0) {\n    return null;\n  }\n\n  return (\n    <div class=\"recent-searches\">\n      <div class=\"recent-searches-header\">\n        <Icon icon=\"history\" />{' '}\n        <span>\n          <Trans>Recent searches</Trans>\n        </span>\n        <span class=\"spacer\" />\n        <button\n          type=\"button\"\n          class=\"plain4 small\"\n          onClick={handleClearAll}\n          disabled={history.length <= 0}\n        >\n          <span>\n            <Trans>Clear all</Trans>\n          </span>\n        </button>\n      </div>\n      <ul class=\"link-list recent-searches-list\" ref={listRef}>\n        {history.map((historyItem) => {\n          const { label, to, icon } = generateSearchItemData(\n            historyItem.query,\n            historyItem.queryType,\n            instance,\n          );\n\n          return (\n            <li\n              key={`${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`}\n              class=\"recent-searches-item\"\n            >\n              <Link\n                to={to}\n                class=\"recent-searches-link\"\n                onClick={(e) => {\n                  addToSearchHistory(historyItem.query, historyItem.queryType);\n                  onItemClick?.(e);\n                }}\n              >\n                <Icon icon={icon} class=\"more-insignificant\" />\n                <span class=\"recent-searches-label\">{label}</span>\n              </Link>\n              <button\n                type=\"button\"\n                class=\"plain4 small\"\n                onClick={() =>\n                  handleRemoveItem(historyItem.query, historyItem.queryType)\n                }\n              >\n                <Icon icon=\"trash\" alt={t`Clear`} />\n              </button>\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n","import './search.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useLayoutEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useParams, useSearchParams } from 'react-router-dom';\n\nimport AccountBlock from '../components/account-block';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport NavMenu from '../components/nav-menu';\nimport RecentSearches from '../components/recent-searches';\nimport SearchForm from '../components/search-form';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport shortenNumber from '../utils/shorten-number';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useTitle from '../utils/useTitle';\n\nconst SHORT_LIMIT = 5;\nconst LIMIT = 40;\nconst emptySearchParams = new URLSearchParams();\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'instant',\n};\n\nfunction Search({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const params = columnMode ? {} : useParams();\n  const { masto, instance, authenticated } = api({\n    instance: params.instance,\n  });\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const searchFormRef = useRef();\n  const q = props?.query || searchParams.get('q');\n  const type = columnMode\n    ? 'statuses'\n    : props?.type || searchParams.get('type');\n  let title = t`Search`;\n  if (q) {\n    switch (type) {\n      case 'statuses':\n        title = t`Search: ${q} (Posts)`;\n        break;\n      case 'accounts':\n        title = t`Search: ${q} (Accounts)`;\n        break;\n      case 'hashtags':\n        title = t`Search: ${q} (Hashtags)`;\n        break;\n      default:\n        title = t`Search: ${q}`;\n    }\n  }\n  useTitle(title, `/search`);\n\n  const [showMore, setShowMore] = useState(false);\n  const offsetRef = useRef(0);\n  useEffect(() => {\n    offsetRef.current = 0;\n  }, [q, type]);\n\n  const scrollableRef = useRef();\n  useLayoutEffect(() => {\n    scrollableRef.current?.scrollTo?.(0, 0);\n  }, [q, type]);\n\n  const [statusResults, setStatusResults] = useState([]);\n  const [accountResults, setAccountResults] = useState([]);\n  const [hashtagResults, setHashtagResults] = useState([]);\n  useEffect(() => {\n    setStatusResults([]);\n    setAccountResults([]);\n    setHashtagResults([]);\n  }, [q]);\n  const typeResults = {\n    statuses: statusResults,\n    accounts: accountResults,\n    hashtags: hashtagResults,\n  };\n  const setTypeResultsFunc = {\n    statuses: setStatusResults,\n    accounts: setAccountResults,\n    hashtags: setHashtagResults,\n  };\n\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n  const loadRelationships = async (accounts) => {\n    if (!accounts?.length) return;\n    const relationships = await fetchRelationships(accounts, relationshipsMap);\n    if (relationships) {\n      setRelationshipsMap({\n        ...relationshipsMap,\n        ...relationships,\n      });\n    }\n  };\n\n  function loadResults(firstLoad) {\n    if (firstLoad) {\n      offsetRef.current = 0;\n    }\n\n    if (!firstLoad && !authenticated) {\n      // Search results pagination is only available to authenticated users\n      return;\n    }\n\n    setUIState('loading');\n    if (firstLoad && !type) {\n      setStatusResults(statusResults.slice(0, SHORT_LIMIT));\n      setAccountResults(accountResults.slice(0, SHORT_LIMIT));\n      setHashtagResults(hashtagResults.slice(0, SHORT_LIMIT));\n    }\n\n    (async () => {\n      const params = {\n        q,\n        resolve: authenticated,\n        limit: SHORT_LIMIT,\n      };\n      if (type) {\n        params.limit = LIMIT;\n        params.type = type;\n        if (authenticated) params.offset = offsetRef.current;\n      }\n\n      try {\n        const results = await masto.v2.search.list(params);\n        console.log(results);\n        if (type) {\n          if (firstLoad) {\n            setTypeResultsFunc[type](results[type]);\n            const length = results[type]?.length;\n            offsetRef.current = LIMIT;\n            setShowMore(!!length);\n          } else {\n            // If first item is the same, it means API doesn't support offset\n            // I know this is a very basic check, but it works for now\n            if (results[type]?.[0]?.id === typeResults[type]?.[0]?.id) {\n              setShowMore(false);\n            } else {\n              setTypeResultsFunc[type]((prev) => [...prev, ...results[type]]);\n              const length = results[type]?.length;\n              offsetRef.current = offsetRef.current + LIMIT;\n              setShowMore(!!length);\n            }\n          }\n        } else {\n          setStatusResults(results.statuses || []);\n          setAccountResults(results.accounts || []);\n          setHashtagResults(results.hashtags || []);\n          offsetRef.current = 0;\n          setShowMore(false);\n        }\n        loadRelationships(results.accounts);\n\n        setUIState('default');\n      } catch (err) {\n        console.error(err);\n        setUIState('error');\n      }\n    })();\n  }\n\n  const lastHiddenTime = useRef();\n  usePageVisibility((visible) => {\n    const reachStart = scrollableRef.current?.scrollTop === 0;\n    if (visible && reachStart) {\n      const timeDiff = Date.now() - lastHiddenTime.current;\n      if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n        // 3 seconds\n        loadResults(true);\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n    }\n  });\n\n  useEffect(() => {\n    let timer;\n    searchFormRef.current?.setValue?.(q || '');\n    if (q) {\n      loadResults(true);\n    } else {\n      timer = setTimeout(() => {\n        searchFormRef.current?.focus?.();\n      }, 150); // Right after focusDeck runs\n    }\n    return () => clearTimeout(timer);\n  }, [q, type, instance]);\n\n  useHotkeys(\n    ['Slash', '/'],\n    (e) => {\n      searchFormRef.current?.focus?.();\n      searchFormRef.current?.select?.();\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const itemsSelector = '.timeline > li > a, .hashtag-list > li > a';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [filterBarParent] = useAutoAnimate();\n\n  return (\n    <div\n      id=\"search-page\"\n      class=\"deck-container\"\n      tabIndex=\"-1\"\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n      }}\n    >\n      <div class=\"timeline-deck deck\">\n        <header class={uiState === 'loading' ? 'loading' : ''}>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n            </div>\n            <SearchForm ref={searchFormRef} />\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => {\n                  loadResults(true);\n                }}\n                disabled={uiState === 'loading'}\n              >\n                <Icon icon=\"search\" size=\"l\" alt={t`Search`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {!!q && !columnMode && (\n            <div\n              ref={filterBarParent}\n              class={`filter-bar ${uiState === 'loading' ? 'loading' : ''}`}\n            >\n              {!!type && (\n                <Link to={`/search${q ? `?q=${encodeURIComponent(q)}` : ''}`}>\n                  <Icon icon=\"chevron-left\" /> <Trans>All</Trans>\n                </Link>\n              )}\n              {[\n                {\n                  label: t`Accounts`,\n                  type: 'accounts',\n                  to: `/search?q=${encodeURIComponent(q)}&type=accounts`,\n                },\n                {\n                  label: t`Hashtags`,\n                  type: 'hashtags',\n                  to: `/search?q=${encodeURIComponent(q)}&type=hashtags`,\n                },\n                {\n                  label: t`Posts`,\n                  type: 'statuses',\n                  to: `/search?q=${encodeURIComponent(q)}&type=statuses`,\n                },\n              ]\n                .sort((a, b) => {\n                  if (a.type === type) return -1;\n                  if (b.type === type) return 1;\n                  return 0;\n                })\n                .map((link) => (\n                  <Link to={link.to} key={link.type}>\n                    {link.label}\n                  </Link>\n                ))}\n            </div>\n          )}\n          {!!q ? (\n            <>\n              {(!type || type === 'accounts') && (\n                <>\n                  {type !== 'accounts' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Accounts</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=accounts`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {accountResults.length > 0 ? (\n                    <>\n                      <ul class=\"timeline flat accounts-list\">\n                        {accountResults.map((account) => (\n                          <li key={account.id}>\n                            <AccountBlock\n                              account={account}\n                              instance={instance}\n                              showStats\n                              relationship={relationshipsMap[account.id]}\n                            />\n                          </li>\n                        ))}\n                      </ul>\n                      {type !== 'accounts' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=accounts`}\n                          >\n                            <Trans>See more accounts</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No accounts found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {(!type || type === 'hashtags') && (\n                <>\n                  {type !== 'hashtags' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Hashtags</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=hashtags`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {hashtagResults.length > 0 ? (\n                    <>\n                      <ul class=\"link-list hashtag-list\">\n                        {hashtagResults.map((hashtag) => {\n                          const { name, history } = hashtag;\n                          const total = history?.reduce?.(\n                            (acc, cur) => acc + +cur.uses,\n                            0,\n                          );\n                          return (\n                            <li key={`${name}-${total}`}>\n                              <Link\n                                to={\n                                  instance\n                                    ? `/${instance}/t/${name}`\n                                    : `/t/${name}`\n                                }\n                              >\n                                <Icon icon=\"hashtag\" alt=\"#\" />\n                                <span>{name}</span>\n                                {!!total && (\n                                  <span class=\"count\">\n                                    {shortenNumber(total)}\n                                  </span>\n                                )}\n                              </Link>\n                            </li>\n                          );\n                        })}\n                      </ul>\n                      {type !== 'hashtags' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=hashtags`}\n                          >\n                            <Trans>See more hashtags</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No hashtags found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {(!type || type === 'statuses') && (\n                <>\n                  {type !== 'statuses' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Posts</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=statuses`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {statusResults.length > 0 ? (\n                    <>\n                      <ul class=\"timeline\">\n                        {statusResults.map((status) => (\n                          <li key={status.id}>\n                            <Link\n                              class=\"status-link\"\n                              to={\n                                instance\n                                  ? `/${instance}/s/${status.id}`\n                                  : `/s/${status.id}`\n                              }\n                            >\n                              <Status status={status} />\n                            </Link>\n                          </li>\n                        ))}\n                      </ul>\n                      {type !== 'statuses' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=statuses`}\n                          >\n                            <Trans>See more posts</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No posts found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {!!type &&\n                (uiState === 'default' ? (\n                  showMore ? (\n                    <InView\n                      onChange={(inView) => {\n                        if (inView) {\n                          loadResults();\n                        }\n                      }}\n                    >\n                      <button\n                        type=\"button\"\n                        class=\"plain block\"\n                        onClick={() => loadResults()}\n                        style={{ marginBlockEnd: '6em' }}\n                      >\n                        <Trans>Show more</Trans>\n                      </button>\n                    </InView>\n                  ) : (\n                    <p class=\"ui-state insignificant\">\n                      <Trans>The end.</Trans>\n                    </p>\n                  )\n                ) : (\n                  uiState === 'loading' && (\n                    <p class=\"ui-state\">\n                      <Loader abrupt />\n                    </p>\n                  )\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : (\n            <>\n              <p class=\"ui-state insignificant\">\n                <Trans>\n                  Enter your search term or paste a URL above to get started.\n                </Trans>\n              </p>\n              <RecentSearches />\n            </>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default Search;\n","import '../components/links-bar.css';\nimport './trending.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { oklab2rgb, rgb2oklab } from '../utils/color-utils';\nimport { filteredItems } from '../utils/filters';\nimport getDomain from '../utils/get-domain';\nimport pmem from '../utils/pmem';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst TREND_CACHE_TIME = 10 * 60 * 1000; // 10 minutes\n\nconst fetchLinks = pmem(\n  (masto) => {\n    return masto.v1.trends.links.list().values().next();\n  },\n  {\n    expires: TREND_CACHE_TIME,\n  },\n);\n\nconst fetchHashtags = pmem(\n  (masto) => {\n    return masto.v1.trends.tags.list().values().next();\n  },\n  {\n    expires: TREND_CACHE_TIME,\n  },\n);\n\nfunction fetchTrendsStatuses(masto) {\n  if (supports('@pixelfed/trending')) {\n    return masto.pixelfed.v2.discover.posts.trending\n      .list({\n        range: 'daily',\n      })\n      .values();\n  }\n  return masto.v1.trends.statuses\n    .list({\n      limit: LIMIT,\n    })\n    .values();\n}\n\nfunction fetchLinkList(masto, params) {\n  return masto.v1.timelines.link.list(params).values();\n}\n\nfunction Trending({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const params = columnMode ? {} : useParams();\n  const { masto, instance } = api({\n    instance: props?.instance || params.instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const title = t`Trending (${instance})`;\n  useTitle(title, `/:instance?/trending`);\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n\n  const sameCurrentInstance = instance === currentInstance;\n\n  const [hashtags, setHashtags] = useState([]);\n  const [links, setLinks] = useState([]);\n  const trendIterator = useRef();\n\n  async function fetchTrends(firstLoad) {\n    console.log('fetchTrend', firstLoad);\n    if (firstLoad || !trendIterator.current) {\n      trendIterator.current = fetchTrendsStatuses(masto);\n\n      // Get hashtags\n      if (supports('@mastodon/trending-hashtags')) {\n        try {\n          // const iterator = masto.v1.trends.tags.list();\n          const { value: tags } = await fetchHashtags(masto);\n          console.log('tags', tags);\n          if (tags?.length) {\n            setHashtags(tags);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n\n      // Get links\n      if (supports('@mastodon/trending-links')) {\n        try {\n          const { value } = await fetchLinks(masto, instance);\n          // 4 types available: link, photo, video, rich\n          // Only want links for now\n          const links = value?.filter?.((link) => link.type === 'link');\n          console.log('links', links);\n          if (links?.length) {\n            setLinks(links);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    }\n    const results = await trendIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public'); // Might not work here\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  // Link mentions\n  // https://github.com/mastodon/mastodon/pull/30381\n  const [currentLinkMentionsLoading, setCurrentLinkMentionsLoading] =\n    useState(false);\n  const currentLinkMentionsIterator = useRef();\n  const [currentLink, setCurrentLink] = useState(null);\n  const hasCurrentLink = !!currentLink;\n  const currentLinkRef = useRef();\n  const supportsTrendingLinkPosts =\n    sameCurrentInstance && supports('@mastodon/trending-link-posts');\n\n  useEffect(() => {\n    if (currentLink && currentLinkRef.current) {\n      currentLinkRef.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest',\n        inline: 'center',\n      });\n    }\n  }, [currentLink]);\n\n  const prevCurrentLink = useRef();\n  async function fetchLinkMentions(firstLoad) {\n    if (firstLoad || !currentLinkMentionsIterator.current) {\n      setCurrentLinkMentionsLoading(true);\n      currentLinkMentionsIterator.current = fetchLinkList(masto, {\n        url: currentLink,\n      });\n    }\n    prevCurrentLink.current = currentLink;\n    const results = await currentLinkMentionsIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    if (prevCurrentLink.current === currentLink) {\n      setCurrentLinkMentionsLoading(false);\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.trends.statuses\n        .list({\n          limit: 1,\n          // NOT SUPPORTED\n          // since_id: latestItem.current,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      value = filteredItems(value, 'public');\n      if (value?.length && value[0].id !== latestItem.current) {\n        latestItem.current = value[0].id;\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const TimelineStart = useMemo(() => {\n    return (\n      <>\n        {!!hashtags.length && (\n          <div class=\"filter-bar expandable\">\n            <Icon icon=\"chart\" class=\"insignificant\" size=\"l\" />\n            {hashtags.map((tag, i) => {\n              const { name, history } = tag;\n              const total = history.reduce((acc, cur) => acc + +cur.uses, 0);\n              return (\n                <Link to={`/${instance}/t/${name}`} key={name}>\n                  <span dir=\"auto\">\n                    <span class=\"more-insignificant\">#</span>\n                    {name}\n                  </span>\n                  <span class=\"filter-count\">{shortenNumber(total)}</span>\n                </Link>\n              );\n            })}\n          </div>\n        )}\n        {!!links.length && (\n          <div class=\"links-bar\">\n            <header>\n              <h3>\n                <Trans>Trending News</Trans>\n              </h3>\n            </header>\n            {links.map((link) => {\n              const {\n                authors,\n                authorName,\n                authorUrl,\n                blurhash,\n                description,\n                height,\n                image,\n                imageDescription,\n                language,\n                providerName,\n                providerUrl,\n                publishedAt,\n                title,\n                url,\n                width,\n              } = link;\n              const author = authors?.[0]?.account?.id\n                ? authors[0].account\n                : null;\n              const isShortTitle = title.length < 30;\n              const hasAuthor = !!(authorName || author);\n              const domain = getDomain(url);\n              let accentColor;\n              if (blurhash) {\n                const averageColor = getBlurHashAverageColor(blurhash);\n                const labAverageColor = rgb2oklab(averageColor);\n                accentColor = oklab2rgb([\n                  0.6,\n                  labAverageColor[1],\n                  labAverageColor[2],\n                ]);\n              }\n\n              return (\n                <div key={url}>\n                  <a\n                    ref={currentLink === url ? currentLinkRef : null}\n                    href={url}\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                    class={`link-block ${\n                      hasCurrentLink\n                        ? currentLink === url\n                          ? 'active'\n                          : 'inactive'\n                        : ''\n                    }`}\n                    style={\n                      accentColor\n                        ? {\n                            '--accent-color': `rgb(${accentColor.join(',')})`,\n                            '--accent-alpha-color': `rgba(${accentColor.join(\n                              ',',\n                            )}, 0.4)`,\n                          }\n                        : {}\n                    }\n                  >\n                    <article>\n                      <figure>\n                        <img\n                          src={image}\n                          alt={imageDescription}\n                          width={width}\n                          height={height}\n                          loading=\"lazy\"\n                        />\n                      </figure>\n                      <div class=\"article-body\">\n                        <header>\n                          <div class=\"article-meta\">\n                            <span class=\"domain\">{domain}</span>{' '}\n                            {!!publishedAt && <>&middot; </>}\n                            {!!publishedAt && (\n                              <>\n                                <RelativeTime\n                                  datetime={publishedAt}\n                                  format=\"micro\"\n                                />\n                              </>\n                            )}\n                          </div>\n                          {!!title && (\n                            <h1\n                              class=\"title\"\n                              lang={language}\n                              dir=\"auto\"\n                              title={title}\n                            >\n                              {title}\n                            </h1>\n                          )}\n                        </header>\n                        {!!description && (\n                          <p\n                            class={`description ${\n                              hasAuthor && !isShortTitle ? '' : 'more-lines'\n                            }`}\n                            lang={language}\n                            dir=\"auto\"\n                            title={description}\n                          >\n                            {description}\n                          </p>\n                        )}\n                        {hasAuthor && (\n                          <>\n                            <hr />\n                            <p class=\"byline\">\n                              <small>\n                                <Trans comment=\"By [Author]\">\n                                  By{' '}\n                                  {author ? (\n                                    <NameText account={author} showAvatar />\n                                  ) : authorUrl ? (\n                                    <a\n                                      href={authorUrl}\n                                      target=\"_blank\"\n                                      rel=\"noopener\"\n                                    >\n                                      {authorName}\n                                    </a>\n                                  ) : (\n                                    authorName\n                                  )}\n                                </Trans>\n                              </small>\n                            </p>\n                          </>\n                        )}\n                      </div>\n                    </article>\n                  </a>\n                  {supportsTrendingLinkPosts && (\n                    <button\n                      type=\"button\"\n                      class=\"small plain4 block\"\n                      onClick={() => {\n                        setCurrentLink(url);\n                      }}\n                      disabled={url === currentLink}\n                    >\n                      <Icon icon=\"comment2\" />{' '}\n                      <span>\n                        <Trans>Mentions</Trans>\n                      </span>{' '}\n                      <Icon icon=\"chevron-down\" />\n                    </button>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n        {supportsTrendingLinkPosts && !!links.length && (\n          <div\n            class={`timeline-header-block ${hasCurrentLink ? 'blended' : ''}`}\n          >\n            {hasCurrentLink ? (\n              <>\n                <div style={{ width: 50, flexShrink: 0, textAlign: 'center' }}>\n                  {currentLinkMentionsLoading ? (\n                    <Loader abrupt />\n                  ) : (\n                    <button\n                      type=\"button\"\n                      class=\"light\"\n                      onClick={() => {\n                        setCurrentLink(null);\n                      }}\n                    >\n                      <Icon icon=\"x\" alt={t`Back to showing trending posts`} />\n                    </button>\n                  )}\n                </div>\n                <p>\n                  <Trans>\n                    Showing posts mentioning{' '}\n                    <span class=\"link-text\">\n                      {currentLink\n                        .replace(/^https?:\\/\\/(www\\.)?/i, '')\n                        .replace(/\\/$/, '')}\n                    </span>\n                  </Trans>\n                </p>\n              </>\n            ) : (\n              <p class=\"insignificant\">\n                <Trans>Trending posts</Trans>\n              </p>\n            )}\n          </div>\n        )}\n      </>\n    );\n  }, [hashtags, links, currentLink, currentLinkMentionsLoading]);\n\n  return (\n    <Timeline\n      key={instance}\n      title={title}\n      titleComponent={\n        <h1 class=\"header-double-lines\">\n          <b>\n            <Trans>Trending</Trans>\n          </b>\n          <div>{instance}</div>\n        </h1>\n      }\n      id=\"trending\"\n      instance={instance}\n      emptyText={t`No trending posts.`}\n      errorText={t`Unable to load posts`}\n      fetchItems={hasCurrentLink ? fetchLinkMentions : fetchTrends}\n      checkForUpdates={hasCurrentLink ? undefined : checkForUpdates}\n      checkForUpdatesInterval={5 * 60 * 1000} // 5 minutes\n      useItemID\n      headerStart={<></>}\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      // allowFilters\n      filterContext=\"public\"\n      timelineStart={TimelineStart}\n      refresh={currentLink}\n      clearWhenRefresh\n      view={hasCurrentLink ? 'link-mentions' : undefined}\n      headerEnd={\n        <Menu2\n          portal\n          // setDownOverflow\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          position=\"anchor\"\n          menuButton={\n            <button type=\"button\" class=\"plain\">\n              <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n            </button>\n          }\n        >\n          <MenuItem\n            onClick={() => {\n              let newInstance = prompt(\n                t`Enter a new instance e.g. \"mastodon.social\"`,\n              );\n              if (!/\\./.test(newInstance)) {\n                if (newInstance) alert(t`Invalid instance`);\n                return;\n              }\n              if (newInstance) {\n                newInstance = newInstance.toLowerCase().trim();\n                // navigate(`/${newInstance}/trending`);\n                location.hash = `/${newInstance}/trending`;\n              }\n            }}\n          >\n            <Icon icon=\"bus\" />{' '}\n            <span>\n              <Trans>Go to another instance</Trans>\n            </span>\n          </MenuItem>\n          {currentInstance !== instance && (\n            <MenuItem\n              onClick={() => {\n                location.hash = `/${currentInstance}/trending`;\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Go to my instance (<b>{currentInstance}</b>)\n                </Trans>\n              </small>\n            </MenuItem>\n          )}\n        </Menu2>\n      }\n    />\n  );\n}\n\nexport default Trending;\n","import { useLingui } from '@lingui/react/macro';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport Bookmarks from '../pages/bookmarks';\nimport Favourites from '../pages/favourites';\nimport Following from '../pages/following';\nimport Hashtag from '../pages/hashtag';\nimport List from '../pages/list';\nimport Mentions from '../pages/mentions';\nimport Notifications from '../pages/notifications';\nimport Public from '../pages/public';\nimport Search from '../pages/search';\nimport Trending from '../pages/trending';\nimport isRTL from '../utils/is-rtl';\nimport states from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'nearest',\n  behavior: 'instant',\n};\n\nfunction Columns() {\n  const { t } = useLingui();\n  useTitle(t`Home`, '/');\n  const snapStates = useSnapshot(states);\n  const { shortcuts } = snapStates;\n\n  console.debug('RENDER Columns', shortcuts);\n\n  const components = shortcuts.map((shortcut) => {\n    if (!shortcut) return null;\n    const { type, ...params } = shortcut;\n    const Component = {\n      following: Following,\n      notifications: Notifications,\n      list: List,\n      public: Public,\n      bookmarks: Bookmarks,\n      favourites: Favourites,\n      hashtag: Hashtag,\n      mentions: Mentions,\n      trending: Trending,\n      search: Search,\n    }[type];\n    if (!Component) return null;\n    // Don't show Search column with no query, for now\n    if (type === 'search' && !params.query) return null;\n    // Don't show List column with no list, for now\n    if (type === 'list' && !params.id) return null;\n    return (\n      <Component key={type + JSON.stringify(params)} {...params} columnMode />\n    );\n  });\n\n  useHotkeys(\n    ['1', '2', '3', '4', '5', '6', '7', '8', '9'],\n    (e) => {\n      try {\n        const index = parseInt(e.key, 10) - 1;\n        const $column = document.querySelectorAll('#columns > *')[index];\n        if ($column) {\n          $column.focus();\n          $column.scrollIntoView(scrollIntoViewOptions);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    ['[', ']'],\n    (e, handler) => {\n      const key = handler.keys[0];\n      const currentFocusedColumn =\n        document.activeElement.closest('#columns > *');\n\n      const rtl = isRTL();\n      const prevColKey = rtl ? ']' : '[';\n      const nextColKey = rtl ? '[' : ']';\n      let $column;\n\n      if (key === prevColKey) {\n        // If [, focus on left of focused column, else first column\n        $column = currentFocusedColumn\n          ? currentFocusedColumn.previousElementSibling\n          : document.querySelectorAll('#columns > *')[0];\n      } else if (key === nextColKey) {\n        // If ], focus on right of focused column, else 2nd column\n        $column = currentFocusedColumn\n          ? currentFocusedColumn.nextElementSibling\n          : document.querySelectorAll('#columns > *')[1];\n      }\n      if ($column) {\n        $column.focus();\n        $column.scrollIntoView(scrollIntoViewOptions);\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  return (\n    <div\n      id=\"columns\"\n      onContextMenu={(e) => {\n        // If right-click on header, but not links or buttons\n        if (\n          e.target.closest('.deck > header') &&\n          !e.target.closest('a') &&\n          !e.target.closest('button')\n        ) {\n          e.preventDefault();\n          states.showShortcutsSettings = true;\n        }\n      }}\n      onFocus={() => {\n        // Get current focused column\n        const currentFocusedColumn =\n          document.activeElement.closest('#columns > *');\n        if (currentFocusedColumn) {\n          // Remove focus classes from all columns\n          // Add focus class to current focused column\n          document.querySelectorAll('#columns > *').forEach((column) => {\n            column.classList.toggle('focus', column === currentFocusedColumn);\n          });\n        }\n      }}\n    >\n      {components}\n    </div>\n  );\n}\n\nexport default Columns;\n","import './notifications-menu.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Columns from '../components/columns';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Notification from '../components/notification';\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport FilterContext from '../utils/filter-context';\nimport { massageNotifications2 } from '../utils/group-notifications';\nimport states, { saveStatus } from '../utils/states';\nimport { getCurrentAccountNS } from '../utils/store-utils';\n\nimport Following from './following';\nimport {\n  getGroupedNotifications,\n  mastoFetchNotifications,\n} from './notifications';\n\nfunction Home() {\n  const { _ } = useLingui();\n  const snapStates = useSnapshot(states);\n  __BENCHMARK.end('time-to-home');\n  useEffect(() => {\n    (async () => {\n      const keys = await db.drafts.keys();\n      if (keys.length) {\n        const ns = getCurrentAccountNS();\n        const ownKeys = keys.filter((key) => key.startsWith(ns));\n        if (ownKeys.length) {\n          states.showDrafts = true;\n        }\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      {(snapStates.settings.shortcutsViewMode === 'multi-column' ||\n        (!snapStates.settings.shortcutsViewMode &&\n          snapStates.settings.shortcutsColumnsMode)) &&\n      !!snapStates.shortcuts?.length ? (\n        <Columns />\n      ) : (\n        <Following\n          title={_(msg`Home`)}\n          path=\"/\"\n          id=\"home\"\n          headerStart={false}\n          headerEnd={<NotificationsLink />}\n        />\n      )}\n    </>\n  );\n}\n\nfunction NotificationsLink() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const notificationLinkRef = useRef();\n  const [menuState, setMenuState] = useState(undefined);\n  return (\n    <>\n      <Link\n        ref={notificationLinkRef}\n        to=\"/notifications\"\n        class={`button plain notifications-button ${\n          snapStates.notificationsShowNew ? 'has-badge' : ''\n        } ${menuState || ''}`}\n        onClick={(e) => {\n          e.stopPropagation();\n          if (window.matchMedia('(min-width: calc(40em))').matches) {\n            e.preventDefault();\n            setMenuState((state) => (!state ? 'open' : undefined));\n          }\n        }}\n      >\n        <Icon icon=\"notification\" size=\"l\" alt={t`Notifications`} />\n      </Link>\n      <NotificationsMenu\n        state={menuState}\n        anchorRef={notificationLinkRef}\n        onClose={() => setMenuState(undefined)}\n      />\n    </>\n  );\n}\n\nconst NOTIFICATIONS_DISPLAY_LIMIT = 5;\nfunction NotificationsMenu({ anchorRef, state, onClose }) {\n  const { masto, instance } = api();\n  const snapStates = useSnapshot(states);\n  const [uiState, setUIState] = useState('default');\n\n  const notificationsIterator = mastoFetchNotifications();\n\n  async function fetchNotifications() {\n    const allNotifications = await notificationsIterator.next();\n    const notifications = massageNotifications2(allNotifications.value);\n\n    if (notifications?.length) {\n      notifications.forEach((notification) => {\n        saveStatus(notification.status, instance, {\n          skipThreading: true,\n        });\n      });\n\n      const groupedNotifications = getGroupedNotifications(notifications);\n\n      states.notificationsLast = groupedNotifications[0];\n      states.notifications = groupedNotifications;\n\n      // Update last read marker\n      masto.v1.markers\n        .create({\n          notifications: {\n            lastReadId: groupedNotifications[0].id,\n          },\n        })\n        .catch(() => {});\n    }\n\n    states.notificationsShowNew = false;\n    states.notificationsLastFetchTime = Date.now();\n    return allNotifications;\n  }\n\n  const [hasFollowRequests, setHasFollowRequests] = useState(false);\n  function fetchFollowRequests() {\n    return masto.v1.followRequests.list({\n      limit: 1,\n    });\n  }\n\n  function loadNotifications({ skipFollowRequests = false } = {}) {\n    setUIState('loading');\n    (async () => {\n      try {\n        await fetchNotifications();\n        if (!skipFollowRequests) {\n          const followRequests = await fetchFollowRequests();\n          setHasFollowRequests(!!followRequests?.length);\n        }\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  }\n\n  const menuRef = useRef();\n  const headerHeight = 52;\n  useEffect(() => {\n    if (state !== 'open') return;\n    if (snapStates.notificationsShowNew) {\n      const menuElement = menuRef.current;\n      if (menuElement?.scrollTop <= headerHeight) {\n        loadNotifications({\n          skipFollowRequests: true,\n        });\n      }\n    } else {\n      loadNotifications();\n    }\n  }, [state, snapStates.notificationsShowNew]);\n\n  return (\n    <ControlledMenu\n      ref={menuRef}\n      menuClassName=\"notifications-menu\"\n      state={state}\n      anchorRef={anchorRef}\n      onClose={onClose}\n      portal={{\n        target: document.body,\n      }}\n      containerProps={{\n        onClick: () => {\n          menuRef.current?.closeMenu?.();\n        },\n      }}\n      overflow=\"auto\"\n      viewScroll=\"close\"\n      position=\"anchor\"\n      align=\"center\"\n      boundingBoxPadding=\"8 8 8 8\"\n    >\n      <header>\n        <h2>\n          <Trans>Notifications</Trans>\n        </h2>\n      </header>\n      <FilterContext.Provider value=\"notifications\">\n        <main>\n          {snapStates.notifications.length ? (\n            <>\n              {snapStates.notifications\n                .slice(0, NOTIFICATIONS_DISPLAY_LIMIT)\n                .map((notification) => (\n                  <Notification\n                    key={notification._ids || notification.id}\n                    instance={instance}\n                    notification={notification}\n                    disableContextMenu\n                  />\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <div class=\"ui-state\">\n              <Loader abrupt />\n            </div>\n          ) : (\n            uiState === 'error' && (\n              <div class=\"ui-state\">\n                <p>\n                  <Trans>Unable to fetch notifications.</Trans>\n                </p>\n                <p>\n                  <button type=\"button\" onClick={loadNotifications}>\n                    <Trans>Try again</Trans>\n                  </button>\n                </p>\n              </div>\n            )\n          )}\n        </main>\n      </FilterContext.Provider>\n      <footer>\n        <Link to=\"/mentions\" class=\"button plain\">\n          <Icon icon=\"at\" />{' '}\n          <span>\n            <Trans>Mentions</Trans>\n          </span>\n        </Link>\n        <Link to=\"/notifications\" class=\"button plain2\">\n          {hasFollowRequests ? (\n            <Trans>\n              <span class=\"tag collapsed\">New</span>{' '}\n              <span>Follow Requests</span>\n            </Trans>\n          ) : (\n            <b>\n              <Trans>See all</Trans>\n            </b>\n          )}{' '}\n          <Icon icon=\"arrow-right\" />\n        </Link>\n      </footer>\n    </ControlledMenu>\n  );\n}\n\nexport default memo(Home);\n","// export const statusRegex = /\\/@([^@\\/]+)@?([^\\/]+)?\\/([^\\/]+)\\/?$/i;\n// export const statusNoteRegex = /\\/notes\\/([^\\/]+)\\/?$/i;\n\nconst statusPostRegexes = [\n  /^\\/@[^@\\/]+\\/(?:statuses|posts)\\/([^\\/]+)/i, // GoToSocial, Takahe\n  /\\/notes\\/([^\\/]+)/i, // Misskey, Firefish\n  /^\\/(?:notice|objects)\\/([a-z0-9-]+)/i, // Pleroma\n  /\\/@[^@\\/]+\\/post\\/([^\\/]+)/i, // Threads\n  /\\/@[^@\\/]+@?[^\\/]+?\\/([^\\/]+)/i, // Mastodon\n  /^\\/p\\/[^\\/]+\\/([^\\/]+)/i, // Pixelfed\n];\n\nexport function getInstanceStatusObject(url) {\n  // Regex /:username/:id, where username = @username or @username@domain, id = anything\n  const theURL = URL.parse(url);\n  if (!theURL) return {};\n  const { hostname, pathname } = theURL;\n  // const [, username, domain, id] = pathname.match(statusRegex) || [];\n  for (const regex of statusPostRegexes) {\n    const [, id] = pathname.match(regex) || [];\n    console.log(pathname, regex, id);\n    if (id) {\n      return {\n        instance: hostname,\n        id,\n      };\n    }\n  }\n  return {};\n}\n\nfunction getInstanceStatusURL(url) {\n  const { instance, id } = getInstanceStatusObject(url);\n  if (instance && id) {\n    return `/${instance}/s/${id}`;\n  }\n  return null;\n}\n\nexport default getInstanceStatusURL;\n","import { Trans } from '@lingui/react/macro';\nimport { useLayoutEffect, useState } from 'preact/hooks';\nimport { useLocation } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport { api } from '../utils/api';\nimport getInstanceStatusURL, {\n  getInstanceStatusObject,\n} from '../utils/get-instance-status-url';\n\nexport default function HttpRoute() {\n  const location = useLocation();\n  const url = location.pathname.replace(/^\\//, '');\n  const statusObject = getInstanceStatusObject(url);\n  // const statusURL = getInstanceStatusURL(url);\n  const statusURL = statusObject?.instance\n    ? `/${statusObject.instance}/s/${statusObject.id}`\n    : null;\n  const [uiState, setUIState] = useState('loading');\n\n  useLayoutEffect(() => {\n    setUIState('loading');\n    (async () => {\n      // Check if status returns 200\n      try {\n        const { instance, id } = statusObject;\n        if (id) {\n          const { masto } = api({ instance });\n          const status = await masto.v1.statuses.$select(id).fetch();\n          if (status) {\n            window.location.hash = statusURL + '?view=full';\n            return;\n          }\n        }\n      } catch (e) {}\n\n      // Fallback to search\n      {\n        const { masto: currentMasto, instance: currentInstance } = api();\n        const result = await currentMasto.v2.search.list({\n          q: url,\n          limit: 1,\n          resolve: true,\n        });\n        if (result.statuses.length) {\n          const status = result.statuses[0];\n          window.location.hash = `/${currentInstance}/s/${status.id}?view=full`;\n        } else if (result.accounts.length) {\n          const account = result.accounts[0];\n          window.location.hash = `/${currentInstance}/a/${account.id}`;\n        } else if (statusURL) {\n          // Fallback to original URL, which will probably show error\n          window.location.hash = statusURL + '?view=full';\n        } else {\n          setUIState('error');\n        }\n      }\n    })();\n  }, [statusURL]);\n\n  return (\n    <div class=\"ui-state\" tabIndex=\"-1\">\n      {uiState === 'loading' ? (\n        <>\n          <Loader abrupt />\n          <h2>\n            <Trans>Resolving</Trans>\n          </h2>\n          <p>\n            <a href={url} target=\"_blank\" rel=\"noopener\">\n              {url}\n            </a>\n          </p>\n        </>\n      ) : (\n        <>\n          <h2>\n            <Trans>Unable to resolve URL</Trans>\n          </h2>\n          <p>\n            <a href={url} target=\"_blank\" rel=\"noopener\">\n              {url}\n            </a>\n          </p>\n        </>\n      )}\n      <hr />\n      <p>\n        <Link to=\"/\">\n          <Trans>Go home</Trans>\n        </Link>\n      </p>\n    </div>\n  );\n}\n","import './lists.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport ListAddEdit from '../components/list-add-edit';\nimport ListExclusiveBadge from '../components/list-exclusive-badge';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport { fetchLists } from '../utils/lists';\nimport useTitle from '../utils/useTitle';\n\nfunction Lists() {\n  const { t } = useLingui();\n  useTitle(t`Lists`, `/l`);\n  const [uiState, setUIState] = useState('default');\n\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [lists, setLists] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const lists = await fetchLists();\n        console.log(lists);\n        setLists(lists);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n\n  const hasExclusiveLists = lists.some((list) => list.exclusive);\n\n  return (\n    <div id=\"lists-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Lists</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => setShowListAddEditModal(true)}\n              >\n                <Icon icon=\"plus\" size=\"l\" alt={t`New list`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {lists.length > 0 ? (\n            <>\n              <ul class=\"link-list\">\n                {lists.map((list) => (\n                  <li>\n                    <Link to={`/l/${list.id}`}>\n                      <Icon icon=\"list\" />{' '}\n                      <span>\n                        {list.title}\n                        {list.exclusive && (\n                          <>\n                            {' '}\n                            <ListExclusiveBadge insignificant />\n                          </>\n                        )}\n                      </span>\n                      {/* <button\n                      type=\"button\"\n                      class=\"plain\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setShowListAddEditModal({\n                          list,\n                        });\n                      }}\n                    >\n                      <Icon icon=\"pencil\" />\n                    </button> */}\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n              {lists.length > 1 && (\n                <footer class=\"ui-state\">\n                  {hasExclusiveLists && (\n                    <p>\n                      <small class=\"insignificant\">\n                        <ListExclusiveBadge />{' '}\n                        <Trans>\n                          Posts on this list are hidden from Home/Following\n                        </Trans>\n                      </small>\n                    </p>\n                  )}\n                  <p>\n                    <small class=\"insignificant\">\n                      <Plural\n                        value={lists.length}\n                        one=\"# list\"\n                        other=\"# lists\"\n                      />\n                    </small>\n                  </p>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load lists.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No lists yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nexport default Lists;\n","export default \"__VITE_ASSET__Bj_CmqRM__\"","export function openAuthPopup(url) {\n  const width = Math.min(500, Math.floor(window.screen.width * 0.9));\n  const height = Math.min(600, Math.floor(window.screen.height * 0.8));\n\n  const features = `popup,width=${width},height=${height}`;\n\n  try {\n    const popup = window.open(url, 'auth-popup', features);\n    if (!popup || popup.closed || typeof popup.closed === 'undefined') {\n      return null;\n    }\n    return popup;\n  } catch (e) {\n    console.error('Failed to open popup:', e);\n    return null;\n  }\n}\n\nexport function closeAuthPopup(popup) {\n  if (popup && !popup.closed) {\n    try {\n      popup.close();\n    } catch (e) {\n      console.error('Failed to close popup:', e);\n    }\n  }\n}\n\nexport function watchAuthPopup(popup, onSuccess, onError) {\n  let resolved = false;\n\n  const messageHandler = (event) => {\n    // Security: verify event origin matches current origin\n    if (event.origin !== window.location.origin) {\n      return;\n    }\n\n    if (event.data && event.data.type === 'oauth-callback') {\n      resolved = true;\n      cleanup();\n\n      if (event.data.code) {\n        onSuccess(event.data.code);\n      } else {\n        onError(new Error('No authorization code received'));\n      }\n    }\n  };\n\n  window.addEventListener('message', messageHandler);\n\n  const pollInterval = setInterval(() => {\n    if (!popup || popup.closed) {\n      clearInterval(pollInterval);\n      if (!resolved) {\n        resolved = true;\n        cleanup();\n        onError(new Error('Popup was closed before authentication completed'));\n      }\n    }\n  }, 500);\n\n  const cleanup = () => {\n    window.removeEventListener('message', messageHandler);\n    clearInterval(pollInterval);\n    closeAuthPopup(popup);\n  };\n\n  return cleanup;\n}\n","import './login.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport Fuse from 'fuse.js';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport logo from '../assets/logo.svg';\n\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport instancesListURL from '../data/instances.json?url';\nimport {\n  getAuthorizationURL,\n  getPKCEAuthorizationURL,\n  registerApplication,\n} from '../utils/auth';\nimport { openAuthPopup, watchAuthPopup } from '../utils/auth-popup';\nimport { supportsPKCE } from '../utils/oauth-pkce';\nimport store from '../utils/store';\nimport {\n  getCredentialApplication,\n  hasAccountInInstance,\n  storeCredentialApplication,\n} from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nconst { PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE } = import.meta.env;\n\nfunction Login() {\n  const { t } = useLingui();\n  useTitle(t`Log in`, '/login');\n  const instanceURLRef = useRef();\n  const cachedInstanceURL = store.local.get('instanceURL');\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = useSearchParams();\n  const instance = searchParams.get('instance');\n  const submit = searchParams.get('submit');\n  const [instanceText, setInstanceText] = useState(\n    instance || cachedInstanceURL?.toLowerCase() || '',\n  );\n\n  const [instancesList, setInstancesList] = useState([]);\n  const searcher = useRef();\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(instancesListURL);\n        const data = await res.json();\n        setInstancesList(data);\n        searcher.current = new Fuse(data);\n      } catch (e) {\n        // Silently fail\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  // useEffect(() => {\n  //   if (cachedInstanceURL) {\n  //     instanceURLRef.current.value = cachedInstanceURL.toLowerCase();\n  //   }\n  // }, []);\n\n  const submitInstance = (instanceURL) => {\n    if (!instanceURL) return;\n\n    (async () => {\n      // WEB_DOMAIN vs LOCAL_DOMAIN negotiation time\n      // https://docs.joinmastodon.org/admin/config/#web_domain\n      try {\n        const res = await fetch(`https://${instanceURL}/.well-known/host-meta`); // returns XML\n        const text = await res.text();\n        // Parse XML\n        const parser = new DOMParser();\n        const xmlDoc = parser.parseFromString(text, 'text/xml');\n        // Get Link[template]\n        const link = xmlDoc.getElementsByTagName('Link')[0];\n        const template = link.getAttribute('template');\n        const url = URL.parse(template);\n        const { host } = url; // host includes the port\n        if (instanceURL !== host) {\n          console.log(` ${instanceURL} -> ${host}`);\n          instanceURL = host;\n        }\n      } catch (e) {\n        // Silently fail\n        console.error(e);\n      }\n\n      store.local.set('instanceURL', instanceURL);\n\n      setUIState('loading');\n      try {\n        let credentialApplication = getCredentialApplication(instanceURL);\n        if (\n          !credentialApplication ||\n          !credentialApplication.client_id ||\n          !credentialApplication.client_secret\n        ) {\n          credentialApplication = await registerApplication({\n            instanceURL,\n          });\n          storeCredentialApplication(instanceURL, credentialApplication);\n        }\n\n        const { client_id, client_secret } = credentialApplication;\n\n        const authPKCE = await supportsPKCE({ instanceURL });\n        console.log({ authPKCE });\n        const forceLogin = hasAccountInInstance(instanceURL);\n\n        let authUrl;\n        if (authPKCE && window.isSecureContext) {\n          if (client_id && client_secret) {\n            const [url, verifier] = await getPKCEAuthorizationURL({\n              instanceURL,\n              client_id,\n              forceLogin,\n            });\n            store.sessionCookie.set('codeVerifier', verifier);\n            authUrl = url;\n          } else {\n            alert(t`Failed to register application`);\n            setUIState('default');\n            return;\n          }\n        } else {\n          if (client_id && client_secret) {\n            authUrl = await getAuthorizationURL({\n              instanceURL,\n              client_id,\n              forceLogin,\n            });\n          } else {\n            alert(t`Failed to register application`);\n            setUIState('default');\n            return;\n          }\n        }\n\n        const popup = openAuthPopup(authUrl);\n\n        if (popup) {\n          watchAuthPopup(\n            popup,\n            (code) => {\n              const callbackUrl = `${window.location.origin}${window.location.pathname}?code=${encodeURIComponent(code)}`;\n              window.location.href = callbackUrl;\n            },\n            (error) => {\n              console.error('Popup auth error:', error);\n              setUIState('error');\n            },\n          );\n        } else {\n          // Popup blocked, fallback to redirect\n          console.log('Popup blocked, falling back to redirect');\n          location.href = authUrl;\n        }\n\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  const cleanInstanceText = instanceText\n    ? instanceText\n        .replace(/^https?:\\/\\//, '') // Remove protocol from instance URL\n        .replace(/\\/+$/, '') // Remove trailing slash\n        .replace(/^@?[^@]+@/, '') // Remove @?acct@\n        .trim()\n    : null;\n  const instanceTextLooksLikeDomain =\n    /[^\\s\\r\\n\\t\\/\\\\]+\\.[^\\s\\r\\n\\t\\/\\\\]+/.test(cleanInstanceText) &&\n    !/[\\s\\/\\\\@]/.test(cleanInstanceText);\n\n  const instancesSuggestions = cleanInstanceText\n    ? searcher.current\n        ?.search(cleanInstanceText, {\n          limit: 10,\n        })\n        ?.map((match) => match.item)\n    : [];\n\n  const selectedInstanceText = instanceTextLooksLikeDomain\n    ? cleanInstanceText\n    : instancesSuggestions?.length\n      ? instancesSuggestions[0]\n      : instanceText\n        ? instancesList.find((instance) => instance.includes(instanceText))\n        : null;\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    // const { elements } = e.target;\n    // let instanceURL = elements.instanceURL.value.toLowerCase();\n    // // Remove protocol from instance URL\n    // instanceURL = instanceURL.replace(/^https?:\\/\\//, '').replace(/\\/+$/, '');\n    // // Remove @acct@ or acct@ from instance URL\n    // instanceURL = instanceURL.replace(/^@?[^@]+@/, '');\n    // if (!/\\./.test(instanceURL)) {\n    //   instanceURL = instancesList.find((instance) =>\n    //     instance.includes(instanceURL),\n    //   );\n    // }\n    // submitInstance(instanceURL);\n    submitInstance(selectedInstanceText);\n  };\n\n  if (submit) {\n    useEffect(() => {\n      submitInstance(instance || selectedInstanceText);\n    }, []);\n  }\n\n  return (\n    <main id=\"login\" style={{ textAlign: 'center' }}>\n      <form onSubmit={onSubmit}>\n        <h1>\n          <img src={logo} alt=\"\" width=\"80\" height=\"80\" />\n          <br />\n          <Trans>Log in</Trans>\n        </h1>\n        <label>\n          <p>\n            <Trans>Instance</Trans>\n          </p>\n          <input\n            value={instanceText}\n            required\n            type=\"text\"\n            class=\"large\"\n            id=\"instanceURL\"\n            ref={instanceURLRef}\n            disabled={uiState === 'loading'}\n            // list=\"instances-list\"\n            autocorrect=\"off\"\n            autocapitalize=\"off\"\n            autocomplete=\"off\"\n            spellCheck={false}\n            placeholder={t`instance domain`}\n            enterKeyHint=\"go\"\n            onInput={(e) => {\n              setInstanceText(e.target.value);\n            }}\n            dir=\"auto\"\n          />\n          {instancesSuggestions?.length > 0 ? (\n            <ul id=\"instances-suggestions\">\n              {instancesSuggestions.map((instance, i) => (\n                <li>\n                  <button\n                    type=\"button\"\n                    class=\"plain5\"\n                    onClick={() => {\n                      submitInstance(instance);\n                    }}\n                  >\n                    {instance}\n                  </button>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <div id=\"instances-eg\">\n              <Trans>e.g. &ldquo;mastodon.social&rdquo;</Trans>\n            </div>\n          )}\n          {/* <datalist id=\"instances-list\">\n            {instancesList.map((instance) => (\n              <option value={instance} />\n            ))}\n          </datalist> */}\n        </label>\n        {uiState === 'error' && (\n          <p class=\"error\">\n            <Trans>\n              Failed to log in. Please try again or try another instance.\n            </Trans>\n          </p>\n        )}\n        <div>\n          <button\n            disabled={\n              uiState === 'loading' || !instanceText || !selectedInstanceText\n            }\n          >\n            {selectedInstanceText\n              ? t`Continue with ${selectedInstanceText}`\n              : t`Continue`}\n          </button>{' '}\n        </div>\n        <Loader hidden={uiState !== 'loading'} />\n        <hr />\n        {!DEFAULT_INSTANCE && (\n          <p>\n            <a href=\"https://joinmastodon.org/servers\" target=\"_blank\">\n              <Trans>Don't have an account? Create one!</Trans>\n            </a>\n          </p>\n        )}\n        <p>\n          <Link to=\"/\">\n            <Trans>Go home</Trans>\n          </Link>\n        </p>\n        <LangSelector />\n      </form>\n    </main>\n  );\n}\n\nexport default Login;\n","import './scheduled-posts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useMemo, useReducer, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Menu2 from '../components/menu2';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport ScheduledAtField, {\n  getLocalTimezoneName,\n} from '../components/ScheduledAtField';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport niceDateTime from '../utils/nice-date-time';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus, statusKey } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 40;\n\nexport default function ScheduledPosts() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  useTitle(t`Scheduled Posts`, '/sp');\n  const { masto } = api();\n  const [scheduledPosts, setScheduledPosts] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [showScheduledPostModal, setShowScheduledPostModal] = useState(false);\n\n  useEffect(reload, [snapStates.reloadScheduledPosts]);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const postsIterator = masto.v1.scheduledStatuses\n          .list({ limit: LIMIT })\n          .values();\n        const allPosts = [];\n        let posts;\n        do {\n          const result = await postsIterator.next();\n          posts = result.value;\n          if (posts?.length) {\n            allPosts.push(...posts);\n          }\n        } while (posts?.length);\n        setScheduledPosts(allPosts);\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      } finally {\n        setUIState('default');\n      }\n    })();\n  }, [reloadCount]);\n\n  return (\n    <div id=\"scheduled-posts-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Scheduled Posts</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <Menu2\n                portal\n                setDownOverflow\n                overflow=\"auto\"\n                viewScroll=\"close\"\n                position=\"anchor\"\n                menuButton={\n                  <button type=\"button\" class=\"plain\">\n                    <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n                  </button>\n                }\n              >\n                <MenuItem\n                  onClick={() => {\n                    reload();\n                  }}\n                >\n                  <Icon icon=\"refresh\" size=\"l\" />\n                  <span>\n                    <Trans>Refresh</Trans>\n                  </span>\n                </MenuItem>\n              </Menu2>\n            </div>\n          </div>\n        </header>\n        <main>\n          {!scheduledPosts.length ? (\n            <p class=\"ui-state\">\n              {uiState === 'loading' ? <Loader /> : t`No scheduled posts.`}\n            </p>\n          ) : (\n            <ul class=\"posts-list\">\n              {scheduledPosts.map((post) => {\n                const { id, params, scheduledAt, mediaAttachments } = post;\n                const {\n                  inReplyToId,\n                  language,\n                  poll,\n                  sensitive,\n                  spoilerText,\n                  text,\n                  visibility,\n                  quotedStatusId,\n                  quoteApprovalPolicy,\n                } = params;\n                const status = {\n                  // account: account.info,\n                  id,\n                  inReplyToId,\n                  language,\n                  mediaAttachments,\n                  poll: poll\n                    ? {\n                        ...poll,\n                        expiresAt: new Date(Date.now() + poll.expiresIn * 1000),\n                        options: poll.options.map((option) => ({\n                          title: option,\n                          votesCount: 0,\n                        })),\n                      }\n                    : undefined,\n                  sensitive,\n                  spoilerText,\n                  text,\n                  visibility,\n                  content: `<p>${text}</p>`,\n                  // createdAt: scheduledAt,\n                  quotedStatusId,\n                  quoteApprovalPolicy,\n                };\n\n                return (\n                  <li key={id}>\n                    <ScheduledPostPreview\n                      status={status}\n                      scheduledAt={scheduledAt}\n                      onClick={() => {\n                        setShowScheduledPostModal({\n                          post: status,\n                          scheduledAt: new Date(scheduledAt),\n                        });\n                      }}\n                    />\n                  </li>\n                );\n              })}\n            </ul>\n          )}\n          {showScheduledPostModal && (\n            <Modal\n              onClick={(e) => {\n                if (e.target === e.currentTarget) {\n                  setShowScheduledPostModal(false);\n                }\n              }}\n            >\n              <ScheduledPostEdit\n                post={showScheduledPostModal.post}\n                scheduledAt={showScheduledPostModal.scheduledAt}\n                onClose={() => setShowScheduledPostModal(false)}\n              />\n            </Modal>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nfunction ScheduledPostPreview({ status, scheduledAt, onClick }) {\n  // Look at scheduledAt, if it's months away, ICON = 'month'. If it's days away, ICON = 'day', else ICON = 'time'\n  const icon = useMemo(() => {\n    const hours = (Date.parse(scheduledAt) - Date.now()) / (1000 * 60 * 60);\n    if (hours < 24) {\n      return 'time';\n    } else if (hours < 720) {\n      // 30 days\n      return 'day';\n    } else {\n      return 'month';\n    }\n  }, [scheduledAt]);\n\n  return (\n    <button type=\"button\" class=\"textual block\" onClick={onClick}>\n      <div class={`post-schedule-meta post-schedule-${icon}`}>\n        <Icon icon={icon} class=\"insignificant\" />{' '}\n        <span>\n          <Trans comment=\"Scheduled [in 1 day] ([Thu, Feb 27, 6:30:00 PM])\">\n            Scheduled{' '}\n            <b>\n              <RelativeTime datetime={scheduledAt} />\n            </b>{' '}\n            <small>\n              (\n              {niceDateTime(scheduledAt, {\n                formatOpts: {\n                  weekday: 'short',\n                  second: 'numeric',\n                },\n              })}\n              )\n            </small>\n          </Trans>\n        </span>\n      </div>\n      <Status status={status} size=\"s\" previewMode readOnly />\n    </button>\n  );\n}\n\nfunction ScheduledPostEdit({ post, scheduledAt, onClose }) {\n  const { masto, instance } = api();\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const [newScheduledAt, setNewScheduledAt] = useState();\n  const differentScheduledAt =\n    newScheduledAt && newScheduledAt.getTime() !== scheduledAt.getTime();\n  const localTZ = getLocalTimezoneName();\n  const pastSchedule = scheduledAt && scheduledAt <= Date.now();\n\n  const { inReplyToId } = post;\n  const [replyToStatus, setReplyToStatus] = useState(null);\n  // TODO: Uncomment this once https://github.com/mastodon/mastodon/issues/34000 is fixed\n  // useEffect(() => {\n  //   if (inReplyToId) {\n  //     (async () => {\n  //       try {\n  //         const status = await masto.v1.statuses.$select(inReplyToId).fetch();\n  //         setReplyToStatus(status);\n  //       } catch (e) {\n  //         console.error(e);\n  //       }\n  //     })();\n  //   }\n  // }, [inReplyToId]);\n\n  const { quotedStatusId } = post;\n  // TODO: Uncomment this once https://github.com/mastodon/mastodon/issues/36536 is fixed\n  // useEffect(() => {\n  //   if (post.id && quotedStatusId) {\n  //     (async () => {\n  //       try {\n  //         const quotedStatus = await masto.v1.statuses\n  //           .$select(quotedStatusId)\n  //           .fetch();\n  //         saveStatus(quotedStatus, instance);\n  //         const sKey = statusKey(post.id, instance);\n  //         states.statusQuotes[sKey] = [\n  //           {\n  //             id: quotedStatus.id,\n  //             instance,\n  //             url: `/${instance}/s/${quotedStatus.id}`,\n  //             native: true,\n  //           },\n  //         ];\n  //       } catch (e) {\n  //         console.error('Failed to fetch quoted status:', e);\n  //       }\n  //     })();\n  //   }\n  // }, [post.id, quotedStatusId]);\n\n  return (\n    <div id=\"scheduled-post-sheet\" class=\"sheet\">\n      <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n        <Icon icon=\"x\" size=\"l\" alt={t`Close`} />\n      </button>\n      <header>\n        <h2>\n          <Trans comment=\"Scheduled [in 1 day]\">\n            Scheduled{' '}\n            <b>\n              <RelativeTime datetime={scheduledAt} />\n            </b>\n          </Trans>\n          <br />\n          <small>\n            {niceDateTime(scheduledAt, {\n              formatOpts: {\n                weekday: 'short',\n                second: 'numeric',\n              },\n            })}\n          </small>\n        </h2>\n      </header>\n      <main tabIndex=\"-1\">\n        {!!replyToStatus && (\n          <div class=\"status-reply\">\n            <Status status={replyToStatus} size=\"s\" previewMode readOnly />\n          </div>\n        )}\n        <Status\n          status={post}\n          size=\"s\"\n          previewMode\n          readOnly\n          onMediaClick={(e, i, media, status) => {\n            e.preventDefault();\n            states.showMediaModal = {\n              mediaAttachments: post.mediaAttachments,\n              mediaIndex: i,\n            };\n          }}\n        />\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            setUIState('loading');\n            (async () => {\n              try {\n                await masto.v1.scheduledStatuses.$select(post.id).update({\n                  scheduledAt: newScheduledAt.toISOString(),\n                });\n                showToast(t`Scheduled post rescheduled`);\n                onClose();\n                setUIState('default');\n                states.reloadScheduledPosts++;\n              } catch (e) {\n                setUIState('error');\n                console.error(e);\n                showToast(t`Failed to reschedule post`);\n              }\n            })();\n          }}\n        >\n          <footer>\n            <div class=\"row\">\n              <span>\n                <ScheduledAtField\n                  scheduledAt={scheduledAt}\n                  setScheduledAt={(date) => {\n                    setNewScheduledAt(date);\n                  }}\n                />{' '}\n                <small class=\"ib\">{localTZ}</small>\n              </span>\n            </div>\n            <div class=\"row\">\n              <button\n                disabled={\n                  !differentScheduledAt || uiState === 'loading' || pastSchedule\n                }\n              >\n                <Trans>Reschedule</Trans>\n              </button>\n              <span class=\"grow\" />\n              <MenuConfirm\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete scheduled post?`}\n                onClick={() => {\n                  setUIState('loading');\n                  (async () => {\n                    try {\n                      await api()\n                        .masto.v1.scheduledStatuses.$select(post.id)\n                        .remove();\n                      showToast(t`Scheduled post deleted`);\n                      onClose();\n                      setUIState('default');\n                      states.reloadScheduledPosts++;\n                    } catch (e) {\n                      setUIState('error');\n                      console.error(e);\n                      showToast(t`Failed to delete scheduled post`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  disabled={uiState === 'loading' || pastSchedule}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            </div>\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n","import { useLingui } from '@lingui/react/macro';\n\nimport { useEditHistory } from '../utils/edit-history-context';\n\nimport Icon from './icon';\n\nexport default function EditHistoryControls() {\n  const { t } = useLingui();\n  const {\n    prevEditedAt,\n    nextEditedAt,\n    editedAtIndex,\n    editHistoryMode,\n    editHistoryRef,\n    exitEditHistory,\n  } = useEditHistory();\n  if (!editHistoryMode) return null;\n  return (\n    <div class=\"edit-history-controls\">\n      <Icon icon=\"edit\" />\n      <b class=\"edit-history-heading\">{t`Edit History Snapshots`}</b>\n      <span class=\"spacer\" />\n      <span class=\"edit-history-pagination\">\n        <button\n          type=\"button\"\n          class=\"plain4\"\n          onClick={() => {\n            prevEditedAt();\n          }}\n          disabled={\n            !editHistoryMode ||\n            editedAtIndex + 1 >= editHistoryRef.current.length\n          }\n        >\n          <Icon icon=\"chevron-left\" alt={t`Previous`} />\n        </button>{' '}\n        {editHistoryRef.current.length - editedAtIndex} /{' '}\n        {editHistoryRef.current.length}{' '}\n        <button\n          type=\"button\"\n          class=\"plain4\"\n          onClick={() => {\n            nextEditedAt();\n          }}\n          disabled={!editHistoryMode || editedAtIndex <= 0}\n        >\n          <Icon icon=\"chevron-right\" alt={t`Next`} />\n        </button>\n      </span>\n      <button\n        type=\"button\"\n        class=\"plain3\"\n        onClick={() => {\n          exitEditHistory();\n        }}\n      >\n        <Icon icon=\"exit\" alt={t`Exit`} />\n      </button>\n    </div>\n  );\n}\n","import './status.css';\n\nimport { plural } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuHeader, MenuItem } from '@szhsin/react-menu';\nimport debounce from 'just-debounce-it';\nimport pRetry from 'p-retry';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { matchPath, useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Avatar from '../components/avatar';\nimport EditHistoryControls from '../components/edit-history-controls';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport { getSafeViewTransitionName } from '../components/media';\nimport MediaModal from '../components/media-modal';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport {\n  EditHistoryProvider,\n  useEditHistory,\n} from '../utils/edit-history-context';\nimport htmlContentLength from '../utils/html-content-length';\nimport shortenNumber from '../utils/shorten-number';\nimport states, {\n  getStatus,\n  saveStatus,\n  statusKey,\n  threadifyStatus,\n} from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { getCurrentAccount } from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nimport getInstanceStatusURL from './../utils/get-instance-status-url';\n\nconst { PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE } = import.meta.env;\n\nconst LIMIT = 40;\nconst SUBCOMMENTS_OPEN_ALL_LIMIT = 10;\nconst MAX_WEIGHT = 5;\n\nlet cachedRepliesToggle = {};\nlet cachedStatusesMap = {};\nlet scrollPositions = {};\nfunction resetScrollPosition(id) {\n  delete cachedStatusesMap[id];\n  delete scrollPositions[id];\n}\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'center',\n  behavior: 'instant',\n};\n\n// Select all statuses except those inside collapsed details/summary\n// Hat-tip to @AmeliaBR@front-end.social\n// https://front-end.social/@AmeliaBR/109784776146144471\nconst STATUSES_SELECTOR =\n  '.status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)';\n\nconst STATUS_URL_REGEX = /\\/s\\//i;\n\nimport { ThreadCountContext } from '../utils/thread-count-context';\n\nfunction StatusPage(params) {\n  const { id } = params;\n  const { masto, instance } = api({ instance: params.instance });\n  const snapStates = useSnapshot(states);\n  const [searchParams, setSearchParams] = useSearchParams();\n  const mediaParam = searchParams.get('media');\n  const mediaOnlyParam = searchParams.get('media-only');\n  const mediaIndex = parseInt(mediaParam || mediaOnlyParam, 10);\n  let showMedia = mediaIndex > 0;\n  const mediaStatusID = searchParams.get('mediaStatusID');\n  const mediaStatus = getStatus(mediaStatusID, instance);\n  if (mediaStatusID && !mediaStatus) {\n    showMedia = false;\n  }\n  const showMediaOnly = showMedia && !!mediaOnlyParam;\n\n  const sKey = statusKey(id, instance);\n  const [heroStatus, setHeroStatus] = useState(states.statuses[sKey]);\n  useEffect(() => {\n    if (states.statuses[sKey]) {\n      setHeroStatus(states.statuses[sKey]);\n    }\n  }, [sKey]);\n\n  // Set canonical link, not for SEO, but for sharing\n  useEffect(() => {\n    if (!heroStatus || !heroStatus.url) return;\n\n    const existingCanonical = document.querySelector('link[rel=\"canonical\"]');\n    let originalHref = null;\n    let canonicalLink;\n\n    if (existingCanonical) {\n      originalHref = existingCanonical.href;\n      existingCanonical.href = heroStatus.url;\n    } else {\n      canonicalLink = document.createElement('link');\n      canonicalLink.rel = 'canonical';\n      canonicalLink.href = heroStatus.url;\n      document.head.appendChild(canonicalLink);\n    }\n\n    return () => {\n      if (existingCanonical && originalHref) {\n        existingCanonical.href = originalHref;\n      } else if (canonicalLink) {\n        document.head.removeChild(canonicalLink);\n      }\n    };\n  }, [heroStatus?.url]);\n\n  const closeLink = useMemo(() => {\n    const { prevLocation } = states;\n    const pathname =\n      (prevLocation?.pathname || '') + (prevLocation?.search || '');\n    const matchStatusPath =\n      matchPath('/:instance/s/:id', pathname) || matchPath('/s/:id', pathname);\n    if (!pathname || matchStatusPath) {\n      return '/';\n    }\n    return pathname;\n  }, []);\n\n  useEffect(() => {\n    if (!heroStatus && showMedia) {\n      (async () => {\n        try {\n          const status = await masto.v1.statuses.$select(id).fetch();\n          saveStatus(status, instance);\n          setHeroStatus(status);\n        } catch (err) {\n          console.error(err);\n          alert('Unable to load post.');\n          location.hash = closeLink;\n        }\n      })();\n    }\n  }, [showMedia]);\n\n  const mediaAttachments = mediaStatusID\n    ? snapStates.statuses[statusKey(mediaStatusID, instance)]?.mediaAttachments\n    : heroStatus?.mediaAttachments;\n\n  const postViewState = () =>\n    window.matchMedia('(min-width: calc(40em + 350px))').matches\n      ? 'large'\n      : 'small';\n  const mediaClose = useCallback(() => {\n    console.log('xxx', {\n      postViewState: postViewState(),\n      showMediaOnly,\n    });\n    if (postViewState() === 'small' && snapStates.prevLocation) {\n      history.back();\n    } else {\n      if (showMediaOnly) {\n        location.hash = closeLink;\n      } else {\n        searchParams.delete('media');\n        searchParams.delete('mediaStatusID');\n        setSearchParams(searchParams);\n      }\n    }\n  }, [showMediaOnly, closeLink, snapStates.prevLocation]);\n  const handleMediaClose = useCallback(\n    (e, currentIndex, mediaAttachments, carouselRef) => {\n      if (postViewState() === 'large' && !showMediaOnly) {\n        mediaClose();\n        return;\n      }\n      if (showMedia && document.startViewTransition) {\n        const media = mediaAttachments[currentIndex];\n        const { id, blurhash, url } = media;\n        const mediaVTN = getSafeViewTransitionName(id || blurhash || url);\n        const els = document.querySelectorAll(\n          `.status .media [data-view-transition-name=\"${mediaVTN}\"]`,\n        );\n        const foundEls = [...els]?.filter?.((el) => {\n          const elBounds = el.getBoundingClientRect();\n          return (\n            elBounds.top < window.innerHeight &&\n            elBounds.bottom > 0 &&\n            elBounds.left < window.innerWidth &&\n            elBounds.right > 0\n          );\n        });\n        // If more than one, get the one in status page\n        const el =\n          foundEls.length === 1\n            ? foundEls[0]\n            : foundEls.find((el) => !!el.closest('.status-deck'));\n\n        console.log('xxx', { media, id, els, el });\n        if (el) {\n          const transition = document.startViewTransition(() => {\n            el.style.viewTransitionName = mediaVTN;\n            if (carouselRef?.current) {\n              carouselRef.current\n                .querySelectorAll('.media img, .media video')\n                ?.forEach((el) => {\n                  el.style.viewTransitionName = '';\n                });\n            }\n            mediaClose();\n          });\n          transition.ready.finally(() => {\n            el.style.viewTransitionName = '';\n            el.dataset.viewTransitioned = mediaVTN;\n          });\n        } else {\n          mediaClose();\n        }\n      } else {\n        mediaClose();\n      }\n    },\n    [showMedia, showMediaOnly],\n  );\n\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      // carouselRef.current?.focus?.();\n      const $carousel = document.querySelector('.carousel');\n      if ($carousel) {\n        $carousel.focus();\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, [showMediaOnly]);\n\n  useEffect(() => {\n    const $deckContainers = document.querySelectorAll('.deck-container');\n    $deckContainers.forEach(($deckContainer) => {\n      $deckContainer.setAttribute('inert', '');\n    });\n    return () => {\n      $deckContainers.forEach(($deckContainer) => {\n        $deckContainer.removeAttribute('inert');\n      });\n    };\n  }, []);\n\n  return (\n    <div class=\"deck-backdrop\">\n      {showMedia ? (\n        mediaAttachments?.length ? (\n          <MediaModal\n            mediaAttachments={mediaAttachments}\n            statusID={mediaStatusID || id}\n            instance={instance}\n            lang={heroStatus?.language}\n            index={mediaIndex - 1}\n            onClose={handleMediaClose}\n          />\n        ) : (\n          <div class=\"media-modal-container loading\">\n            <Loader abrupt />\n          </div>\n        )\n      ) : (\n        <Link to={closeLink} />\n      )}\n      {!showMediaOnly && (\n        <EditHistoryProvider statusID={id}>\n          <StatusThread\n            id={id}\n            instance={params.instance}\n            closeLink={closeLink}\n          />\n        </EditHistoryProvider>\n      )}\n    </div>\n  );\n}\n\nfunction StatusParent(props) {\n  const { linkable, to, onClick, ...restProps } = props;\n  return linkable ? (\n    <Link class=\"status-link\" to={to} onClick={onClick} {...restProps} />\n  ) : (\n    <div class=\"status-focus\" tabIndex={0} {...restProps} />\n  );\n}\n\n// oldest first\nfunction createdAtSort(a, b) {\n  return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n}\n\nconst MONTH_IN_MS = 1000 * 60 * 60 * 24 * 30;\n\nfunction StatusThread({ id, closeLink = '/', instance: propInstance }) {\n  const { t } = useLingui();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const mediaParam = searchParams.get('media');\n  const mediaStatusID = searchParams.get('mediaStatusID');\n  const showMedia = parseInt(mediaParam, 10) > 0;\n  const firstLoad = useRef(\n    !states.prevLocation &&\n      (history.length === 1 ||\n        ('navigation' in window && navigation?.entries?.()?.length === 1)),\n  );\n  const [viewMode, setViewMode] = useState(\n    searchParams.get('view') || firstLoad.current ? 'full' : null,\n  );\n  const translate = !!parseInt(searchParams.get('translate'));\n  const { masto, instance } = api({ instance: propInstance });\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated,\n  } = api();\n  const sameInstance = instance === currentInstance;\n  const snapStates = useSnapshot(states);\n  const [statuses, setStatuses] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const heroStatusRef = useRef();\n  const sKey = statusKey(id, instance);\n  const totalDescendants = useRef(0);\n\n  const scrollableRef = useRef();\n  useEffect(() => {\n    scrollableRef.current?.focus();\n  }, []);\n  useEffect(() => {\n    const onScroll = debounce(() => {\n      // console.log('onScroll');\n      if (!scrollableRef.current) return;\n      const { scrollTop } = scrollableRef.current;\n      if (uiState !== 'loading') {\n        scrollPositions[id] = scrollTop;\n      }\n    }, 50);\n    scrollableRef.current?.addEventListener('scroll', onScroll, {\n      passive: true,\n    });\n    onScroll();\n    return () => {\n      onScroll.cancel();\n      scrollableRef.current?.removeEventListener('scroll', onScroll);\n    };\n  }, [id, uiState !== 'loading']);\n\n  const { editHistoryMode, initEditHistory, editedAtIndex, editHistoryRef } =\n    useEditHistory();\n\n  const scrollOffsets = useRef();\n  const lastInitContextTS = useRef();\n  const [threadsCount, setThreadsCount] = useState(0);\n  const fullContext = useRef(null);\n  const restructureContext = () => {\n    console.log({ fullContext: fullContext.current });\n    if (!fullContext.current) return;\n    let { ancestors, descendants, heroStatus } = fullContext.current;\n\n    if (editHistoryMode && descendants?.length) {\n      // Filter descendants based on createdAt/editedAt dates\n      // - editHistory items only has createdAt\n      // - descendants items has createdAt and optional editedAt\n      const currentEditedAtStatus = editHistoryRef.current[editedAtIndex];\n      const currentEditedAtStatusCreatedAt = Date.parse(\n        currentEditedAtStatus.createdAt,\n      );\n      const nextEditedAtStatus = editHistoryRef.current[editedAtIndex - 1];\n      const nextEditedAtStatusCreatedAt = nextEditedAtStatus\n        ? Date.parse(nextEditedAtStatus.createdAt)\n        : null;\n      descendants = descendants.filter((s) => {\n        // Show descendants created between current and next editedAt dates\n        const sCreatedAt = Date.parse(s.editedAt || s.createdAt);\n        return (\n          sCreatedAt >= currentEditedAtStatusCreatedAt &&\n          (!nextEditedAtStatusCreatedAt ||\n            sCreatedAt <= nextEditedAtStatusCreatedAt)\n        );\n      });\n    }\n\n    ancestors.sort(createdAtSort);\n    descendants.sort(createdAtSort);\n\n    totalDescendants.current = descendants?.length || 0;\n\n    // Ghost posts - detect missing ancestors\n    const missingAncestorIds = new Set();\n    ancestors.forEach((status) => {\n      saveStatus(status, instance, {\n        skipThreading: true,\n      });\n      if (\n        status.inReplyToId &&\n        !ancestors.find((s) => s.id === status.inReplyToId)\n      ) {\n        missingAncestorIds.add(status.inReplyToId);\n      }\n    });\n    if (\n      heroStatus.inReplyToId &&\n      !ancestors.find((s) => s.id === heroStatus.inReplyToId)\n    ) {\n      missingAncestorIds.add(heroStatus.inReplyToId);\n    }\n\n    // Insert ghost statuses\n    missingAncestorIds.forEach((missingId) => {\n      const referencingStatus =\n        ancestors.find((s) => s.inReplyToId === missingId) ||\n        (heroStatus.inReplyToId === missingId ? heroStatus : null);\n      if (referencingStatus) {\n        const ghostStatus = {\n          id: missingId,\n          ghost: {\n            inReplyToAccountId: referencingStatus.inReplyToAccountId,\n          },\n        };\n        if (referencingStatus === heroStatus) {\n          ancestors.push(ghostStatus);\n        } else {\n          const insertIndex = ancestors.indexOf(referencingStatus);\n          ancestors.splice(insertIndex, 0, ghostStatus);\n        }\n      }\n    });\n\n    const missingStatuses = new Set();\n    const ancestorsIsThread = ancestors.every(\n      (s) => s.ghost || s.account.id === heroStatus.account.id,\n    );\n    const nestedDescendants = [];\n    descendants.forEach((status) => {\n      saveStatus(status, instance, {\n        // skipThreading: true,\n      });\n\n      if (\n        status.inReplyToId &&\n        !descendants.find((s) => s.id === status.inReplyToId) &&\n        status.inReplyToId !== heroStatus.id\n      ) {\n        missingStatuses.add(status.inReplyToId);\n      }\n\n      if (status.inReplyToAccountId === status.account.id) {\n        // If replying to self, it's part of the thread, level 1\n        nestedDescendants.push(status);\n      } else if (status.inReplyToId === heroStatus.id) {\n        // If replying to the hero status, it's a reply, level 1\n        nestedDescendants.push(status);\n      } else if (\n        !status.inReplyToAccountId &&\n        nestedDescendants.find(\n          (s) =>\n            s.id === status.inReplyToId &&\n            s.account.id === heroStatus.account.id,\n        ) &&\n        status.account.id === heroStatus.account.id\n      ) {\n        // If replying to hero's own statuses, it's part of the thread, level 1\n        nestedDescendants.push(status);\n      } else {\n        // If replying to someone else, it's a reply to a reply, level 2\n        const parent = descendants.find((s) => s.id === status.inReplyToId);\n        if (parent) {\n          if (!parent.__replies) {\n            parent.__replies = [];\n          }\n          parent.__replies.push(status);\n        } else {\n          // If no parent, something is wrong\n          console.warn('No parent found for', status);\n        }\n      }\n    });\n\n    // sort hero author to top\n    nestedDescendants.sort((a, b) => {\n      const heroAccountID = heroStatus.account.id;\n      if (a.account.id === heroAccountID && b.account.id !== heroAccountID)\n        return -1;\n      if (b.account.id === heroAccountID && a.account.id !== heroAccountID)\n        return 1;\n      return 0;\n    });\n\n    console.log({ ancestors, descendants, nestedDescendants });\n    if (missingStatuses.size) {\n      console.error('Missing statuses', [...missingStatuses]);\n    }\n\n    let descendantLevelsCount = 1;\n    function expandReplies(_replies, level) {\n      const nextLevel = level + 1;\n      if (nextLevel > descendantLevelsCount) {\n        descendantLevelsCount = level;\n      }\n      return _replies?.map((_r) => ({\n        id: _r.id,\n        account: _r.account,\n        repliesCount: _r.repliesCount,\n        content: _r.content,\n        weight: calcStatusWeight(_r),\n        level: nextLevel,\n        replies: expandReplies(_r.__replies, nextLevel),\n      }));\n    }\n\n    const mappedNestedDescendants = nestedDescendants.map((s) => ({\n      id: s.id,\n      account: s.account,\n      accountID: s.account.id,\n      descendant: true,\n      thread: s.account.id === heroStatus.account.id,\n      weight: calcStatusWeight(s),\n      level: 1,\n      replies: expandReplies(s.__replies, 1),\n      createdAt: s.createdAt,\n    }));\n    const allStatuses = [\n      ...ancestors.map((s) => ({\n        id: s.id,\n        ancestor: true,\n        ghost: s.ghost,\n        isThread: ancestorsIsThread && !s.ghost,\n        accountID: s.account?.id,\n        account: s.account,\n        repliesCount: s.repliesCount,\n        weight: s.ghost ? 0 : calcStatusWeight(s),\n        createdAt: s.createdAt,\n      })),\n      {\n        id,\n        accountID: heroStatus.account.id,\n        weight: calcStatusWeight(heroStatus),\n        createdAt: heroStatus.createdAt,\n      },\n      ...mappedNestedDescendants,\n    ];\n\n    console.log({ allStatuses, descendantLevelsCount });\n    return { allStatuses, ancestorsIsThread, mappedNestedDescendants };\n  };\n\n  const initContext = ({ reloadHero } = {}) => {\n    console.debug('initContext', id);\n    setUIState('loading');\n    let heroTimer;\n\n    const cachedStatuses = cachedStatusesMap[id];\n    if (cachedStatuses) {\n      // Case 1: It's cached, let's restore them to make it snappy\n      const reallyCachedStatuses = cachedStatuses.filter(\n        (s) => states.statuses[sKey],\n        // Some are not cached in the global state, so we need to filter them out\n      );\n      setStatuses(reallyCachedStatuses);\n    } else {\n      // const heroIndex = statuses.findIndex((s) => s.id === id);\n      // if (heroIndex !== -1) {\n      //   // Case 2: It's in current statuses. Slice off all descendant statuses after the hero status to be safe\n      //   const slicedStatuses = statuses.slice(0, heroIndex + 1);\n      //   setStatuses(slicedStatuses);\n      // } else {\n      // Case 3: Not cached and not in statuses, let's start from scratch\n      setStatuses([{ id }]);\n      // }\n    }\n\n    (async () => {\n      const heroFetch = () =>\n        pRetry(() => masto.v1.statuses.$select(id).fetch(), {\n          retries: 4,\n        });\n      const contextFetch = pRetry(\n        () => masto.v1.statuses.$select(id).context.fetch(),\n        {\n          retries: 8,\n        },\n      );\n\n      const hasStatus = !!snapStates.statuses[sKey];\n      let heroStatus = snapStates.statuses[sKey];\n      if (hasStatus && !reloadHero) {\n        console.debug('Hero status is cached');\n      } else {\n        try {\n          heroStatus = await heroFetch();\n          saveStatus(heroStatus, instance);\n          // Give time for context to appear\n          await new Promise((resolve) => {\n            setTimeout(resolve, 100);\n          });\n        } catch (e) {\n          console.error(e);\n          setUIState('error');\n          return;\n        }\n      }\n\n      try {\n        const context = await contextFetch;\n        const { ancestors } = context;\n        fullContext.current = { ...context, heroStatus };\n        const { allStatuses, ancestorsIsThread, mappedNestedDescendants } =\n          restructureContext();\n\n        const descendantsThread =\n          ancestors.length && !ancestorsIsThread\n            ? []\n            : mappedNestedDescendants.filter((s) => s.thread);\n        const threadsCount =\n          (ancestorsIsThread ? ancestors.length : 0) + descendantsThread.length;\n        if (threadsCount > 0 && threadsCount < 100) {\n          // Cap at 100 because there's no point showing 100+\n          // Include hero as part of thread count\n          setThreadsCount(threadsCount + 1);\n        }\n\n        setUIState('default');\n        scrollOffsets.current = {\n          offsetTop: heroStatusRef.current?.offsetTop,\n          scrollTop: scrollableRef.current?.scrollTop,\n        };\n\n        // Set limit to hero's index\n        // const heroLimit = allStatuses.findIndex((s) => s.id === id);\n        const heroLimit = ancestors.length || 0; // 0-indexed\n        if (heroLimit >= limit) {\n          setLimit(heroLimit + 1);\n        }\n\n        setStatuses(allStatuses);\n        cachedStatusesMap[id] = allStatuses;\n\n        // Let's threadify this one\n        // Note that all non-hero statuses will trigger saveStatus which will threadify them too\n        // By right, at this point, all descendant statuses should be cached\n        threadifyStatus(heroStatus, instance);\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n\n    lastInitContextTS.current = Date.now();\n\n    return () => {\n      clearTimeout(heroTimer);\n    };\n  };\n\n  useEffect(initContext, [id, masto]);\n\n  useEffect(() => {\n    try {\n      const { allStatuses } = restructureContext();\n      setStatuses(allStatuses);\n    } catch (e) {}\n    // Only run this when editHistoryMode changes\n    // If id changes, initContext will run instead, so don't worry\n  }, [editHistoryMode, editedAtIndex]);\n\n  const [showRefresh, setShowRefresh] = useState(false);\n  useEffect(() => {\n    let interval = setInterval(() => {\n      const now = Date.now();\n      if (\n        lastInitContextTS.current &&\n        now - lastInitContextTS.current >= 60_000\n      ) {\n        setShowRefresh(true);\n      }\n    }, 60_000); // 1 minute\n    return () => {\n      clearInterval(interval);\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (!statuses.length) return;\n    console.debug('STATUSES', statuses);\n    const scrollPosition = scrollPositions[id];\n    console.debug('scrollPosition', scrollPosition);\n    if (!!scrollPosition) {\n      console.debug('Case 1', {\n        id,\n        scrollPosition,\n      });\n      scrollableRef.current.scrollTop = scrollPosition;\n    } else if (scrollOffsets.current) {\n      const newScrollOffsets = {\n        offsetTop: heroStatusRef.current?.offsetTop,\n        scrollTop: scrollableRef.current?.scrollTop,\n      };\n      const newScrollTop =\n        newScrollOffsets.offsetTop -\n        scrollOffsets.current.offsetTop +\n        newScrollOffsets.scrollTop;\n      console.debug('Case 2', {\n        scrollOffsets: scrollOffsets.current,\n        newScrollOffsets,\n        newScrollTop,\n        statuses: [...statuses],\n      });\n      scrollableRef.current.scrollTop = newScrollTop;\n    } else if (statuses.length === 1) {\n      console.debug('Case 3', {\n        id,\n      });\n      scrollableRef.current.scrollTop = 0;\n    }\n\n    // RESET\n    scrollOffsets.current = null;\n  }, [statuses]);\n\n  useEffect(() => {\n    if (snapStates.reloadStatusPage <= 0) return;\n    // Delete the cache for the context\n    (async () => {\n      try {\n        const { instanceURL } = getCurrentAccount();\n        const contextURL = `https://${instanceURL}/api/v1/statuses/${id}/context`;\n        console.log('Clear cache', contextURL);\n        const apiCache = await caches.open('api');\n        await apiCache.delete(contextURL, { ignoreVary: true });\n\n        return initContext({\n          reloadHero: true,\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [snapStates.reloadStatusPage]);\n\n  useEffect(() => {\n    return () => {\n      // RESET\n      scrollPositions = {};\n      states.reloadStatusPage = 0;\n      cachedStatusesMap = {};\n      cachedRepliesToggle = {};\n      statusWeightCache.clear();\n    };\n  }, []);\n\n  const heroStatus = snapStates.statuses[sKey] || snapStates.statuses[id];\n  const heroDisplayName = useMemo(() => {\n    // Remove shortcodes from display name\n    if (!heroStatus) return '';\n    const { account } = heroStatus;\n    const div = document.createElement('div');\n    div.innerHTML = account.displayName;\n    return div.innerText.trim();\n  }, [heroStatus]);\n  const heroContentText = useMemo(() => {\n    if (!heroStatus) return '';\n    let text = statusPeek(heroStatus);\n    if (text.length > 64) {\n      // \"The title should ideally be less than 64 characters in length\"\n      // https://www.w3.org/Provider/Style/TITLE.html\n      text = text.slice(0, 64) + '';\n    }\n    return text;\n  }, [heroStatus]);\n  useTitle(\n    heroDisplayName && heroContentText\n      ? `${heroDisplayName}: \"${heroContentText}\"`\n      : t({\n          id: 'post.title',\n          message: 'Post',\n        }),\n    '/:instance?/s/:id',\n  );\n\n  const postInstance = useMemo(() => {\n    if (!heroStatus) return;\n    const { url } = heroStatus;\n    if (!url) return;\n    return URL.parse(url)?.hostname;\n  }, [heroStatus]);\n  const postSameInstance = useMemo(() => {\n    if (!postInstance) return;\n    return postInstance === instance;\n  }, [postInstance, instance]);\n\n  const [limit, setLimit] = useState(LIMIT);\n  const showMore = useMemo(() => {\n    // return number of statuses to show\n    return statuses.length - limit;\n  }, [statuses.length, limit]);\n\n  const hasDescendants = statuses.some((s) => s.descendant);\n  const ancestors = statuses.filter((s) => s.ancestor);\n\n  const [heroInView, setHeroInView] = useState(true);\n  const heroPointer = useMemo(() => {\n    // get top offset of heroStatus\n    if (!heroStatusRef.current || heroInView) return null;\n    const { top } = heroStatusRef.current.getBoundingClientRect();\n    return top > 0 ? 'down' : 'up';\n  }, [heroInView]);\n\n  useHotkeys(\n    'esc',\n    () => {\n      location.hash = closeLink;\n    },\n    {\n      // If media is open, esc to close media first\n      // Else close the status page\n      enabled: !showMedia,\n      ignoreEventWhen: (e) => {\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return hasModal || e.metaKey || e.ctrlKey || e.altKey || e.shiftKey;\n      },\n      useKey: true,\n    },\n  );\n  // For backspace, will always close both media and status page\n  useHotkeys(\n    'backspace',\n    () => {\n      location.hash = closeLink;\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    'j',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      const activeStatusRect = activeStatus?.getBoundingClientRect();\n      const allStatusLinks = Array.from(\n        scrollableRef.current.querySelectorAll(STATUSES_SELECTOR),\n      );\n      console.log({ allStatusLinks });\n      if (\n        activeStatus &&\n        activeStatusRect.top < scrollableRef.current.clientHeight &&\n        activeStatusRect.bottom > 0\n      ) {\n        const activeStatusIndex = allStatusLinks.indexOf(activeStatus);\n        let nextStatus = allStatusLinks[activeStatusIndex + 1];\n        if (nextStatus) {\n          nextStatus.focus();\n          nextStatus.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostStatusLink = allStatusLinks.find((statusLink) => {\n          const statusLinkRect = statusLink.getBoundingClientRect();\n          return statusLinkRect.top >= 44 && statusLinkRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostStatusLink) {\n          topmostStatusLink.focus();\n          topmostStatusLink.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    'k',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      const activeStatusRect = activeStatus?.getBoundingClientRect();\n      const allStatusLinks = Array.from(\n        scrollableRef.current.querySelectorAll(STATUSES_SELECTOR),\n      );\n      if (\n        activeStatus &&\n        activeStatusRect.top < scrollableRef.current.clientHeight &&\n        activeStatusRect.bottom > 0\n      ) {\n        const activeStatusIndex = allStatusLinks.indexOf(activeStatus);\n        let prevStatus = allStatusLinks[activeStatusIndex - 1];\n        if (prevStatus) {\n          prevStatus.focus();\n          prevStatus.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostStatusLink = allStatusLinks.find((statusLink) => {\n          const statusLinkRect = statusLink.getBoundingClientRect();\n          return statusLinkRect.top >= 44 && statusLinkRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostStatusLink) {\n          topmostStatusLink.focus();\n          topmostStatusLink.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  // NOTE: I'm not sure if 'x' is the best shortcut for this, might change it later\n  // IDEA: x is for expand\n  useHotkeys(\n    'x',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      if (activeStatus) {\n        const details = activeStatus.nextElementSibling;\n        if (details && details.tagName.toLowerCase() === 'details') {\n          details.open = !details.open;\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [reachTopPost, setReachTopPost] = useState(false);\n  // const { nearReachStart } = useScroll({\n  //   scrollableRef,\n  //   distanceFromStartPx: 16,\n  // });\n\n  const initialPageState = useRef(showMedia ? 'media+status' : 'status');\n\n  const handleMediaClick = useCallback(\n    (e, i, media, status) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setSearchParams({\n        media: i + 1,\n        mediaStatusID: status.id,\n      });\n    },\n    [id],\n  );\n\n  const handleStatusLinkClick = useCallback((e, status) => {\n    resetScrollPosition(status.id);\n  }, []);\n\n  useEffect(() => {\n    let timer;\n    if (mediaStatusID && showMedia) {\n      timer = setTimeout(() => {\n        const status = scrollableRef.current?.querySelector(\n          `.status-link[href*=\"/${mediaStatusID}\"]`,\n        );\n        if (status) {\n          status.scrollIntoView(scrollIntoViewOptions);\n        }\n      }, 400); // After CSS transition\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [mediaStatusID, showMedia]);\n\n  const renderStatus = useCallback(\n    (status, i) => {\n      const {\n        id: statusID,\n        ancestor,\n        ghost,\n        isThread,\n        descendant,\n        thread,\n        replies,\n        repliesCount,\n        weight,\n        level,\n      } = status;\n      const isHero = statusID === id;\n      const isLinkable = !ghost && (isThread || ancestor);\n\n      return (\n        <li\n          key={statusID}\n          ref={isHero ? heroStatusRef : null}\n          class={`${ancestor ? 'ancestor' : ''} ${\n            descendant ? 'descendant' : ''\n          } ${thread ? 'thread' : ''} ${isHero ? 'hero' : ''}`}\n        >\n          {isHero ? (\n            <>\n              <InView\n                threshold={0.1}\n                onChange={(inView) => {\n                  queueMicrotask(() => {\n                    requestAnimationFrame(() => {\n                      setHeroInView(inView);\n                    });\n                  });\n                }}\n                class=\"status-focus\"\n                tabIndex={0}\n              >\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size=\"l\"\n                  enableTranslate\n                  forceTranslate={translate}\n                />\n              </InView>\n              {uiState !== 'loading' && !authenticated ? (\n                <div class=\"post-status-banner\">\n                  <p>\n                    <Trans>\n                      You're not logged in. Interactions (reply, boost, etc) are\n                      not possible.\n                    </Trans>\n                  </p>\n                  <Link\n                    to={\n                      DEFAULT_INSTANCE\n                        ? `/login?instance=${DEFAULT_INSTANCE}&submit=1`\n                        : '/login'\n                    }\n                    class=\"button\"\n                  >\n                    <Trans>Log in</Trans>\n                  </Link>\n                </div>\n              ) : (\n                !sameInstance && (\n                  <div class=\"post-status-banner\">\n                    <p>\n                      <Trans>\n                        This post is from another instance (<b>{instance}</b>).\n                        Interactions (reply, boost, etc) are not possible.\n                      </Trans>\n                    </p>\n                    <button\n                      type=\"button\"\n                      disabled={uiState === 'loading'}\n                      onClick={() => {\n                        setUIState('loading');\n                        (async () => {\n                          try {\n                            const results = await currentMasto.v2.search.list({\n                              q: heroStatus.url,\n                              type: 'statuses',\n                              resolve: true,\n                              limit: 1,\n                            });\n                            if (results.statuses.length) {\n                              const status = results.statuses[0];\n                              location.hash = currentInstance\n                                ? `/${currentInstance}/s/${status.id}`\n                                : `/s/${status.id}`;\n                            } else {\n                              throw new Error('No results');\n                            }\n                          } catch (e) {\n                            setUIState('default');\n                            alert(t`Error: ${e}`);\n                            console.error(e);\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"transfer\" />{' '}\n                      <Trans>\n                        Switch to my instance to enable interactions\n                      </Trans>\n                    </button>\n                  </div>\n                )\n              )}\n            </>\n          ) : (\n            <StatusParent\n              linkable={isLinkable}\n              to={instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`}\n              onClick={() => {\n                resetScrollPosition(statusID);\n              }}\n            >\n              {/* <Link\n              class=\"status-link\"\n              to={instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`}\n              onClick={() => {\n                resetScrollPosition(statusID);\n              }}\n            > */}\n              {ghost ? (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size=\"m\"\n                  ghost={ghost}\n                />\n              ) : i === 0 && ancestor ? (\n                <InView\n                  threshold={0.5}\n                  onChange={(inView) => {\n                    queueMicrotask(() => {\n                      requestAnimationFrame(() => {\n                        setReachTopPost(inView);\n                      });\n                    });\n                  }}\n                >\n                  <Status\n                    statusID={statusID}\n                    instance={instance}\n                    withinContext\n                    size={thread || ancestor ? 'm' : 's'}\n                    enableTranslate\n                    onMediaClick={handleMediaClick}\n                    onStatusLinkClick={handleStatusLinkClick}\n                  />\n                </InView>\n              ) : (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size={thread || ancestor ? 'm' : 's'}\n                  enableTranslate\n                  onMediaClick={handleMediaClick}\n                  onStatusLinkClick={handleStatusLinkClick}\n                  showActionsBar={!!descendant}\n                />\n              )}\n              {ancestor && repliesCount > 1 && (\n                <div class=\"replies-link\">\n                  <Icon icon=\"comment2\" alt={t`Replies`} />{' '}\n                  <span title={repliesCount}>\n                    {shortenNumber(repliesCount)}\n                  </span>\n                </div>\n              )}{' '}\n              {/* {replies?.length > LIMIT && (\n                        <div class=\"replies-link\">\n                          <Icon icon=\"comment\" />{' '}\n                          <span title={replies.length}>\n                            {shortenNumber(replies.length)}\n                          </span>\n                        </div>\n                      )} */}\n            </StatusParent>\n            // </Link>\n          )}\n          {descendant && replies?.length > 0 && (\n            <SubComments\n              instance={instance}\n              replies={replies}\n              hasParentThread={thread}\n              level={level}\n              accWeight={weight}\n              openAll={totalDescendants.current < SUBCOMMENTS_OPEN_ALL_LIMIT}\n              parentLink={{\n                to: instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`,\n                onClick: () => resetScrollPosition(statusID),\n              }}\n            />\n          )}\n          {uiState === 'loading' &&\n            isHero &&\n            !!heroStatus?.repliesCount &&\n            !hasDescendants && (\n              <div class=\"status-loading\">\n                <Loader abrupt={heroStatus.repliesCount >= 3} />\n              </div>\n            )}\n          {uiState === 'error' &&\n            isHero &&\n            !!heroStatus?.repliesCount &&\n            !hasDescendants && (\n              <div class=\"status-error\">\n                <Trans>Unable to load replies.</Trans>\n                <br />\n                <button\n                  type=\"button\"\n                  class=\"plain\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Trans>Try again</Trans>\n                </button>\n              </div>\n            )}\n        </li>\n      );\n    },\n    [\n      id,\n      instance,\n      uiState,\n      authenticated,\n      sameInstance,\n      translate,\n      handleMediaClick,\n      handleStatusLinkClick,\n      hasDescendants,\n    ],\n  );\n\n  const prevLocationIsStatusPage = useMemo(() => {\n    // Navigation API\n    if ('navigation' in window && navigation?.entries) {\n      const prevEntry = navigation.entries()[navigation.currentEntry.index - 1];\n      if (prevEntry?.url) {\n        return STATUS_URL_REGEX.test(prevEntry.url);\n      }\n    }\n    return STATUS_URL_REGEX.test(states.prevLocation?.pathname);\n  }, [sKey]);\n\n  const moreStatusesKeys = useMemo(() => {\n    if (!showMore) return [];\n    const ids = [];\n    function getIDs(status) {\n      ids.push(status.id);\n      if (status.replies) {\n        status.replies.forEach(getIDs);\n      }\n    }\n    statuses.slice(limit).forEach(getIDs);\n    return ids.map((id) => statusKey(id, instance));\n  }, [showMore, statuses, limit, instance]);\n\n  // Helper function to format time differences between two dates\n  function formatTimeGap(months) {\n    if (months < 12) {\n      return plural(months, {\n        one: '# month later',\n        other: '# months later',\n      });\n    } else {\n      const years = Math.floor(months / 12);\n      return plural(years, {\n        one: '# year later',\n        other: '# years later',\n      });\n    }\n  }\n\n  const statusesList = useMemo(() => {\n    const result = [];\n    const slicedStatuses = statuses.slice(0, limit);\n\n    for (let i = 0; i < slicedStatuses.length; i++) {\n      const status = slicedStatuses[i];\n\n      // Add time gap indicator if needed\n      if (i > 0) {\n        const prevStatus = slicedStatuses[i - 1];\n\n        const { createdAt, descendant, thread, id } = status;\n\n        if (prevStatus?.createdAt && createdAt) {\n          const currentDate = Date.parse(createdAt);\n          if (isFinite(currentDate) && currentDate > MONTH_IN_MS) {\n            const prevDate = Date.parse(prevStatus.createdAt);\n\n            if (prevDate && isFinite(prevDate)) {\n              const { ancestor, id: prevID } = prevStatus;\n              const timeDiff = currentDate - prevDate;\n              const monthsDiff = ~~(timeDiff / MONTH_IN_MS);\n\n              if (monthsDiff > 0) {\n                result.push(\n                  <li\n                    key={`time-gap-${id}-${prevID}`}\n                    style={{\n                      '--time-gap-range': Math.min(12, monthsDiff),\n                    }}\n                    class={`time-gap ${ancestor ? 'ancestor' : ''} ${descendant ? 'descendant' : ''} ${\n                      thread ? 'thread' : ''\n                    }`}\n                  >\n                    {formatTimeGap(monthsDiff)}\n                  </li>,\n                );\n              } else {\n                // NOTE: For testing purposes\n                // result.push(\n                //   <li\n                //     key={`time-gap-${id}`}\n                //     class={`time-gap ${ancestor ? 'ancestor' : ''} ${descendant ? 'descendant' : ''} ${\n                //       thread ? 'thread' : ''\n                //     }`}\n                //   >\n                //     One eternity later\n                //   </li>,\n                // );\n              }\n            }\n          }\n        }\n      }\n\n      result.push(renderStatus(status, i));\n    }\n\n    return result;\n  }, [statuses, limit, renderStatus, editHistoryMode, editedAtIndex]);\n\n  // If there's spoiler in hero status, auto-expand it\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      if (!heroStatusRef.current) return;\n      const spoilerButton = heroStatusRef.current.querySelector(\n        '.spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)',\n      );\n      if (spoilerButton) spoilerButton.click();\n    }, 1000);\n    return () => clearTimeout(timer);\n  }, [id]);\n\n  return (\n    <ThreadCountContext.Provider value={threadsCount}>\n      <div\n        tabIndex=\"-1\"\n        ref={scrollableRef}\n        class={`status-deck deck contained ${\n          statuses.length > 1 ? 'padded-bottom' : ''\n        } ${\n          initialPageState.current === 'status' && !firstLoad.current\n            ? 'slide-in'\n            : ''\n        } ${viewMode ? `deck-view-${viewMode}` : ''} ${\n          editHistoryMode ? 'edit-history-mode' : ''\n        }`}\n        style={\n          editHistoryMode\n            ? {\n                '--edit-history-percentage': `${editedAtIndex / (editHistoryRef.current.length - 1)}`,\n              }\n            : undefined\n        }\n        onAnimationEnd={(e) => {\n          // Fix the bounce effect when switching viewMode\n          // `slide-in` animation kicks in when switching viewMode\n          if (initialPageState.current === 'status') {\n            // e.target.classList.remove('slide-in');\n            initialPageState.current = null;\n          }\n        }}\n      >\n        <header\n          class={`${uiState === 'loading' ? 'loading' : ''}`}\n          onDblClick={(e) => {\n            // reload statuses\n            states.reloadStatusPage++;\n          }}\n        >\n          {/* <div>\n            <Link class=\"button plain deck-close\" href={closeLink}>\n              <Icon icon=\"chevron-left\" size=\"xl\" />\n            </Link>\n          </div> */}\n          <div class=\"header-grid header-grid-2\">\n            <h1>\n              {prevLocationIsStatusPage && (\n                <button\n                  type=\"button\"\n                  class=\"plain deck-back\"\n                  onClick={() => {\n                    history.back();\n                  }}\n                >\n                  <Icon icon=\"chevron-left\" size=\"xl\" alt={t`Back`} />\n                </button>\n              )}\n              {!heroInView && heroStatus && uiState !== 'loading' ? (\n                <>\n                  <span class=\"hero-heading\">\n                    <NameText\n                      account={heroStatus.account}\n                      instance={instance}\n                      showAvatar\n                      short\n                    />{' '}\n                    <span class=\"insignificant\">\n                      &bull;{' '}\n                      <RelativeTime\n                        datetime={heroStatus.createdAt}\n                        format=\"micro\"\n                      />\n                    </span>\n                  </span>{' '}\n                  <button\n                    type=\"button\"\n                    class=\"ancestors-indicator light small\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      heroStatusRef.current.scrollIntoView({\n                        behavior: 'smooth',\n                        block: 'start',\n                      });\n                    }}\n                    title={t`Go to main post`}\n                  >\n                    <Icon\n                      icon={heroPointer === 'down' ? 'arrow-down' : 'arrow-up'}\n                    />\n                  </button>\n                </>\n              ) : (\n                <>\n                  <Trans id=\"post.title\">Post</Trans>{' '}\n                  <button\n                    type=\"button\"\n                    class=\"ancestors-indicator light small\"\n                    onClick={(e) => {\n                      // Scroll to top\n                      e.preventDefault();\n                      e.stopPropagation();\n                      scrollableRef.current.scrollTo({\n                        top: 0,\n                        behavior: 'smooth',\n                      });\n                    }}\n                    hidden={!ancestors.length || reachTopPost}\n                    title={t`${ancestors.length} posts above  Go to top`}\n                  >\n                    <Icon icon=\"arrow-up\" />\n                    {ancestors\n                      .filter((a) => !a.ghost)\n                      .filter(\n                        (a, i, arr) =>\n                          arr.findIndex((b) => b.accountID === a.accountID) ===\n                          i,\n                      )\n                      .slice(0, 3)\n                      .map((ancestor) => (\n                        <Avatar\n                          key={ancestor.account.id}\n                          url={\n                            ancestor.account.avatarStatic ||\n                            ancestor.account.avatar\n                          }\n                          alt={ancestor.account.displayName}\n                          squircle={ancestor.account?.bot}\n                        />\n                      ))}\n                    {/* <Icon icon=\"comment\" />{' '} */}\n                    {ancestors.length > 3 && (\n                      <>\n                        {' '}\n                        <span class=\"insignificant\">\n                          {shortenNumber(ancestors.length)}\n                        </span>\n                      </>\n                    )}\n                  </button>\n                </>\n              )}\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain4 button-switch-view\"\n                style={{\n                  display: viewMode === 'full' ? '' : 'none',\n                }}\n                onClick={() => {\n                  setViewMode(null);\n                  searchParams.delete('media');\n                  searchParams.delete('media-only');\n                  searchParams.delete('view');\n                  setSearchParams(searchParams);\n                }}\n                title={t`Switch to Side Peek view`}\n              >\n                <Icon icon=\"layout4\" size=\"l\" />\n              </button>\n              {showRefresh && (\n                <button\n                  type=\"button\"\n                  class=\"plain button-refresh\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                    setShowRefresh(false);\n                  }}\n                >\n                  <Icon icon=\"refresh\" size=\"l\" alt={t`Refresh`} />\n                </button>\n              )}\n              <Menu2\n                align=\"end\"\n                portal={{\n                  // Need this, else the menu click will cause scroll jump\n                  target: scrollableRef.current,\n                }}\n                menuButton={\n                  <button type=\"button\" class=\"button plain4\">\n                    <Icon icon=\"more\" alt={t`More`} size=\"xl\" />\n                  </button>\n                }\n              >\n                <MenuItem\n                  disabled={uiState === 'loading'}\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Icon icon=\"refresh\" />\n                  <span>\n                    <Trans>Refresh</Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  className=\"menu-switch-view\"\n                  onClick={() => {\n                    setViewMode(viewMode === 'full' ? null : 'full');\n                    searchParams.delete('media');\n                    searchParams.delete('media-only');\n                    if (viewMode === 'full') {\n                      searchParams.delete('view');\n                    } else {\n                      searchParams.set('view', 'full');\n                    }\n                    setSearchParams(searchParams);\n                  }}\n                >\n                  <Icon\n                    icon={\n                      {\n                        '': 'layout5',\n                        full: 'layout4',\n                      }[viewMode || '']\n                    }\n                  />\n                  <span>\n                    {viewMode === 'full'\n                      ? t`Switch to Side Peek view`\n                      : t`Switch to Full view`}\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    // Click all buttons with class .spoiler but not .spoiling\n                    const buttons = Array.from(\n                      scrollableRef.current.querySelectorAll(\n                        '.spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)',\n                      ),\n                    );\n                    buttons.forEach((button) => {\n                      button.click();\n                    });\n                  }}\n                >\n                  <Icon icon=\"eye-open\" />{' '}\n                  <span>\n                    <Trans>Show all sensitive content</Trans>\n                  </span>\n                </MenuItem>\n                <MenuDivider />\n                <MenuHeader className=\"plain\">\n                  <Trans>Experimental</Trans>\n                </MenuHeader>\n                <MenuItem\n                  disabled={!postInstance || postSameInstance}\n                  onClick={() => {\n                    const statusURL = getInstanceStatusURL(heroStatus.url);\n                    if (statusURL) {\n                      location.hash = statusURL;\n                    } else {\n                      alert(t`Unable to switch`);\n                    }\n                  }}\n                >\n                  <Icon icon=\"transfer\" />\n                  <small class=\"menu-double-lines\">\n                    {postInstance\n                      ? t`Switch to post's instance (${punycode.toUnicode(\n                          postInstance,\n                        )})`\n                      : t`Switch to post's instance`}\n                  </small>\n                </MenuItem>\n                <MenuItem\n                  disabled={\n                    !sameInstance ||\n                    uiState === 'loading' ||\n                    !heroStatus?.editedAt ||\n                    !totalDescendants.current\n                  }\n                  onClick={initEditHistory}\n                >\n                  <Icon icon=\"edit\" />\n                  <span>{t`View Edit History Snapshots`}</span>\n                </MenuItem>\n              </Menu2>\n              <Link class=\"button plain deck-close\" to={closeLink}>\n                <Icon icon=\"x\" size=\"xl\" alt={t`Close`} />\n              </Link>\n            </div>\n          </div>\n        </header>\n        <EditHistoryControls />\n        {!!statuses.length && heroStatus ? (\n          <ul\n            class={`timeline flat contextual grow ${\n              uiState === 'loading' ? 'loading' : ''\n            }`}\n          >\n            {statusesList}\n            {showMore > 0 && (\n              <li class=\"descendant descendant-more\">\n                <button\n                  type=\"button\"\n                  class=\"plain block show-more\"\n                  disabled={uiState === 'loading'}\n                  onClick={() => setLimit((l) => l + LIMIT)}\n                  style={{ marginBlockEnd: '6em' }}\n                  data-state-post-ids={moreStatusesKeys.join(' ')}\n                >\n                  <div class=\"ib avatars-bunch\">\n                    {/* show avatars for first 5 statuses */}\n                    {statuses.slice(limit, limit + 5).map((status) => (\n                      <Avatar\n                        key={status.id}\n                        url={status.account.avatarStatic}\n                        // title={`${status.avatar.displayName} (@${status.avatar.acct})`}\n                      />\n                    ))}\n                  </div>{' '}\n                  <div class=\"ib\">\n                    <Trans>Show more</Trans>{' '}\n                    <span class=\"tag\">\n                      {showMore > LIMIT ? `${LIMIT}+` : showMore}\n                    </span>\n                  </div>\n                </button>\n              </li>\n            )}\n          </ul>\n        ) : (\n          <>\n            {uiState === 'loading' && (\n              <ul class=\"timeline flat contextual grow loading\">\n                <li>\n                  <Status skeleton size=\"l\" />\n                </li>\n              </ul>\n            )}\n            {uiState === 'error' && (\n              <p class=\"ui-state\">\n                <Trans>Unable to load post</Trans>\n                <br />\n                <br />\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Trans>Try again</Trans>\n                </button>\n              </p>\n            )}\n          </>\n        )}\n      </div>\n    </ThreadCountContext.Provider>\n  );\n}\n\nfunction SubComments({\n  replies,\n  instance,\n  hasParentThread,\n  level,\n  accWeight,\n  openAll,\n  parentLink,\n}) {\n  const { t } = useLingui();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  // Total comments count, including sub-replies\n  const diveDeep = (replies) => {\n    return replies.reduce((acc, reply) => {\n      const { repliesCount, replies } = reply;\n      const count = replies?.length || repliesCount;\n      return acc + count + diveDeep(replies || []);\n    }, 0);\n  };\n  const totalComments = replies.length + diveDeep(replies);\n  const sameCount = replies.length === totalComments;\n\n  // Get the first 3 accounts, unique by id\n  const accounts = replies\n    .map((r) => r.account)\n    .filter((a, i, arr) => arr.findIndex((b) => b.id === a.id) === i)\n    .slice(0, 3);\n\n  const totalWeight = useMemo(() => {\n    return replies?.reduce((acc, reply) => {\n      return acc + reply?.weight;\n    }, accWeight);\n  }, [accWeight, replies?.length]);\n\n  let open = false;\n  if (openAll) {\n    open = true;\n  } else if (totalWeight <= MAX_WEIGHT) {\n    open = true;\n  } else if (!hasParentThread && totalComments === 1) {\n    const shortReply = calcStatusWeight(replies[0]) < 2;\n    if (shortReply) open = true;\n  }\n  const openBefore = cachedRepliesToggle[replies[0].id];\n\n  const handleMediaClick = useCallback((e, i, media, status) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setSearchParams({\n      media: i + 1,\n      mediaStatusID: status.id,\n    });\n  }, []);\n\n  const detailsRef = useRef();\n  useLayoutEffect(() => {\n    function handleScroll(e) {\n      // NOTE: this scrollLeft works for RTL too\n      // Browsers do the magic for us\n      e.target.dataset.scrollLeft = e.target.scrollLeft;\n    }\n    detailsRef.current?.addEventListener('scroll', handleScroll, {\n      passive: true,\n    });\n    return () => {\n      detailsRef.current?.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  // If not open, delay render replies\n  const [renderReplies, setRenderReplies] = useState(openBefore || open);\n  useEffect(() => {\n    let timer;\n    if (!openBefore && !open) {\n      timer = setTimeout(() => setRenderReplies(true), 100);\n    }\n    return () => clearTimeout(timer);\n  }, [openBefore, open]);\n\n  const Container = open ? 'div' : 'details';\n  const isDetails = Container === 'details';\n\n  return (\n    <Container\n      ref={detailsRef}\n      class=\"replies\"\n      open={isDetails ? openBefore || open : undefined}\n      onToggle={\n        isDetails\n          ? (e) => {\n              const { open } = e.target;\n              // use first reply as ID\n              cachedRepliesToggle[replies[0].id] = open;\n            }\n          : undefined\n      }\n      style={{\n        '--comments-level': level,\n      }}\n      data-comments-level={level}\n      data-comments-level-overflow={level > 4}\n    >\n      {!open && (\n        <summary class=\"replies-summary\" hidden={open}>\n          <span class=\"avatars\">\n            {accounts.map((a) => (\n              <Avatar\n                key={a.id}\n                url={a.avatarStatic}\n                title={`${a.displayName} @${a.username}`}\n                squircle={a?.bot}\n              />\n            ))}\n          </span>\n          <span class=\"replies-counts\">\n            <b>\n              <Plural\n                value={replies.length}\n                one=\"# reply\"\n                other={\n                  <Trans>\n                    <span title={replies.length}>\n                      {shortenNumber(replies.length)}\n                    </span>{' '}\n                    replies\n                  </Trans>\n                }\n              />\n            </b>\n            {!sameCount && totalComments > 1 && (\n              <>\n                {' '}\n                &middot;{' '}\n                <span>\n                  <Plural\n                    value={totalComments}\n                    one=\"# comment\"\n                    other={\n                      <Trans>\n                        <span title={totalComments}>\n                          {shortenNumber(totalComments)}\n                        </span>{' '}\n                        comments\n                      </Trans>\n                    }\n                  />\n                </span>\n              </>\n            )}\n          </span>\n          <Icon icon=\"chevron-down\" class=\"replies-summary-chevron\" />\n          {!!parentLink && (\n            <Link\n              class=\"replies-parent-link\"\n              to={parentLink.to}\n              onClick={parentLink.onClick}\n              title={t`View post with its replies`}\n            >\n              &raquo;\n            </Link>\n          )}\n        </summary>\n      )}\n      {renderReplies && (\n        <ul>\n          {replies.map((r) => (\n            <li key={r.id}>\n              {/* <Link\n              class=\"status-link\"\n              to={instance ? `/${instance}/s/${r.id}` : `/s/${r.id}`}\n              onClick={() => {\n                resetScrollPosition(r.id);\n              }}\n            > */}\n              <div class=\"status-focus\" tabIndex={0}>\n                <Status\n                  statusID={r.id}\n                  instance={instance}\n                  withinContext\n                  size=\"s\"\n                  enableTranslate\n                  onMediaClick={handleMediaClick}\n                  showActionsBar\n                />\n                {!r.replies?.length && r.repliesCount > 0 && (\n                  <div class=\"replies-link\">\n                    <Icon icon=\"comment2\" alt={t`Replies`} />{' '}\n                    <span title={r.repliesCount}>\n                      {shortenNumber(r.repliesCount)}\n                    </span>\n                  </div>\n                )}\n              </div>\n              {/* </Link> */}\n              {r.replies?.length && (\n                <SubComments\n                  instance={instance}\n                  replies={r.replies}\n                  level={r.level}\n                  accWeight={!open ? r.weight : totalWeight}\n                  openAll={openAll}\n                  parentLink={{\n                    to: instance ? `/${instance}/s/${r.id}` : `/s/${r.id}`,\n                    onClick: () => {\n                      resetScrollPosition(r.id);\n                    },\n                  }}\n                />\n              )}\n            </li>\n          ))}\n        </ul>\n      )}\n    </Container>\n  );\n}\n\nconst MEDIA_VIRTUAL_LENGTH = 140;\nconst POLL_VIRTUAL_LENGTH = 35;\nconst CARD_VIRTUAL_LENGTH = 70;\nconst WEIGHT_SEGMENT = 140;\nconst statusWeightCache = new Map();\nfunction calcStatusWeight(status) {\n  const cachedWeight = statusWeightCache.get(status.id);\n  if (cachedWeight) return cachedWeight;\n  const { spoilerText, content, mediaAttachments, poll, card } = status;\n  const length = htmlContentLength(spoilerText + content);\n  const mediaLength = mediaAttachments?.length ? MEDIA_VIRTUAL_LENGTH : 0;\n  const pollLength = (poll?.options?.length || 0) * POLL_VIRTUAL_LENGTH;\n  const cardLength =\n    card && (mediaAttachments?.length || poll?.options?.length)\n      ? 0\n      : CARD_VIRTUAL_LENGTH;\n  const totalLength = length + mediaLength + pollLength + cardLength;\n  const weight = totalLength / WEIGHT_SEGMENT;\n  statusWeightCache.set(status.id, weight);\n  return weight;\n}\n\nexport default memo(StatusPage);\n","import { useParams } from 'react-router-dom';\n\nimport Status from './status';\n\nexport default function StatusRoute() {\n  const params = useParams();\n  const { id, instance } = params;\n  return <Status id={id} instance={instance} />;\n}\n","export default \"__VITE_ASSET__BbkKeAoc__\"","export default \"__VITE_ASSET__MUCjVR2Z__\"","export default \"__VITE_ASSET__Pb$jWfr9__\"","export default \"__VITE_ASSET__DJIucEyS__\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e\"","import './welcome.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport boostsCarouselUrl from '../assets/features/boosts-carousel.jpg';\nimport catchupUrl from '../assets/features/catch-up.png';\nimport multiColumnUrl from '../assets/features/multi-column.jpg';\nimport multiHashtagTimelineUrl from '../assets/features/multi-hashtag-timeline.jpg';\nimport nestedCommentsThreadUrl from '../assets/features/nested-comments-thread.jpg';\nimport logo from '../assets/logo.svg';\nimport logoText from '../assets/logo-text.svg';\n\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport states from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst {\n  PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE,\n  PHANPY_WEBSITE: WEBSITE,\n  PHANPY_PRIVACY_POLICY_URL: PRIVACY_POLICY_URL,\n  PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL: DEFAULT_INSTANCE_REGISTRATION_URL,\n} = import.meta.env;\nconst appSite = WEBSITE\n  ? WEBSITE.replace(/https?:\\/\\//g, '').replace(/\\/$/, '')\n  : null;\nconst sameSite = WEBSITE\n  ? WEBSITE.toLowerCase().includes(location.hostname)\n  : false;\nconst appVersion = __COMMIT_TIME__\n  ? `${__COMMIT_TIME__.slice(0, 10).replace(/-/g, '.')}${\n      __COMMIT_HASH__ ? `.${__COMMIT_HASH__}` : ''\n    }`\n  : null;\n\nfunction Welcome() {\n  const { t } = useLingui();\n  useTitle(null, ['/', '/welcome']);\n  return (\n    <main id=\"welcome\">\n      <div class=\"hero-container\">\n        <div class=\"hero-content\">\n          <h1>\n            <img\n              src={logo}\n              alt=\"\"\n              width=\"160\"\n              height=\"160\"\n              style={{\n                aspectRatio: '1/1',\n                marginBlockEnd: -16,\n              }}\n            />\n            <img src={logoText} alt=\"Phanpy\" width=\"200\" />\n          </h1>\n          <p class=\"desc\">\n            <Trans>A minimalistic opinionated Mastodon web client.</Trans>\n          </p>\n          <p>\n            <Link\n              to={\n                DEFAULT_INSTANCE\n                  ? `/login?instance=${DEFAULT_INSTANCE}&submit=1`\n                  : '/login'\n              }\n              class=\"button\"\n            >\n              {DEFAULT_INSTANCE ? t`Log in` : t`Log in with Mastodon`}\n            </Link>\n          </p>\n          {DEFAULT_INSTANCE && DEFAULT_INSTANCE_REGISTRATION_URL && (\n            <p>\n              <a href={DEFAULT_INSTANCE_REGISTRATION_URL} class=\"button plain5\">\n                <Trans>Sign up</Trans>\n              </a>\n            </p>\n          )}\n          {!DEFAULT_INSTANCE && (\n            <p class=\"insignificant\">\n              <small>\n                <Trans>\n                  Connect your existing Mastodon/Fediverse account.\n                  <br />\n                  Your credentials are not stored on this server.\n                </Trans>\n              </small>\n            </p>\n          )}\n        </div>\n        {(appSite || appVersion) && (\n          <p class=\"app-site-version\">\n            <small>\n              {sameSite ? appSite : ''} {appVersion}\n            </small>\n          </p>\n        )}\n        <p>\n          <Trans>\n            <a href=\"https://github.com/cheeaun/phanpy\" target=\"_blank\">\n              Built\n            </a>{' '}\n            by{' '}\n            <a\n              href=\"https://mastodon.social/@cheeaun\"\n              target=\"_blank\"\n              onClick={(e) => {\n                e.preventDefault();\n                states.showAccount = 'cheeaun@mastodon.social';\n              }}\n            >\n              @cheeaun\n            </a>\n            .{' '}\n            <a href={PRIVACY_POLICY_URL} target=\"_blank\">\n              Privacy Policy\n            </a>\n            .\n          </Trans>\n        </p>\n        <div>\n          <LangSelector />\n        </div>\n      </div>\n      <div id=\"why-container\">\n        <div class=\"sections\">\n          <section>\n            <img\n              src={boostsCarouselUrl}\n              alt={t`Screenshot of Boosts Carousel`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Boosts Carousel</Trans>\n            </h4>\n            <p>\n              <Trans>\n                Visually separate original posts and re-shared posts (boosted\n                posts).\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={catchupUrl}\n              alt={t`Screenshot of Catch-up`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Catch-up</Trans>\n            </h4>\n            <p>\n              <Trans>\n                A separate timeline for followings. Email-inspired interface to\n                sort and filter posts.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={nestedCommentsThreadUrl}\n              alt={t`Screenshot of nested comments thread`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Nested comments thread</Trans>\n            </h4>\n            <p>\n              <Trans>\n                Effortlessly follow conversations. Semi-collapsible replies.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={multiColumnUrl}\n              alt={t`Screenshot of multi-column UI`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Single or multi-column</Trans>\n            </h4>\n            <p>\n              <Trans>\n                By default, single column for zen-mode seekers. Configurable\n                multi-column for power users.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={multiHashtagTimelineUrl}\n              alt={t`Screenshot of multi-hashtag timeline with a form to add more hashtags`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Multi-hashtag timeline</Trans>\n            </h4>\n            <p>\n              <Trans>Up to 5 hashtags combined into a single timeline.</Trans>\n            </p>\n          </section>\n        </div>\n      </div>\n    </main>\n  );\n}\n\nexport default Welcome;\n","// Replace alert() with toastify-js\nimport Toastify from 'toastify-js';\n\nconst nativeAlert = window.alert;\nif (!window.__nativeAlert) window.__nativeAlert = nativeAlert;\n\nwindow.alert = function (message) {\n  console.debug(\n    'ALERT: This is a custom alert() function. Native alert() is still available as window.__nativeAlert()',\n  );\n  // If Error object, show the message\n  if (message instanceof Error && message?.message) {\n    message = message.message;\n  }\n  // If not string, stringify it\n  if (typeof message !== 'string') {\n    message = JSON.stringify(message);\n  }\n\n  const toast = Toastify({\n    text: message,\n    className: 'alert',\n    gravity: 'top',\n    position: 'center',\n    duration: 10_000,\n    offset: {\n      y: 48,\n    },\n    onClick: () => {\n      toast.hideToast();\n    },\n  });\n  toast.showToast();\n};\n","import './app.css';\n\nimport { useLingui } from '@lingui/react';\nimport debounce from 'just-debounce-it';\nimport { lazy, memo, Suspense } from 'preact/compat';\nimport {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { matchPath, Route, Routes, useLocation } from 'react-router-dom';\n\nimport 'swiped-events';\n\nimport { subscribe } from 'valtio';\n\nimport BackgroundService from './components/background-service';\nimport ComposeButton from './components/compose-button';\nimport { ICONS } from './components/ICONS';\nimport KeyboardShortcutsHelp from './components/keyboard-shortcuts-help';\nimport Loader from './components/loader';\nimport Modals from './components/modals';\nimport NavigationCommand from './components/navigation-command';\nimport NotificationService from './components/notification-service';\nimport SearchCommand from './components/search-command';\nimport Shortcuts from './components/shortcuts';\nimport NotFound from './pages/404';\nimport AccountStatuses from './pages/account-statuses';\nimport AnnualReport from './pages/annual-report';\nimport Bookmarks from './pages/bookmarks';\nimport Catchup from './pages/catchup';\nimport Favourites from './pages/favourites';\nimport Filters from './pages/filters';\nimport FollowedHashtags from './pages/followed-hashtags';\nimport Following from './pages/following';\nimport Hashtag from './pages/hashtag';\nimport Home from './pages/home';\nimport HttpRoute from './pages/http-route';\nimport List from './pages/list';\nimport Lists from './pages/lists';\nimport Login from './pages/login';\nimport Mentions from './pages/mentions';\nimport Notifications from './pages/notifications';\nimport Public from './pages/public';\nimport ScheduledPosts from './pages/scheduled-posts';\nimport Search from './pages/search';\nimport StatusRoute from './pages/status-route';\nimport Trending from './pages/trending';\nimport Welcome from './pages/welcome';\nimport {\n  api,\n  hasInstance,\n  hasPreferences,\n  initAccount,\n  initClient,\n  initInstance,\n  initPreferences,\n} from './utils/api';\nimport { getAccessToken } from './utils/auth';\nimport focusDeck from './utils/focus-deck';\nimport states, { hideAllModals, initStates, statusKey } from './utils/states';\nimport store from './utils/store';\nimport {\n  getAccount,\n  getCredentialApplication,\n  getCurrentAccount,\n  getVapidKey,\n  setCurrentAccountID,\n} from './utils/store-utils';\n\nimport './utils/toast-alert';\n\n// Lazy load Sandbox component only in development\nconst Sandbox =\n  import.meta.env.DEV || import.meta.env.PHANPY_DEV\n    ? lazy(() => import('./pages/sandbox'))\n    : () => null;\n\n// Lazy load YearInPosts component\nconst YearInPosts = lazy(() => import('./pages/year-in-posts'));\n\n// QR Scan Test component for development\nfunction QrScanTest() {\n  useEffect(() => {\n    states.showQrScannerModal = {\n      onClose: ({ text } = {}) => {\n        hideAllModals();\n        location.hash = text ? `/${text}` : '/';\n      },\n    };\n  }, []);\n\n  return null;\n}\n\nwindow.__STATES__ = states;\nwindow.__STATES_STATS__ = () => {\n  const keys = [\n    'statuses',\n    'accounts',\n    'spoilers',\n    'unfurledLinks',\n    'statusQuotes',\n  ];\n  const counts = {};\n  keys.forEach((key) => {\n    counts[key] = Object.keys(states[key]).length;\n  });\n  console.warn('STATE stats', counts);\n\n  const { statuses } = states;\n  const unmountedPosts = [];\n  for (const key in statuses) {\n    const $post = document.querySelector(\n      `[data-state-post-id~=\"${key}\"], [data-state-post-ids~=\"${key}\"]`,\n    );\n    if (!$post) {\n      unmountedPosts.push(key);\n    }\n  }\n  console.warn('Unmounted posts', unmountedPosts.length, unmountedPosts);\n};\n\n// Experimental \"garbage collection\" for states\n// Every 15 minutes\n// Only posts for now\nsetInterval(\n  () => {\n    if (!window.__IDLE__) return;\n    const { statuses, unfurledLinks, notifications } = states;\n    let keysCount = 0;\n    const { instance } = api();\n    for (const key in statuses) {\n      if (!window.__IDLE__) break;\n      try {\n        const $post = document.querySelector(\n          `[data-state-post-id~=\"${key}\"], [data-state-post-ids~=\"${key}\"]`,\n        );\n        const postInNotifications = notifications.some(\n          (n) => key === statusKey(n.status?.id, instance),\n        );\n        if (!$post && !postInNotifications) {\n          delete states.statuses[key];\n          delete states.statusQuotes[key];\n          for (const link in unfurledLinks) {\n            const unfurled = unfurledLinks[link];\n            const sKey = statusKey(unfurled.id, unfurled.instance);\n            if (sKey === key) {\n              delete states.unfurledLinks[link];\n              break;\n            }\n          }\n          keysCount++;\n        }\n      } catch (e) {}\n    }\n    if (keysCount) {\n      console.info(`GC: Removed ${keysCount} keys`);\n    }\n  },\n  15 * 60 * 1000,\n);\n\n// Preload icons\n// There's probably a better way to do this\n// Related: https://github.com/vitejs/vite/issues/10600\nsetTimeout(() => {\n  for (const icon in ICONS) {\n    setTimeout(() => {\n      if (Array.isArray(ICONS[icon])) {\n        ICONS[icon][0]?.();\n      } else if (typeof ICONS[icon] === 'object') {\n        ICONS[icon].module?.();\n      } else {\n        ICONS[icon]?.();\n      }\n    }, 1);\n  }\n}, 5000);\n\n(() => {\n  window.__IDLE__ = true;\n  const nonIdleEvents = [\n    'mousemove',\n    'mousedown',\n    'resize',\n    'keydown',\n    'touchstart',\n    'pointerdown',\n    'pointermove',\n    'wheel',\n  ];\n  const setIdle = () => {\n    window.__IDLE__ = true;\n  };\n  const IDLE_TIME = 3_000; // 3 seconds\n  const debouncedSetIdle = debounce(setIdle, IDLE_TIME);\n  const onNonIdle = () => {\n    window.__IDLE__ = false;\n    debouncedSetIdle();\n  };\n  nonIdleEvents.forEach((event) => {\n    window.addEventListener(event, onNonIdle, {\n      passive: true,\n      capture: true,\n    });\n  });\n  window.addEventListener('blur', setIdle, {\n    passive: true,\n  });\n  // When cursor leaves the window, set idle\n  document.documentElement.addEventListener(\n    'mouseleave',\n    (e) => {\n      if (!e.relatedTarget && !e.toElement) {\n        setIdle();\n      }\n    },\n    {\n      passive: true,\n    },\n  );\n  // document.addEventListener(\n  //   'visibilitychange',\n  //   () => {\n  //     if (document.visibilityState === 'visible') {\n  //       onNonIdle();\n  //     }\n  //   },\n  //   {\n  //     passive: true,\n  //   },\n  // );\n})();\n\n// Possible fix for iOS PWA theme-color bug\n// It changes when loading web pages in \"webview\"\nconst isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\nif (isIOS) {\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState === 'visible') {\n      // Don't reset theme color if media modal is showing\n      // Media modal will set its own theme color based on the media's color\n      const showingMediaModal =\n        document.getElementsByClassName('media-modal-container').length > 0;\n      if (showingMediaModal) return;\n\n      const theme = store.local.get('theme');\n      let $meta;\n      if (theme) {\n        // Get current meta\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][data-theme-setting=\"manual\"]`,\n        );\n        if ($meta) {\n          const color = $meta.content;\n          const tempColor =\n            theme === 'light'\n              ? $meta.dataset.themeLightColorTemp\n              : $meta.dataset.themeDarkColorTemp;\n          $meta.content = tempColor || '';\n          setTimeout(() => {\n            $meta.content = color;\n          }, 10);\n        }\n      } else {\n        // Get current color scheme\n        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        // Get current theme-color\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][media*=\"${colorScheme}\"]`,\n        );\n        if ($meta) {\n          const color = $meta.dataset.content;\n          const tempColor = $meta.dataset.contentTemp;\n          $meta.content = tempColor || '';\n          setTimeout(() => {\n            $meta.content = color;\n          }, 10);\n        }\n      }\n    }\n  });\n}\n\n{\n  const theme = store.local.get('theme');\n  // If there's a theme, it's NOT auto\n  if (theme) {\n    // dark | light\n    document.documentElement.classList.add(`is-${theme}`);\n    document\n      .querySelector('meta[name=\"color-scheme\"]')\n      .setAttribute('content', theme || 'light dark');\n\n    // Enable manual theme <meta>\n    const $manualMeta = document.querySelector(\n      'meta[data-theme-setting=\"manual\"]',\n    );\n    if ($manualMeta) {\n      $manualMeta.name = 'theme-color';\n      $manualMeta.content =\n        theme === 'light'\n          ? $manualMeta.dataset.themeLightColor\n          : $manualMeta.dataset.themeDarkColor;\n    }\n    // Disable auto theme <meta>s\n    const $autoMetas = document.querySelectorAll(\n      'meta[data-theme-setting=\"auto\"]',\n    );\n    $autoMetas.forEach((m) => {\n      m.name = '';\n    });\n  }\n  const textSize = store.local.get('textSize');\n  if (textSize) {\n    document.documentElement.style.setProperty('--text-size', `${textSize}px`);\n  }\n}\n\nsubscribe(states, (changes) => {\n  for (const [action, path, value, prevValue] of changes) {\n    // Change #app dataset based on settings.shortcutsViewMode\n    if (path.join('.') === 'settings.shortcutsViewMode') {\n      const $app = document.getElementById('app');\n      if ($app) {\n        $app.dataset.shortcutsViewMode = states.shortcuts?.length ? value : '';\n      }\n    }\n\n    // Add/Remove cloak class to body\n    if (path.join('.') === 'settings.cloakMode') {\n      const $body = document.body;\n      $body.classList.toggle('cloak', value);\n    }\n  }\n});\n\nconst BENCHES = new Map();\nwindow.__BENCH_RESULTS = new Map();\nwindow.__BENCHMARK = {\n  start(name) {\n    if (!import.meta.env.DEV && !import.meta.env.PHANPY_DEV) return;\n    // If already started, ignore\n    if (BENCHES.has(name)) return;\n    const start = performance.now();\n    BENCHES.set(name, start);\n  },\n  end(name) {\n    if (!import.meta.env.DEV && !import.meta.env.PHANPY_DEV) return;\n    const start = BENCHES.get(name);\n    if (start) {\n      const end = performance.now();\n      const duration = end - start;\n      __BENCH_RESULTS.set(name, duration);\n      BENCHES.delete(name);\n    }\n  },\n};\n\nif (import.meta.env.DEV) {\n  // If press shift down, set --time-scale to 10 in root\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Shift') {\n      document.documentElement.classList.add('slow-mo');\n    }\n  });\n  document.addEventListener('keyup', (e) => {\n    if (e.key === 'Shift') {\n      document.documentElement.classList.remove('slow-mo');\n    }\n  });\n}\n\n{\n  // Temporary Experiments\n  // May be removed in the future\n  document.body.classList.toggle(\n    'exp-tab-bar-v2',\n    store.local.get('experiments-tabBarV2') ?? false,\n  );\n}\n\n// const isPWA = true; // testing\nconst isPWA =\n  window.matchMedia('(display-mode: standalone)').matches ||\n  window.navigator.standalone === true;\nconst PATH_RESTORE_TIME_LIMIT = 1 * 60 * 60 * 1000; // 1 hour, should be good enough\n\nfunction App() {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [uiState, setUIState] = useState('loading');\n  __BENCHMARK.start('app-init');\n  __BENCHMARK.start('time-to-following');\n  __BENCHMARK.start('time-to-home');\n  __BENCHMARK.start('time-to-isLoggedIn');\n  useLingui();\n\n  useEffect(() => {\n    const instanceURL = store.local.get('instanceURL');\n    const code = decodeURIComponent(\n      (window.location.search.match(/code=([^&]+)/) || [, ''])[1],\n    );\n\n    if (code) {\n      console.log({ code });\n\n      const isPopup = window.opener && !window.opener.closed;\n\n      if (isPopup) {\n        try {\n          window.opener.postMessage(\n            {\n              type: 'oauth-callback',\n              code: code,\n            },\n            window.location.origin,\n          );\n          setTimeout(() => {\n            window.close();\n          }, 100);\n        } catch (e) {\n          console.error('Failed to send message to parent window:', e);\n          window.close();\n        }\n        return;\n      }\n\n      // Clear the code from the URL\n      window.history.replaceState(\n        {},\n        document.title,\n        window.location.pathname || '/',\n      );\n\n      const {\n        client_id: clientID,\n        client_secret: clientSecret,\n        vapid_key,\n      } = getCredentialApplication(instanceURL) || {};\n      const vapidKey = getVapidKey(instanceURL) || vapid_key;\n      const verifier = store.sessionCookie.get('codeVerifier');\n\n      (async () => {\n        setUIState('loading');\n        const { access_token: accessToken } = await getAccessToken({\n          instanceURL,\n          client_id: clientID,\n          client_secret: clientSecret,\n          code,\n          code_verifier: verifier || undefined,\n        });\n\n        if (accessToken) {\n          const client = initClient({ instance: instanceURL, accessToken });\n          await Promise.allSettled([\n            initPreferences(client),\n            initInstance(client, instanceURL),\n            initAccount(client, instanceURL, accessToken, vapidKey),\n          ]);\n          initStates();\n          window.__IGNORE_GET_ACCOUNT_ERROR__ = true;\n\n          setIsLoggedIn(true);\n          setUIState('default');\n        } else {\n          setUIState('error');\n        }\n        __BENCHMARK.end('app-init');\n      })();\n    } else {\n      window.__IGNORE_GET_ACCOUNT_ERROR__ = true;\n      const searchAccount = decodeURIComponent(\n        (window.location.search.match(/account=([^&]+)/) || [, ''])[1],\n      );\n      let account;\n      if (searchAccount) {\n        account = getAccount(searchAccount);\n        console.log('searchAccount', searchAccount, account);\n        if (account) {\n          setCurrentAccountID(account.info.id);\n          window.history.replaceState(\n            {},\n            document.title,\n            window.location.pathname || '/',\n          );\n        }\n      }\n      if (!account) {\n        account = getCurrentAccount();\n      }\n      if (account) {\n        setCurrentAccountID(account.info.id);\n        const { client } = api({ account });\n        const { instance } = client;\n        // console.log('masto', masto);\n        initStates();\n        setUIState('loading');\n        (async () => {\n          try {\n            if (hasPreferences() && hasInstance(instance)) {\n              // Non-blocking\n              initPreferences(client);\n              initInstance(client, instance);\n            } else {\n              await Promise.allSettled([\n                initPreferences(client),\n                initInstance(client, instance),\n              ]);\n            }\n          } catch (e) {\n          } finally {\n            setIsLoggedIn(true);\n            setUIState('default');\n            __BENCHMARK.end('app-init');\n          }\n        })();\n      } else {\n        setUIState('default');\n        __BENCHMARK.end('app-init');\n      }\n    }\n\n    // Cleanup\n    store.sessionCookie.del('clientID');\n    store.sessionCookie.del('clientSecret');\n    store.sessionCookie.del('codeVerifier');\n  }, []);\n\n  let location = useLocation();\n  states.currentLocation = location.pathname;\n  // useLayoutEffect(() => {\n  //   states.currentLocation = location.pathname;\n  // }, [location.pathname]);\n\n  useEffect(focusDeck, [location, isLoggedIn]);\n\n  // Save last page for PWA restoration\n  const restoredRef = useRef(false);\n  const lastPathKey = 'pwaLastPath';\n  useEffect(() => {\n    if (!restoredRef.current) return;\n    // console.log('location.pathname', location.pathname);\n    if (isPWA && isLoggedIn) {\n      if (isRootPath(location.pathname)) {\n        store.local.del(lastPathKey);\n      } else {\n        store.local.setJSON(lastPathKey, {\n          path: location.pathname + location.search,\n          lastAccessed: Date.now(),\n        });\n      }\n    }\n  }, [location.pathname, location.search, isLoggedIn]);\n\n  // Restore last page on PWA reopen\n  useEffect(() => {\n    if (restoredRef.current) return;\n    const isRootPath = !location.pathname || location.pathname === '/';\n    if (!isRootPath) return;\n    if (isPWA && isLoggedIn && uiState === 'default') {\n      const lastPath = store.local.getJSON(lastPathKey);\n      if (lastPath) {\n        setTimeout(() => {\n          if (lastPath?.path) {\n            const timeSinceLastAccess =\n              Date.now() - (lastPath.lastAccessed || 0);\n            if (timeSinceLastAccess < PATH_RESTORE_TIME_LIMIT) {\n              window.location.hash = lastPath.path;\n            }\n          }\n          store.local.del(lastPathKey);\n        }, 300);\n      }\n      restoredRef.current = true;\n    }\n  }, [uiState, isLoggedIn]);\n\n  if (/\\/https?:/.test(location.pathname)) {\n    return <HttpRoute />;\n  }\n\n  if (uiState === 'loading') {\n    return <Loader id=\"loader-root\" />;\n  }\n\n  return (\n    <>\n      <PrimaryRoutes isLoggedIn={isLoggedIn} />\n      <SecondaryRoutes isLoggedIn={isLoggedIn} />\n      <Routes>\n        <Route path=\"/:instance?/s/:id\" element={<StatusRoute />} />\n      </Routes>\n      {isLoggedIn && <ComposeButton />}\n      {isLoggedIn && <Shortcuts />}\n      <Modals />\n      {isLoggedIn && <NotificationService />}\n      <BackgroundService isLoggedIn={isLoggedIn} />\n      {isLoggedIn && <NavigationCommand />}\n      <SearchCommand onClose={focusDeck} />\n      <KeyboardShortcutsHelp />\n    </>\n  );\n}\n\nfunction Root({ isLoggedIn }) {\n  if (isLoggedIn) {\n    __BENCHMARK.end('time-to-isLoggedIn');\n  }\n  return isLoggedIn ? <Home /> : <Welcome />;\n}\n\nfunction isRootPath(pathname) {\n  return /^\\/(login|welcome|_sandbox|_qr-scan)/i.test(pathname);\n}\n\nconst PrimaryRoutes = memo(({ isLoggedIn }) => {\n  const location = useLocation();\n  const nonRootLocation = useMemo(() => {\n    const { pathname } = location;\n    return !isRootPath(pathname);\n  }, [location]);\n\n  return (\n    <Routes location={nonRootLocation || location}>\n      <Route path=\"/\" element={<Root isLoggedIn={isLoggedIn} />} />\n      <Route path=\"/login\" element={<Login />} />\n      <Route path=\"/welcome\" element={<Welcome />} />\n      {(import.meta.env.DEV || import.meta.env.PHANPY_DEV) && (\n        <>\n          <Route\n            path=\"/_sandbox\"\n            element={\n              <Suspense fallback={<Loader id=\"loader-sandbox\" />}>\n                <Sandbox />\n              </Suspense>\n            }\n          />\n          <Route path=\"/_qr-scan\" element={<QrScanTest />} />\n        </>\n      )}\n    </Routes>\n  );\n});\n\nfunction getPrevLocation() {\n  return states.prevLocation || null;\n}\nfunction SecondaryRoutes({ isLoggedIn }) {\n  // const snapStates = useSnapshot(states);\n  const location = useLocation();\n  // const prevLocation = snapStates.prevLocation;\n  const backgroundLocation = useRef(getPrevLocation());\n\n  const isModalPage = useMemo(() => {\n    return (\n      matchPath('/:instance/s/:id', location.pathname) ||\n      matchPath('/s/:id', location.pathname)\n    );\n  }, [location.pathname, matchPath]);\n  if (isModalPage) {\n    if (!backgroundLocation.current)\n      backgroundLocation.current = getPrevLocation();\n  } else {\n    backgroundLocation.current = null;\n  }\n  console.debug({\n    backgroundLocation: backgroundLocation.current,\n    location,\n  });\n\n  return (\n    <Routes location={backgroundLocation.current || location}>\n      {isLoggedIn && (\n        <>\n          <Route path=\"/notifications\" element={<Notifications />} />\n          <Route path=\"/mentions\" element={<Mentions />} />\n          <Route path=\"/following\" element={<Following />} />\n          <Route path=\"/b\" element={<Bookmarks />} />\n          <Route path=\"/f\" element={<Favourites />} />\n          <Route path=\"/l\">\n            <Route index element={<Lists />} />\n            <Route path=\":id\" element={<List />} />\n          </Route>\n          <Route path=\"/fh\" element={<FollowedHashtags />} />\n          <Route path=\"/sp\" element={<ScheduledPosts />} />\n          <Route path=\"/ft\" element={<Filters />} />\n          <Route path=\"/catchup\" element={<Catchup />} />\n          <Route\n            path=\"/yip\"\n            element={\n              <Suspense\n                fallback={\n                  <div\n                    id=\"year-in-posts-page\"\n                    class=\"deck-container\"\n                    tabIndex=\"-1\"\n                  >\n                    {/* Prevent flash of no background as this is lazy-loaded */}\n                    <Loader />\n                  </div>\n                }\n              >\n                <YearInPosts />\n              </Suspense>\n            }\n          />\n          <Route path=\"/annual_report/:year\" element={<AnnualReport />} />\n        </>\n      )}\n      <Route path=\"/:instance?/t/:hashtag\" element={<Hashtag />} />\n      <Route path=\"/:instance?/a/:id\" element={<AccountStatuses />} />\n      <Route path=\"/:instance?/p\">\n        <Route index element={<Public />} />\n        <Route path=\"l\" element={<Public local />} />\n      </Route>\n      <Route path=\"/:instance?/trending\" element={<Trending />} />\n      <Route path=\"/:instance?/search\" element={<Search />} />\n      {/* <Route path=\"/:anything\" element={<NotFound />} /> */}\n    </Routes>\n  );\n}\n\nexport { App };\n","import './index.css';\nimport './cloak-mode.css';\nimport './polyfills';\n\nimport { i18n } from '@lingui/core';\nimport { I18nProvider } from '@lingui/react';\n// Polyfill needed for Firefox < 122\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1423593\n// import '@formatjs/intl-segmenter/polyfill';\nimport { render } from 'preact';\nimport { HashRouter } from 'react-router-dom';\n\nimport { App } from './app';\nimport { IconSpriteProvider } from './components/icon-sprite-manager';\nimport { initActivateLang } from './utils/lang';\nimport { initPWAViewport } from './utils/pwa-viewport';\n\ninitActivateLang();\ninitPWAViewport();\n\nif (import.meta.env.DEV) {\n  import('preact/debug');\n}\n\nrender(\n  <I18nProvider i18n={i18n}>\n    <HashRouter>\n      <IconSpriteProvider>\n        <App />\n      </IconSpriteProvider>\n    </HashRouter>\n  </I18nProvider>,\n  document.getElementById('app'),\n);\n\n// Storage cleanup\nsetTimeout(() => {\n  try {\n    // Clean up old settings key\n    localStorage.removeItem('settings-groupedNotificationsAlpha');\n  } catch (e) {}\n}, 5000);\n\n// Service worker cache cleanup\nif ('serviceWorker' in navigator && typeof caches !== 'undefined') {\n  const MAX_SW_CACHE_SIZE = 50;\n  const IGNORE_CACHE_KEYS = ['icons'];\n  let clearRanOnce = false;\n  const FAST_INTERVAL = 10_000; // 10 seconds\n  const SLOW_INTERVAL = 60 * 60 * 1000; // 1 hour\n  async function clearCaches() {\n    if (window.__IDLE__) {\n      try {\n        const keys = await caches.keys();\n        for (const key of keys) {\n          if (IGNORE_CACHE_KEYS.includes(key)) continue;\n          const cache = await caches.open(key);\n          const _keys = await cache.keys();\n          if (_keys.length > MAX_SW_CACHE_SIZE) {\n            console.warn('Cleaning cache', key, _keys.length);\n            const deleteKeys = _keys.slice(MAX_SW_CACHE_SIZE);\n            for (const deleteKey of deleteKeys) {\n              await cache.delete(deleteKey);\n            }\n          }\n        }\n        clearRanOnce = true;\n      } catch (e) {} // Silent fail\n    }\n    // Once cleared, clear again at slower interval\n    setTimeout(clearCaches, clearRanOnce ? SLOW_INTERVAL : FAST_INTERVAL);\n  }\n  setTimeout(clearCaches, FAST_INTERVAL);\n}\n\nwindow.__CLOAK__ = () => {\n  document.body.classList.toggle('cloak');\n};\n"],"file":"main-CTqQNjfH.js"}